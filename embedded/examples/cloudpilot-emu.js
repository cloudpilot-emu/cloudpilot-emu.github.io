!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cloudpilot=e():t.cloudpilot=e()}(self,()=>(()=>{var t={84:(t,e,r)=>{"use strict";var i=r(360);e.J=i.default},360:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=[];r[0]=function(){return function(){}},r[1]=function(t,e){return void 0===e?t:function(r){t(r,e)}};var i=function(){function t(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return t.prototype.addHandler=function(t,e){return this.isHandlerAttached(t,e)||(this._handlers.push(t),this._contexts.push(e),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.removeHandler=function(t,e){var r=this._getHandlerIndex(t,e);return void 0!==r&&(this._handlers.splice(r,1),this._contexts.splice(r,1),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.isHandlerAttached=function(t,e){return void 0!==this._getHandlerIndex(t,e)},t.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},t.prototype._getHandlerIndex=function(t,e){var r,i=this._handlers.length;for(r=0;r<i&&(this._handlers[r]!==t||this._contexts[r]!==e);r++);return r<i?r:void 0},t.prototype._createDispatcher=function(){var t;this.dispatch=(t=this._handlers.length,r[t]||(r[t]=function(t){for(var e="return function dispatcher"+t+"(payload) {\n",r=[],i=[],n=0;n<t;n++)r.push("cb"+n),i.push("ctx"+n),e+="    cb"+n+"(payload, ctx"+n+");\n";return e+="};",new(Function.bind.apply(Function,[void 0].concat(r.concat(i),[e])))}(t)),r[t]).apply(this,this._handlers.concat(this._contexts))},t}();e.default=i},389:function(t,e){!function(t){"use strict";var e,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,i=536870912,n=1073741824,o=new WeakMap,s=function(t,e){return function(o){var s=e.get(o),a=void 0===s?o.size:s<n?s+1:0;if(!o.has(a))return t(o,a);if(o.size<i){for(;o.has(a);)a=Math.floor(Math.random()*n);return t(o,a)}if(o.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(a);)a=Math.floor(Math.random()*r);return t(o,a)}}((e=o,function(t,r){return e.set(t,r),r}),o),a=function(t){return function(e){var r=t(e);return e.add(r),r}}(s);t.addUniqueNumber=a,t.generateUniqueNumber=s}(e)},666:t=>{var e,r=(e="undefined"!=typeof document?document.currentScript?.src:void 0,async function(t={}){var r=t,i="object"==typeof window,n="undefined"!=typeof WorkerGlobalScope,o=("object"==typeof process&&process.versions?.node&&process.type,"./this.program"),s=(t,e)=>{throw e};n&&(e=self.location.href);var a,c,p="";if(i||n){try{p=new URL(".",e).href}catch{}n&&(c=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),a=async t=>{var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)}}var u,l,h,d,m,y,_,f,v,g,b,S=console.log.bind(console),w=console.error.bind(console),C=!1;function I(t,e){t||M(e)}function E(){if(!C){var t=Wi();0==t&&(t+=4);var e=v[t>>2],r=v[t+4>>2];34821223==e&&2310721022==r||M(`Stack overflow! Stack cookie has been overwritten at ${j(t)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${j(r)} ${j(e)}`),1668509029!=v[0]&&M("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var D=!1;function G(){var t=m.buffer;y=new Int8Array(t),new Int16Array(t),r.HEAPU8=_=new Uint8Array(t),new Uint16Array(t),f=new Int32Array(t),r.HEAPU32=v=new Uint32Array(t),new Float32Array(t),g=new Float64Array(t),b=new BigInt64Array(t),new BigUint64Array(t)}var P,x=0,k=null;function M(t){r.onAbort?.(t),w(t="Aborted("+t+")"),C=!0,t+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(t);throw d?.(e),e}async function R(t,e,r){if(!t&&"function"==typeof WebAssembly.instantiateStreaming)try{var i=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(i,r)}catch(t){w(`wasm streaming compile failed: ${t}`),w("falling back to ArrayBuffer instantiation")}return async function(t,e){try{var r=await async function(t){if(!u)try{var e=await a(t);return new Uint8Array(e)}catch{}return function(t){if(t==P&&u)return new Uint8Array(u);if(c)return c(t);throw"both async and sync fetching of the wasm failed"}(t)}(t);return await WebAssembly.instantiate(r,e)}catch(t){w(`failed to asynchronously prepare wasm: ${t}`),M(t)}}(e,r)}class z{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var T,H,A=t=>{for(;t.length>0;)t.shift()(r)},B=[],N=t=>B.push(t),L=[],U=t=>L.push(t),F=!0,j=t=>"0x"+(t>>>=0).toString(16).padStart(8,"0"),O="undefined"!=typeof TextDecoder?new TextDecoder:void 0,W=(t,e=0,r=NaN)=>{for(var i=e+r,n=e;t[n]&&!(n>=i);)++n;if(n-e>16&&t.buffer&&O)return O.decode(t.subarray(e,n));for(var o="";e<n;){var s=t[e++];if(128&s){var a=63&t[e++];if(192!=(224&s)){var c=63&t[e++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&t[e++])<65536)o+=String.fromCharCode(s);else{var p=s-65536;o+=String.fromCharCode(55296|p>>10,56320|1023&p)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o},V=(t,e)=>t?W(_,t,e):"",q=t=>t<-9007199254740992||t>9007199254740992?NaN:Number(t),K=0,$=[0,31,60,91,121,152,182,213,244,274,305,335],Q=[0,31,59,90,120,151,181,212,243,273,304,334],Y=t=>{var e;return((e=t.getFullYear())%4!=0||e%100==0&&e%400!=0?Q:$)[t.getMonth()]+t.getDate()-1},Z={},J=t=>{if(t instanceof z||"unwind"==t)return l;E(),t instanceof WebAssembly.RuntimeError&&Ki()<=0&&w("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 1048576)"),s(0,t)},X=()=>F||K>0,tt=t=>{l=t,X()||(r.onExit?.(t),C=!0),s(0,new z(t))},et=(t,e)=>{l=t,tt(t)},rt=et,it=()=>performance.now(),nt=(t,e,r,i)=>{if(!(i>0))return 0;for(var n=r,o=r+i-1,s=0;s<t.length;++s){var a=t.codePointAt(s);if(a<=127){if(r>=o)break;e[r++]=a}else if(a<=2047){if(r+1>=o)break;e[r++]=192|a>>6,e[r++]=128|63&a}else if(a<=65535){if(r+2>=o)break;e[r++]=224|a>>12,e[r++]=128|a>>6&63,e[r++]=128|63&a}else{if(r+3>=o)break;e[r++]=240|a>>18,e[r++]=128|a>>12&63,e[r++]=128|a>>6&63,e[r++]=128|63&a,s++}}return e[r]=0,r-n},ot=(t,e,r)=>nt(t,_,e,r),st=()=>Date.now(),at=[],ct=(t,e)=>Math.ceil(t/e)*e,pt=t=>{var e=(t-m.buffer.byteLength+65535)/65536|0;try{return m.grow(e),G(),1}catch(t){}},ut={},lt=()=>{if(!lt.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:o||"./this.program"};for(var e in ut)void 0===ut[e]?delete t[e]:t[e]=ut[e];var r=[];for(var e in t)r.push(`${e}=${t[e]}`);lt.strings=r}return lt.strings},ht=t=>{for(var e=0,r=0;r<t.length;++r){var i=t.charCodeAt(r);i<=127?e++:i<=2047?e+=2:i>=55296&&i<=57343?(e+=4,++r):e+=3}return e},dt=[null,[],[]],mt=(t,e)=>{var r=dt[t];0===e||10===e?((1===t?S:w)(W(r)),r.length=0):r.push(e)},yt=[],_t=(t,e)=>{t<128?e.push(t):e.push(t%128|128,t>>7)},ft=[],vt=t=>{var e=ft[t];return e||(ft[t]=e=T.get(t)),e},gt=[],bt=(t,e)=>{T.set(t,e),ft[t]=T.get(t)};r.noExitRuntime&&(F=r.noExitRuntime),r.print&&(S=r.print),r.printErr&&(w=r.printErr),r.wasmBinary&&(u=r.wasmBinary),r.arguments&&r.arguments,r.thisProgram&&(o=r.thisProgram),r.addFunction=(t,e)=>{var r=(t=>(H||(H=new WeakMap,((t,e)=>{if(H)for(var r=0;r<0+e;r++){var i=vt(r);i&&H.set(i,r)}})(0,T.length)),H.get(t)||0))(t);if(r)return r;var i=(()=>{if(gt.length)return gt.pop();try{T.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return T.length-1})();try{bt(i,t)}catch(r){if(!(r instanceof TypeError))throw r;var n=((t,e)=>{if("function"==typeof WebAssembly.Function)return new WebAssembly.Function((t=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},r={parameters:[],results:"v"==t[0]?[]:[e[t[0]]]},i=1;i<t.length;++i)r.parameters.push(e[t[i]]);return r})(e),t);var r=[1];((t,e)=>{var r=t.slice(0,1),i=t.slice(1),n={i:127,p:127,j:126,f:125,d:124,e:111};for(var o of(e.push(96),_t(i.length,e),i))e.push(n[o]);"v"==r?e.push(0):e.push(1,n[r])})(e,r);var i=[0,97,115,109,1,0,0,0,1];_t(r.length,i),i.push(...r),i.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var n=new WebAssembly.Module(new Uint8Array(i));return new WebAssembly.Instance(n,{e:{f:t}}).exports.f})(t,e);bt(i,n)}return H.set(t,i),i},r.UTF8ToString=V;var St,wt,Ct,It,Et,Dt,Gt,Pt,xt,kt,Mt,Rt,zt,Tt,Ht,At,Bt,Nt,Lt,Ut,Ft,jt,Ot,Wt,Vt,qt,Kt,$t,Qt,Yt,Zt,Jt,Xt,te,ee,re,ie,ne,oe,se,ae,ce,pe,ue,le,he,de,me,ye,_e,fe,ve,ge,be,Se,we,Ce,Ie,Ee,De,Ge,Pe,xe,ke,Me,Re,ze,Te,He,Ae,Be,Ne,Le,Ue,Fe,je,Oe,We,Ve,qe,Ke,$e,Qe,Ye,Ze,Je,Xe,tr,er,rr,ir,nr,or,sr,ar,cr,pr,ur,lr,hr,dr,mr,yr,_r,fr,vr,gr,br,Sr,wr,Cr,Ir,Er,Dr,Gr,Pr,xr,kr,Mr,Rr,zr,Tr,Hr,Ar,Br,Nr,Lr,Ur,Fr,jr,Or,Wr,Vr,qr,Kr,$r,Qr,Yr,Zr,Jr,Xr,ti,ei,ri,ii,ni,oi,si,ai,ci,pi,ui,li,hi,di,mi,yi,_i,fi,vi,gi,bi,Si,wi,Ci,Ii,Ei,Di,Gi,Pi,xi,ki,Mi,Ri,zi,Ti,Hi,Ai,Bi,Ni,Li,Ui,Fi,ji,Oi,Wi,Vi,qi,Ki,$i={428784:t=>{T.grow(65536);for(let e=0;e<=65535;e++)T.set(T.length-65535-1+e,T.get(v[(t>>>2)+e]));return T.length-65535-1}},Qi={a:(t,e,r,i)=>M(`Assertion failed: ${V(t)}, at: `+[e?V(e):"unknown filename",r,i?V(i):"unknown function"]),s:function(t){const e=new Error(V(t));throw e.isAssert=!0,e},c:function(t,e){e=q(e)},h:()=>M(""),j:()=>{F=!1,K=0},p:function(t,e){t=q(t);var r=new Date(1e3*t);f[e>>2]=r.getSeconds(),f[e+4>>2]=r.getMinutes(),f[e+8>>2]=r.getHours(),f[e+12>>2]=r.getDate(),f[e+16>>2]=r.getMonth(),f[e+20>>2]=r.getFullYear()-1900,f[e+24>>2]=r.getDay();var i=0|Y(r);f[e+28>>2]=i,f[e+36>>2]=-60*r.getTimezoneOffset();var n=new Date(r.getFullYear(),0,1),o=new Date(r.getFullYear(),6,1).getTimezoneOffset(),s=n.getTimezoneOffset(),a=0|(o!=s&&r.getTimezoneOffset()==Math.min(s,o));f[e+32>>2]=a},q:function(t){var e=(()=>{var e=new Date(f[t+20>>2]+1900,f[t+16>>2],f[t+12>>2],f[t+8>>2],f[t+4>>2],f[t>>2],0),r=f[t+32>>2],i=e.getTimezoneOffset(),n=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),s=n.getTimezoneOffset(),a=Math.min(s,o);if(r<0)f[t+32>>2]=Number(o!=s&&a==i);else if(r>0!=(a==i)){var c=Math.max(s,o),p=r>0?a:c;e.setTime(e.getTime()+6e4*(p-i))}f[t+24>>2]=e.getDay();var u=0|Y(e);f[t+28>>2]=u,f[t>>2]=e.getSeconds(),f[t+4>>2]=e.getMinutes(),f[t+8>>2]=e.getHours(),f[t+12>>2]=e.getDate(),f[t+16>>2]=e.getMonth(),f[t+20>>2]=e.getYear();var l=e.getTime();return isNaN(l)?-1:l/1e3})();return BigInt(e)},k:(t,e)=>{if(Z[t]&&(clearTimeout(Z[t].id),delete Z[t]),!e)return 0;var r=setTimeout(()=>{delete Z[t],(t=>{if(!C)try{t(),(()=>{if(!X())try{rt(l)}catch(t){J(t)}})()}catch(t){J(t)}})(()=>Vi(t,it()))},e);return Z[t]={id:r,timeout_ms:e},0},r:(t,e,r,i)=>{var n=(new Date).getFullYear(),o=new Date(n,0,1),s=new Date(n,6,1),a=o.getTimezoneOffset(),c=s.getTimezoneOffset(),p=Math.max(a,c);v[t>>2]=60*p,f[e>>2]=Number(a!=c);var u=t=>{var e=t>=0?"-":"+",r=Math.abs(t);return`UTC${e}${String(Math.floor(r/60)).padStart(2,"0")}${String(r%60).padStart(2,"0")}`},l=u(a),h=u(c);c<a?(ot(l,r,17),ot(h,i,17)):(ot(l,i,17),ot(h,r,17))},n:function(t,e,r){if(e=q(e),!((i=t)>=0&&i<=3))return 28;var i,n;n=0===t?st():it();var o=Math.round(1e3*n*1e3);return b[r>>3]=BigInt(o),0},t:(t,e,r)=>((t,e,r)=>{var i=((t,e)=>{var r;for(at.length=0;r=_[t++];){var i=105!=r;e+=(i&=112!=r)&&e%8?4:0,at.push(112==r?v[e>>2]:106==r?b[e>>3]:105==r?f[e>>2]:g[e>>3]),e+=i?8:4}return at})(e,r);return $i[t](...i)})(t,e,r),g:st,o:t=>{var e=_.length,r=2147483648;if((t>>>=0)>r)return!1;for(var i=1;i<=4;i*=2){var n=e*(1+.2/i);n=Math.min(n,t+100663296);var o=Math.min(r,ct(Math.max(t,n),65536));if(pt(o))return!0}return!1},l:(t,e)=>{var r=0,i=0;for(var n of lt()){var o=e+r;v[t+i>>2]=o,r+=ot(n,o,1/0)+1,i+=4}return 0},m:(t,e)=>{var r=lt();v[t>>2]=r.length;var i=0;for(var n of r)i+=ht(n)+1;return v[e>>2]=i,0},d:t=>52,f:(t,e,r,i)=>52,b:function(t,e,r,i){return e=q(e),70},e:(t,e,r,i)=>{for(var n=0,o=0;o<r;o++){var s=v[e>>2],a=v[e+4>>2];e+=8;for(var c=0;c<a;c++)mt(t,_[s+c]);n+=a}return v[i>>2]=n,0},i:tt},Yi=await async function(){function t(t,e){return Yi=t.exports,m=Yi.u,G(),T=Yi.Vc,function(t){r._main=St=t.w,r._webidl_free=t.x,r._webidl_malloc=t.y,r._emscripten_bind_VoidPtr___destroy___0=wt=t.z,r._emscripten_bind_Cloudpilot_Cloudpilot_0=Ct=t.A,r._emscripten_bind_Cloudpilot_Malloc_1=It=t.B,r._emscripten_bind_Cloudpilot_Free_1=Et=t.C,r._emscripten_bind_Cloudpilot_Nullptr_0=Dt=t.D,r._emscripten_bind_Cloudpilot_EnableLogging_1=Gt=t.E,r._emscripten_bind_Cloudpilot_InitializeSession_3=Pt=t.F,r._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=xt=t.G,r._emscripten_bind_Cloudpilot_RunEmulation_1=kt=t.H,r._emscripten_bind_Cloudpilot_SetClockFactor_1=Mt=t.I,r._emscripten_bind_Cloudpilot_CopyFrame_0=Rt=t.J,r._emscripten_bind_Cloudpilot_IsScreenDirty_0=zt=t.K,r._emscripten_bind_Cloudpilot_MarkScreenClean_0=Tt=t.L,r._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=Ht=t.M,r._emscripten_bind_Cloudpilot_FramebufferSizeForDevice_1=At=t.N,r._emscripten_bind_Cloudpilot_TotalMemoryForDevice_1=Bt=t.O,r._emscripten_bind_Cloudpilot_QueuePenMove_2=Nt=t.P,r._emscripten_bind_Cloudpilot_QueuePenUp_0=Lt=t.Q,r._emscripten_bind_Cloudpilot_QueueButtonDown_1=Ut=t.R,r._emscripten_bind_Cloudpilot_QueueButtonUp_1=Ft=t.S,r._emscripten_bind_Cloudpilot_QueueKeyboardEvent_2=jt=t.T,r._emscripten_bind_Cloudpilot_IsPowerOff_0=Ot=t.U,r._emscripten_bind_Cloudpilot_IsUIInitialized_0=Wt=t.V,r._emscripten_bind_Cloudpilot_GetOSVersion_0=Vt=t.W,r._emscripten_bind_Cloudpilot_IsSetupComplete_0=qt=t.X,r._emscripten_bind_Cloudpilot_Reset_0=Kt=t.Y,r._emscripten_bind_Cloudpilot_ResetNoExtensions_0=$t=t.Z,r._emscripten_bind_Cloudpilot_ResetHard_0=Qt=t._,r._emscripten_bind_Cloudpilot_InstallDb_2=Yt=t.$,r._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=Zt=t.aa,r._emscripten_bind_Cloudpilot_GetMemoryPtr_0=Jt=t.ba,r._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=Xt=t.ca,r._emscripten_bind_Cloudpilot_GetMemorySize_0=te=t.da,r._emscripten_bind_Cloudpilot_ImportMemoryImage_2=ee=t.ea,r._emscripten_bind_Cloudpilot_GetRomPtr_0=re=t.fa,r._emscripten_bind_Cloudpilot_GetRomSize_0=ie=t.ga,r._emscripten_bind_Cloudpilot_GetSavestatePtr_0=ne=t.ha,r._emscripten_bind_Cloudpilot_GetSavestateSize_0=oe=t.ia,r._emscripten_bind_Cloudpilot_SaveState_0=se=t.ja,r._emscripten_bind_Cloudpilot_LoadState_2=ae=t.ka,r._emscripten_bind_Cloudpilot_GetHotsyncName_0=ce=t.la,r._emscripten_bind_Cloudpilot_SetHotsyncName_1=pe=t.ma,r._emscripten_bind_Cloudpilot_RegisterPwmHandler_1=ue=t.na,r._emscripten_bind_Cloudpilot_StartBackup_0=le=t.oa,r._emscripten_bind_Cloudpilot_SetClipboardIntegration_1=he=t.pa,r._emscripten_bind_Cloudpilot_GetClipboardIntegration_0=de=t.qa,r._emscripten_bind_Cloudpilot_IsSuspended_0=me=t.ra,r._emscripten_bind_Cloudpilot_GetSuspendContext_0=ye=t.sa,r._emscripten_bind_Cloudpilot_SetNetworkRedirection_1=_e=t.ta,r._emscripten_bind_Cloudpilot_GetNetworkRedirection_0=fe=t.ua,r._emscripten_bind_Cloudpilot_RegisterProxyDisconnectHandler_1=ve=t.va,r._emscripten_bind_Cloudpilot_SetHotsyncNameManagement_1=ge=t.wa,r._emscripten_bind_Cloudpilot_LaunchAppByName_1=be=t.xa,r._emscripten_bind_Cloudpilot_LaunchAppByDbHeader_2=Se=t.ya,r._emscripten_bind_Cloudpilot_DeviceSupportsCardSize_1=we=t.za,r._emscripten_bind_Cloudpilot_ClearExternalStorage_0=Ce=t.Aa,r._emscripten_bind_Cloudpilot_AllocateCard_2=Ie=t.Ba,r._emscripten_bind_Cloudpilot_AdoptCard_3=Ee=t.Ca,r._emscripten_bind_Cloudpilot_MountCard_1=De=t.Da,r._emscripten_bind_Cloudpilot_RemoveCard_1=Ge=t.Ea,r._emscripten_bind_Cloudpilot_GetCardData_1=Pe=t.Fa,r._emscripten_bind_Cloudpilot_GetCardDirtyPages_1=xe=t.Ga,r._emscripten_bind_Cloudpilot_GetCardSize_1=ke=t.Ha,r._emscripten_bind_Cloudpilot_RemountCards_0=Me=t.Ia,r._emscripten_bind_Cloudpilot_GetSupportLevel_1=Re=t.Ja,r._emscripten_bind_Cloudpilot_GetMountedKey_0=ze=t.Ka,r._emscripten_bind_Cloudpilot_GetTransportIR_0=Te=t.La,r._emscripten_bind_Cloudpilot_GetTransportSerial_0=He=t.Ma,r._emscripten_bind_Cloudpilot___destroy___0=Ae=t.Na,r._emscripten_bind_RomInfo_RomInfo_2=Be=t.Oa,r._emscripten_bind_RomInfo_IsValid_0=Ne=t.Pa,r._emscripten_bind_RomInfo_CardVersion_0=Le=t.Qa,r._emscripten_bind_RomInfo_CardName_0=Ue=t.Ra,r._emscripten_bind_RomInfo_RomVersion_0=Fe=t.Sa,r._emscripten_bind_RomInfo_RomVersionString_0=je=t.Ta,r._emscripten_bind_RomInfo_Supports_1=Oe=t.Ua,r._emscripten_bind_RomInfo___destroy___0=We=t.Va,r._emscripten_bind_Frame_GetLineWidth_0=Ve=t.Wa,r._emscripten_bind_Frame_GetBpp_0=qe=t.Xa,r._emscripten_bind_Frame_GetLines_0=Ke=t.Ya,r._emscripten_bind_Frame_GetMargin_0=$e=t.Za,r._emscripten_bind_Frame_GetBytesPerLine_0=Qe=t._a,r._emscripten_bind_Frame_GetFirstDirtyLine_0=Ye=t.$a,r._emscripten_bind_Frame_GetLastDirtyLine_0=Ze=t.ab,r._emscripten_bind_Frame_GetHasChanges_0=Je=t.bb,r._emscripten_bind_Frame_GetBuffer_0=Xe=t.cb,r._emscripten_bind_Frame_GetBufferSize_0=tr=t.db,r._emscripten_bind_Frame_GetScaleX_0=er=t.eb,r._emscripten_bind_Frame_GetScaleY_0=rr=t.fb,r._emscripten_bind_Frame___destroy___0=ir=t.gb,r._emscripten_bind_DbBackup_Init_1=nr=t.hb,r._emscripten_bind_DbBackup_IsInProgress_0=or=t.ib,r._emscripten_bind_DbBackup_IsDone_0=sr=t.jb,r._emscripten_bind_DbBackup_GetCurrentDatabase_0=ar=t.kb,r._emscripten_bind_DbBackup_Save_0=cr=t.lb,r._emscripten_bind_DbBackup_Skip_0=pr=t.mb,r._emscripten_bind_DbBackup_GetArchivePtr_0=ur=t.nb,r._emscripten_bind_DbBackup_GetArchiveSize_0=lr=t.ob,r._emscripten_bind_DbBackup___destroy___0=hr=t.pb,r._emscripten_bind_SuspendContextClipboardCopy_Cancel_0=dr=t.qb,r._emscripten_bind_SuspendContextClipboardCopy_Resume_0=mr=t.rb,r._emscripten_bind_SuspendContextClipboardCopy_GetClipboardContent_0=yr=t.sb,r._emscripten_bind_SuspendContextClipboardCopy___destroy___0=_r=t.tb,r._emscripten_bind_SuspendContextClipboardPaste_Cancel_0=fr=t.ub,r._emscripten_bind_SuspendContextClipboardPaste_Resume_1=vr=t.vb,r._emscripten_bind_SuspendContextClipboardPaste___destroy___0=gr=t.wb,r._emscripten_bind_SuspendContextNetworkConnect_Cancel_0=br=t.xb,r._emscripten_bind_SuspendContextNetworkConnect_Resume_0=Sr=t.yb,r._emscripten_bind_SuspendContextNetworkConnect___destroy___0=wr=t.zb,r._emscripten_bind_SuspendContextNetworkRpc_Cancel_0=Cr=t.Ab,r._emscripten_bind_SuspendContextNetworkRpc_GetRequestSize_0=Ir=t.Bb,r._emscripten_bind_SuspendContextNetworkRpc_GetRequestData_0=Er=t.Cb,r._emscripten_bind_SuspendContextNetworkRpc_ReceiveResponse_2=Dr=t.Db,r._emscripten_bind_SuspendContextNetworkRpc___destroy___0=Gr=t.Eb,r._emscripten_bind_SuspendContextSerialSync_Cancel_0=Pr=t.Fb,r._emscripten_bind_SuspendContextSerialSync_Resume_0=xr=t.Gb,r._emscripten_bind_SuspendContextSerialSync___destroy___0=kr=t.Hb,r._emscripten_bind_SuspendContext_GetKind_0=Mr=t.Ib,r._emscripten_bind_SuspendContext_Cancel_0=Rr=t.Jb,r._emscripten_bind_SuspendContext_AsContextClipboardCopy_0=zr=t.Kb,r._emscripten_bind_SuspendContext_AsContextClipboardPaste_0=Tr=t.Lb,r._emscripten_bind_SuspendContext_AsContextNetworkConnect_0=Hr=t.Mb,r._emscripten_bind_SuspendContext_AsContextNetworkRpc_0=Ar=t.Nb,r._emscripten_bind_SuspendContext_AsContextSerialSync_0=Br=t.Ob,r._emscripten_bind_SuspendContext___destroy___0=Nr=t.Pb,r._emscripten_bind_SessionImage_SessionImage_0=Lr=t.Qb,r._emscripten_bind_SessionImage_GetDeviceId_0=Ur=t.Rb,r._emscripten_bind_SessionImage_SetDeviceId_1=Fr=t.Sb,r._emscripten_bind_SessionImage_GetRomImage_0=jr=t.Tb,r._emscripten_bind_SessionImage_GetRomImageSize_0=Or=t.Ub,r._emscripten_bind_SessionImage_SetRomImage_2=Wr=t.Vb,r._emscripten_bind_SessionImage_GetMemoryImage_0=Vr=t.Wb,r._emscripten_bind_SessionImage_GetMemoryImageSize_0=qr=t.Xb,r._emscripten_bind_SessionImage_SetMemoryImage_2=Kr=t.Yb,r._emscripten_bind_SessionImage_GetMetadata_0=$r=t.Zb,r._emscripten_bind_SessionImage_GetMetadataSize_0=Qr=t._b,r._emscripten_bind_SessionImage_SetMetadata_2=Yr=t.$b,r._emscripten_bind_SessionImage_GetSavestate_0=Zr=t.ac,r._emscripten_bind_SessionImage_GetSavestateSize_0=Jr=t.bc,r._emscripten_bind_SessionImage_SetSavestate_2=Xr=t.cc,r._emscripten_bind_SessionImage_GetVersion_0=ti=t.dc,r._emscripten_bind_SessionImage_Serialize_0=ei=t.ec,r._emscripten_bind_SessionImage_GetSerializedImage_0=ri=t.fc,r._emscripten_bind_SessionImage_GetSerializedImageSize_0=ii=t.gc,r._emscripten_bind_SessionImage_Deserialize_2=ni=t.hc,r._emscripten_bind_SessionImage___destroy___0=oi=t.ic,r._emscripten_bind_SkinLoader_SkinLoader_1=si=t.jc,r._emscripten_bind_SkinLoader_GetData_0=ai=t.kc,r._emscripten_bind_SkinLoader_GetSize_0=ci=t.lc,r._emscripten_bind_SkinLoader___destroy___0=pi=t.mc,r._emscripten_bind_EmTransportSerialBuffer_RxBytesPending_0=ui=t.nc,r._emscripten_bind_EmTransportSerialBuffer_Receive_0=li=t.oc,r._emscripten_bind_EmTransportSerialBuffer_Send_3=hi=t.pc,r._emscripten_bind_EmTransportSerialBuffer_IsOpen_0=di=t.qc,r._emscripten_bind_EmTransportSerialBuffer_Rts_0=mi=t.rc,r._emscripten_bind_EmTransportSerialBuffer_Dtr_0=yi=t.sc,r._emscripten_bind_EmTransportSerialBuffer_IsBreak_0=_i=t.tc,r._emscripten_bind_EmTransportSerialBuffer_BufferSize_0=fi=t.uc,r._emscripten_bind_EmTransportSerialBuffer_GetBaud_0=vi=t.vc,r._emscripten_bind_EmTransportSerialBuffer_GetParity_0=gi=t.wc,r._emscripten_bind_EmTransportSerialBuffer_GetStopBits_0=bi=t.xc,r._emscripten_bind_EmTransportSerialBuffer_GetDataBits_0=Si=t.yc,r._emscripten_bind_EmTransportSerialBuffer_GetHwrHandshake_0=wi=t.zc,r._emscripten_bind_EmTransportSerialBuffer_GetModeSync_0=Ci=t.Ac,r._emscripten_bind_EmTransportSerialBuffer_SetModeSync_1=Ii=t.Bc,r._emscripten_bind_EmTransportSerialBuffer_IsFrameComplete_0=Ei=t.Cc,r._emscripten_bind_EmTransportSerialBuffer_SetRequestTransferCallback_1=Di=t.Dc,r._emscripten_bind_EmTransportSerialBuffer___destroy___0=Gi=t.Ec,r._emscripten_bind_GunzipContext_GunzipContext_3=Pi=t.Fc,r._emscripten_bind_GunzipContext_GetState_0=xi=t.Gc,r._emscripten_bind_GunzipContext_Continue_0=ki=t.Hc,r._emscripten_bind_GunzipContext_GetUncompressedData_0=Mi=t.Ic,r._emscripten_bind_GunzipContext_ReleaseUncompressedData_0=Ri=t.Jc,r._emscripten_bind_GunzipContext_GetUncompressedSize_0=zi=t.Kc,r._emscripten_bind_GunzipContext_GetError_0=Ti=t.Lc,r._emscripten_bind_GunzipContext___destroy___0=Hi=t.Mc,r._emscripten_bind_ZipfileWalker_ZipfileWalker_2=Ai=t.Nc,r._emscripten_bind_ZipfileWalker_GetState_0=Bi=t.Oc,r._emscripten_bind_ZipfileWalker_Next_0=Ni=t.Pc,r._emscripten_bind_ZipfileWalker_GetTotalEntries_0=Li=t.Qc,r._emscripten_bind_ZipfileWalker_GetCurrentEntrySize_0=Ui=t.Rc,r._emscripten_bind_ZipfileWalker_GetCurrentEntryName_0=Fi=t.Sc,r._emscripten_bind_ZipfileWalker_GetCurrentEntryContent_0=ji=t.Tc,r._emscripten_bind_ZipfileWalker___destroy___0=Oi=t.Uc,Wi=t.Wc,Vi=t.Xc,qi=t.Yc,Ki=t.Zc,r.___original_main=t._c}(Yi),function(){if(x--,r.monitorRunDependencies?.(x),0==x&&k){var t=k;k=null,t()}}(),Yi}x++,r.monitorRunDependencies?.(x);var e,i={a:Qi};return r.instantiateWasm?new Promise((e,n)=>{r.instantiateWasm(i,(r,i)=>{e(t(r))})}):(P??=(e="cloudpilot_web.wasm",r.locateFile?r.locateFile(e,p):p+e),t((await R(u,P,i)).instance))}();function Zi(){}function Ji(t){return(t||Zi).__cache__}function Xi(t,e){var r=Ji(e),i=r[t];return i||((i=Object.create((e||Zi).prototype)).ptr=t,r[t]=i)}!function(){if(r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()()}(),function t(){function e(){r.calledRun=!0,C||(D=!0,E(),A(yt),Yi.v(),E(),h?.(r),r.onRuntimeInitialized?.(),r.noInitialRun||function(){var t=St;try{var e=t(0,0);return et(e),e}catch(t){return J(t)}}(),function(){if(E(),r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)N(r.postRun.shift());A(B)}())}var i;x>0?k=t:(qi(),0==(i=Wi())&&(i+=4),v[i>>2]=34821223,v[i+4>>2]=2310721022,v[0]=1668509029,function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)U(r.preRun.shift());A(L)}(),x>0?k=t:(r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),e()},1)):e(),E()))}(),Zi.prototype=Object.create(Zi.prototype),Zi.prototype.constructor=Zi,Zi.prototype.__class__=Zi,Zi.__cache__={},r.WrapperObject=Zi,r.getCache=Ji,r.wrapPointer=Xi,r.castObject=function(t,e){return Xi(t.ptr,e)},r.NULL=Xi(0),r.destroy=function(t){if(!t.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";t.__destroy__(),delete Ji(t.__class__)[t.ptr]},r.compare=function(t,e){return t.ptr===e.ptr},r.getPointer=function(t){return t.ptr},r.getClass=function(t){return t.__class__};var tn={buffer:0,size:0,pos:0,temps:[],needed:0,prepare(){if(tn.needed){for(var t=0;t<tn.temps.length;t++)r._webidl_free(tn.temps[t]);tn.temps.length=0,r._webidl_free(tn.buffer),tn.buffer=0,tn.size+=tn.needed,tn.needed=0}tn.buffer||(tn.size+=128,tn.buffer=r._webidl_malloc(tn.size),I(tn.buffer)),tn.pos=0},alloc(t,e){I(tn.buffer);var i,n=e.BYTES_PER_ELEMENT,o=t.length*n;return o=ct(o,8),tn.pos+o>=tn.size?(I(o>0),tn.needed+=o,i=r._webidl_malloc(o),tn.temps.push(i)):(i=tn.buffer+tn.pos,tn.pos+=o),i},copy(t,e,r){r/=e.BYTES_PER_ELEMENT;for(var i=0;i<t.length;i++)e[r+i]=t[i]}};function en(t){if("string"==typeof t){var e=(n=ht(i=t)+1,o=new Array(n),nt(i,o,0,o.length),o),r=tn.alloc(e,y);return tn.copy(e,y,r),r}var i,n,o;return t}function rn(){throw"cannot construct a VoidPtr, no constructor in IDL"}function nn(){this.ptr=Ct(),Ji(nn)[this.ptr]=this}function on(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Be(t,e),Ji(on)[this.ptr]=this}function sn(){throw"cannot construct a Frame, no constructor in IDL"}function an(){throw"cannot construct a DbBackup, no constructor in IDL"}function cn(){throw"cannot construct a SuspendContextClipboardCopy, no constructor in IDL"}function pn(){throw"cannot construct a SuspendContextClipboardPaste, no constructor in IDL"}function un(){throw"cannot construct a SuspendContextNetworkConnect, no constructor in IDL"}function ln(){throw"cannot construct a SuspendContextNetworkRpc, no constructor in IDL"}function hn(){throw"cannot construct a SuspendContextSerialSync, no constructor in IDL"}function dn(){throw"cannot construct a SuspendContext, no constructor in IDL"}function mn(){this.ptr=Lr(),Ji(mn)[this.ptr]=this}function yn(t){tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),this.ptr=si(t),Ji(yn)[this.ptr]=this}function _n(){throw"cannot construct a EmTransportSerialBuffer, no constructor in IDL"}function fn(t,e,r){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),this.ptr=Pi(t,e,r),Ji(fn)[this.ptr]=this}function vn(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Ai(t,e),Ji(vn)[this.ptr]=this}return rn.prototype=Object.create(Zi.prototype),rn.prototype.constructor=rn,rn.prototype.__class__=rn,rn.__cache__={},r.VoidPtr=rn,rn.prototype.__destroy__=rn.prototype.__destroy__=function(){var t=this.ptr;wt(t)},nn.prototype=Object.create(Zi.prototype),nn.prototype.constructor=nn,nn.prototype.__class__=nn,nn.__cache__={},r.Cloudpilot=nn,nn.prototype.Malloc=nn.prototype.Malloc=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Xi(It(e,t),rn)},nn.prototype.Free=nn.prototype.Free=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Et(e,t)},nn.prototype.Nullptr=nn.prototype.Nullptr=function(){var t=this.ptr;return Xi(Dt(t),rn)},nn.prototype.EnableLogging=nn.prototype.EnableLogging=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Gt(e,t)},nn.prototype.InitializeSession=nn.prototype.InitializeSession=function(t,e,r){var i=this.ptr;return tn.prepare(),t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r=r&&"object"==typeof r?r.ptr:en(r),!!Pt(i,t,e,r)},nn.prototype.GetCyclesPerSecond=nn.prototype.GetCyclesPerSecond=function(){var t=this.ptr;return xt(t)},nn.prototype.RunEmulation=nn.prototype.RunEmulation=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),kt(e,t)},nn.prototype.SetClockFactor=nn.prototype.SetClockFactor=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Mt(e,t)},nn.prototype.CopyFrame=nn.prototype.CopyFrame=function(){var t=this.ptr;return Xi(Rt(t),sn)},nn.prototype.IsScreenDirty=nn.prototype.IsScreenDirty=function(){var t=this.ptr;return!!zt(t)},nn.prototype.MarkScreenClean=nn.prototype.MarkScreenClean=function(){var t=this.ptr;Tt(t)},nn.prototype.MinMemoryForDevice=nn.prototype.MinMemoryForDevice=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),Ht(e,t)},nn.prototype.FramebufferSizeForDevice=nn.prototype.FramebufferSizeForDevice=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),At(e,t)},nn.prototype.TotalMemoryForDevice=nn.prototype.TotalMemoryForDevice=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),Bt(e,t)},nn.prototype.QueuePenMove=nn.prototype.QueuePenMove=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Nt(r,t,e)},nn.prototype.QueuePenUp=nn.prototype.QueuePenUp=function(){var t=this.ptr;Lt(t)},nn.prototype.QueueButtonDown=nn.prototype.QueueButtonDown=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Ut(e,t)},nn.prototype.QueueButtonUp=nn.prototype.QueueButtonUp=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Ft(e,t)},nn.prototype.QueueKeyboardEvent=nn.prototype.QueueKeyboardEvent=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),jt(r,t,e)},nn.prototype.IsPowerOff=nn.prototype.IsPowerOff=function(){var t=this.ptr;return!!Ot(t)},nn.prototype.IsUIInitialized=nn.prototype.IsUIInitialized=function(){var t=this.ptr;return!!Wt(t)},nn.prototype.GetOSVersion=nn.prototype.GetOSVersion=function(){var t=this.ptr;return Vt(t)},nn.prototype.IsSetupComplete=nn.prototype.IsSetupComplete=function(){var t=this.ptr;return!!qt(t)},nn.prototype.Reset=nn.prototype.Reset=function(){var t=this.ptr;Kt(t)},nn.prototype.ResetNoExtensions=nn.prototype.ResetNoExtensions=function(){var t=this.ptr;$t(t)},nn.prototype.ResetHard=nn.prototype.ResetHard=function(){var t=this.ptr;Qt(t)},nn.prototype.InstallDb=nn.prototype.InstallDb=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Yt(r,t,e)},nn.prototype.GetPalette2bitMapping=nn.prototype.GetPalette2bitMapping=function(){var t=this.ptr;return Zt(t)},nn.prototype.GetMemoryPtr=nn.prototype.GetMemoryPtr=function(){var t=this.ptr;return Xi(Jt(t),rn)},nn.prototype.GetDirtyPagesPtr=nn.prototype.GetDirtyPagesPtr=function(){var t=this.ptr;return Xi(Xt(t),rn)},nn.prototype.GetMemorySize=nn.prototype.GetMemorySize=function(){var t=this.ptr;return te(t)},nn.prototype.ImportMemoryImage=nn.prototype.ImportMemoryImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ee(r,t,e)},nn.prototype.GetRomPtr=nn.prototype.GetRomPtr=function(){var t=this.ptr;return Xi(re(t),rn)},nn.prototype.GetRomSize=nn.prototype.GetRomSize=function(){var t=this.ptr;return ie(t)},nn.prototype.GetSavestatePtr=nn.prototype.GetSavestatePtr=function(){var t=this.ptr;return Xi(ne(t),rn)},nn.prototype.GetSavestateSize=nn.prototype.GetSavestateSize=function(){var t=this.ptr;return oe(t)},nn.prototype.SaveState=nn.prototype.SaveState=function(){var t=this.ptr;return!!se(t)},nn.prototype.LoadState=nn.prototype.LoadState=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ae(r,t,e)},nn.prototype.GetHotsyncName=nn.prototype.GetHotsyncName=function(){var t=this.ptr;return V(ce(t))},nn.prototype.SetHotsyncName=nn.prototype.SetHotsyncName=function(t){var e=this.ptr;tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),pe(e,t)},nn.prototype.RegisterPwmHandler=nn.prototype.RegisterPwmHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ue(e,t)},nn.prototype.StartBackup=nn.prototype.StartBackup=function(){var t=this.ptr;return Xi(le(t),an)},nn.prototype.SetClipboardIntegration=nn.prototype.SetClipboardIntegration=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),he(e,t)},nn.prototype.GetClipboardIntegration=nn.prototype.GetClipboardIntegration=function(){var t=this.ptr;return!!de(t)},nn.prototype.IsSuspended=nn.prototype.IsSuspended=function(){var t=this.ptr;return!!me(t)},nn.prototype.GetSuspendContext=nn.prototype.GetSuspendContext=function(){var t=this.ptr;return Xi(ye(t),dn)},nn.prototype.SetNetworkRedirection=nn.prototype.SetNetworkRedirection=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),_e(e,t)},nn.prototype.GetNetworkRedirection=nn.prototype.GetNetworkRedirection=function(){var t=this.ptr;return!!fe(t)},nn.prototype.RegisterProxyDisconnectHandler=nn.prototype.RegisterProxyDisconnectHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ve(e,t)},nn.prototype.SetHotsyncNameManagement=nn.prototype.SetHotsyncNameManagement=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ge(e,t)},nn.prototype.LaunchAppByName=nn.prototype.LaunchAppByName=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),!!be(e,t)},nn.prototype.LaunchAppByDbHeader=nn.prototype.LaunchAppByDbHeader=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!Se(r,t,e)},nn.prototype.DeviceSupportsCardSize=nn.prototype.DeviceSupportsCardSize=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),!!we(e,t)},nn.prototype.ClearExternalStorage=nn.prototype.ClearExternalStorage=function(){var t=this.ptr;Ce(t)},nn.prototype.AllocateCard=nn.prototype.AllocateCard=function(t,e){var r=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),e&&"object"==typeof e&&(e=e.ptr),!!Ie(r,t,e)},nn.prototype.AdoptCard=nn.prototype.AdoptCard=function(t,e,r){var i=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Ee(i,t,e,r)},nn.prototype.MountCard=nn.prototype.MountCard=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),!!De(e,t)},nn.prototype.RemoveCard=nn.prototype.RemoveCard=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),!!Ge(e,t)},nn.prototype.GetCardData=nn.prototype.GetCardData=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),Xi(Pe(e,t),rn)},nn.prototype.GetCardDirtyPages=nn.prototype.GetCardDirtyPages=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),Xi(xe(e,t),rn)},nn.prototype.GetCardSize=nn.prototype.GetCardSize=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),ke(e,t)},nn.prototype.RemountCards=nn.prototype.RemountCards=function(){var t=this.ptr;Me(t)},nn.prototype.GetSupportLevel=nn.prototype.GetSupportLevel=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Re(e,t)},nn.prototype.GetMountedKey=nn.prototype.GetMountedKey=function(){var t=this.ptr;return V(ze(t))},nn.prototype.GetTransportIR=nn.prototype.GetTransportIR=function(){var t=this.ptr;return Xi(Te(t),_n)},nn.prototype.GetTransportSerial=nn.prototype.GetTransportSerial=function(){var t=this.ptr;return Xi(He(t),_n)},nn.prototype.__destroy__=nn.prototype.__destroy__=function(){var t=this.ptr;Ae(t)},on.prototype=Object.create(Zi.prototype),on.prototype.constructor=on,on.prototype.__class__=on,on.__cache__={},r.RomInfo=on,on.prototype.IsValid=on.prototype.IsValid=function(){var t=this.ptr;return!!Ne(t)},on.prototype.CardVersion=on.prototype.CardVersion=function(){var t=this.ptr;return Le(t)},on.prototype.CardName=on.prototype.CardName=function(){var t=this.ptr;return V(Ue(t))},on.prototype.RomVersion=on.prototype.RomVersion=function(){var t=this.ptr;return Fe(t)},on.prototype.RomVersionString=on.prototype.RomVersionString=function(){var t=this.ptr;return V(je(t))},on.prototype.Supports=on.prototype.Supports=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),!!Oe(e,t)},on.prototype.__destroy__=on.prototype.__destroy__=function(){var t=this.ptr;We(t)},sn.prototype=Object.create(Zi.prototype),sn.prototype.constructor=sn,sn.prototype.__class__=sn,sn.__cache__={},r.Frame=sn,sn.prototype.GetLineWidth=sn.prototype.GetLineWidth=function(){var t=this.ptr;return Ve(t)},sn.prototype.GetBpp=sn.prototype.GetBpp=function(){var t=this.ptr;return qe(t)},sn.prototype.GetLines=sn.prototype.GetLines=function(){var t=this.ptr;return Ke(t)},sn.prototype.GetMargin=sn.prototype.GetMargin=function(){var t=this.ptr;return $e(t)},sn.prototype.GetBytesPerLine=sn.prototype.GetBytesPerLine=function(){var t=this.ptr;return Qe(t)},sn.prototype.GetFirstDirtyLine=sn.prototype.GetFirstDirtyLine=function(){var t=this.ptr;return Ye(t)},sn.prototype.GetLastDirtyLine=sn.prototype.GetLastDirtyLine=function(){var t=this.ptr;return Ze(t)},sn.prototype.GetHasChanges=sn.prototype.GetHasChanges=function(){var t=this.ptr;return!!Je(t)},sn.prototype.GetBuffer=sn.prototype.GetBuffer=function(){var t=this.ptr;return Xi(Xe(t),rn)},sn.prototype.GetBufferSize=sn.prototype.GetBufferSize=function(){var t=this.ptr;return tr(t)},sn.prototype.GetScaleX=sn.prototype.GetScaleX=function(){var t=this.ptr;return er(t)},sn.prototype.GetScaleY=sn.prototype.GetScaleY=function(){var t=this.ptr;return rr(t)},sn.prototype.__destroy__=sn.prototype.__destroy__=function(){var t=this.ptr;ir(t)},an.prototype=Object.create(Zi.prototype),an.prototype.constructor=an,an.prototype.__class__=an,an.__cache__={},r.DbBackup=an,an.prototype.Init=an.prototype.Init=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),!!nr(e,t)},an.prototype.IsInProgress=an.prototype.IsInProgress=function(){var t=this.ptr;return!!or(t)},an.prototype.IsDone=an.prototype.IsDone=function(){var t=this.ptr;return!!sr(t)},an.prototype.GetCurrentDatabase=an.prototype.GetCurrentDatabase=function(){var t=this.ptr;return V(ar(t))},an.prototype.Save=an.prototype.Save=function(){var t=this.ptr;return!!cr(t)},an.prototype.Skip=an.prototype.Skip=function(){var t=this.ptr;pr(t)},an.prototype.GetArchivePtr=an.prototype.GetArchivePtr=function(){var t=this.ptr;return Xi(ur(t),rn)},an.prototype.GetArchiveSize=an.prototype.GetArchiveSize=function(){var t=this.ptr;return lr(t)},an.prototype.__destroy__=an.prototype.__destroy__=function(){var t=this.ptr;hr(t)},cn.prototype=Object.create(Zi.prototype),cn.prototype.constructor=cn,cn.prototype.__class__=cn,cn.__cache__={},r.SuspendContextClipboardCopy=cn,cn.prototype.Cancel=cn.prototype.Cancel=function(){var t=this.ptr;dr(t)},cn.prototype.Resume=cn.prototype.Resume=function(){var t=this.ptr;mr(t)},cn.prototype.GetClipboardContent=cn.prototype.GetClipboardContent=function(){var t=this.ptr;return V(yr(t))},cn.prototype.__destroy__=cn.prototype.__destroy__=function(){var t=this.ptr;_r(t)},pn.prototype=Object.create(Zi.prototype),pn.prototype.constructor=pn,pn.prototype.__class__=pn,pn.__cache__={},r.SuspendContextClipboardPaste=pn,pn.prototype.Cancel=pn.prototype.Cancel=function(){var t=this.ptr;fr(t)},pn.prototype.Resume=pn.prototype.Resume=function(t){var e=this.ptr;tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),vr(e,t)},pn.prototype.__destroy__=pn.prototype.__destroy__=function(){var t=this.ptr;gr(t)},un.prototype=Object.create(Zi.prototype),un.prototype.constructor=un,un.prototype.__class__=un,un.__cache__={},r.SuspendContextNetworkConnect=un,un.prototype.Cancel=un.prototype.Cancel=function(){var t=this.ptr;br(t)},un.prototype.Resume=un.prototype.Resume=function(){var t=this.ptr;Sr(t)},un.prototype.__destroy__=un.prototype.__destroy__=function(){var t=this.ptr;wr(t)},ln.prototype=Object.create(Zi.prototype),ln.prototype.constructor=ln,ln.prototype.__class__=ln,ln.__cache__={},r.SuspendContextNetworkRpc=ln,ln.prototype.Cancel=ln.prototype.Cancel=function(){var t=this.ptr;Cr(t)},ln.prototype.GetRequestSize=ln.prototype.GetRequestSize=function(){var t=this.ptr;return Ir(t)},ln.prototype.GetRequestData=ln.prototype.GetRequestData=function(){var t=this.ptr;return Xi(Er(t),rn)},ln.prototype.ReceiveResponse=ln.prototype.ReceiveResponse=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Dr(r,t,e)},ln.prototype.__destroy__=ln.prototype.__destroy__=function(){var t=this.ptr;Gr(t)},hn.prototype=Object.create(Zi.prototype),hn.prototype.constructor=hn,hn.prototype.__class__=hn,hn.__cache__={},r.SuspendContextSerialSync=hn,hn.prototype.Cancel=hn.prototype.Cancel=function(){var t=this.ptr;Pr(t)},hn.prototype.Resume=hn.prototype.Resume=function(){var t=this.ptr;xr(t)},hn.prototype.__destroy__=hn.prototype.__destroy__=function(){var t=this.ptr;kr(t)},dn.prototype=Object.create(Zi.prototype),dn.prototype.constructor=dn,dn.prototype.__class__=dn,dn.__cache__={},r.SuspendContext=dn,dn.prototype.GetKind=dn.prototype.GetKind=function(){var t=this.ptr;return Mr(t)},dn.prototype.Cancel=dn.prototype.Cancel=function(){var t=this.ptr;Rr(t)},dn.prototype.AsContextClipboardCopy=dn.prototype.AsContextClipboardCopy=function(){var t=this.ptr;return Xi(zr(t),cn)},dn.prototype.AsContextClipboardPaste=dn.prototype.AsContextClipboardPaste=function(){var t=this.ptr;return Xi(Tr(t),pn)},dn.prototype.AsContextNetworkConnect=dn.prototype.AsContextNetworkConnect=function(){var t=this.ptr;return Xi(Hr(t),un)},dn.prototype.AsContextNetworkRpc=dn.prototype.AsContextNetworkRpc=function(){var t=this.ptr;return Xi(Ar(t),ln)},dn.prototype.AsContextSerialSync=dn.prototype.AsContextSerialSync=function(){var t=this.ptr;return Xi(Br(t),hn)},dn.prototype.__destroy__=dn.prototype.__destroy__=function(){var t=this.ptr;Nr(t)},mn.prototype=Object.create(Zi.prototype),mn.prototype.constructor=mn,mn.prototype.__class__=mn,mn.__cache__={},r.SessionImage=mn,mn.prototype.GetDeviceId=mn.prototype.GetDeviceId=function(){var t=this.ptr;return V(Ur(t))},mn.prototype.SetDeviceId=mn.prototype.SetDeviceId=function(t){var e=this.ptr;return tn.prepare(),t=t&&"object"==typeof t?t.ptr:en(t),Xi(Fr(e,t),mn)},mn.prototype.GetRomImage=mn.prototype.GetRomImage=function(){var t=this.ptr;return Xi(jr(t),rn)},mn.prototype.GetRomImageSize=mn.prototype.GetRomImageSize=function(){var t=this.ptr;return Or(t)},mn.prototype.SetRomImage=mn.prototype.SetRomImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Xi(Wr(r,t,e),mn)},mn.prototype.GetMemoryImage=mn.prototype.GetMemoryImage=function(){var t=this.ptr;return Xi(Vr(t),rn)},mn.prototype.GetMemoryImageSize=mn.prototype.GetMemoryImageSize=function(){var t=this.ptr;return qr(t)},mn.prototype.SetMemoryImage=mn.prototype.SetMemoryImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Xi(Kr(r,t,e),mn)},mn.prototype.GetMetadata=mn.prototype.GetMetadata=function(){var t=this.ptr;return Xi($r(t),rn)},mn.prototype.GetMetadataSize=mn.prototype.GetMetadataSize=function(){var t=this.ptr;return Qr(t)},mn.prototype.SetMetadata=mn.prototype.SetMetadata=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Xi(Yr(r,t,e),mn)},mn.prototype.GetSavestate=mn.prototype.GetSavestate=function(){var t=this.ptr;return Xi(Zr(t),rn)},mn.prototype.GetSavestateSize=mn.prototype.GetSavestateSize=function(){var t=this.ptr;return Jr(t)},mn.prototype.SetSavestate=mn.prototype.SetSavestate=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Xi(Xr(r,t,e),mn)},mn.prototype.GetVersion=mn.prototype.GetVersion=function(){var t=this.ptr;return ti(t)},mn.prototype.Serialize=mn.prototype.Serialize=function(){var t=this.ptr;return!!ei(t)},mn.prototype.GetSerializedImage=mn.prototype.GetSerializedImage=function(){var t=this.ptr;return Xi(ri(t),rn)},mn.prototype.GetSerializedImageSize=mn.prototype.GetSerializedImageSize=function(){var t=this.ptr;return ii(t)},mn.prototype.Deserialize=mn.prototype.Deserialize=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ni(r,t,e)},mn.prototype.__destroy__=mn.prototype.__destroy__=function(){var t=this.ptr;oi(t)},yn.prototype=Object.create(Zi.prototype),yn.prototype.constructor=yn,yn.prototype.__class__=yn,yn.__cache__={},r.SkinLoader=yn,yn.prototype.GetData=yn.prototype.GetData=function(){var t=this.ptr;return Xi(ai(t),rn)},yn.prototype.GetSize=yn.prototype.GetSize=function(){var t=this.ptr;return ci(t)},yn.prototype.__destroy__=yn.prototype.__destroy__=function(){var t=this.ptr;pi(t)},_n.prototype=Object.create(Zi.prototype),_n.prototype.constructor=_n,_n.prototype.__class__=_n,_n.__cache__={},r.EmTransportSerialBuffer=_n,_n.prototype.RxBytesPending=_n.prototype.RxBytesPending=function(){var t=this.ptr;return ui(t)},_n.prototype.Receive=_n.prototype.Receive=function(){var t=this.ptr;return Xi(li(t),rn)},_n.prototype.Send=_n.prototype.Send=function(t,e,r){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),hi(i,t,e,r)},_n.prototype.IsOpen=_n.prototype.IsOpen=function(){var t=this.ptr;return!!di(t)},_n.prototype.Rts=_n.prototype.Rts=function(){var t=this.ptr;return mi(t)},_n.prototype.Dtr=_n.prototype.Dtr=function(){var t=this.ptr;return!!yi(t)},_n.prototype.IsBreak=_n.prototype.IsBreak=function(){var t=this.ptr;return!!_i(t)},_n.prototype.BufferSize=_n.prototype.BufferSize=function(){var t=this.ptr;return fi(t)},_n.prototype.GetBaud=_n.prototype.GetBaud=function(){var t=this.ptr;return vi(t)},_n.prototype.GetParity=_n.prototype.GetParity=function(){var t=this.ptr;return gi(t)},_n.prototype.GetStopBits=_n.prototype.GetStopBits=function(){var t=this.ptr;return bi(t)},_n.prototype.GetDataBits=_n.prototype.GetDataBits=function(){var t=this.ptr;return Si(t)},_n.prototype.GetHwrHandshake=_n.prototype.GetHwrHandshake=function(){var t=this.ptr;return wi(t)},_n.prototype.GetModeSync=_n.prototype.GetModeSync=function(){var t=this.ptr;return!!Ci(t)},_n.prototype.SetModeSync=_n.prototype.SetModeSync=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Ii(e,t)},_n.prototype.IsFrameComplete=_n.prototype.IsFrameComplete=function(){var t=this.ptr;return!!Ei(t)},_n.prototype.SetRequestTransferCallback=_n.prototype.SetRequestTransferCallback=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Di(e,t)},_n.prototype.__destroy__=_n.prototype.__destroy__=function(){var t=this.ptr;Gi(t)},fn.prototype=Object.create(Zi.prototype),fn.prototype.constructor=fn,fn.prototype.__class__=fn,fn.__cache__={},r.GunzipContext=fn,fn.prototype.GetState=fn.prototype.GetState=function(){var t=this.ptr;return xi(t)},fn.prototype.Continue=fn.prototype.Continue=function(){var t=this.ptr;return ki(t)},fn.prototype.GetUncompressedData=fn.prototype.GetUncompressedData=function(){var t=this.ptr;return Xi(Mi(t),rn)},fn.prototype.ReleaseUncompressedData=fn.prototype.ReleaseUncompressedData=function(){var t=this.ptr;return Xi(Ri(t),rn)},fn.prototype.GetUncompressedSize=fn.prototype.GetUncompressedSize=function(){var t=this.ptr;return zi(t)},fn.prototype.GetError=fn.prototype.GetError=function(){var t=this.ptr;return V(Ti(t))},fn.prototype.__destroy__=fn.prototype.__destroy__=function(){var t=this.ptr;Hi(t)},vn.prototype=Object.create(Zi.prototype),vn.prototype.constructor=vn,vn.prototype.__class__=vn,vn.__cache__={},r.ZipfileWalker=vn,vn.prototype.GetState=vn.prototype.GetState=function(){var t=this.ptr;return Bi(t)},vn.prototype.Next=vn.prototype.Next=function(){var t=this.ptr;return Ni(t)},vn.prototype.GetTotalEntries=vn.prototype.GetTotalEntries=function(){var t=this.ptr;return Li(t)},vn.prototype.GetCurrentEntrySize=vn.prototype.GetCurrentEntrySize=function(){var t=this.ptr;return Ui(t)},vn.prototype.GetCurrentEntryName=vn.prototype.GetCurrentEntryName=function(){var t=this.ptr;return V(Fi(t))},vn.prototype.GetCurrentEntryContent=vn.prototype.GetCurrentEntryContent=function(){var t=this.ptr;return Xi(ji(t),rn)},vn.prototype.__destroy__=vn.prototype.__destroy__=function(){var t=this.ptr;Oi(t)},D?r:new Promise((t,e)=>{h=t,d=e})});t.exports=r,t.exports.default=r}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";function t(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function e(t,e,r,i){return new(r||(r=Promise))(function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((i=i.apply(t,e||[])).next())})}r.r(i),r.d(i,{Button:()=>ht,DeviceId:()=>n,DeviceOrientation:()=>d,VERSION:()=>dt,createEmulator:()=>mt,createEmulatorFactory:()=>yt}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var n,o,s=r(666),a=r.n(s),c=r(84);(o=n||(n={})).palmPilot="PalmPilot",o.pilot="Pilot",o.iii="PalmIII",o.palmVx="PalmVx",o.palmV="PalmV",o.palmVII="PalmVII",o.palmVIIEZ="PalmVIIEZ",o.palmVIIx="PalmVIIx",o.iiic="PalmIIIc",o.iiix="PalmIIIx",o.iiixe="PalmIIIxe",o.iiie="PalmIIIe",o.m500="PalmM500",o.m505="PalmM505",o.m515="PalmM515",o.m520="PalmM520",o.m100="PalmM100",o.m105="PalmM105",o.m125="PalmM125",o.m130="PalmM130",o.i705="Palmi705",o.i710="PalmI710",o.handera330="HandEra330",o.handera330c="HandEra330c",o.pegS300="PEG-S300",o.pegS320="PEG-S320",o.pegS500c="PEG-S500C",o.pegT400="PEG-T400",o.pegN600c="PEG-N600C/N610C",o.pegT600c="PEG-T600",o.pegN700c="PEG-N700C/N710C",o.pegT650c="YSX1230",o.pegNR70="NR70",o.acerS11="Acer-S11",o.lp168="Legend-P168";let p=0;const u=[n.palmPilot,n.pilot,n.iii,n.palmVx,n.palmV,n.palmVII,n.palmVIIEZ,n.palmVIIx,n.iiixe,n.iiix,n.iiie,n.m500,n.m505,n.m515,n.m520,n.iiic,n.m100,n.m105,n.m125,n.m130,n.i705,n.i710,n.handera330,n.handera330c,n.pegS300,n.pegS320,n.pegS500c,n.pegT400,n.pegN600c,n.pegT600c,n.pegN700c,n.pegT650c,n.pegNR70,n.acerS11,n.lp168];function l(){return(t,e,r)=>{const i=r.value;return r.value=function(t,e){return this.guard(()=>i.call(this,t,e))},r}}class h{constructor(t){this.module=t,this.fatalErrorEvent=new c.J,this.pwmUpdateEvent=new c.J,this.proxyDisconnectEvent=new c.J,this.amIdead=!1,this.cloudpilot=new t.Cloudpilot,this.cloudpilot.RegisterPwmHandler(t.addFunction((t,e)=>this.pwmUpdateEvent.dispatch({frequency:t,dutyCycle:e}),"vdd")),this.cloudpilot.RegisterProxyDisconnectHandler(t.addFunction(()=>this.proxyDisconnectEvent.dispatch(),"v")),this.transportIR=this.wrapTransport(this.cloudpilot.GetTransportIR()),this.transportSerial=this.wrapTransport(this.cloudpilot.GetTransportSerial())}static create(t){return e(this,void 0,void 0,function*(){const e=p++;return new h(yield a()(Object.assign(Object.assign({print:t=>console.log(`${e}: ${t}`),printErr:t=>console.error(`${e}: ${t}`)},"string"==typeof t?{locateFile:()=>t}:{}),"function"==typeof t?{instantiateWasm:t}:{})))})}destroy(){this.module.destroy(this.cloudpilot)}hasFatalError(){return this.amIdead}enableLogging(t){this.cloudpilot.EnableLogging(t)}getRomInfo(t){const e=this.copyIn(t),r=new this.module.RomInfo(e,t.length);let i;return r.IsValid()&&(i={cardVersion:r.CardVersion(),cardName:r.CardName(),romVersion:r.RomVersion(),romVersionString:r.RomVersionString(),supportedDevices:u.filter(r.Supports.bind(r))}),this.cloudpilot.Free(e),this.module.destroy(r),i}initializeSession(t,e){const r=this.copyIn(t),i=this.cloudpilot.InitializeSession(r,t.length,e);return this.cloudpilot.Free(r),i}cyclesPerSecond(){return this.cloudpilot.GetCyclesPerSecond()}runEmulation(t){return this.cloudpilot.RunEmulation(t)}getFrame(){const t=this.cloudpilot.CopyFrame(),e=this.module.getPointer(t.GetBuffer());return{bpp:t.GetBpp(),bytesPerLine:t.GetBytesPerLine(),lines:t.GetLines(),lineWidth:t.GetLineWidth(),margin:t.GetMargin(),firstDirtyLine:t.GetFirstDirtyLine(),lastDirtyLine:t.GetLastDirtyLine(),hasChanges:t.GetHasChanges(),scaleX:t.GetScaleX(),scaleY:t.GetScaleY(),buffer:this.module.HEAPU8.subarray(e,e+t.GetBufferSize())}}isScreenDirty(){return this.cloudpilot.IsScreenDirty()}markScreenClean(){this.cloudpilot.MarkScreenClean()}minRamForDevice(t){return 1024*this.cloudpilot.MinMemoryForDevice(t)}framebufferSizeForDevice(t){return 1024*this.cloudpilot.FramebufferSizeForDevice(t)}totalMemorySizeForDevice(t){return 1024*this.cloudpilot.TotalMemoryForDevice(t)}queuePenMove(t,e){this.cloudpilot.QueuePenMove(t,e)}queuePenUp(){this.cloudpilot.QueuePenUp()}queueButtonDown(t){this.cloudpilot.QueueButtonDown(t)}queueButtonUp(t){this.cloudpilot.QueueButtonUp(t)}queueKeyboardEvent(t,e){this.cloudpilot.QueueKeyboardEvent(t,e)}isPowerOff(){return!!this.cloudpilot.IsPowerOff()}isUiInitialized(){return!!this.cloudpilot.IsUIInitialized()}isSetupComplete(){return!!this.cloudpilot.IsSetupComplete()}getOSVersion(){return this.cloudpilot.GetOSVersion()}reset(){this.cloudpilot.Reset()}resetNoExtensions(){this.cloudpilot.ResetNoExtensions()}resetHard(){this.cloudpilot.ResetHard()}installDb(t){const e=this.copyIn(t),r=this.cloudpilot.InstallDb(e,t.length);return this.cloudpilot.Free(e),r}getPalette2bitMapping(){return this.cloudpilot.GetPalette2bitMapping()}getMemory(){const t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetMemorySize())}getMemory32(){let t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());if(3&t)throw new Error("unaligned pointer");return t>>>=2,this.module.HEAPU32.subarray(t,t+(this.cloudpilot.GetMemorySize()>>>2))}getDirtyPages(){const t=this.module.getPointer(this.cloudpilot.GetDirtyPagesPtr()),e=this.cloudpilot.GetMemorySize(),r=(e>>>13)+(e%8192==0?0:1);return this.module.HEAPU8.subarray(t,t+r)}loadMemory(t){const e=this.getMemory32();if((()=>{if(t.length!==e.length||t.length<256)return!1;for(let r=256;r>0;r--){if(t[t.length-r]!==e[e.length-r])return!1;if(4294967295===e[e.length-r])break}return!0})())return e.set(t),!0;{const e=this.copyIn32(t),r=this.cloudpilot.ImportMemoryImage(e,t.length<<2);return this.cloudpilot.Free(e),r}}getRomImage(){const t=this.module.getPointer(this.cloudpilot.GetRomPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetRomSize())}getSavestate(){const t=this.module.getPointer(this.cloudpilot.GetSavestatePtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetSavestateSize())}saveState(){return!!this.cloudpilot.SaveState()}loadState(t){const e=this.copyIn(t),r=this.cloudpilot.LoadState(e,t.length);return this.cloudpilot.Free(e),r}getHotsyncName(){return this.cloudpilot.GetHotsyncName()}setClockFactor(t){this.cloudpilot.SetClockFactor(t)}setHotsyncName(t){this.cloudpilot.SetHotsyncName(t)}backup(t){return e(this,void 0,void 0,function*(){const e=this.guard(()=>this.cloudpilot.StartBackup());try{return yield t(this.wrap(e))}finally{this.module.destroy(e)}})}getArchive(t){const e=t.GetArchiveSize();return this.copyOut(t.GetArchivePtr(),e)}setClipboardIntegration(t){this.cloudpilot.SetClipboardIntegration(t)}getClipboardIntegration(){return this.cloudpilot.GetClipboardIntegration()}isSuspended(){return this.cloudpilot.IsSuspended()}getSuspendKind(){return this.cloudpilot.IsSuspended()?this.cloudpilot.GetSuspendContext().GetKind():void 0}cancelSuspend(){this.cloudpilot.GetSuspendContext().Cancel()}getSuspendContextClipboardCopy(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardCopy())}getSuspendContextClipboardPaste(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardPaste())}setNetworkRedirection(t){this.cloudpilot.SetNetworkRedirection(t)}getNetworkRedirection(){return this.cloudpilot.GetNetworkRedirection()}getSuspendContextNetworkConnect(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkConnect())}getSuspendContextNetworkRpc(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkRpc())}getSuspendContextSerialSync(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextSerialSync())}copyBuffer(t){return this.copyIn(t)}freeBuffer(t){this.cloudpilot.Free(t)}setHotsyncNameManagement(t){this.cloudpilot.SetHotsyncNameManagement(t)}resolveBuffer(t,e){const r=this.module.getPointer(t);return this.module.HEAPU8.subarray(r,r+e)}withZipfileWalker(t,r){return e(this,void 0,void 0,function*(){const e=this.guard(()=>{const e=this.copyIn(t),r=new this.module.ZipfileWalker(t.length,e);return this.cloudpilot.Free(e),r});try{return yield r(function(t,e){return Object.setPrototypeOf({GetCurrentEntryContent:()=>{const r=e.getPointer(t.GetCurrentEntryContent()),i=t.GetCurrentEntrySize();return r>0&&i>0?e.HEAPU8.subarray(r,r+i):void 0}},t)}(this.wrap(e),this.module))}finally{this.module.destroy(e)}})}withZipfileWalkerSync(t,e){const r=this.guard(()=>{const e=this.copyIn(t),r=new this.module.ZipfileWalker(t.length,e);return this.cloudpilot.Free(e),r});try{return e(this.wrap(Object.setPrototypeOf({GetCurrentEntryContent:()=>this.copyOut(r.GetCurrentEntryContent(),r.GetCurrentEntrySize())},r)))}finally{this.module.destroy(r)}}serializeSessionImage(t){var e,r;const i=new this.module.SessionImage,n=this.cloudpilot.Nullptr(),o=this.copyIn(t.rom),s=t.memory?this.copyIn(t.memory):n,a=void 0!==t.savestate?this.copyIn(t.savestate):n;let c=n,p=0;if(void 0!==t.metadata){const e=(new TextEncoder).encode(JSON.stringify(t.metadata));p=e.length,c=this.copyIn(e)}i.SetRomImage(o,t.rom.length),i.SetMemoryImage(s,(null===(e=t.memory)||void 0===e?void 0:e.length)||0),i.SetDeviceId(t.deviceId),i.SetSavestate(a,(null===(r=t.savestate)||void 0===r?void 0:r.length)||0),i.SetMetadata(c,p);const u=i.Serialize()?this.copyOut(i.GetSerializedImage(),i.GetSerializedImageSize()):void 0;return this.module.destroy(i),[o,s,a,c].forEach(t=>this.cloudpilot.Free(t)),u}deserializeSessionImage(t){if(!t)return;const e=new this.module.SessionImage,r=this.copyIn(t),i=(()=>{if(!e.Deserialize(r,t.length))return;const i=this.copyOut(e.GetRomImage(),e.GetRomImageSize()),n=this.copyOut(e.GetMemoryImage(),e.GetMemoryImageSize()),o=this.copyOut(e.GetSavestate(),e.GetSavestateSize()),s=e.GetDeviceId();if(!u.includes(s))return void console.warn(`unsupported device ${s}`);let a;const c=this.copyOut(e.GetMetadata(),e.GetMetadataSize());if(c)try{a=JSON.parse((new TextDecoder).decode(c))}catch(t){console.warn("invalid metadata",t)}return{deviceId:s,rom:i,memory:n,savestate:o,metadata:a,version:e.GetVersion()}})();return this.module.destroy(e),this.cloudpilot.Free(r),i}launchAppByName(t){return this.cloudpilot.LaunchAppByName(t)}launchAppByDbHeader(t){if(t.length<32)return!1;const e=this.copyIn(t.subarray(0,32)),r=this.cloudpilot.LaunchAppByDbHeader(e,32);return this.cloudpilot.Free(e),r}deviceSupportsCardSize(t){return this.cloudpilot.DeviceSupportsCardSize(t)}clearExternalStorage(){this.cloudpilot.ClearExternalStorage()}allocateCard(t,e){return this.cloudpilot.AllocateCard(t,e>>>9)}decompressCard(t,e){const r=this.copyIn(e);let i;try{for(i=new this.module.GunzipContext(r,e.length,524288);0===i.GetState();)i.Continue();return-1===i.GetState()?(console.error(`gunzip failed: ${i.GetError()}`),!1):i.GetUncompressedSize()%512!=0?(console.error("failed to allocate card: invalid size of decompressed image"),!1):this.cloudpilot.AdoptCard(t,i.ReleaseUncompressedData(),i.GetUncompressedSize()>>>9)}finally{this.cloudpilot.Free(r),i&&this.module.destroy(i)}}getCardData(t){const e=this.module.getPointer(this.cloudpilot.GetCardData(t));if(0!==e)return this.module.HEAPU32.subarray(e>>>2,e+this.cloudpilot.GetCardSize(t)>>2)}getCardDirtyPages(t){const e=this.module.getPointer(this.cloudpilot.GetCardDirtyPages(t));if(0===e)return;const r=function(t){const e=(t>>>13)+(t%8192>0?1:0);return(e>>>3)+(e%8>0?1:0)}(this.cloudpilot.GetCardSize(t));return this.module.HEAPU8.subarray(e,e+r)}getMountedKey(){return this.cloudpilot.GetMountedKey()}mountCard(t){return this.cloudpilot.MountCard(t)}removeCard(t){return this.cloudpilot.RemoveCard(t)}remountCards(){this.cloudpilot.RemountCards()}getCardSupportLevel(t){return this.cloudpilot.GetSupportLevel(t)}loadSkin(t){const e=new this.module.SkinLoader(t);try{const t=this.module.getPointer(e.GetData());if(0===t)return;return(new TextDecoder).decode(this.module.HEAPU8.subarray(t,t+e.GetSize()))}finally{this.module.destroy(e)}}getTransportIR(){return this.transportIR}getTransportSerial(){return this.transportSerial}guard(t){if(this.amIdead)throw new Error("cloudpilot instance is dead");try{return t()}catch(t){throw this.amIdead=!0,this.cloudpilot=void 0,this.fatalErrorEvent.dispatch(t instanceof Error?t:new Error("unknown error")),t}}copyIn(t){const e=this.cloudpilot.Malloc(t.length),r=this.module.getPointer(e);return this.module.HEAPU8.subarray(r,r+t.length).set(t),e}copyIn32(t){const e=this.cloudpilot.Malloc(t.length<<2),r=this.module.getPointer(e);return this.module.HEAPU32.subarray(r>>>2,(r>>>2)+t.length).set(t),e}copyOut(t,e){const r=this.module.getPointer(t);return r>0&&e>0?this.module.HEAPU8.subarray(r,r+e).slice():void 0}wrap(t){return new Proxy(t,{get:(t,e)=>{const r=t[e];return"function"!=typeof r?r:(...e)=>this.guard(()=>r.apply(t,e))}})}wrapTransport(t){const e=new c.J;return t.SetRequestTransferCallback(this.module.addFunction(()=>e.dispatch(),"v")),this.wrap(Object.setPrototypeOf({Receive:()=>{const e=t.RxBytesPending();return this.copyOut(t.Receive(),e)},Send:(e,r)=>{var i;const n=e&&this.copyIn(e);t.Send(null!==(i=null==e?void 0:e.length)&&void 0!==i?i:0,null!=n?n:this.cloudpilot.Nullptr(),r),n&&this.cloudpilot.Free(n)},frameCompleteEvent:e},t))}}var d;t([l()],h.prototype,"enableLogging",null),t([l()],h.prototype,"getRomInfo",null),t([l()],h.prototype,"initializeSession",null),t([l()],h.prototype,"cyclesPerSecond",null),t([l()],h.prototype,"runEmulation",null),t([l()],h.prototype,"getFrame",null),t([l()],h.prototype,"isScreenDirty",null),t([l()],h.prototype,"markScreenClean",null),t([l()],h.prototype,"minRamForDevice",null),t([l()],h.prototype,"framebufferSizeForDevice",null),t([l()],h.prototype,"totalMemorySizeForDevice",null),t([l()],h.prototype,"queuePenMove",null),t([l()],h.prototype,"queuePenUp",null),t([l()],h.prototype,"queueButtonDown",null),t([l()],h.prototype,"queueButtonUp",null),t([l()],h.prototype,"queueKeyboardEvent",null),t([l()],h.prototype,"isPowerOff",null),t([l()],h.prototype,"isUiInitialized",null),t([l()],h.prototype,"isSetupComplete",null),t([l()],h.prototype,"getOSVersion",null),t([l()],h.prototype,"reset",null),t([l()],h.prototype,"resetNoExtensions",null),t([l()],h.prototype,"resetHard",null),t([l()],h.prototype,"installDb",null),t([l()],h.prototype,"getPalette2bitMapping",null),t([l()],h.prototype,"getMemory",null),t([l()],h.prototype,"getMemory32",null),t([l()],h.prototype,"getDirtyPages",null),t([l()],h.prototype,"loadMemory",null),t([l()],h.prototype,"getRomImage",null),t([l()],h.prototype,"getSavestate",null),t([l()],h.prototype,"saveState",null),t([l()],h.prototype,"loadState",null),t([l()],h.prototype,"getHotsyncName",null),t([l()],h.prototype,"setClockFactor",null),t([l()],h.prototype,"setHotsyncName",null),t([l()],h.prototype,"setClipboardIntegration",null),t([l()],h.prototype,"getClipboardIntegration",null),t([l()],h.prototype,"isSuspended",null),t([l()],h.prototype,"getSuspendKind",null),t([l()],h.prototype,"cancelSuspend",null),t([l()],h.prototype,"getSuspendContextClipboardCopy",null),t([l()],h.prototype,"getSuspendContextClipboardPaste",null),t([l()],h.prototype,"setNetworkRedirection",null),t([l()],h.prototype,"getNetworkRedirection",null),t([l()],h.prototype,"getSuspendContextNetworkConnect",null),t([l()],h.prototype,"getSuspendContextNetworkRpc",null),t([l()],h.prototype,"getSuspendContextSerialSync",null),t([l()],h.prototype,"copyBuffer",null),t([l()],h.prototype,"freeBuffer",null),t([l()],h.prototype,"setHotsyncNameManagement",null),t([l()],h.prototype,"resolveBuffer",null),t([l()],h.prototype,"serializeSessionImage",null),t([l()],h.prototype,"deserializeSessionImage",null),t([l()],h.prototype,"launchAppByName",null),t([l()],h.prototype,"launchAppByDbHeader",null),t([l()],h.prototype,"deviceSupportsCardSize",null),t([l()],h.prototype,"clearExternalStorage",null),t([l()],h.prototype,"allocateCard",null),t([l()],h.prototype,"decompressCard",null),t([l()],h.prototype,"getCardData",null),t([l()],h.prototype,"getCardDirtyPages",null),t([l()],h.prototype,"getMountedKey",null),t([l()],h.prototype,"mountCard",null),t([l()],h.prototype,"removeCard",null),t([l()],h.prototype,"remountCards",null),t([l()],h.prototype,"getCardSupportLevel",null),t([l()],h.prototype,"loadSkin",null),function(t){t.portrait="portrait",t.landscape90="landscape90",t.landscape270="landscape270",t.portrait180="portrait180"}(d||(d={}));const m="safari"in window,y=!!navigator.platform.match(/iPhone|iPad|iPod/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;function _(t,r){let i,n;const o=document.createElement("canvas");return(s,a)=>e(this,void 0,void 0,function*(){if(i===s&&n===a)return o;o.width=s,o.height=a;const e=o.getContext("2d");if(!e)throw new Error("get a new browser");return e.drawImage(yield t,0,0,o.width,o.height),(m||y)&&(yield r).indexOf("data:image")>=0&&(yield new Promise(t=>setTimeout(t,0)),e.drawImage(yield t,0,0,o.width,o.height)),i=s,n=a,o})}function f(t){return new Promise((e,r)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>r(),i.src=t})}y&&navigator.userAgent.match(/(crios)|(fxios)/i),navigator.userAgent.match(/pwashell/i),navigator.userAgent.match(/android/i),navigator.userAgent.toLowerCase().indexOf("firefox");const v=t=>`data:image/svg+xml;base64,${btoa(t)}`;class g{constructor(t){this.cloudpilot=t,this.images=new Map}loadSkinElement(t){if(this.images.has(t))return this.images.get(t);const e=this.cloudpilot.then(e=>e.loadSkin(t)).then(e=>e?Promise.all([e,f(v(e))]):Promise.reject(new Error(`failed to load skin ${t}`))),r=_(e.then(([,t])=>t),e.then(([t])=>t));return this.images.set(t,r),r}}class b{constructor(t){this.query=t,this.changeEvent=new c.J,this.last=t()}update(){const t=this.query();t!==this.last&&(this.changeEvent.dispatch(t),this.last=t)}}new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const S=new Error("request for lock canceled");class w{constructor(t,e=S){this._value=t,this._cancelError=e,this._queue=[],this._weightedWaiters=[]}acquire(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((r,i)=>{const n={resolve:r,reject:i,weight:t,priority:e},o=C(this._queue,t=>e<=t.priority);-1===o&&t<=this._value?this._dispatchItem(n):this._queue.splice(o+1,0,n)})}runExclusive(t){return e=this,r=arguments,n=function*(t,e=1,r=0){const[i,n]=yield this.acquire(e,r);try{return yield t(i)}finally{n()}},new((i=void 0)||(i=Promise))(function(t,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i(function(t){t(r)})).then(s,a)}c((n=n.apply(e,r||[])).next())});var e,r,i,n}waitForUnlock(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,e)?Promise.resolve():new Promise(r=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),function(t,e){const r=C(t,t=>e.priority<=t.priority);t.splice(r+1,0,e)}(this._weightedWaiters[t-1],{resolve:r,priority:e})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const e=this._value;this._value-=t.weight,t.resolve([e,this._newReleaser(t.weight)])}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let t=this._value;t>0;t--){const e=this._weightedWaiters[t-1];e&&(e.forEach(t=>t.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let e=this._value;e>0;e--){const r=this._weightedWaiters[e-1];if(!r)continue;const i=r.findIndex(e=>e.priority<=t);(-1===i?r:r.splice(0,i)).forEach(t=>t.resolve())}}}_couldLockImmediately(t,e){return(0===this._queue.length||this._queue[0].priority<e)&&t<=this._value}}function C(t,e){for(let r=t.length-1;r>=0;r--)if(e(t[r]))return r;return-1}class I{constructor(t){this._semaphore=new w(1,t)}acquire(){return t=this,e=arguments,i=function*(t=0){const[,e]=yield this._semaphore.acquire(1,t);return e},new((r=void 0)||(r=Promise))(function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((i=i.apply(t,e||[])).next())});var t,e,r,i}runExclusive(t,e=0){return this._semaphore.runExclusive(()=>t(),1,e)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const E=window.AudioContext||window.webkitAudioContext;function D(t,e=100){return new Promise((r,i)=>{setTimeout(()=>i(new Error("timeout")),e),t.then(r,i)})}class G{constructor(t){this.emulationService=t,this.initialize=()=>this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){for(let t=0;t<3;t++)if(yield this.initializeAudioUnguarded())return!1;return!0})),this.updateState=(t=!1)=>this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){if(!this.context)return;if(this.isRunning()===this.shouldRun())return;t||this.isRunning()||!this.shouldRun()||this.applyPwmUpdate();const e=this.context.state;if(this.shouldRun())try{this.updateGain(),yield D(this.context.resume()),console.log("resume audio context")}catch(t){console.error(`failed to resume audio from state ${e}`,t)}else try{yield D(this.context.suspend()),console.log("suspend audio context")}catch(t){console.error(`failed to suspend audio from state ${e}`,t)}console.log(`audio context state change ${e} -> ${this.context.state}`)})),this.onPwmUpdate=t=>e(this,void 0,void 0,function*(){this.pendingPwmUpdate=t,this.initialized&&(this.shouldRun()!==this.isRunning()&&this.updateState(!0),this.shouldRun()&&this.applyPwmUpdate())}),this.mutex=new I,this.initialized=!1,this.muted=!1,this.emulationService.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.emulationService.emulationStateChangeEvent.addHandler(()=>this.updateState()),this.emulationService.powerOffChangeEvent.addHandler(()=>this.updateState()),y||document.addEventListener("visibilitychange",()=>this.updateState())}isInitialized(){return this.initialized}mute(t){this.muted=t,this.updateState()}isMuted(){return this.muted}shouldRun(){return this.emulationService.isRunning()&&!this.emulationService.isPowerOff()&&!this.muted&&this.gain()>0&&("hidden"!==document.visibilityState||y||this.runHidden())}updateGain(){this.gainNode&&(this.gainNode.gain.value=this.gain())}initializeAudioUnguarded(){return e(this,void 0,void 0,function*(){if(this.initialized)return!0;try{this.context=new E}catch(t){return console.error("web audio not available",t),!1}try{this.context.destination.channelCount=1}catch(t){console.warn("audio driver: failed to set channel count",t)}try{yield this.start()}catch(t){return console.error("failed to initialize audio context",t),!1}return this.context.addEventListener("statechange",()=>{var t;"interrupted"===(null===(t=this.context)||void 0===t?void 0:t.state)&&this.updateState()}),this.gainNode=this.context.createGain(),this.gainNode.channelCount=1,this.gainNode.channelInterpretation="speakers",this.gainNode.gain.value=this.gain(),this.gainNode.connect(this.context.destination),this.applyPwmUpdate(),this.initialized=!0,!0})}start(){return e(this,void 0,void 0,function*(){this.context&&(yield D(this.context.resume()),this.updateState(),console.log("audio context initialized"))})}isRunning(){var t;return"running"===(null===(t=this.context)||void 0===t?void 0:t.state)}applyPwmUpdate(){if(!this.context||!this.pendingPwmUpdate)return;const{frequency:t,dutyCycle:e}=this.pendingPwmUpdate,r=this.context.sampleRate;if(this.pendingPwmUpdate=void 0,t<=0||e<=0||t>=r)return void this.disconnectSource();const i=this.context.createBuffer(1,Math.round(r/t),r),n=i.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=t/n.length<e?1:0;const o=this.context.createBufferSource();o.channelCount=1,o.channelInterpretation="speakers",o.loop=!0,o.buffer=i,this.disconnectSource(),o.connect(this.gainNode),o.start(),this.bufferSourceNode=o,this.pendingPwmUpdate=void 0}disconnectSource(){this.bufferSourceNode&&(this.bufferSourceNode.stop(),this.bufferSourceNode.disconnect(),this.bufferSourceNode=void 0)}gain(){return this.getVolume()/2}}class P extends G{constructor(){super(...arguments),this.volume=.5}setVolume(t){this.volume=Math.max(Math.min(t,1),0),this.updateGain()}getVolume(){return this.volume}runHidden(){return!1}}var x,k;function M(t){switch(t){case n.i710:case n.m520:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.handera330:case n.handera330c:case n.lp168:return{screenSize:2,width:240,height:320,silkscreenHeight:0};case n.pegS300:case n.pegS320:case n.pegS500c:return{screenSize:0,width:160,height:160,silkscreenHeight:76};case n.pegT600c:case n.pegT400:case n.pegT650c:return{screenSize:1,width:320,height:320,silkscreenHeight:140,silkscreenOvershoot:10};case n.pegN600c:case n.pegN700c:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.pegNR70:return{screenSize:3,width:320,height:480,silkscreenHeight:0};case n.acerS11:return{screenSize:0,width:160,height:160,silkscreenHeight:60,siklscreenShift:8};default:return{screenSize:0,width:160,height:160,silkscreenHeight:60}}}function R(t){switch(t){case n.pilot:case n.palmPilot:case n.iii:case n.palmV:case n.palmVx:case n.iiix:case n.iiixe:case n.iiie:case n.m100:case n.m105:case n.m125:case n.m500:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:case n.i705:case n.handera330:case n.pegS300:case n.pegS320:case n.pegT400:case n.acerS11:return!1;default:return!0}}(k=x||(x={})).sdcard="sdcard",k.memorystick="memorystick",k.none="none";const z=[135,135,105],T=[0,0,0],H=new Array(16).fill(0).map((t,e)=>T.map((t,r)=>Math.floor((e*t+(15-e)*z[r])/15))).map(([t,e,r])=>4278190080|r<<16|e<<8|t),A=H.map(t=>{var e;return"#"+(null===(e=(16777215&t).toString(16).padStart(6,"0").match(/(..?)/g))||void 0===e?void 0:e.reverse().join(""))}),B=n.m515,N=A[2],L=A[0],U="rgba(0,0,0,0.2)";function F(t){const e=M(t),r=(0===e.screenSize?3:2)*devicePixelRatio,i={frameDevice:1,frameCanvas:r},n=t=>({frameDevice:t,frameCanvas:t*r}),o=t=>({frameDevice:t,frameCanvas:i.frameCanvas+t*r}),s=e.silkscreenHeight>0?n(1):n(0),a=n(function(t){switch(t){case 3:case 1:return 60;case 2:return 45;default:return 30}}(e.screenSize));return{scale:r,borderWidth:i,height:n(2*i.frameDevice+e.height+s.frameDevice+e.silkscreenHeight+a.frameDevice),width:n(2*i.frameDevice+e.width),screenHeight:n(e.height),screenWidth:n(e.width),screenLeft:o(0),screenTop:o(0),screenBottom:o(e.height),separatorHeight:s,silkscreenHeight:n(e.silkscreenHeight),silkscreenTop:o(e.height+s.frameDevice),silkscreenBottom:o(e.height+s.frameDevice+e.silkscreenHeight),softSilkscreenHeight:n(e.silkscreenHeight>0?0:e.height-e.width),buttonHeight:a,buttonWidth:a,buttonTop:o(e.height+s.frameDevice+e.silkscreenHeight),buttonBottom:o(e.height+s.frameDevice+e.silkscreenHeight+a.frameDevice)}}class j{constructor(t){this.skinLoader=t,this.layout=F(B),this.onResize=new c.J}get width(){switch(this.getOrientation()){case d.portrait:case d.portrait180:case void 0:return this.layout.width.frameCanvas;default:return this.layout.height.frameCanvas}}get height(){switch(this.getOrientation()){case d.portrait:case d.portrait180:case void 0:return this.layout.height.frameCanvas;default:return this.layout.width.frameCanvas}}updateEmulationCanvas(t){this.setupTransformation(),this.drawEmulationCanvas(t),this.onAfterUpdateCanvas()}eventToPalmCoordinates(t,e=!1){if(!this.ctx)return;const r=this.ctx.canvas.getBoundingClientRect();let i,n,o,s;r.width/r.height>this.width/this.height?(s=r.height,o=this.width/this.height*r.height,n=r.top,i=r.left+(r.width-o)/2):(o=r.width,s=this.height/this.width*r.width,i=r.left,n=r.top+(r.height-s)/2);let a=(t.clientX-i)/o*this.width/this.layout.scale,c=(t.clientY-n)/s*this.height/this.layout.scale;switch(this.getOrientation()){case d.landscape90:{const t=c;c=this.layout.height.frameDevice-a,a=t;break}case d.landscape270:{const t=c;c=a,a=this.layout.width.frameDevice-t;break}case d.portrait180:a=this.layout.width.frameDevice-a,c=this.layout.height.frameDevice-c}a-=this.layout.borderWidth.frameDevice,c-=this.layout.borderWidth.frameDevice,c>=this.layout.screenHeight.frameDevice&&(c<=this.layout.screenHeight.frameDevice+this.layout.separatorHeight.frameDevice?c=this.layout.screenHeight.frameDevice:c-=this.layout.separatorHeight.frameDevice);const p=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice;if(e)a<0&&(a=0),a>=this.layout.screenWidth.frameDevice&&(a=this.layout.screenWidth.frameDevice-1),c<0&&(c=0),c>=p&&(c=p-1);else if(a<0||a>=this.layout.screenWidth.frameDevice||c<0||c>=p)return;return[a,c]}isSilkscreen(t){const[,e]=t;return!this.isButtons(t)&&e>=this.layout.screenHeight.frameDevice}isButtons([,t]){return t>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice}determineButton([t,e]){return t>=this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice?3:t>=this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice?2:t>=2*this.layout.buttonWidth.frameDevice?e>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice/2?5:4:t>=this.layout.buttonWidth.frameDevice?1:0}initWithCanvas(t){return e(this,void 0,void 0,function*(){var e;if(void 0===t&&(t=null===(e=this.ctx)||void 0===e?void 0:e.canvas),!t)return;this.layout=F(this.getDeviceId()),this.onResize.dispatch(),t.width=this.width,t.height=this.height;const r=t.getContext("2d");if(!r)throw new Error("canvas not supported - get a new browser");this.ctx=r,this.setupTransformation(),this.fillCanvasRect(0,0,this.layout.width.frameCanvas,this.layout.height.frameCanvas,this.frameColor()),this.fillRect(0,0,this.layout.screenWidth.frameDevice,this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.separatorHeight.frameDevice+this.layout.buttonHeight.frameDevice,this.backgroundColor()),this.drawEmulationCanvas(),yield Promise.all([this.drawSilkscreen(),this.drawButtons()])})}drawButtons(){return e(this,arguments,void 0,function*(t=[]){this.ctx&&(this.setupTransformation(),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.buttonsImage()(this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),this.layout.screenLeft.frameCanvas,this.layout.buttonTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),t.includes(0)&&this.fillRect(0,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,U),t.includes(1)&&this.fillRect(this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,U),t.includes(2)&&this.fillRect(this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,U),t.includes(3)&&this.fillRect(this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,U),t.includes(4)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,U),t.includes(5)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice+this.layout.buttonHeight.frameDevice/2,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,U))})}onAfterUpdateCanvas(){}setupTransformation(){if(this.ctx)switch(this.ctx.resetTransform(),this.getOrientation()){case d.portrait:case void 0:break;case d.landscape90:this.ctx.translate(this.layout.height.frameCanvas,0),this.ctx.rotate(Math.PI/2);break;case d.landscape270:this.ctx.translate(0,this.layout.width.frameCanvas),this.ctx.rotate(3*Math.PI/2);break;case d.portrait180:this.ctx.translate(this.layout.width.frameCanvas,this.layout.height.frameCanvas),this.ctx.rotate(Math.PI)}}drawSilkscreen(){return e(this,void 0,void 0,function*(){0!==this.layout.silkscreenHeight.frameCanvas&&this.ctx&&(this.setupTransformation(),this.fillRect(this.layout.screenLeft.frameDevice,this.layout.silkscreenTop.frameDevice,this.layout.screenWidth.frameDevice,this.layout.silkscreenHeight.frameDevice,N),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.silkscreenImage()(this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas),this.layout.borderWidth.frameCanvas,this.layout.silkscreenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas))})}drawEmulationCanvas(t=this.lastEmulationCanvas){t&&this.ctx&&(this.lastEmulationCanvas=t,this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(t,this.layout.screenLeft.frameCanvas,this.layout.screenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.screenHeight.frameCanvas))}fillRect(t,e,r,i,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(this.layout.borderWidth.frameCanvas+this.layout.scale*t,this.layout.borderWidth.frameCanvas+this.layout.scale*e,this.layout.scale*r,this.layout.scale*i),this.ctx.fillStyle=n,this.ctx.fill())}fillCanvasRect(t,e,r,i,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(t,e,r,i),this.ctx.fillStyle=n,this.ctx.fill())}silkscreenImage(){return this.skinLoader.loadSkinElement(this.silkscreenSkinElement())}silkscreenSkinElement(){switch(this.getDeviceId()){case n.pegT600c:case n.pegT650c:return"silkscreen/clie-t600.svg";case n.pegN700c:case n.pegN600c:return"silkscreen/clie-n610.svg";case n.pegS320:case n.pegS300:return"silkscreen/clie-s300.svg";case n.pegS500c:return"silkscreen/clie-s500.svg";case n.pegT400:return"silkscreen/clie-t415.svg";case n.acerS11:return"silkscreen/acer-s10.svg";case n.palmPilot:case n.pilot:case n.iii:case n.palmVII:return"silkscreen/pilot.svg";case n.m500:return"silkscreen/m500.svg";case n.m505:case n.m515:case n.m520:return"silkscreen/m515.svg";case n.iiic:return"silkscreen/iiic.svg";case n.m100:case n.m105:case n.m125:return"silkscreen/m100.svg";case n.m130:return"silkscreen/m130.svg";case n.i710:return"silkscreen/tungstenw.svg";case n.i705:return"silkscreen/i705.svg";case n.iiix:case n.iiixe:case n.palmVx:case n.palmV:case n.palmVIIEZ:case n.palmVIIx:default:return"silkscreen/v.svg"}}buttonsImage(){return this.skinLoader.loadSkinElement(this.buttonsSkinElement())}buttonsSkinElement(){switch(this.getDeviceId()){case n.acerS11:return"hard-buttons/acer-s10.svg";case n.pegNR70:return"hard-buttons/clie-nr70.svg";case n.pegN700c:return"hard-buttons/clie-n700.svg";case n.pegN600c:return"hard-buttons/clie-n610.svg";case n.pegS300:return"hard-buttons/clie-s300.svg";case n.pegS500c:return"hard-buttons/clie-s500.svg";case n.pegS320:return"hard-buttons/clie-s320.svg";case n.pegT400:case n.pegT600c:case n.pegT650c:return"hard-buttons/clie-t415.svg";case n.pilot:case n.palmPilot:return"hard-buttons/pilot.svg";case n.m500:return"hard-buttons/m500.svg";case n.m505:case n.m515:case n.m520:return"hard-buttons/m515.svg";case n.iiic:return"hard-buttons/iiic.svg";case n.m100:case n.m105:return"hard-buttons/m100.svg";case n.m125:return"hard-buttons/m125.svg";case n.m130:return"hard-buttons/m130.svg";case n.i710:return"hard-buttons/tungstenw.svg";case n.iii:case n.iiix:case n.iiixe:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:return"hard-buttons/iiix.svg";case n.iiie:return"hard-buttons/iiie.svg";case n.i705:return"hard-buttons/i705.svg";case n.handera330:return"hard-buttons/handera330.svg";case n.handera330c:return"hard-buttons/handera330c.svg";case n.lp168:return"hard-buttons/lp168.svg";case n.palmVx:case n.palmV:default:return"hard-buttons/v.svg"}}backgroundColor(){return R(this.getDeviceId())?"white":L}frameColor(){return R(this.getDeviceId())?"white":"#ccc"}}const O='<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Game Controller</title><path d="M467.51 248.83c-18.4-83.18-45.69-136.24-89.43-149.17A91.5 91.5 0 00352 96c-26.89 0-48.11 16-96 16s-69.15-16-96-16a99.09 99.09 0 00-27.2 3.66C89 112.59 61.94 165.7 43.33 248.83c-19 84.91-15.56 152 21.58 164.88 26 9 49.25-9.61 71.27-37 25-31.2 55.79-40.8 119.82-40.8s93.62 9.6 118.66 40.8c22 27.41 46.11 45.79 71.42 37.16 41.02-14.01 40.44-79.13 21.43-165.04z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><circle cx="292" cy="224" r="20"/><path d="M336 288a20 20 0 1120-19.95A20 20 0 01336 288z"/><circle cx="336" cy="180" r="20"/><circle cx="380" cy="224" r="20"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 176v96M208 224h-96"/></svg>',W=_(f(v(O)),O);class V extends j{constructor(){super(...arguments),this.deviceId=n.m515,this.orientation=d.portrait,this.gameModeIndicatorEnabled=!0,this.gameModeActive=!1,this.lastActiveButtons=void 0}initialize(t){return e(this,arguments,void 0,function*(t,e=this.deviceId,r=this.orientation){var i;this.deviceId=e,this.orientation=r;const n=t||(null===(i=this.ctx)||void 0===i?void 0:i.canvas);n&&(n.width=this.width,n.height=this.height,n.style.objectFit="contain"),yield this.initWithCanvas(t)})}updateOrientation(t){this.orientation=t,this.initialize()}toggleGameModeIndicator(t){this.gameModeActive=t,this.drawButtons(this.lastActiveButtons)}setGameModeIndicatorEnabled(t){this.gameModeIndicatorEnabled=t,this.drawButtons(this.lastActiveButtons)}isGameModeIndicatorEnabled(){return this.gameModeIndicatorEnabled}getCanvas(){var t;return null===(t=this.ctx)||void 0===t?void 0:t.canvas}drawButtons(){const t=Object.create(null,{drawButtons:{get:()=>super.drawButtons}});return e(this,arguments,void 0,function*(e=[]){this.lastActiveButtons=e,yield t.drawButtons.call(this,e),this.gameModeActive&&this.gameModeIndicatorEnabled&&(yield this.drawGameModeIndicator())})}getDeviceId(){return this.deviceId}getOrientation(){return this.orientation}drawGameModeIndicator(){return e(this,void 0,void 0,function*(){if(!this.ctx)return;const t=Math.floor(.1*this.layout.screenWidth.frameCanvas),e=Math.floor(.8*t),r=Math.floor(.1*t),i=Math.floor(.11*t);this.fillCanvasRect(this.layout.screenLeft.frameCanvas-r+this.layout.screenWidth.frameCanvas-t,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-r,t,t,"rgba(200, 200, 200, 0.7)"),this.ctx.drawImage(yield W(t,t),this.layout.screenLeft.frameCanvas+this.layout.screenWidth.frameCanvas-r-t+i,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-r+i,e,e)})}}var q=r(389);const K=new WeakMap,$=new WeakMap,Q=new Map([[0,null]]),Y=new Map([[0,null]]),Z=(t=>{const e=(r=t,{...r,connect:({call:t})=>async()=>{const{port1:e,port2:r}=new MessageChannel,i=await t("connect",{port:e},[e]);return K.set(r,i),r},disconnect:({call:t})=>async e=>{const r=K.get(e);if(void 0===r)throw new Error("The given port is not connected.");await t("disconnect",{portId:r})},isSupported:({call:t})=>()=>t("isSupported")});var r;return t=>{const r=(t=>{if($.has(t))return $.get(t);const e=new Map;return $.set(t,e),e})(t);t.addEventListener("message",({data:t})=>{const{id:e}=t;if(null!==e&&r.has(e)){const{reject:i,resolve:n}=r.get(e);r.delete(e),void 0===t.error?n(t.result):i(new Error(t.error.message))}}),(t=>"function"==typeof t.start)(t)&&t.start();const i=(e,i=null,n=[])=>new Promise((o,s)=>{const a=(0,q.generateUniqueNumber)(r);r.set(a,{reject:s,resolve:o}),null===i?t.postMessage({id:a,method:e},n):t.postMessage({id:a,method:e,params:i},n)}),n=(e,r,i=[])=>{t.postMessage({id:null,method:e,params:r},i)};let o={};for(const[t,r]of Object.entries(e))o={...o,[t]:r({call:i,notify:n})};return{...o}}})({clearInterval:({call:t})=>e=>{"symbol"==typeof Q.get(e)&&(Q.set(e,null),t("clear",{timerId:e,timerType:"interval"}).then(()=>{Q.delete(e)}))},clearTimeout:({call:t})=>e=>{"symbol"==typeof Y.get(e)&&(Y.set(e,null),t("clear",{timerId:e,timerType:"timeout"}).then(()=>{Y.delete(e)}))},setInterval:({call:t})=>(e,r=0,...i)=>{const n=Symbol(),o=(0,q.generateUniqueNumber)(Q);Q.set(o,n);const s=()=>t("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:o,timerType:"interval"}).then(()=>{const t=Q.get(o);if(void 0===t)throw new Error("The timer is in an undefined state.");t===n&&(e(...i),Q.get(o)===n&&s())});return s(),o},setTimeout:({call:t})=>(e,r=0,...i)=>{const n=Symbol(),o=(0,q.generateUniqueNumber)(Y);return Y.set(o,n),t("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:o,timerType:"timeout"}).then(()=>{const t=Y.get(o);if(void 0===t)throw new Error("The timer is in an undefined state.");t===n&&(Y.delete(o),e(...i))}),o}}),J=(()=>{let t=null;return()=>{if(null!==t)return t;const e=new Blob(['(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,s=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<s?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*s);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,u=r(i),c=a(u,i),l=t(c);e.addUniqueNumber=l,e.generateUniqueNumber=c}(t)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,o=(e,t)=>Object.assign(new Error(e),{status:t}),s=t=>o(\'The handler of the method called "\'.concat(t,\'" returned an unexpected result.\'),e),a=(t,r)=>async({data:{id:a,method:i,params:u}})=>{const c=r[i];try{if(void 0===c)throw(e=>o(\'The requested method called "\'.concat(e,\'" is not supported.\'),n))(i);const r=void 0===u?c():c(u);if(void 0===r)throw(t=>o(\'The handler of the method called "\'.concat(t,\'" returned no required result.\'),e))(i);const l=r instanceof Promise?await r:r;if(null===a){if(void 0!==l.result)throw s(i)}else{if(void 0===l.result)throw s(i);const{result:e,transferables:r=[]}=l;t.postMessage({id:a,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:a})}};var i=r(455);const u=new Map,c=(e,r,n)=>({...r,connect:({port:t})=>{t.start();const n=e(t,r),o=(0,i.generateUniqueNumber)(u);return u.set(o,()=>{n(),t.close(),u.delete(o)}),{result:o}},disconnect:({portId:e})=>{const r=u.get(e);if(void 0===r)throw(e=>o(\'The specified parameter called "portId" with the given value "\'.concat(e,\'" does not identify a port connected to this worker.\'),t))(e);return r(),{result:null}},isSupported:async()=>{if(await new Promise(e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=({data:t})=>e(null!==t),n.postMessage(t,[t])})){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),l=(e,t,r=()=>!0)=>{const n=c(l,t,r),o=a(e,n);return e.addEventListener("message",o),()=>e.removeEventListener("message",o)},d=(e,t)=>r=>{const n=t.get(r);if(void 0===n)return Promise.resolve(!1);const[o,s]=n;return e(o),t.delete(r),s(!1),Promise.resolve(!0)},f=(e,t,r,n)=>(o,s,a)=>{const i=o+s-t.timeOrigin,u=i-t.now();return new Promise(t=>{e.set(a,[r(n,u,i,e,t,a),t])})},m=new Map,h=d(globalThis.clearTimeout,m),p=new Map,v=d(globalThis.clearTimeout,p),w=((e,t)=>{const r=(n,o,s,a)=>{const i=n-e.now();i>0?o.set(a,[t(r,i,n,o,s,a),s]):(o.delete(a),s(!0))};return r})(performance,globalThis.setTimeout),g=f(m,performance,globalThis.setTimeout,w),T=f(p,performance,globalThis.setTimeout,w);l(self,{clear:async({timerId:e,timerType:t})=>({result:await("interval"===t?h(e):v(e))}),set:async({delay:e,now:t,timerId:r,timerType:n})=>({result:await("interval"===n?g:T)(e,t,r)})})})()})();'],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(e);return t=(t=>{const e=new Worker(t);return Z(e)})(r),setTimeout(()=>URL.revokeObjectURL(r)),t}})();var X;!function(t){t[t.animationFrame=0]="animationFrame",t[t.timeout=1]="timeout"}(X||(X={}));class tt{constructor(t){this.callback=t}schedule(){void 0===this.handle&&(this.handle=requestAnimationFrame(t=>{this.handle=void 0,this.callback(t)}))}cancel(){void 0!==this.handle&&(cancelAnimationFrame(this.handle),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return X.animationFrame}}class et{constructor(t,e=60){this.callback=t,this.fps=e}schedule(){if(void 0!==this.handle)return;const t=performance.now(),e=1e3*Math.ceil(t/1e3*this.fps)/this.fps;this.handle=((...t)=>J().setTimeout(...t))(()=>{this.handle=void 0,this.callback(performance.now())},Math.max(e-t,0))}cancel(){var t;void 0!==this.handle&&(t=this.handle,J().clearTimeout(t),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return X.timeout}}class rt{constructor(t,e){this.queue=new Array(t).fill(0),this.reset(e)}reset(t=0){this.next=1,this.size=1,this.queue[0]=t}push(t){return this.queue[this.next]=t,this.next=(this.next+1)%this.queue.length,this.size<this.queue.length&&this.size++,this}calculateAverage(){let t=0;for(let e=0;e<this.size;e++)t+=this.queue[e];return t/this.size}}class it{constructor(t){this.start=0,this.size=0,this.buffer=new Array(t)}push(t){return this.size<this.buffer.length?this.buffer[(this.start+this.size++)%this.buffer.length]=t:(this.start=(this.start+1)%this.buffer.length,this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}pop(){if(0===this.size)return;const t=this.buffer[this.start];return this.start=(this.start+1)%this.buffer.length,this.size--,t}peekLast(){if(0!==this.size)return this.buffer[(this.start+this.size-1)%this.buffer.length]}replaceLast(t){return this.size>0&&(this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}count(){return this.size}flush(){return this.start=0,this.size=0,this}}class nt{constructor(){this.onFrameComplete=()=>{this.transport&&this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()})},this.receiveEvent=new c.J,this.dispatchEvent=new c.J,this.isSync=!1}bind(t){this.transport!==t&&(this.transport&&this.transport.frameCompleteEvent.removeHandler(this.onFrameComplete),t.frameCompleteEvent.addHandler(this.onFrameComplete),t.SetModeSync(this.isSync),this.transport=t)}send(t,e){this.transport&&(this.transport.IsOpen()||!this.transport.GetModeSync()?(this.transport.Send(t,e),setTimeout(()=>this.dispatchEvent.dispatch(),0)):this.receiveEvent.dispatch({data:void 0,isFrameComplete:!0}))}setModeSync(t){var e;this.isSync=t,null===(e=this.transport)||void 0===e||e.SetModeSync(t)}getModeSync(){var t,e,r;return null!==(r=null===(e=null===(t=this.transport)||void 0===t?void 0:t.GetModeSync)||void 0===e?void 0:e.call(t))&&void 0!==r&&r}dispatch(){if(!this.transport)return;const t=this.transport.RxBytesPending();0!==t&&(this.transport.GetModeSync()&&t<1024||this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()}))}}class ot{constructor(){this.onPwmUpdate=t=>{this.pendingPwmUpdates.count()>0&&this.pendingPwmUpdates.peekLast().frequency<0?this.pendingPwmUpdates.replaceLast(t):this.pendingPwmUpdates.push(t)},this.advanceEmulation=t=>{if(this.isDirty=!1,!this.isRunning)return;if(!this.cloudpilotInstance||this.hasFatalError()||t<this.clockEmulator)return;this.cloudpilotInstance.isSuspended()&&5===this.cloudpilotInstance.getSuspendKind()&&t-this.serialSyncStartedAt>250&&(console.log("serial sync timeout, waking emulator"),this.cloudpilotInstance.getSuspendContextSerialSync().Cancel());const e=this.cloudpilotInstance.isSuspended();let r=!1;this.cloudpilotInstance.setClockFactor(this.emulationSpeed*this.getConfiguredSpeed()),t-this.clockEmulator>1e3/30&&(this.clockEmulator=t-1e3/30);const i=(t-this.clockEmulator)/1e3*this.cloudpilotInstance.cyclesPerSecond(),n=performance.now();let o=0;for(;o<i;)if(o+=this.cloudpilotInstance.runEmulation(Math.ceil(i-o)),this.cloudpilotInstance.isSuspended()){r=!0;break}const s=o/this.cloudpilotInstance.cyclesPerSecond()*1e3,a=performance.now()-n;this.clockEmulator+=Math.max(s,a),this.speedAverage.push(s/(a>0?a:s/1e3)*this.emulationSpeed),this.updateEmulationSpeed(this.speedAverage.calculateAverage()),r&&!e&&(5===this.cloudpilotInstance.getSuspendKind()?this.serialSyncStartedAt=performance.now():this.handleSuspend());const c=this.cloudpilotInstance.isPowerOff(),p=this.cloudpilotInstance.isUiInitialized();if(c!==this.powerOff||p!==this.uiInitialized){const t=this.powerOff;this.powerOff=c,this.uiInitialized=p,t!==this.powerOff&&this.powerOffChangeEvent.dispatch(this.powerOff),this.isDirty=!0}p&&!c&&this.manageHotsyncName()&&!r&&this.checkAndUpdateHotsyncName(),this.serialPortIR.dispatch(),this.serialPortSerial.dispatch(),this.onAfterAdvanceEmulation(t,o)},this.newFrameEvent=new c.J,this.pwmUpdateEvent=new c.J,this.emulationStateChangeEvent=new c.J,this.powerOffChangeEvent=new c.J,this.deviceId=n.m515,this.clockEmulator=0,this.scheduler=new tt(t=>this.onSchedule(t)),this.canvas=document.createElement("canvas"),this.canvasTmp=document.createElement("canvas"),this.lastPenUpdate=0,this.penDown=!1,this.running=!1,this.powerOff=!1,this.uiInitialized=!1,this.pendingPwmUpdates=new it(10),this.lastPwmUpdateEvent=0,this.emulationSpeed=1,this.speedAverage=new rt(20),this.timePerFrameAverage=new rt(60),this.timestampLastFrame=0,this.frameCounter=0,this.isDirty=!1,this.serialPortIR=new nt,this.serialPortSerial=new nt,this.serialSyncStartedAt=0,this.serialPortIR.dispatchEvent.addHandler(()=>this.advanceEmulation(performance.now())),this.serialPortSerial.dispatchEvent.addHandler(()=>this.advanceEmulation(performance.now()))}handlePointerMove(t,e,r){if(!this.handleInput())return;const i=performance.now();if(this.penDown=!0,!(i-this.lastPenUpdate<25)&&this.cloudpilotInstance){if(r){const r=M(this.deviceId);t=this.transformSilkscreenX(t,r),e=this.transformSilkscreenY(e,r)}this.cloudpilotInstance.queuePenMove(Math.floor(t),Math.floor(e)),this.lastPenUpdate=i}}handlePointerUp(){this.handleInput()&&(this.cloudpilotInstance&&this.penDown&&this.cloudpilotInstance.queuePenUp(),this.lastPenUpdate=0,this.penDown=!1)}handleButtonDown(t){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonDown(t)}handleButtonUp(t){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonUp(t)}handleKeyDown(t,e=!1){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueKeyboardEvent(t,e)}reset(){this.cloudpilotInstance&&this.cloudpilotInstance.reset()}resetNoExtensions(){this.cloudpilotInstance&&this.cloudpilotInstance.resetNoExtensions()}resetHard(){this.cloudpilotInstance&&this.cloudpilotInstance.resetHard()}isRunning(){return this.running}isPowerOff(){return this.powerOff}isUiInitialized(){return this.uiInitialized}getCanvas(){return this.canvas}getStatistics(){return{hostSpeed:this.speedAverage.calculateAverage(),emulationSpeed:this.emulationSpeed,averageFps:this.calculateFPS()}}getEmulationSpeed(){return this.emulationSpeed}isSuspended(){return!!this.cloudpilotInstance&&this.cloudpilotInstance.isSuspended()}getSerialPortSerial(){if(!this.serialPortSerial)throw new Error("emulator not initialized");return this.serialPortSerial}getSerialPortIR(){if(!this.serialPortIR)throw new Error("emulator not initialized");return this.serialPortIR}onAfterAdvanceEmulation(t,e){}handleSuspend(){}callScheduler(){this.scheduler.schedule()}handleInput(){return!0}openSession(t,e,r,i,n){let o=!1;return!!t.initializeSession(e,r)&&(i&&(i.length%4!=0?console.warn("memory size is not a multiple of 4; ignoring image"):(o=t.loadMemory(new Uint32Array(i.buffer,i.byteOffset,i.length>>>2)),o||console.warn("failed to load memory"))),o&&n&&t.loadState(n),t.remountCards(),this.cloudpilotInstance&&this.cloudpilotInstance.pwmUpdateEvent.removeHandler(this.onPwmUpdate),t.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.cloudpilotInstance!==t&&(this.serialPortIR.bind(t.getTransportIR()),this.serialPortSerial.bind(t.getTransportSerial())),this.cloudpilotInstance=t,this.deviceId=r,this.resetCanvas(),this.pendingPwmUpdates.flush(),this.lastPwmUpdateEvent=0,this.deviceHotsyncName=void 0,this.emulationSpeed=1,this.frameCounter=0,this.speedAverage.reset(1),this.powerOff=t.isPowerOff(),this.uiInitialized=t.isUiInitialized(),this.frameCounter=0,!0)}resetCanvas(){const t=M(this.deviceId);this.canvas.width=this.canvasTmp.width=t.width,this.canvas.height=this.canvasTmp.height=t.height;const e=this.canvas.getContext("2d");if(!e)throw new Error("get a new browser");this.context=e;const r=this.canvasTmp.getContext("2d");if(!r)throw new Error("get a new browser");this.contextTmp=r,this.clearCanvas(),this.imageData=void 0}doResume(){this.cloudpilotInstance&&(this.clockEmulator=performance.now(),this.schedule(),this.setRunning(!0),this.resetFPS())}doPause(){this.stopLoop()}doStop(){this.stopLoop()}stopLoop(){this.running&&(this.scheduler.cancel(),void 0!==this.advanceEmulationHandle&&(window.clearTimeout(this.advanceEmulationHandle),this.advanceEmulationHandle=void 0),this.setRunning(!1))}resetFPS(){this.timePerFrameAverage.reset(),this.timestampLastFrame=performance.now()}calculateFPS(){const t=this.timePerFrameAverage.calculateAverage();return t&&1e3/t}transformSilkscreenX(t,e){if(void 0===e.silkscreenOvershoot)return t;const r=e.width/(e.width+2*e.silkscreenOvershoot);return(t-e.width/2)/r+e.width/2}transformSilkscreenY(t,e){return void 0===e.siklscreenShift?t:t+e.siklscreenShift}setRunning(t){t!==this.running&&(this.running=t,this.emulationStateChangeEvent.dispatch(t))}updateEmulationSpeed(t){if(t>=1&&this.emulationSpeed>=1)return;const e=Math.min(Math.max(Math.floor(10*t)/10,.1),1);e<=this.emulationSpeed?this.emulationSpeed=e:this.emulationSpeed=t-e>=.05?e:this.emulationSpeed}performScreenUpdate(){var t;(null===(t=this.cloudpilotInstance)||void 0===t?void 0:t.isScreenDirty())&&(this.updateScreen(),this.cloudpilotInstance.markScreenClean(),this.frameCounter++)}onSchedule(t){this.hasFatalError()||(this.skipEmulationUpdate()||(this.performScreenUpdate(),this.pendingPwmUpdates.count()>0&&t-this.lastPwmUpdateEvent>10&&(this.pwmUpdateEvent.dispatch(this.pendingPwmUpdates.pop()),this.lastPwmUpdateEvent=t),void 0===this.advanceEmulationHandle&&(this.advanceEmulationHandle=window.setTimeout(()=>{this.advanceEmulationHandle=void 0,this.advanceEmulation(t)},0)),this.timePerFrameAverage.push(Math.max(0,t-this.timestampLastFrame)),this.timestampLastFrame=t),this.schedule())}schedule(){this.scheduler.cancel(),this.getConfiguredSchdedulerKind()!==this.scheduler.getKind()&&(this.scheduler=this.getConfiguredSchdedulerKind()===X.animationFrame?new tt(t=>this.onSchedule(t)):new et(t=>this.onSchedule(t))),this.callScheduler()}checkAndUpdateHotsyncName(){if(!this.cloudpilotInstance)return;void 0===this.deviceHotsyncName&&(this.deviceHotsyncName=this.cloudpilotInstance.getHotsyncName());const t=this.getConfiguredHotsyncName();void 0===t?this.updateConfiguredHotsyncName(this.deviceHotsyncName):t!==this.deviceHotsyncName&&t.length<=40&&this.cloudpilotInstance.isSetupComplete()&&(this.cloudpilotInstance.setHotsyncName(t),this.deviceHotsyncName=t)}clearCanvas(){const t=this.deviceId,e=M(t);this.context.beginPath(),this.context.rect(0,0,e.width,e.height),this.context.fillStyle=R(t)?"white":A[0],this.context.fill()}updateScreen(){if(!this.cloudpilotInstance)return;const t=this.cloudpilotInstance.getFrame();if(this.cloudpilotInstance.isPowerOff())return this.clearCanvas(),void this.newFrameEvent.dispatch(this.canvas);if(!t.hasChanges)return;if(t.lines*t.scaleY===this.canvas.height&&t.lineWidth*t.scaleX===this.canvas.width){this.imageData&&this.imageData.width===t.lineWidth&&this.imageData.height===t.lines||(this.imageData=new ImageData(t.lineWidth,t.lines));const e=new Uint32Array(this.imageData.data.buffer);switch(t.bpp){case 1:{const r=H[15],i=H[0];let n=0;for(let o=t.firstDirtyLine;o<=t.lastDirtyLine;o++){const s=o*t.bytesPerLine;for(let o=t.margin;o<t.lineWidth+t.margin;o++)e[n++]=t.buffer[s+(o>>>3)]&128>>>(7&o)?r:i}break}case 2:{const r=this.cloudpilotInstance.getPalette2bitMapping(),i=[H[15&r],H[r>>>4&15],H[r>>>8&15],H[r>>>12&15]];let n=0;for(let r=t.firstDirtyLine;r<=t.lastDirtyLine;r++){const o=r*t.bytesPerLine;for(let r=t.margin;r<t.lineWidth+t.margin;r++)e[n++]=i[t.buffer[o+(r>>>2)]>>6-2*(3&r)&3]}break}case 4:{let r=0;for(let i=t.firstDirtyLine;i<=t.lastDirtyLine;i++){const n=i*t.bytesPerLine;for(let i=t.margin;i<t.lineWidth+t.margin;i++)e[r++]=H[t.buffer[n+(i>>>1)]>>>4-4*(1&i)&15]}break}case 24:{const r=new Uint32Array(t.buffer.buffer,t.buffer.byteOffset,t.buffer.byteLength>>>2);if(0===t.margin)e.subarray(0,t.lineWidth*(t.lastDirtyLine-t.firstDirtyLine+1)).set(r.subarray(t.firstDirtyLine*t.lineWidth,t.lineWidth*(t.lastDirtyLine+1)));else{let i=0;for(let n=t.firstDirtyLine;n<=t.lastDirtyLine;n++){let o=n*(t.bytesPerLine>>>2)+t.margin;for(let n=0;n<t.lineWidth;n++)e[i++]=r[o++]}}}}}if(!this.imageData)return;const e=1!==t.scaleX||1!==t.scaleY;(e?this.contextTmp:this.context).putImageData(this.imageData,0,t.firstDirtyLine,0,0,t.lineWidth,t.lastDirtyLine-t.firstDirtyLine+1),e&&(this.context.imageSmoothingEnabled=!1,this.context.drawImage(this.canvasTmp,0,t.firstDirtyLine,t.lineWidth,t.lastDirtyLine-t.firstDirtyLine+1,0,t.firstDirtyLine*t.scaleY,t.lineWidth*t.scaleX,(t.lastDirtyLine-t.firstDirtyLine+1)*t.scaleY)),this.newFrameEvent.dispatch(this.canvas)}}class st extends ot{constructor(){super(...arguments),this.timesliceEvent=new c.J}pause(){this.doPause()}resume(){this.doResume()}initWithRom(t,e,r,i){return this.isRunning()&&(this.doStop(),this.session=void 0),t.clearExternalStorage(),!!this.openSession(t,e,r)&&(this.session=i,!0)}initWithSessionImage(t,e,r){return this.isRunning()&&(this.doStop(),this.session=void 0),t.clearExternalStorage(),!!this.openSession(t,e.rom,e.deviceId,e.memory,e.savestate)&&(this.session=r,!0)}getSession(){return this.session}forceUpdateHotsyncName(){this.cloudpilotInstance&&this.cloudpilotInstance.isUiInitialized()&&!this.cloudpilotInstance.isPowerOff()&&this.checkAndUpdateHotsyncName()}getConfiguredSpeed(){var t,e;return null!==(e=null===(t=this.session)||void 0===t?void 0:t.speed)&&void 0!==e?e:1}manageHotsyncName(){return!0}getConfiguredHotsyncName(){var t;return null===(t=this.session)||void 0===t?void 0:t.hotsyncName}updateConfiguredHotsyncName(t){this.session&&(this.session.hotsyncName=t)}getConfiguredSchdedulerKind(){var t;return(null===(t=this.session)||void 0===t?void 0:t.runInBackground)?X.timeout:X.animationFrame}hasFatalError(){var t;return!!(null===(t=this.cloudpilotInstance)||void 0===t?void 0:t.hasFatalError())}skipEmulationUpdate(){return!1}onAfterAdvanceEmulation(t,e){this.timesliceEvent.dispatch()}handleInput(){return this.isRunning()}}class at{constructor(t,e){this.emulationService=t,this.canvasDisplayService=e,this.handleMouseDown=t=>{if(0!==t.button)return;const e=this.canvasDisplayService.eventToPalmCoordinates(t);if(!e)return;const r=this.determineArea(e);if(2===r){const t=this.canvasDisplayService.determineButton(e);this.interactionMouse={area:r,buttonPrimary:t},this.handleButtonDown(t)}else this.interactionMouse={area:r},this.emulationService.handlePointerMove(...e,1===r)},this.handleMouseMove=t=>{var e,r;if(!(1&t.buttons&&this.interactionMouse&&2!==(null===(e=this.interactionMouse)||void 0===e?void 0:e.area)))return;const i=this.canvasDisplayService.eventToPalmCoordinates(t,!0);i&&this.emulationService.handlePointerMove(...i,1===(null===(r=this.interactionMouse)||void 0===r?void 0:r.area))},this.handeMouseUp=t=>{if(0!==t.button)return;const e=this.interactionMouse;switch(this.interactionMouse=void 0,null==e?void 0:e.area){case 2:this.handleButtonUp(e.buttonPrimary);break;case 0:case 1:this.emulationService.handlePointerUp()}},this.handleTouchStart=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.canvasDisplayService.eventToPalmCoordinates(i);if(!n)continue;e=!0;const o=this.determineArea(n);if(2===o){const t=this.canvasDisplayService.determineButton(n);this.interactionsTouch.set(i.identifier,{area:o,buttonPrimary:t}),this.handleButtonDown(t)}else this.interactionsTouch.set(i.identifier,{area:o}),this.emulationService.handlePointerMove(...n,1===o)}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchMove=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.interactionsTouch.get(i.identifier);if(!n)continue;e=!0;const o=n.area;switch(o){case 2:{const t=this.canvasDisplayService.eventToPalmCoordinates(i);if(!t||2!==this.determineArea(t)){this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0;break}const e=this.canvasDisplayService.determineButton(t);e===n.buttonPrimary?(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0):e!==n.buttonSecondary&&(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=e,this.handleButtonDown(e));break}case 0:case 1:{const t=this.canvasDisplayService.eventToPalmCoordinates(i,!0);if(!t)continue;this.emulationService.handlePointerMove(...t,1===o);break}default:continue}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchEnd=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.interactionsTouch.get(i.identifier);switch(n&&(e=!0),this.interactionsTouch.delete(i.identifier),null==n?void 0:n.area){case 2:this.handleButtonUp(n.buttonPrimary),this.handleButtonUp(n.buttonSecondary);break;case 0:case 1:this.emulationService.handlePointerUp()}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleKeyDown=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;if(this.isToggleGameMode(t))return t.preventDefault(),this.gameMode=!this.gameMode,void this.onToggleGameMode();const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonDown(e),void t.preventDefault();const r=this.keyCodeFromEvent(t);void 0!==r&&(this.emulationService.handleKeyDown(r),t.preventDefault())},this.handleKeyUp=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonUp(e),void t.preventDefault();if("Control"===t.key){for(const t of this.activeButtons)this.emulationService.handleButtonUp(t);this.activeButtons.clear(),this.canvasDisplayService.drawButtons([])}},this.keyEventTarget=window,this.interactionsTouch=new Map,this.activeButtons=new Set,this.gameMode=!1,this.enableGamemodeHotkey=!0}bind(t,e=window){this.pointerEventTarget&&this.release(),this.pointerEventTarget=t,this.keyEventTarget=e||window,this.addEventListener(t,"mousedown",this.handleMouseDown),this.addEventListener(window,"mouseup",this.handeMouseUp),this.addEventListener(window,"mousemove",this.handleMouseMove),this.addEventListener(t,"touchstart",this.handleTouchStart),this.addEventListener(t,"touchmove",this.handleTouchMove),this.addEventListener(t,"touchend",this.handleTouchEnd),this.addEventListener(t,"touchcancel",this.handleTouchEnd),this.addEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.addEventListener(this.keyEventTarget,"keyup",this.handleKeyUp)}release(){if(this.pointerEventTarget){this.removeEventListener(this.pointerEventTarget,"mousedown",this.handleMouseDown),this.removeEventListener(window,"mouseup",this.handeMouseUp),this.removeEventListener(window,"mousemove",this.handleMouseMove),this.removeEventListener(this.pointerEventTarget,"touchstart",this.handleTouchStart),this.removeEventListener(this.pointerEventTarget,"touchmove",this.handleTouchMove),this.removeEventListener(this.pointerEventTarget,"touchend",this.handleTouchEnd),this.removeEventListener(this.pointerEventTarget,"touchcancel",this.handleTouchEnd),this.removeEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.removeEventListener(this.keyEventTarget,"keyup",this.handleKeyUp);for(const t of this.activeButtons)this.handleButtonUp(t);this.activeButtons.clear(),this.interactionsTouch.clear(),this.interactionMouse=void 0,this.pointerEventTarget=void 0}}isGameMode(){return this.gameMode}setGameMode(t){this.gameMode=t,this.onToggleGameMode()}setGameModeHotkeyEnabled(t){this.enableGamemodeHotkey=t}isGameModeHotkeyEnabled(){return this.enableGamemodeHotkey}enableKeyboardEvents(){return!0}onToggleGameMode(){}addEventListener(t,e,r,i){t.addEventListener(e,r,i)}removeEventListener(t,e,r,i){t.removeEventListener(e,r,i)}determineArea(t){return this.canvasDisplayService.isButtons(t)?2:this.canvasDisplayService.isSilkscreen(t)?1:0}handleButtonDown(t){this.activeButtons.has(t)||(this.activeButtons.add(t),this.emulationService.handleButtonDown(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}handleButtonUp(t){void 0!==t&&this.activeButtons.has(t)&&(this.activeButtons.delete(t),this.emulationService.handleButtonUp(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}isToggleGameMode(t){return this.isGameModeHotkeyEnabled()&&("Shift"===t.key&&t.ctrlKey||"Control"===t.key&&t.shiftKey)}isGameModeActive(t){return!this.gameMode&&t.ctrlKey||this.gameMode&&!t.ctrlKey}buttonFromEvent(t){switch(t.key){case"PageUp":return 4;case"PageDown":return 5}if(this.isGameModeActive(t))switch(t.key){case"w":case"i":case"ArrowUp":return 4;case"s":case"k":case"ArrowDown":return 5;case"a":case"j":case"y":case"z":case"ArrowLeft":return 0;case"q":case"u":case"x":return 1;case"e":case"o":case"c":return 2;case"d":case"l":case"v":case"ArrowRight":return 3}}keyCodeFromEvent(t){if(!this.isGameModeActive(t)){if(1===t.key.length&&t.key.charCodeAt(0)<=255)return t.key.charCodeAt(0);switch(t.key){case"ArrowLeft":return 28;case"ArrowRight":return 29;case"ArrowUp":return 30;case"ArrowDown":return 31;case"Backspace":return 8;case"Tab":return 9;case"Enter":return 10;default:return}}}}class ct extends at{constructor(t,e){super(t,e),this.gameModeChangeEvent=new c.J,this.canvasDisplayService=e}onToggleGameMode(){this.canvasDisplayService.toggleGameModeIndicator(this.isGameMode()),this.gameModeChangeEvent.dispatch(this.isGameMode())}}const pt={hotsyncName:void 0,orientation:d.portrait,runInBackground:!1,speed:1,deviceId:n.m515},ut="MEMORY_CARD";class lt{constructor(t){this.cloudpilot=t,this.onTimeslice=()=>{this.powerOffWatcher.update(),this.uiInitializedWatcher.update(),this.hotsyncNameWatcher.update()},this.audioInitializedEvent=new c.J,this.session=Object.assign({},pt),this.emulationService=new st,this.canvasDisplayService=new V(new g(Promise.resolve(t))),this.eventHandlingService=new ct(this.emulationService,this.canvasDisplayService),this.audioService=new P(this.emulationService),this.emulationService.newFrameEvent.addHandler(t=>this.canvasDisplayService.updateEmulationCanvas(t)),this.timesliceEvent.addHandler(this.onTimeslice),this.powerOffWatcher=new b(()=>this.isPowerOff()),this.uiInitializedWatcher=new b(()=>this.isUiInitialized()),this.hotsyncNameWatcher=new b(()=>this.getHotsyncName()||"")}getStatistics(){return this.emulationService.getStatistics()}loadRom(t,e){if(void 0===e){const r=this.cloudpilot.getRomInfo(t);if(!r||0===r.supportedDevices.length)throw new Error("unsupported device");e=r.supportedDevices[0]}if(this.session=Object.assign(Object.assign({},pt),{deviceId:e}),this.emulationService.initWithRom(this.cloudpilot,t,e,this.session))return this.canvasDisplayService.initialize(void 0,e,this.session.orientation),this;throw new Error("failed to initialize session")}loadSession(t){var e,r,i,n,o;const s=this.cloudpilot.deserializeSessionImage(t);if(!s)throw new Error("bad session image");if(this.session={hotsyncName:null===(e=s.metadata)||void 0===e?void 0:e.hotsyncName,speed:null!==(i=null===(r=s.metadata)||void 0===r?void 0:r.speed)&&void 0!==i?i:1,orientation:null!==(o=null===(n=s.metadata)||void 0===n?void 0:n.deviceOrientation)&&void 0!==o?o:d.portrait,runInBackground:!1,deviceId:s.deviceId},this.emulationService.initWithSessionImage(this.cloudpilot,s,this.session))return this.canvasDisplayService.initialize(void 0,s.deviceId,this.session.orientation),this;throw new Error("failed to initialize session")}insertCompressedCardImage(t){if(!this.cloudpilot.decompressCard(ut,t))throw new Error("failed to decompress and mount card image");if(!this.cloudpilot.mountCard(ut))throw new Error("failed to mount card image");return this}insertCardImage(t){if(t.length%512!=0)throw new Error("card image size must be a multiple of 512");if(!this.cloudpilot.allocateCard(ut,t.length))throw new Error("failed to allocate card image");const e=this.cloudpilot.getCardData(ut);if(!e)throw new Error("failed to allocate card image");if(e.set(new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>>2)),!this.cloudpilot.mountCard(ut))throw new Error("failed to mount card image");return this}ejectCard(){if(!this.isCardMounted())return this;if(!this.cloudpilot.removeCard(ut))throw new Error("failed to eject card");return this}isCardMounted(){return this.cloudpilot.getMountedKey()===ut}setCanvas(t){return this.canvasDisplayService.initialize(t,this.session.deviceId,this.session.orientation),this}bindInput(t){const e=this.canvasDisplayService.getCanvas();if(!e)throw new Error("you must set up the canvas setCanvas before calling bindInput");return this.eventHandlingService.bind(e,t),this}releaseInput(){return this.eventHandlingService.release(),this}installDatabase(t){if(this.cloudpilot.installDb(t)<0)throw new Error("failed to install database");return this}installAndLaunchDatabase(t){return this.installDatabase(t).launchDatabase(t)}installFromZipfile(t){return this.installFromZipfileAndLaunch(t)}installFromZipfileAndLaunch(t,e){let r;if(this.cloudpilot.withZipfileWalkerSync(t,t=>{for(;0===t.GetState();){const i=t.GetCurrentEntryContent(),n=t.GetCurrentEntryName();if(!i)throw new Error(`unable to read ${n} from zupfile`);this.installDatabase(i),n.toLowerCase()===(null==e?void 0:e.toLowerCase())&&(r=i.subarray(0,32).slice()),t.Next()}if(-1===t.GetState())throw new Error("error reading zipfile")}),void 0!==e&&!r)throw new Error(`database ${e} not found `);return r&&this.launchDatabase(r),this}launchByName(t){if(!this.cloudpilot.launchAppByName(t))throw new Error(`failed to launch ${t}`);return this}launchDatabase(t){if(!this.cloudpilot.launchAppByDbHeader(t))throw new Error("failed to launch database");return this}reset(){return this.emulationService.reset(),this}resetNoExtensions(){return this.emulationService.resetNoExtensions(),this}resetHard(){return this.emulationService.resetHard(),this}isRunning(){return this.emulationService.isRunning()}isPowerOff(){return this.emulationService.isPowerOff()}isUiInitialized(){return this.emulationService.isUiInitialized()}resume(){return this.emulationService.resume(),this}pause(){return this.emulationService.pause(),this}buttonDown(t){return this.emulationService.handleButtonDown(t),this}buttonUp(t){return this.emulationService.handleButtonUp(t),this}setSpeed(t){return this.session.speed=t,this}getSpeed(){return this.session.speed}setVolume(t){return this.audioService.setVolume(t),this}getVolume(){return this.audioService.getVolume()}initializeAudio(){return e(this,void 0,void 0,function*(){return yield this.audioService.initialize(),this.audioService.isInitialized()})}isAudioInitialized(){return this.audioService.isInitialized()}setOrientation(t){return this.session.orientation=t,this.canvasDisplayService.updateOrientation(this.session.orientation),this}getOrientation(){return this.session.orientation}setHotsyncName(t){return this.session.hotsyncName=t,this.emulationService.forceUpdateHotsyncName(),this}getHotsyncName(){return this.session.hotsyncName}setRunHidden(t){return this.session.runInBackground=t,this}getRunHidden(){return this.session.runInBackground}isGameMode(){return this.eventHandlingService.isGameMode()}setGameMode(t){return this.eventHandlingService.setGameMode(t),this}isGameModeHotkeyEnabled(){return this.eventHandlingService.isGameModeHotkeyEnabled()}setGameModeHotkeyEnabled(t){return this.eventHandlingService.setGameModeHotkeyEnabled(t),this}isGameModeIndicatorEnabled(){return this.canvasDisplayService.isGameModeIndicatorEnabled()}setGameModeIndicatorEnabled(t){return this.canvasDisplayService.setGameModeIndicatorEnabled(t),this}getSerialPortIR(){return this.emulationService.getSerialPortIR()}getSerialPortSerial(){return this.emulationService.getSerialPortSerial()}get powerOffChangeEvent(){return this.powerOffWatcher.changeEvent}get isUiInitializedChangeEvent(){return this.uiInitializedWatcher.changeEvent}get hotsyncNameChangeEvent(){return this.hotsyncNameWatcher.changeEvent}get gameModeChangeEvent(){return this.eventHandlingService.gameModeChangeEvent}get timesliceEvent(){return this.emulationService.timesliceEvent}}var ht;!function(t){t[t.cal=0]="cal",t[t.phone=1]="phone",t[t.todo=2]="todo",t[t.notes=3]="notes",t[t.up=4]="up",t[t.down=5]="down",t[t.power=6]="power",t[t.cradle=7]="cradle"}(ht||(ht={}));const dt="1.10.15";function mt(t){return e(this,void 0,void 0,function*(){return new lt(yield h.create(t))})}function yt(t){const r=function(t){const r=WebAssembly.compileStreaming?WebAssembly.compileStreaming(fetch(t)):fetch(t).then(t=>t.arrayBuffer()).then(t=>WebAssembly.compile(t));return(t,i)=>e(this,void 0,void 0,function*(){return i(yield WebAssembly.instantiate(yield r,t))})}(null!=t?t:"cloudpilot_web.wasm");return()=>h.create(r).then(t=>new lt(t))}})(),i})());
//# sourceMappingURL=cloudpilot-emu.js.map