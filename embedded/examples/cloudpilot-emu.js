!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cloudpilot=t():e.cloudpilot=t()}(self,(()=>(()=>{var e={492:e=>{var t,i=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e={}){var i,r,n=e;n.ready=new Promise(((e,t)=>{i=e,r=t}));var o,s=Object.assign({},n),a="./this.program",c=(e,t)=>{throw t},p="object"==typeof window,u="function"==typeof importScripts,l=("object"==typeof process&&"object"==typeof process.versions&&process.versions.node,"");(p||u)&&(u?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),t&&(l=t),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",u&&(o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var d,h,_=n.print||console.log.bind(console),m=n.printErr||console.error.bind(console);Object.assign(n,s),s=null,n.arguments&&n.arguments,n.thisProgram&&(a=n.thisProgram),n.quit&&(c=n.quit),n.wasmBinary&&(d=n.wasmBinary),"object"!=typeof WebAssembly&&R("no native wasm support detected");var y,f,v,g,b,S,C=!1;function w(e,t){e||R(t)}function I(){var e=h.buffer;n.HEAP8=f=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=v=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=g=new Int32Array(e),n.HEAPU32=b=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=S=new Float64Array(e)}var D=[],G=[],E=[],x=[],k=0,M=null,P=null;function R(e){n.onAbort&&n.onAbort(e),m(e="Aborted("+e+")"),C=!0,y=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var z,H,A,N=e=>e.startsWith("data:application/octet-stream;base64,");function T(e){if(e==z&&d)return new Uint8Array(d);if(o)return o(e);throw"both async and sync fetching of the wasm failed"}function F(e,t,i){return function(e){return d||!p&&!u||"function"!=typeof fetch?Promise.resolve().then((()=>T(e))):fetch(e,{credentials:"same-origin"}).then((t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})).catch((()=>T(e)))}(e).then((e=>WebAssembly.instantiate(e,t))).then((e=>e)).then(i,(e=>{m(`failed to asynchronously prepare wasm: ${e}`),R(e)}))}N(z="cloudpilot_web.wasm")||(H=z,z=n.locateFile?n.locateFile(H,l):l+H);var L={1472504:e=>{ce.grow(65536);for(let t=0;t<=65535;t++)ce.set(ce.length-65535-1+t,ce.get(b[(e>>>2)+t]));return ce.length-65535-1}};function U(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var B=e=>{for(;e.length>0;)e.shift()(n)},j=n.noExitRuntime||!0,O="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,W=(e,t,i)=>{for(var r=t+i,n=t;e[n]&&!(n>=r);)++n;if(n-t>16&&e.buffer&&O)return O.decode(e.subarray(t,n));for(var o="";t<n;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var c=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var p=s-65536;o+=String.fromCharCode(55296|p>>10,56320|1023&p)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o},V=(e,t)=>e?W(v,e,t):"",q=(e,t)=>t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN,Y=e=>e%4==0&&(e%100!=0||e%400==0),K=[0,31,60,91,121,152,182,213,244,274,305,335],Z=[0,31,59,90,120,151,181,212,243,273,304,334],Q=e=>(Y(e.getFullYear())?K:Z)[e.getMonth()]+e.getDate()-1,$=e=>{for(var t=0,i=0;i<e.length;++i){var r=e.charCodeAt(i);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++i):t+=3}return t},X=(e,t,i,r)=>{if(!(r>0))return 0;for(var n=i,o=i+r-1,s=0;s<e.length;++s){var a=e.charCodeAt(s);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s)),a<=127){if(i>=o)break;t[i++]=a}else if(a<=2047){if(i+1>=o)break;t[i++]=192|a>>6,t[i++]=128|63&a}else if(a<=65535){if(i+2>=o)break;t[i++]=224|a>>12,t[i++]=128|a>>6&63,t[i++]=128|63&a}else{if(i+3>=o)break;t[i++]=240|a>>18,t[i++]=128|a>>12&63,t[i++]=128|a>>6&63,t[i++]=128|63&a}}return t[i]=0,i-n},J=e=>{var t=$(e)+1,i=ve(t);return i&&((e,t,i)=>{X(e,v,t,i)})(e,i,t),i},ee=[],te=e=>{var t=(e-h.buffer.byteLength+65535)/65536;try{return h.grow(t),I(),1}catch(e){}},ie={},re=()=>{if(!re.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:a||"./this.program"};for(var t in ie)void 0===ie[t]?delete e[t]:e[t]=ie[t];var i=[];for(var t in e)i.push(`${t}=${e[t]}`);re.strings=i}return re.strings},ne=[null,[],[]],oe=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function ae(e,t,i){var r=i>0?i:$(e)+1,n=new Array(r),o=X(e,n,0,n.length);return t&&(n.length=o),n}var ce,pe,ue,le=(e,t)=>{var i;y=e,y=i=e,j||(n.onExit&&n.onExit(i),C=!0),c(i,new U(i))},de=(e,t)=>{e<128?t.push(e):t.push(e%128|128,e>>7)},he=[],_e=[],me=(e,t)=>{ce.set(e,t),he[e]=ce.get(e)},ye={b:(e,t,i,r)=>{R(`Assertion failed: ${V(e)}, at: `+[t?V(t):"unknown filename",i,r?V(r):"unknown function"])},i:function(e){const t=new Error(V(e));throw t.isAssert=!0,t},m:function(e,t,i){q(t,i)},h:()=>1,j:function(e,t,i){var r=q(e,t),n=new Date(1e3*r);g[i>>2]=n.getSeconds(),g[i+4>>2]=n.getMinutes(),g[i+8>>2]=n.getHours(),g[i+12>>2]=n.getDate(),g[i+16>>2]=n.getMonth(),g[i+20>>2]=n.getFullYear()-1900,g[i+24>>2]=n.getDay();var o=0|Q(n);g[i+28>>2]=o,g[i+36>>2]=-60*n.getTimezoneOffset();var s=new Date(n.getFullYear(),0,1),a=new Date(n.getFullYear(),6,1).getTimezoneOffset(),c=s.getTimezoneOffset(),p=0|(a!=c&&n.getTimezoneOffset()==Math.min(c,a));g[i+32>>2]=p},k:function(e){var t=(()=>{var t=new Date(g[e+20>>2]+1900,g[e+16>>2],g[e+12>>2],g[e+8>>2],g[e+4>>2],g[e>>2],0),i=g[e+32>>2],r=t.getTimezoneOffset(),n=new Date(t.getFullYear(),0,1),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),s=n.getTimezoneOffset(),a=Math.min(s,o);if(i<0)g[e+32>>2]=Number(o!=s&&a==r);else if(i>0!=(a==r)){var c=Math.max(s,o),p=i>0?a:c;t.setTime(t.getTime()+6e4*(p-r))}g[e+24>>2]=t.getDay();var u=0|Q(t);g[e+28>>2]=u,g[e>>2]=t.getSeconds(),g[e+4>>2]=t.getMinutes(),g[e+8>>2]=t.getHours(),g[e+12>>2]=t.getDate(),g[e+16>>2]=t.getMonth(),g[e+20>>2]=t.getYear();var l=t.getTime();return isNaN(l)?(61,g[fr()>>2]=61,-1):l/1e3})();return vr((A=t,+Math.abs(A)>=1?A>0?+Math.floor(A/4294967296)>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)),t>>>0},r:(e,t,i)=>{var r=(new Date).getFullYear(),n=new Date(r,0,1),o=new Date(r,6,1),s=n.getTimezoneOffset(),a=o.getTimezoneOffset(),c=Math.max(s,a);function p(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}b[e>>2]=60*c,g[t>>2]=Number(s!=a);var u=p(n),l=p(o),d=J(u),h=J(l);a<s?(b[i>>2]=d,b[i+4>>2]=h):(b[i>>2]=h,b[i+4>>2]=d)},a:()=>{R("")},s:(e,t,i)=>((e,t,i)=>{var r=((e,t)=>{var i;for(ee.length=0;i=v[e++];){var r=105!=i;t+=(r&=112!=i)&&t%8?4:0,ee.push(112==i?b[t>>2]:105==i?g[t>>2]:S[t>>3]),t+=r?8:4}return ee})(t,i);return L[e].apply(null,r)})(e,t,i),c:()=>Date.now(),d:(e,t,i)=>v.copyWithin(e,t,t+i),q:e=>{var t=v.length,i=2147483648;if((e>>>=0)>i)return!1;for(var r,n=1;n<=4;n*=2){var o=t*(1+.2/n);o=Math.min(o,e+100663296);var s=Math.min(i,(r=Math.max(e,o))+(65536-r%65536)%65536);if(te(s))return!0}return!1},o:(e,t)=>{var i=0;return re().forEach(((r,n)=>{var o=t+i;b[e+4*n>>2]=o,((e,t)=>{for(var i=0;i<e.length;++i)f[t++>>0]=e.charCodeAt(i);f[t>>0]=0})(r,o),i+=r.length+1})),0},p:(e,t)=>{var i=re();b[e>>2]=i.length;var r=0;return i.forEach((e=>r+=e.length+1)),b[t>>2]=r,0},e:e=>52,g:(e,t,i,r)=>52,l:function(e,t,i,r,n){return q(t,i),70},f:(e,t,i,r)=>{for(var n,o,s,a=0,c=0;c<i;c++){var p=b[t>>2],u=b[t+4>>2];t+=8;for(var l=0;l<u;l++)n=e,o=v[p+l],s=void 0,s=ne[n],0===o||10===o?((1===n?_:m)(W(s,0)),s.length=0):s.push(o);a+=u}return b[r>>2]=a,0},n:(e,t,i,r,n)=>((e,t,i,r)=>{var n=b[r+40>>2],o={tm_sec:g[r>>2],tm_min:g[r+4>>2],tm_hour:g[r+8>>2],tm_mday:g[r+12>>2],tm_mon:g[r+16>>2],tm_year:g[r+20>>2],tm_wday:g[r+24>>2],tm_yday:g[r+28>>2],tm_isdst:g[r+32>>2],tm_gmtoff:g[r+36>>2],tm_zone:n?V(n):""},s=V(i),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in a)s=s.replace(new RegExp(c,"g"),a[c]);var p=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function l(e,t,i){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=i[0]+r;return r}function d(e,t){return l(e,t,"0")}function h(e,t){function i(e){return e<0?-1:e>0?1:0}var r;return 0===(r=i(e.getFullYear()-t.getFullYear()))&&0===(r=i(e.getMonth()-t.getMonth()))&&(r=i(e.getDate()-t.getDate())),r}function _(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=((e,t)=>{for(var i=new Date(e.getTime());t>0;){var r=Y(i.getFullYear()),n=i.getMonth(),o=(r?oe:se)[n];if(!(t>o-i.getDate()))return i.setDate(i.getDate()+t),i;t-=o-i.getDate()+1,i.setDate(1),n<11?i.setMonth(n+1):(i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return i})(new Date(e.tm_year+1900,0,1),e.tm_yday),i=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),n=_(i),o=_(r);return h(n,t)<=0?h(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var y={"%a":e=>p[e.tm_wday].substring(0,3),"%A":e=>p[e.tm_wday],"%b":e=>u[e.tm_mon].substring(0,3),"%B":e=>u[e.tm_mon],"%C":e=>d((e.tm_year+1900)/100|0,2),"%d":e=>d(e.tm_mday,2),"%e":e=>l(e.tm_mday,2," "),"%g":e=>m(e).toString().substring(2),"%G":e=>m(e),"%H":e=>d(e.tm_hour,2),"%I":e=>{var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":e=>d(e.tm_mday+((e,t)=>{for(var i=0,r=0;r<=t;i+=e[r++]);return i})(Y(e.tm_year+1900)?oe:se,e.tm_mon-1),3),"%m":e=>d(e.tm_mon+1,2),"%M":e=>d(e.tm_min,2),"%n":()=>"\n","%p":e=>e.tm_hour>=0&&e.tm_hour<12?"AM":"PM","%S":e=>d(e.tm_sec,2),"%t":()=>"\t","%u":e=>e.tm_wday||7,"%U":e=>{var t=e.tm_yday+7-e.tm_wday;return d(Math.floor(t/7),2)},"%V":e=>{var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var i=(e.tm_wday+371-e.tm_yday)%7;4==i||3==i&&Y(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&Y(e.tm_year%400-1))&&t++}return d(t,2)},"%w":e=>e.tm_wday,"%W":e=>{var t=e.tm_yday+7-(e.tm_wday+6)%7;return d(Math.floor(t/7),2)},"%y":e=>(e.tm_year+1900).toString().substring(2),"%Y":e=>e.tm_year+1900,"%z":e=>{var t=e.tm_gmtoff,i=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(i?"+":"-")+String("0000"+t).slice(-4)},"%Z":e=>e.tm_zone,"%%":()=>"%"};for(var c in s=s.replace(/%%/g,"\0\0"),y)s.includes(c)&&(s=s.replace(new RegExp(c,"g"),y[c](o)));var v,S,C=ae(s=s.replace(/\0\0/g,"%"),!1);return C.length>t?0:(v=C,S=e,f.set(v,S),C.length-1)})(e,t,i,r)},fe=function(){var e,t,i,o,s={a:ye};function a(e,t){var i;return fe=e.exports,h=fe.t,I(),ce=fe.yc,i=fe.u,G.unshift(i),function(e){if(k--,n.monitorRunDependencies&&n.monitorRunDependencies(k),0==k&&(null!==M&&(clearInterval(M),M=null),P)){var t=P;P=null,t()}}(),fe}if(k++,n.monitorRunDependencies&&n.monitorRunDependencies(k),n.instantiateWasm)try{return n.instantiateWasm(s,a)}catch(e){m(`Module.instantiateWasm callback failed with error: ${e}`),r(e)}return(e=d,t=z,i=s,o=function(e){a(e.instance)},e||"function"!=typeof WebAssembly.instantiateStreaming||N(t)||"function"!=typeof fetch?F(t,i,o):fetch(t,{credentials:"same-origin"}).then((e=>WebAssembly.instantiateStreaming(e,i).then(o,(function(e){return m(`wasm streaming compile failed: ${e}`),m("falling back to ArrayBuffer instantiation"),F(t,i,o)}))))).catch(r),{}}(),ve=n._malloc=e=>(ve=n._malloc=fe.v)(e),ge=(n._free=e=>(n._free=fe.w)(e),n._main=(e,t)=>(ge=n._main=fe.x)(e,t)),be=(n._webidl_free=e=>(n._webidl_free=fe.y)(e),n._webidl_malloc=e=>(n._webidl_malloc=fe.z)(e),n._emscripten_bind_VoidPtr___destroy___0=e=>(be=n._emscripten_bind_VoidPtr___destroy___0=fe.A)(e)),Se=n._emscripten_bind_Cloudpilot_Cloudpilot_0=()=>(Se=n._emscripten_bind_Cloudpilot_Cloudpilot_0=fe.B)(),Ce=n._emscripten_bind_Cloudpilot_Malloc_1=(e,t)=>(Ce=n._emscripten_bind_Cloudpilot_Malloc_1=fe.C)(e,t),we=n._emscripten_bind_Cloudpilot_Free_1=(e,t)=>(we=n._emscripten_bind_Cloudpilot_Free_1=fe.D)(e,t),Ie=n._emscripten_bind_Cloudpilot_Nullptr_0=e=>(Ie=n._emscripten_bind_Cloudpilot_Nullptr_0=fe.E)(e),De=n._emscripten_bind_Cloudpilot_InitializeSession_3=(e,t,i,r)=>(De=n._emscripten_bind_Cloudpilot_InitializeSession_3=fe.F)(e,t,i,r),Ge=n._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=e=>(Ge=n._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=fe.G)(e),Ee=n._emscripten_bind_Cloudpilot_RunEmulation_1=(e,t)=>(Ee=n._emscripten_bind_Cloudpilot_RunEmulation_1=fe.H)(e,t),xe=n._emscripten_bind_Cloudpilot_SetClockFactor_1=(e,t)=>(xe=n._emscripten_bind_Cloudpilot_SetClockFactor_1=fe.I)(e,t),ke=n._emscripten_bind_Cloudpilot_CopyFrame_0=e=>(ke=n._emscripten_bind_Cloudpilot_CopyFrame_0=fe.J)(e),Me=n._emscripten_bind_Cloudpilot_IsScreenDirty_0=e=>(Me=n._emscripten_bind_Cloudpilot_IsScreenDirty_0=fe.K)(e),Pe=n._emscripten_bind_Cloudpilot_MarkScreenClean_0=e=>(Pe=n._emscripten_bind_Cloudpilot_MarkScreenClean_0=fe.L)(e),Re=n._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=(e,t)=>(Re=n._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=fe.M)(e,t),ze=n._emscripten_bind_Cloudpilot_FramebufferSizeForDevice_1=(e,t)=>(ze=n._emscripten_bind_Cloudpilot_FramebufferSizeForDevice_1=fe.N)(e,t),He=n._emscripten_bind_Cloudpilot_TotalMemoryForDevice_1=(e,t)=>(He=n._emscripten_bind_Cloudpilot_TotalMemoryForDevice_1=fe.O)(e,t),Ae=n._emscripten_bind_Cloudpilot_QueuePenMove_2=(e,t,i)=>(Ae=n._emscripten_bind_Cloudpilot_QueuePenMove_2=fe.P)(e,t,i),Ne=n._emscripten_bind_Cloudpilot_QueuePenUp_0=e=>(Ne=n._emscripten_bind_Cloudpilot_QueuePenUp_0=fe.Q)(e),Te=n._emscripten_bind_Cloudpilot_QueueButtonDown_1=(e,t)=>(Te=n._emscripten_bind_Cloudpilot_QueueButtonDown_1=fe.R)(e,t),Fe=n._emscripten_bind_Cloudpilot_QueueButtonUp_1=(e,t)=>(Fe=n._emscripten_bind_Cloudpilot_QueueButtonUp_1=fe.S)(e,t),Le=n._emscripten_bind_Cloudpilot_QueueKeyboardEvent_2=(e,t,i)=>(Le=n._emscripten_bind_Cloudpilot_QueueKeyboardEvent_2=fe.T)(e,t,i),Ue=n._emscripten_bind_Cloudpilot_IsPowerOff_0=e=>(Ue=n._emscripten_bind_Cloudpilot_IsPowerOff_0=fe.U)(e),Be=n._emscripten_bind_Cloudpilot_IsUIInitialized_0=e=>(Be=n._emscripten_bind_Cloudpilot_IsUIInitialized_0=fe.V)(e),je=n._emscripten_bind_Cloudpilot_GetOSVersion_0=e=>(je=n._emscripten_bind_Cloudpilot_GetOSVersion_0=fe.W)(e),Oe=n._emscripten_bind_Cloudpilot_IsSetupComplete_0=e=>(Oe=n._emscripten_bind_Cloudpilot_IsSetupComplete_0=fe.X)(e),We=n._emscripten_bind_Cloudpilot_Reset_0=e=>(We=n._emscripten_bind_Cloudpilot_Reset_0=fe.Y)(e),Ve=n._emscripten_bind_Cloudpilot_ResetNoExtensions_0=e=>(Ve=n._emscripten_bind_Cloudpilot_ResetNoExtensions_0=fe.Z)(e),qe=n._emscripten_bind_Cloudpilot_ResetHard_0=e=>(qe=n._emscripten_bind_Cloudpilot_ResetHard_0=fe._)(e),Ye=n._emscripten_bind_Cloudpilot_InstallDb_2=(e,t,i)=>(Ye=n._emscripten_bind_Cloudpilot_InstallDb_2=fe.$)(e,t,i),Ke=n._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=e=>(Ke=n._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=fe.aa)(e),Ze=n._emscripten_bind_Cloudpilot_GetMemoryPtr_0=e=>(Ze=n._emscripten_bind_Cloudpilot_GetMemoryPtr_0=fe.ba)(e),Qe=n._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=e=>(Qe=n._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=fe.ca)(e),$e=n._emscripten_bind_Cloudpilot_GetMemorySize_0=e=>($e=n._emscripten_bind_Cloudpilot_GetMemorySize_0=fe.da)(e),Xe=n._emscripten_bind_Cloudpilot_ImportMemoryImage_2=(e,t,i)=>(Xe=n._emscripten_bind_Cloudpilot_ImportMemoryImage_2=fe.ea)(e,t,i),Je=n._emscripten_bind_Cloudpilot_GetRomPtr_0=e=>(Je=n._emscripten_bind_Cloudpilot_GetRomPtr_0=fe.fa)(e),et=n._emscripten_bind_Cloudpilot_GetRomSize_0=e=>(et=n._emscripten_bind_Cloudpilot_GetRomSize_0=fe.ga)(e),tt=n._emscripten_bind_Cloudpilot_GetSavestatePtr_0=e=>(tt=n._emscripten_bind_Cloudpilot_GetSavestatePtr_0=fe.ha)(e),it=n._emscripten_bind_Cloudpilot_GetSavestateSize_0=e=>(it=n._emscripten_bind_Cloudpilot_GetSavestateSize_0=fe.ia)(e),rt=n._emscripten_bind_Cloudpilot_SaveState_0=e=>(rt=n._emscripten_bind_Cloudpilot_SaveState_0=fe.ja)(e),nt=n._emscripten_bind_Cloudpilot_LoadState_2=(e,t,i)=>(nt=n._emscripten_bind_Cloudpilot_LoadState_2=fe.ka)(e,t,i),ot=n._emscripten_bind_Cloudpilot_GetHotsyncName_0=e=>(ot=n._emscripten_bind_Cloudpilot_GetHotsyncName_0=fe.la)(e),st=n._emscripten_bind_Cloudpilot_SetHotsyncName_1=(e,t)=>(st=n._emscripten_bind_Cloudpilot_SetHotsyncName_1=fe.ma)(e,t),at=n._emscripten_bind_Cloudpilot_RegisterPwmHandler_1=(e,t)=>(at=n._emscripten_bind_Cloudpilot_RegisterPwmHandler_1=fe.na)(e,t),ct=n._emscripten_bind_Cloudpilot_StartBackup_0=e=>(ct=n._emscripten_bind_Cloudpilot_StartBackup_0=fe.oa)(e),pt=n._emscripten_bind_Cloudpilot_SetClipboardIntegration_1=(e,t)=>(pt=n._emscripten_bind_Cloudpilot_SetClipboardIntegration_1=fe.pa)(e,t),ut=n._emscripten_bind_Cloudpilot_GetClipboardIntegration_0=e=>(ut=n._emscripten_bind_Cloudpilot_GetClipboardIntegration_0=fe.qa)(e),lt=n._emscripten_bind_Cloudpilot_IsSuspended_0=e=>(lt=n._emscripten_bind_Cloudpilot_IsSuspended_0=fe.ra)(e),dt=n._emscripten_bind_Cloudpilot_GetSuspendContext_0=e=>(dt=n._emscripten_bind_Cloudpilot_GetSuspendContext_0=fe.sa)(e),ht=n._emscripten_bind_Cloudpilot_SetNetworkRedirection_1=(e,t)=>(ht=n._emscripten_bind_Cloudpilot_SetNetworkRedirection_1=fe.ta)(e,t),_t=n._emscripten_bind_Cloudpilot_GetNetworkRedirection_0=e=>(_t=n._emscripten_bind_Cloudpilot_GetNetworkRedirection_0=fe.ua)(e),mt=n._emscripten_bind_Cloudpilot_RegisterProxyDisconnectHandler_1=(e,t)=>(mt=n._emscripten_bind_Cloudpilot_RegisterProxyDisconnectHandler_1=fe.va)(e,t),yt=n._emscripten_bind_Cloudpilot_SetHotsyncNameManagement_1=(e,t)=>(yt=n._emscripten_bind_Cloudpilot_SetHotsyncNameManagement_1=fe.wa)(e,t),ft=n._emscripten_bind_Cloudpilot_LaunchAppByName_1=(e,t)=>(ft=n._emscripten_bind_Cloudpilot_LaunchAppByName_1=fe.xa)(e,t),vt=n._emscripten_bind_Cloudpilot_LaunchAppByDbHeader_2=(e,t,i)=>(vt=n._emscripten_bind_Cloudpilot_LaunchAppByDbHeader_2=fe.ya)(e,t,i),gt=n._emscripten_bind_Cloudpilot_DeviceSupportsCardSize_1=(e,t)=>(gt=n._emscripten_bind_Cloudpilot_DeviceSupportsCardSize_1=fe.za)(e,t),bt=n._emscripten_bind_Cloudpilot_ClearExternalStorage_0=e=>(bt=n._emscripten_bind_Cloudpilot_ClearExternalStorage_0=fe.Aa)(e),St=n._emscripten_bind_Cloudpilot_AllocateCard_2=(e,t,i)=>(St=n._emscripten_bind_Cloudpilot_AllocateCard_2=fe.Ba)(e,t,i),Ct=n._emscripten_bind_Cloudpilot_AdoptCard_3=(e,t,i,r)=>(Ct=n._emscripten_bind_Cloudpilot_AdoptCard_3=fe.Ca)(e,t,i,r),wt=n._emscripten_bind_Cloudpilot_MountCard_1=(e,t)=>(wt=n._emscripten_bind_Cloudpilot_MountCard_1=fe.Da)(e,t),It=n._emscripten_bind_Cloudpilot_RemoveCard_1=(e,t)=>(It=n._emscripten_bind_Cloudpilot_RemoveCard_1=fe.Ea)(e,t),Dt=n._emscripten_bind_Cloudpilot_GetCardData_1=(e,t)=>(Dt=n._emscripten_bind_Cloudpilot_GetCardData_1=fe.Fa)(e,t),Gt=n._emscripten_bind_Cloudpilot_GetCardDirtyPages_1=(e,t)=>(Gt=n._emscripten_bind_Cloudpilot_GetCardDirtyPages_1=fe.Ga)(e,t),Et=n._emscripten_bind_Cloudpilot_GetCardSize_1=(e,t)=>(Et=n._emscripten_bind_Cloudpilot_GetCardSize_1=fe.Ha)(e,t),xt=n._emscripten_bind_Cloudpilot_RemountCards_0=e=>(xt=n._emscripten_bind_Cloudpilot_RemountCards_0=fe.Ia)(e),kt=n._emscripten_bind_Cloudpilot_GetSupportLevel_1=(e,t)=>(kt=n._emscripten_bind_Cloudpilot_GetSupportLevel_1=fe.Ja)(e,t),Mt=n._emscripten_bind_Cloudpilot_GetMountedKey_0=e=>(Mt=n._emscripten_bind_Cloudpilot_GetMountedKey_0=fe.Ka)(e),Pt=n._emscripten_bind_Cloudpilot___destroy___0=e=>(Pt=n._emscripten_bind_Cloudpilot___destroy___0=fe.La)(e),Rt=n._emscripten_bind_RomInfo_RomInfo_2=(e,t)=>(Rt=n._emscripten_bind_RomInfo_RomInfo_2=fe.Ma)(e,t),zt=n._emscripten_bind_RomInfo_IsValid_0=e=>(zt=n._emscripten_bind_RomInfo_IsValid_0=fe.Na)(e),Ht=n._emscripten_bind_RomInfo_CardVersion_0=e=>(Ht=n._emscripten_bind_RomInfo_CardVersion_0=fe.Oa)(e),At=n._emscripten_bind_RomInfo_CardName_0=e=>(At=n._emscripten_bind_RomInfo_CardName_0=fe.Pa)(e),Nt=n._emscripten_bind_RomInfo_RomVersion_0=e=>(Nt=n._emscripten_bind_RomInfo_RomVersion_0=fe.Qa)(e),Tt=n._emscripten_bind_RomInfo_RomVersionString_0=e=>(Tt=n._emscripten_bind_RomInfo_RomVersionString_0=fe.Ra)(e),Ft=n._emscripten_bind_RomInfo_Supports_1=(e,t)=>(Ft=n._emscripten_bind_RomInfo_Supports_1=fe.Sa)(e,t),Lt=n._emscripten_bind_RomInfo___destroy___0=e=>(Lt=n._emscripten_bind_RomInfo___destroy___0=fe.Ta)(e),Ut=n._emscripten_bind_Frame_GetLineWidth_0=e=>(Ut=n._emscripten_bind_Frame_GetLineWidth_0=fe.Ua)(e),Bt=n._emscripten_bind_Frame_GetBpp_0=e=>(Bt=n._emscripten_bind_Frame_GetBpp_0=fe.Va)(e),jt=n._emscripten_bind_Frame_GetLines_0=e=>(jt=n._emscripten_bind_Frame_GetLines_0=fe.Wa)(e),Ot=n._emscripten_bind_Frame_GetMargin_0=e=>(Ot=n._emscripten_bind_Frame_GetMargin_0=fe.Xa)(e),Wt=n._emscripten_bind_Frame_GetBytesPerLine_0=e=>(Wt=n._emscripten_bind_Frame_GetBytesPerLine_0=fe.Ya)(e),Vt=n._emscripten_bind_Frame_GetFirstDirtyLine_0=e=>(Vt=n._emscripten_bind_Frame_GetFirstDirtyLine_0=fe.Za)(e),qt=n._emscripten_bind_Frame_GetLastDirtyLine_0=e=>(qt=n._emscripten_bind_Frame_GetLastDirtyLine_0=fe._a)(e),Yt=n._emscripten_bind_Frame_GetHasChanges_0=e=>(Yt=n._emscripten_bind_Frame_GetHasChanges_0=fe.$a)(e),Kt=n._emscripten_bind_Frame_GetBuffer_0=e=>(Kt=n._emscripten_bind_Frame_GetBuffer_0=fe.ab)(e),Zt=n._emscripten_bind_Frame_GetBufferSize_0=e=>(Zt=n._emscripten_bind_Frame_GetBufferSize_0=fe.bb)(e),Qt=n._emscripten_bind_Frame_GetScaleX_0=e=>(Qt=n._emscripten_bind_Frame_GetScaleX_0=fe.cb)(e),$t=n._emscripten_bind_Frame_GetScaleY_0=e=>($t=n._emscripten_bind_Frame_GetScaleY_0=fe.db)(e),Xt=n._emscripten_bind_Frame___destroy___0=e=>(Xt=n._emscripten_bind_Frame___destroy___0=fe.eb)(e),Jt=n._emscripten_bind_DbBackup_Init_1=(e,t)=>(Jt=n._emscripten_bind_DbBackup_Init_1=fe.fb)(e,t),ei=n._emscripten_bind_DbBackup_IsInProgress_0=e=>(ei=n._emscripten_bind_DbBackup_IsInProgress_0=fe.gb)(e),ti=n._emscripten_bind_DbBackup_IsDone_0=e=>(ti=n._emscripten_bind_DbBackup_IsDone_0=fe.hb)(e),ii=n._emscripten_bind_DbBackup_GetCurrentDatabase_0=e=>(ii=n._emscripten_bind_DbBackup_GetCurrentDatabase_0=fe.ib)(e),ri=n._emscripten_bind_DbBackup_Save_0=e=>(ri=n._emscripten_bind_DbBackup_Save_0=fe.jb)(e),ni=n._emscripten_bind_DbBackup_Skip_0=e=>(ni=n._emscripten_bind_DbBackup_Skip_0=fe.kb)(e),oi=n._emscripten_bind_DbBackup_GetArchivePtr_0=e=>(oi=n._emscripten_bind_DbBackup_GetArchivePtr_0=fe.lb)(e),si=n._emscripten_bind_DbBackup_GetArchiveSize_0=e=>(si=n._emscripten_bind_DbBackup_GetArchiveSize_0=fe.mb)(e),ai=n._emscripten_bind_DbBackup___destroy___0=e=>(ai=n._emscripten_bind_DbBackup___destroy___0=fe.nb)(e),ci=n._emscripten_bind_SuspendContextClipboardCopy_Cancel_0=e=>(ci=n._emscripten_bind_SuspendContextClipboardCopy_Cancel_0=fe.ob)(e),pi=n._emscripten_bind_SuspendContextClipboardCopy_Resume_0=e=>(pi=n._emscripten_bind_SuspendContextClipboardCopy_Resume_0=fe.pb)(e),ui=n._emscripten_bind_SuspendContextClipboardCopy_GetClipboardContent_0=e=>(ui=n._emscripten_bind_SuspendContextClipboardCopy_GetClipboardContent_0=fe.qb)(e),li=n._emscripten_bind_SuspendContextClipboardCopy___destroy___0=e=>(li=n._emscripten_bind_SuspendContextClipboardCopy___destroy___0=fe.rb)(e),di=n._emscripten_bind_SuspendContextClipboardPaste_Cancel_0=e=>(di=n._emscripten_bind_SuspendContextClipboardPaste_Cancel_0=fe.sb)(e),hi=n._emscripten_bind_SuspendContextClipboardPaste_Resume_1=(e,t)=>(hi=n._emscripten_bind_SuspendContextClipboardPaste_Resume_1=fe.tb)(e,t),_i=n._emscripten_bind_SuspendContextClipboardPaste___destroy___0=e=>(_i=n._emscripten_bind_SuspendContextClipboardPaste___destroy___0=fe.ub)(e),mi=n._emscripten_bind_SuspendContextNetworkConnect_Cancel_0=e=>(mi=n._emscripten_bind_SuspendContextNetworkConnect_Cancel_0=fe.vb)(e),yi=n._emscripten_bind_SuspendContextNetworkConnect_Resume_1=(e,t)=>(yi=n._emscripten_bind_SuspendContextNetworkConnect_Resume_1=fe.wb)(e,t),fi=n._emscripten_bind_SuspendContextNetworkConnect___destroy___0=e=>(fi=n._emscripten_bind_SuspendContextNetworkConnect___destroy___0=fe.xb)(e),vi=n._emscripten_bind_SuspendContextNetworkRpc_Cancel_0=e=>(vi=n._emscripten_bind_SuspendContextNetworkRpc_Cancel_0=fe.yb)(e),gi=n._emscripten_bind_SuspendContextNetworkRpc_GetRequestSize_0=e=>(gi=n._emscripten_bind_SuspendContextNetworkRpc_GetRequestSize_0=fe.zb)(e),bi=n._emscripten_bind_SuspendContextNetworkRpc_GetRequestData_0=e=>(bi=n._emscripten_bind_SuspendContextNetworkRpc_GetRequestData_0=fe.Ab)(e),Si=n._emscripten_bind_SuspendContextNetworkRpc_ReceiveResponse_2=(e,t,i)=>(Si=n._emscripten_bind_SuspendContextNetworkRpc_ReceiveResponse_2=fe.Bb)(e,t,i),Ci=n._emscripten_bind_SuspendContextNetworkRpc___destroy___0=e=>(Ci=n._emscripten_bind_SuspendContextNetworkRpc___destroy___0=fe.Cb)(e),wi=n._emscripten_bind_SuspendContext_GetKind_0=e=>(wi=n._emscripten_bind_SuspendContext_GetKind_0=fe.Db)(e),Ii=n._emscripten_bind_SuspendContext_Cancel_0=e=>(Ii=n._emscripten_bind_SuspendContext_Cancel_0=fe.Eb)(e),Di=n._emscripten_bind_SuspendContext_AsContextClipboardCopy_0=e=>(Di=n._emscripten_bind_SuspendContext_AsContextClipboardCopy_0=fe.Fb)(e),Gi=n._emscripten_bind_SuspendContext_AsContextClipboardPaste_0=e=>(Gi=n._emscripten_bind_SuspendContext_AsContextClipboardPaste_0=fe.Gb)(e),Ei=n._emscripten_bind_SuspendContext_AsContextNetworkConnect_0=e=>(Ei=n._emscripten_bind_SuspendContext_AsContextNetworkConnect_0=fe.Hb)(e),xi=n._emscripten_bind_SuspendContext_AsContextNetworkRpc_0=e=>(xi=n._emscripten_bind_SuspendContext_AsContextNetworkRpc_0=fe.Ib)(e),ki=n._emscripten_bind_SuspendContext___destroy___0=e=>(ki=n._emscripten_bind_SuspendContext___destroy___0=fe.Jb)(e),Mi=n._emscripten_bind_SessionImage_SessionImage_0=()=>(Mi=n._emscripten_bind_SessionImage_SessionImage_0=fe.Kb)(),Pi=n._emscripten_bind_SessionImage_GetDeviceId_0=e=>(Pi=n._emscripten_bind_SessionImage_GetDeviceId_0=fe.Lb)(e),Ri=n._emscripten_bind_SessionImage_SetDeviceId_1=(e,t)=>(Ri=n._emscripten_bind_SessionImage_SetDeviceId_1=fe.Mb)(e,t),zi=n._emscripten_bind_SessionImage_GetRomImage_0=e=>(zi=n._emscripten_bind_SessionImage_GetRomImage_0=fe.Nb)(e),Hi=n._emscripten_bind_SessionImage_GetRomImageSize_0=e=>(Hi=n._emscripten_bind_SessionImage_GetRomImageSize_0=fe.Ob)(e),Ai=n._emscripten_bind_SessionImage_SetRomImage_2=(e,t,i)=>(Ai=n._emscripten_bind_SessionImage_SetRomImage_2=fe.Pb)(e,t,i),Ni=n._emscripten_bind_SessionImage_GetMemoryImage_0=e=>(Ni=n._emscripten_bind_SessionImage_GetMemoryImage_0=fe.Qb)(e),Ti=n._emscripten_bind_SessionImage_GetMemoryImageSize_0=e=>(Ti=n._emscripten_bind_SessionImage_GetMemoryImageSize_0=fe.Rb)(e),Fi=n._emscripten_bind_SessionImage_SetMemoryImage_2=(e,t,i)=>(Fi=n._emscripten_bind_SessionImage_SetMemoryImage_2=fe.Sb)(e,t,i),Li=n._emscripten_bind_SessionImage_GetMetadata_0=e=>(Li=n._emscripten_bind_SessionImage_GetMetadata_0=fe.Tb)(e),Ui=n._emscripten_bind_SessionImage_GetMetadataSize_0=e=>(Ui=n._emscripten_bind_SessionImage_GetMetadataSize_0=fe.Ub)(e),Bi=n._emscripten_bind_SessionImage_SetMetadata_2=(e,t,i)=>(Bi=n._emscripten_bind_SessionImage_SetMetadata_2=fe.Vb)(e,t,i),ji=n._emscripten_bind_SessionImage_GetSavestate_0=e=>(ji=n._emscripten_bind_SessionImage_GetSavestate_0=fe.Wb)(e),Oi=n._emscripten_bind_SessionImage_GetSavestateSize_0=e=>(Oi=n._emscripten_bind_SessionImage_GetSavestateSize_0=fe.Xb)(e),Wi=n._emscripten_bind_SessionImage_SetSavestate_2=(e,t,i)=>(Wi=n._emscripten_bind_SessionImage_SetSavestate_2=fe.Yb)(e,t,i),Vi=n._emscripten_bind_SessionImage_GetVersion_0=e=>(Vi=n._emscripten_bind_SessionImage_GetVersion_0=fe.Zb)(e),qi=n._emscripten_bind_SessionImage_Serialize_0=e=>(qi=n._emscripten_bind_SessionImage_Serialize_0=fe._b)(e),Yi=n._emscripten_bind_SessionImage_GetSerializedImage_0=e=>(Yi=n._emscripten_bind_SessionImage_GetSerializedImage_0=fe.$b)(e),Ki=n._emscripten_bind_SessionImage_GetSerializedImageSize_0=e=>(Ki=n._emscripten_bind_SessionImage_GetSerializedImageSize_0=fe.ac)(e),Zi=n._emscripten_bind_SessionImage_Deserialize_2=(e,t,i)=>(Zi=n._emscripten_bind_SessionImage_Deserialize_2=fe.bc)(e,t,i),Qi=n._emscripten_bind_SessionImage___destroy___0=e=>(Qi=n._emscripten_bind_SessionImage___destroy___0=fe.cc)(e),$i=n._emscripten_bind_SkinLoader_SkinLoader_1=e=>($i=n._emscripten_bind_SkinLoader_SkinLoader_1=fe.dc)(e),Xi=n._emscripten_bind_SkinLoader_GetData_0=e=>(Xi=n._emscripten_bind_SkinLoader_GetData_0=fe.ec)(e),Ji=n._emscripten_bind_SkinLoader_GetSize_0=e=>(Ji=n._emscripten_bind_SkinLoader_GetSize_0=fe.fc)(e),er=n._emscripten_bind_SkinLoader___destroy___0=e=>(er=n._emscripten_bind_SkinLoader___destroy___0=fe.gc)(e),tr=n._emscripten_bind_GunzipContext_GunzipContext_3=(e,t,i)=>(tr=n._emscripten_bind_GunzipContext_GunzipContext_3=fe.hc)(e,t,i),ir=n._emscripten_bind_GunzipContext_GetState_0=e=>(ir=n._emscripten_bind_GunzipContext_GetState_0=fe.ic)(e),rr=n._emscripten_bind_GunzipContext_Continue_0=e=>(rr=n._emscripten_bind_GunzipContext_Continue_0=fe.jc)(e),nr=n._emscripten_bind_GunzipContext_GetUncompressedData_0=e=>(nr=n._emscripten_bind_GunzipContext_GetUncompressedData_0=fe.kc)(e),or=n._emscripten_bind_GunzipContext_ReleaseUncompressedData_0=e=>(or=n._emscripten_bind_GunzipContext_ReleaseUncompressedData_0=fe.lc)(e),sr=n._emscripten_bind_GunzipContext_GetUncompressedSize_0=e=>(sr=n._emscripten_bind_GunzipContext_GetUncompressedSize_0=fe.mc)(e),ar=n._emscripten_bind_GunzipContext_GetError_0=e=>(ar=n._emscripten_bind_GunzipContext_GetError_0=fe.nc)(e),cr=n._emscripten_bind_GunzipContext___destroy___0=e=>(cr=n._emscripten_bind_GunzipContext___destroy___0=fe.oc)(e),pr=n._emscripten_bind_ZipfileWalker_ZipfileWalker_2=(e,t)=>(pr=n._emscripten_bind_ZipfileWalker_ZipfileWalker_2=fe.pc)(e,t),ur=n._emscripten_bind_ZipfileWalker_GetState_0=e=>(ur=n._emscripten_bind_ZipfileWalker_GetState_0=fe.qc)(e),lr=n._emscripten_bind_ZipfileWalker_Next_0=e=>(lr=n._emscripten_bind_ZipfileWalker_Next_0=fe.rc)(e),dr=n._emscripten_bind_ZipfileWalker_GetTotalEntries_0=e=>(dr=n._emscripten_bind_ZipfileWalker_GetTotalEntries_0=fe.sc)(e),hr=n._emscripten_bind_ZipfileWalker_GetCurrentEntrySize_0=e=>(hr=n._emscripten_bind_ZipfileWalker_GetCurrentEntrySize_0=fe.tc)(e),_r=n._emscripten_bind_ZipfileWalker_GetCurrentEntryName_0=e=>(_r=n._emscripten_bind_ZipfileWalker_GetCurrentEntryName_0=fe.uc)(e),mr=n._emscripten_bind_ZipfileWalker_GetCurrentEntryContent_0=e=>(mr=n._emscripten_bind_ZipfileWalker_GetCurrentEntryContent_0=fe.vc)(e),yr=n._emscripten_bind_ZipfileWalker___destroy___0=e=>(yr=n._emscripten_bind_ZipfileWalker___destroy___0=fe.wc)(e),fr=()=>(fr=fe.xc)(),vr=e=>(vr=fe.zc)(e);function gr(){function e(){ue||(ue=!0,n.calledRun=!0,C||(B(G),B(E),i(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),br&&function(){var e=ge;try{var t=e(0,0);return le(t),t}catch(e){return(e=>{if(e instanceof U||"unwind"==e)return y;c(1,e)})(e)}}(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),x.unshift(e);var e;B(x)}()))}k>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),D.unshift(e);var e;B(D)}(),k>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),e()}),1)):e()))}if(n.___original_main=()=>(n.___original_main=fe.Ac)(),n.___start_em_js=1472695,n.___stop_em_js=1472794,n.addFunction=(e,t)=>{var i=(e=>(pe||(pe=new WeakMap,((e,t)=>{if(pe)for(var i=0;i<0+t;i++){var r=(o=void 0,(o=he[n=i])||(n>=he.length&&(he.length=n+1),he[n]=o=ce.get(n)),o);r&&pe.set(r,i)}var n,o})(0,ce.length)),pe.get(e)||0))(e);if(i)return i;var r=(()=>{if(_e.length)return _e.pop();try{ce.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return ce.length-1})();try{me(r,e)}catch(i){if(!(i instanceof TypeError))throw i;var n=((e,t)=>{if("function"==typeof WebAssembly.Function)return new WebAssembly.Function((e=>{for(var t={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==e[0]?[]:[t[e[0]]]},r=1;r<e.length;++r)i.parameters.push(t[e[r]]);return i})(t),e);var i=[1];((e,t)=>{var i=e.slice(0,1),r=e.slice(1),n={i:127,p:127,j:126,f:125,d:124,e:111};t.push(96),de(r.length,t);for(var o=0;o<r.length;++o)t.push(n[r[o]]);"v"==i?t.push(0):t.push(1,n[i])})(t,i);var r=[0,97,115,109,1,0,0,0,1];de(i.length,r),r.push.apply(r,i),r.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var n=new WebAssembly.Module(new Uint8Array(r));return new WebAssembly.Instance(n,{e:{f:e}}).exports.f})(e,t);me(r,n)}return pe.set(e,r),r},n.UTF8ToString=V,P=function e(){ue||gr(),ue||(P=e)},n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();var br=!0;function Sr(){}function Cr(e){return(e||Sr).__cache__}function wr(e,t){var i=Cr(t),r=i[e];return r||((r=Object.create((t||Sr).prototype)).ptr=e,i[e]=r)}n.noInitialRun&&(br=!1),gr(),Sr.prototype=Object.create(Sr.prototype),Sr.prototype.constructor=Sr,Sr.prototype.__class__=Sr,Sr.__cache__={},n.WrapperObject=Sr,n.getCache=Cr,n.wrapPointer=wr,n.castObject=function(e,t){return wr(e.ptr,t)},n.NULL=wr(0),n.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete Cr(e.__class__)[e.ptr]},n.compare=function(e,t){return e.ptr===t.ptr},n.getPointer=function(e){return e.ptr},n.getClass=function(e){return e.__class__};var Ir={buffer:0,size:0,pos:0,temps:[],needed:0,prepare(){if(Ir.needed){for(var e=0;e<Ir.temps.length;e++)n._webidl_free(Ir.temps[e]);Ir.temps.length=0,n._webidl_free(Ir.buffer),Ir.buffer=0,Ir.size+=Ir.needed,Ir.needed=0}Ir.buffer||(Ir.size+=128,Ir.buffer=n._webidl_malloc(Ir.size),w(Ir.buffer)),Ir.pos=0},alloc(e,t){w(Ir.buffer);var i,r=t.BYTES_PER_ELEMENT,o=e.length*r;return o=o+7&-8,Ir.pos+o>=Ir.size?(w(o>0),Ir.needed+=o,i=n._webidl_malloc(o),Ir.temps.push(i)):(i=Ir.buffer+Ir.pos,Ir.pos+=o),i},copy(e,t,i){switch(i>>>=0,t.BYTES_PER_ELEMENT){case 2:i>>>=1;break;case 4:i>>>=2;break;case 8:i>>>=3}for(var r=0;r<e.length;r++)t[i+r]=e[r]}};function Dr(e){if("string"==typeof e){var t=ae(e),i=Ir.alloc(t,f);return Ir.copy(t,f,i),i}return e}function Gr(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Er(){this.ptr=Se(),Cr(Er)[this.ptr]=this}function xr(e,t){e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),this.ptr=Rt(e,t),Cr(xr)[this.ptr]=this}function kr(){throw"cannot construct a Frame, no constructor in IDL"}function Mr(){throw"cannot construct a DbBackup, no constructor in IDL"}function Pr(){throw"cannot construct a SuspendContextClipboardCopy, no constructor in IDL"}function Rr(){throw"cannot construct a SuspendContextClipboardPaste, no constructor in IDL"}function zr(){throw"cannot construct a SuspendContextNetworkConnect, no constructor in IDL"}function Hr(){throw"cannot construct a SuspendContextNetworkRpc, no constructor in IDL"}function Ar(){throw"cannot construct a SuspendContext, no constructor in IDL"}function Nr(){this.ptr=Mi(),Cr(Nr)[this.ptr]=this}function Tr(e){Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),this.ptr=$i(e),Cr(Tr)[this.ptr]=this}function Fr(e,t,i){e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),this.ptr=tr(e,t,i),Cr(Fr)[this.ptr]=this}function Lr(e,t){e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),this.ptr=pr(e,t),Cr(Lr)[this.ptr]=this}return Gr.prototype=Object.create(Sr.prototype),Gr.prototype.constructor=Gr,Gr.prototype.__class__=Gr,Gr.__cache__={},n.VoidPtr=Gr,Gr.prototype.__destroy__=Gr.prototype.__destroy__=function(){var e=this.ptr;be(e)},Er.prototype=Object.create(Sr.prototype),Er.prototype.constructor=Er,Er.prototype.__class__=Er,Er.__cache__={},n.Cloudpilot=Er,Er.prototype.Malloc=Er.prototype.Malloc=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),wr(Ce(t,e),Gr)},Er.prototype.Free=Er.prototype.Free=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),we(t,e)},Er.prototype.Nullptr=Er.prototype.Nullptr=function(){var e=this.ptr;return wr(Ie(e),Gr)},Er.prototype.InitializeSession=Er.prototype.InitializeSession=function(e,t,i){var r=this.ptr;return Ir.prepare(),e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i=i&&"object"==typeof i?i.ptr:Dr(i),!!De(r,e,t,i)},Er.prototype.GetCyclesPerSecond=Er.prototype.GetCyclesPerSecond=function(){var e=this.ptr;return Ge(e)},Er.prototype.RunEmulation=Er.prototype.RunEmulation=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ee(t,e)},Er.prototype.SetClockFactor=Er.prototype.SetClockFactor=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),xe(t,e)},Er.prototype.CopyFrame=Er.prototype.CopyFrame=function(){var e=this.ptr;return wr(ke(e),kr)},Er.prototype.IsScreenDirty=Er.prototype.IsScreenDirty=function(){var e=this.ptr;return!!Me(e)},Er.prototype.MarkScreenClean=Er.prototype.MarkScreenClean=function(){var e=this.ptr;Pe(e)},Er.prototype.MinMemoryForDevice=Er.prototype.MinMemoryForDevice=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),Re(t,e)},Er.prototype.FramebufferSizeForDevice=Er.prototype.FramebufferSizeForDevice=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),ze(t,e)},Er.prototype.TotalMemoryForDevice=Er.prototype.TotalMemoryForDevice=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),He(t,e)},Er.prototype.QueuePenMove=Er.prototype.QueuePenMove=function(e,t){var i=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ae(i,e,t)},Er.prototype.QueuePenUp=Er.prototype.QueuePenUp=function(){var e=this.ptr;Ne(e)},Er.prototype.QueueButtonDown=Er.prototype.QueueButtonDown=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Te(t,e)},Er.prototype.QueueButtonUp=Er.prototype.QueueButtonUp=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Fe(t,e)},Er.prototype.QueueKeyboardEvent=Er.prototype.QueueKeyboardEvent=function(e,t){var i=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Le(i,e,t)},Er.prototype.IsPowerOff=Er.prototype.IsPowerOff=function(){var e=this.ptr;return!!Ue(e)},Er.prototype.IsUIInitialized=Er.prototype.IsUIInitialized=function(){var e=this.ptr;return!!Be(e)},Er.prototype.GetOSVersion=Er.prototype.GetOSVersion=function(){var e=this.ptr;return je(e)},Er.prototype.IsSetupComplete=Er.prototype.IsSetupComplete=function(){var e=this.ptr;return!!Oe(e)},Er.prototype.Reset=Er.prototype.Reset=function(){var e=this.ptr;We(e)},Er.prototype.ResetNoExtensions=Er.prototype.ResetNoExtensions=function(){var e=this.ptr;Ve(e)},Er.prototype.ResetHard=Er.prototype.ResetHard=function(){var e=this.ptr;qe(e)},Er.prototype.InstallDb=Er.prototype.InstallDb=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ye(i,e,t)},Er.prototype.GetPalette2bitMapping=Er.prototype.GetPalette2bitMapping=function(){var e=this.ptr;return Ke(e)},Er.prototype.GetMemoryPtr=Er.prototype.GetMemoryPtr=function(){var e=this.ptr;return wr(Ze(e),Gr)},Er.prototype.GetDirtyPagesPtr=Er.prototype.GetDirtyPagesPtr=function(){var e=this.ptr;return wr(Qe(e),Gr)},Er.prototype.GetMemorySize=Er.prototype.GetMemorySize=function(){var e=this.ptr;return $e(e)},Er.prototype.ImportMemoryImage=Er.prototype.ImportMemoryImage=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Xe(i,e,t)},Er.prototype.GetRomPtr=Er.prototype.GetRomPtr=function(){var e=this.ptr;return wr(Je(e),Gr)},Er.prototype.GetRomSize=Er.prototype.GetRomSize=function(){var e=this.ptr;return et(e)},Er.prototype.GetSavestatePtr=Er.prototype.GetSavestatePtr=function(){var e=this.ptr;return wr(tt(e),Gr)},Er.prototype.GetSavestateSize=Er.prototype.GetSavestateSize=function(){var e=this.ptr;return it(e)},Er.prototype.SaveState=Er.prototype.SaveState=function(){var e=this.ptr;return!!rt(e)},Er.prototype.LoadState=Er.prototype.LoadState=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!nt(i,e,t)},Er.prototype.GetHotsyncName=Er.prototype.GetHotsyncName=function(){var e=this.ptr;return V(ot(e))},Er.prototype.SetHotsyncName=Er.prototype.SetHotsyncName=function(e){var t=this.ptr;Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),st(t,e)},Er.prototype.RegisterPwmHandler=Er.prototype.RegisterPwmHandler=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),at(t,e)},Er.prototype.StartBackup=Er.prototype.StartBackup=function(){var e=this.ptr;return wr(ct(e),Mr)},Er.prototype.SetClipboardIntegration=Er.prototype.SetClipboardIntegration=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),pt(t,e)},Er.prototype.GetClipboardIntegration=Er.prototype.GetClipboardIntegration=function(){var e=this.ptr;return!!ut(e)},Er.prototype.IsSuspended=Er.prototype.IsSuspended=function(){var e=this.ptr;return!!lt(e)},Er.prototype.GetSuspendContext=Er.prototype.GetSuspendContext=function(){var e=this.ptr;return wr(dt(e),Ar)},Er.prototype.SetNetworkRedirection=Er.prototype.SetNetworkRedirection=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),ht(t,e)},Er.prototype.GetNetworkRedirection=Er.prototype.GetNetworkRedirection=function(){var e=this.ptr;return!!_t(e)},Er.prototype.RegisterProxyDisconnectHandler=Er.prototype.RegisterProxyDisconnectHandler=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),mt(t,e)},Er.prototype.SetHotsyncNameManagement=Er.prototype.SetHotsyncNameManagement=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),yt(t,e)},Er.prototype.LaunchAppByName=Er.prototype.LaunchAppByName=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),!!ft(t,e)},Er.prototype.LaunchAppByDbHeader=Er.prototype.LaunchAppByDbHeader=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!vt(i,e,t)},Er.prototype.DeviceSupportsCardSize=Er.prototype.DeviceSupportsCardSize=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!gt(t,e)},Er.prototype.ClearExternalStorage=Er.prototype.ClearExternalStorage=function(){var e=this.ptr;bt(e)},Er.prototype.AllocateCard=Er.prototype.AllocateCard=function(e,t){var i=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),t&&"object"==typeof t&&(t=t.ptr),!!St(i,e,t)},Er.prototype.AdoptCard=Er.prototype.AdoptCard=function(e,t,i){var r=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Ct(r,e,t,i)},Er.prototype.MountCard=Er.prototype.MountCard=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),!!wt(t,e)},Er.prototype.RemoveCard=Er.prototype.RemoveCard=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),!!It(t,e)},Er.prototype.GetCardData=Er.prototype.GetCardData=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),wr(Dt(t,e),Gr)},Er.prototype.GetCardDirtyPages=Er.prototype.GetCardDirtyPages=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),wr(Gt(t,e),Gr)},Er.prototype.GetCardSize=Er.prototype.GetCardSize=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),Et(t,e)},Er.prototype.RemountCards=Er.prototype.RemountCards=function(){var e=this.ptr;xt(e)},Er.prototype.GetSupportLevel=Er.prototype.GetSupportLevel=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),kt(t,e)},Er.prototype.GetMountedKey=Er.prototype.GetMountedKey=function(){var e=this.ptr;return V(Mt(e))},Er.prototype.__destroy__=Er.prototype.__destroy__=function(){var e=this.ptr;Pt(e)},xr.prototype=Object.create(Sr.prototype),xr.prototype.constructor=xr,xr.prototype.__class__=xr,xr.__cache__={},n.RomInfo=xr,xr.prototype.IsValid=xr.prototype.IsValid=function(){var e=this.ptr;return!!zt(e)},xr.prototype.CardVersion=xr.prototype.CardVersion=function(){var e=this.ptr;return Ht(e)},xr.prototype.CardName=xr.prototype.CardName=function(){var e=this.ptr;return V(At(e))},xr.prototype.RomVersion=xr.prototype.RomVersion=function(){var e=this.ptr;return Nt(e)},xr.prototype.RomVersionString=xr.prototype.RomVersionString=function(){var e=this.ptr;return V(Tt(e))},xr.prototype.Supports=xr.prototype.Supports=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),!!Ft(t,e)},xr.prototype.__destroy__=xr.prototype.__destroy__=function(){var e=this.ptr;Lt(e)},kr.prototype=Object.create(Sr.prototype),kr.prototype.constructor=kr,kr.prototype.__class__=kr,kr.__cache__={},n.Frame=kr,kr.prototype.GetLineWidth=kr.prototype.GetLineWidth=function(){var e=this.ptr;return Ut(e)},kr.prototype.GetBpp=kr.prototype.GetBpp=function(){var e=this.ptr;return Bt(e)},kr.prototype.GetLines=kr.prototype.GetLines=function(){var e=this.ptr;return jt(e)},kr.prototype.GetMargin=kr.prototype.GetMargin=function(){var e=this.ptr;return Ot(e)},kr.prototype.GetBytesPerLine=kr.prototype.GetBytesPerLine=function(){var e=this.ptr;return Wt(e)},kr.prototype.GetFirstDirtyLine=kr.prototype.GetFirstDirtyLine=function(){var e=this.ptr;return Vt(e)},kr.prototype.GetLastDirtyLine=kr.prototype.GetLastDirtyLine=function(){var e=this.ptr;return qt(e)},kr.prototype.GetHasChanges=kr.prototype.GetHasChanges=function(){var e=this.ptr;return!!Yt(e)},kr.prototype.GetBuffer=kr.prototype.GetBuffer=function(){var e=this.ptr;return wr(Kt(e),Gr)},kr.prototype.GetBufferSize=kr.prototype.GetBufferSize=function(){var e=this.ptr;return Zt(e)},kr.prototype.GetScaleX=kr.prototype.GetScaleX=function(){var e=this.ptr;return Qt(e)},kr.prototype.GetScaleY=kr.prototype.GetScaleY=function(){var e=this.ptr;return $t(e)},kr.prototype.__destroy__=kr.prototype.__destroy__=function(){var e=this.ptr;Xt(e)},Mr.prototype=Object.create(Sr.prototype),Mr.prototype.constructor=Mr,Mr.prototype.__class__=Mr,Mr.__cache__={},n.DbBackup=Mr,Mr.prototype.Init=Mr.prototype.Init=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Jt(t,e)},Mr.prototype.IsInProgress=Mr.prototype.IsInProgress=function(){var e=this.ptr;return!!ei(e)},Mr.prototype.IsDone=Mr.prototype.IsDone=function(){var e=this.ptr;return!!ti(e)},Mr.prototype.GetCurrentDatabase=Mr.prototype.GetCurrentDatabase=function(){var e=this.ptr;return V(ii(e))},Mr.prototype.Save=Mr.prototype.Save=function(){var e=this.ptr;return!!ri(e)},Mr.prototype.Skip=Mr.prototype.Skip=function(){var e=this.ptr;ni(e)},Mr.prototype.GetArchivePtr=Mr.prototype.GetArchivePtr=function(){var e=this.ptr;return wr(oi(e),Gr)},Mr.prototype.GetArchiveSize=Mr.prototype.GetArchiveSize=function(){var e=this.ptr;return si(e)},Mr.prototype.__destroy__=Mr.prototype.__destroy__=function(){var e=this.ptr;ai(e)},Pr.prototype=Object.create(Sr.prototype),Pr.prototype.constructor=Pr,Pr.prototype.__class__=Pr,Pr.__cache__={},n.SuspendContextClipboardCopy=Pr,Pr.prototype.Cancel=Pr.prototype.Cancel=function(){var e=this.ptr;ci(e)},Pr.prototype.Resume=Pr.prototype.Resume=function(){var e=this.ptr;pi(e)},Pr.prototype.GetClipboardContent=Pr.prototype.GetClipboardContent=function(){var e=this.ptr;return V(ui(e))},Pr.prototype.__destroy__=Pr.prototype.__destroy__=function(){var e=this.ptr;li(e)},Rr.prototype=Object.create(Sr.prototype),Rr.prototype.constructor=Rr,Rr.prototype.__class__=Rr,Rr.__cache__={},n.SuspendContextClipboardPaste=Rr,Rr.prototype.Cancel=Rr.prototype.Cancel=function(){var e=this.ptr;di(e)},Rr.prototype.Resume=Rr.prototype.Resume=function(e){var t=this.ptr;Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),hi(t,e)},Rr.prototype.__destroy__=Rr.prototype.__destroy__=function(){var e=this.ptr;_i(e)},zr.prototype=Object.create(Sr.prototype),zr.prototype.constructor=zr,zr.prototype.__class__=zr,zr.__cache__={},n.SuspendContextNetworkConnect=zr,zr.prototype.Cancel=zr.prototype.Cancel=function(){var e=this.ptr;mi(e)},zr.prototype.Resume=zr.prototype.Resume=function(e){var t=this.ptr;Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),yi(t,e)},zr.prototype.__destroy__=zr.prototype.__destroy__=function(){var e=this.ptr;fi(e)},Hr.prototype=Object.create(Sr.prototype),Hr.prototype.constructor=Hr,Hr.prototype.__class__=Hr,Hr.__cache__={},n.SuspendContextNetworkRpc=Hr,Hr.prototype.Cancel=Hr.prototype.Cancel=function(){var e=this.ptr;vi(e)},Hr.prototype.GetRequestSize=Hr.prototype.GetRequestSize=function(){var e=this.ptr;return gi(e)},Hr.prototype.GetRequestData=Hr.prototype.GetRequestData=function(){var e=this.ptr;return wr(bi(e),Gr)},Hr.prototype.ReceiveResponse=Hr.prototype.ReceiveResponse=function(e,t){var i=this.ptr;e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Si(i,e,t)},Hr.prototype.__destroy__=Hr.prototype.__destroy__=function(){var e=this.ptr;Ci(e)},Ar.prototype=Object.create(Sr.prototype),Ar.prototype.constructor=Ar,Ar.prototype.__class__=Ar,Ar.__cache__={},n.SuspendContext=Ar,Ar.prototype.GetKind=Ar.prototype.GetKind=function(){var e=this.ptr;return wi(e)},Ar.prototype.Cancel=Ar.prototype.Cancel=function(){var e=this.ptr;Ii(e)},Ar.prototype.AsContextClipboardCopy=Ar.prototype.AsContextClipboardCopy=function(){var e=this.ptr;return wr(Di(e),Pr)},Ar.prototype.AsContextClipboardPaste=Ar.prototype.AsContextClipboardPaste=function(){var e=this.ptr;return wr(Gi(e),Rr)},Ar.prototype.AsContextNetworkConnect=Ar.prototype.AsContextNetworkConnect=function(){var e=this.ptr;return wr(Ei(e),zr)},Ar.prototype.AsContextNetworkRpc=Ar.prototype.AsContextNetworkRpc=function(){var e=this.ptr;return wr(xi(e),Hr)},Ar.prototype.__destroy__=Ar.prototype.__destroy__=function(){var e=this.ptr;ki(e)},Nr.prototype=Object.create(Sr.prototype),Nr.prototype.constructor=Nr,Nr.prototype.__class__=Nr,Nr.__cache__={},n.SessionImage=Nr,Nr.prototype.GetDeviceId=Nr.prototype.GetDeviceId=function(){var e=this.ptr;return V(Pi(e))},Nr.prototype.SetDeviceId=Nr.prototype.SetDeviceId=function(e){var t=this.ptr;return Ir.prepare(),e=e&&"object"==typeof e?e.ptr:Dr(e),wr(Ri(t,e),Nr)},Nr.prototype.GetRomImage=Nr.prototype.GetRomImage=function(){var e=this.ptr;return wr(zi(e),Gr)},Nr.prototype.GetRomImageSize=Nr.prototype.GetRomImageSize=function(){var e=this.ptr;return Hi(e)},Nr.prototype.SetRomImage=Nr.prototype.SetRomImage=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),wr(Ai(i,e,t),Nr)},Nr.prototype.GetMemoryImage=Nr.prototype.GetMemoryImage=function(){var e=this.ptr;return wr(Ni(e),Gr)},Nr.prototype.GetMemoryImageSize=Nr.prototype.GetMemoryImageSize=function(){var e=this.ptr;return Ti(e)},Nr.prototype.SetMemoryImage=Nr.prototype.SetMemoryImage=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),wr(Fi(i,e,t),Nr)},Nr.prototype.GetMetadata=Nr.prototype.GetMetadata=function(){var e=this.ptr;return wr(Li(e),Gr)},Nr.prototype.GetMetadataSize=Nr.prototype.GetMetadataSize=function(){var e=this.ptr;return Ui(e)},Nr.prototype.SetMetadata=Nr.prototype.SetMetadata=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),wr(Bi(i,e,t),Nr)},Nr.prototype.GetSavestate=Nr.prototype.GetSavestate=function(){var e=this.ptr;return wr(ji(e),Gr)},Nr.prototype.GetSavestateSize=Nr.prototype.GetSavestateSize=function(){var e=this.ptr;return Oi(e)},Nr.prototype.SetSavestate=Nr.prototype.SetSavestate=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),wr(Wi(i,e,t),Nr)},Nr.prototype.GetVersion=Nr.prototype.GetVersion=function(){var e=this.ptr;return Vi(e)},Nr.prototype.Serialize=Nr.prototype.Serialize=function(){var e=this.ptr;return!!qi(e)},Nr.prototype.GetSerializedImage=Nr.prototype.GetSerializedImage=function(){var e=this.ptr;return wr(Yi(e),Gr)},Nr.prototype.GetSerializedImageSize=Nr.prototype.GetSerializedImageSize=function(){var e=this.ptr;return Ki(e)},Nr.prototype.Deserialize=Nr.prototype.Deserialize=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Zi(i,e,t)},Nr.prototype.__destroy__=Nr.prototype.__destroy__=function(){var e=this.ptr;Qi(e)},Tr.prototype=Object.create(Sr.prototype),Tr.prototype.constructor=Tr,Tr.prototype.__class__=Tr,Tr.__cache__={},n.SkinLoader=Tr,Tr.prototype.GetData=Tr.prototype.GetData=function(){var e=this.ptr;return wr(Xi(e),Gr)},Tr.prototype.GetSize=Tr.prototype.GetSize=function(){var e=this.ptr;return Ji(e)},Tr.prototype.__destroy__=Tr.prototype.__destroy__=function(){var e=this.ptr;er(e)},Fr.prototype=Object.create(Sr.prototype),Fr.prototype.constructor=Fr,Fr.prototype.__class__=Fr,Fr.__cache__={},n.GunzipContext=Fr,Fr.prototype.GetState=Fr.prototype.GetState=function(){var e=this.ptr;return ir(e)},Fr.prototype.Continue=Fr.prototype.Continue=function(){var e=this.ptr;return rr(e)},Fr.prototype.GetUncompressedData=Fr.prototype.GetUncompressedData=function(){var e=this.ptr;return wr(nr(e),Gr)},Fr.prototype.ReleaseUncompressedData=Fr.prototype.ReleaseUncompressedData=function(){var e=this.ptr;return wr(or(e),Gr)},Fr.prototype.GetUncompressedSize=Fr.prototype.GetUncompressedSize=function(){var e=this.ptr;return sr(e)},Fr.prototype.GetError=Fr.prototype.GetError=function(){var e=this.ptr;return V(ar(e))},Fr.prototype.__destroy__=Fr.prototype.__destroy__=function(){var e=this.ptr;cr(e)},Lr.prototype=Object.create(Sr.prototype),Lr.prototype.constructor=Lr,Lr.prototype.__class__=Lr,Lr.__cache__={},n.ZipfileWalker=Lr,Lr.prototype.GetState=Lr.prototype.GetState=function(){var e=this.ptr;return ur(e)},Lr.prototype.Next=Lr.prototype.Next=function(){var e=this.ptr;return lr(e)},Lr.prototype.GetTotalEntries=Lr.prototype.GetTotalEntries=function(){var e=this.ptr;return dr(e)},Lr.prototype.GetCurrentEntrySize=Lr.prototype.GetCurrentEntrySize=function(){var e=this.ptr;return hr(e)},Lr.prototype.GetCurrentEntryName=Lr.prototype.GetCurrentEntryName=function(){var e=this.ptr;return V(_r(e))},Lr.prototype.GetCurrentEntryContent=Lr.prototype.GetCurrentEntryContent=function(){var e=this.ptr;return wr(mr(e),Gr)},Lr.prototype.__destroy__=Lr.prototype.__destroy__=function(){var e=this.ptr;yr(e)},e.ready});e.exports=i},650:function(e,t){!function(e){"use strict";var t,i=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,r=536870912,n=1073741824,o=new WeakMap,s=function(e,t){return function(o){var s=t.get(o),a=void 0===s?o.size:s<n?s+1:0;if(!o.has(a))return e(o,a);if(o.size<r){for(;o.has(a);)a=Math.floor(Math.random()*n);return e(o,a)}if(o.size>i)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(a);)a=Math.floor(Math.random()*i);return e(o,a)}}((t=o,function(e,i){return t.set(e,i),i}),o),a=function(e){return function(t){var i=e(t);return t.add(i),i}}(s);e.addUniqueNumber=a,e.generateUniqueNumber=s}(t)},37:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[];i[0]=function(){return function(){}},i[1]=function(e,t){return void 0===t?e:function(i){e(i,t)}};var r=function(){function e(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return e.prototype.addHandler=function(e,t){return this.isHandlerAttached(e,t)||(this._handlers.push(e),this._contexts.push(t),this._createDispatcher(),this._updateHasHandlers()),this},e.prototype.removeHandler=function(e,t){var i=this._getHandlerIndex(e,t);return void 0!==i&&(this._handlers.splice(i,1),this._contexts.splice(i,1),this._createDispatcher(),this._updateHasHandlers()),this},e.prototype.isHandlerAttached=function(e,t){return void 0!==this._getHandlerIndex(e,t)},e.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},e.prototype._getHandlerIndex=function(e,t){var i,r=this._handlers.length;for(i=0;i<r&&(this._handlers[i]!==e||this._contexts[i]!==t);i++);return i<r?i:void 0},e.prototype._createDispatcher=function(){var e;this.dispatch=(e=this._handlers.length,i[e]||(i[e]=function(e){for(var t="return function dispatcher"+e+"(payload) {\n",i=[],r=[],n=0;n<e;n++)i.push("cb"+n),r.push("ctx"+n),t+="    cb"+n+"(payload, ctx"+n+");\n";return t+="};",new(Function.bind.apply(Function,[void 0].concat(i.concat(r),[t])))}(e)),i[e]).apply(this,this._handlers.concat(this._contexts))},e}();t.default=r},819:(e,t,i)=>{"use strict";var r=i(37);t.j=r.default}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function e(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s}function t(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}var n,o,s;i.r(r),i.d(r,{Button:()=>ne,DeviceId:()=>n,DeviceOrientation:()=>o,VERSION:()=>oe,createEmulator:()=>se,createEmulatorFactory:()=>ae}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError,(s=n||(n={})).palmPilot="PalmPilot",s.pilot="Pilot",s.iii="PalmIII",s.palmVx="PalmVx",s.palmV="PalmV",s.palmVII="PalmVII",s.palmVIIEZ="PalmVIIEZ",s.palmVIIx="PalmVIIx",s.iiic="PalmIIIc",s.iiix="PalmIIIx",s.iiixe="PalmIIIxe",s.iiie="PalmIIIe",s.m500="PalmM500",s.m505="PalmM505",s.m515="PalmM515",s.m520="PalmM520",s.m100="PalmM100",s.m105="PalmM105",s.m125="PalmM125",s.m130="PalmM130",s.i705="Palmi705",s.i710="PalmI710",s.handera330="HandEra330",s.handera330c="HandEra330c",s.pegS300="PEG-S300",s.pegS320="PEG-S320",s.pegS500c="PEG-S500C",s.pegT400="PEG-T400",s.pegN600c="PEG-N600C/N610C",s.pegT600c="PEG-T600",s.pegN700c="PEG-N700C/N710C",s.pegT650c="YSX1230",s.pegNR70="NR70",s.acerS11="Acer-S11",s.lp168="Legend-P168",function(e){e.portrait="portrait",e.landscape90="landscape90",e.landscape270="landscape270",e.portrait180="portrait180"}(o||(o={})),new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const a=new Error("request for lock canceled");class c{constructor(e,t=a){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(((t,i)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:i}),this._dispatch()}))}runExclusive(e,t=1){return i=this,r=void 0,o=function*(){const[i,r]=yield this.acquire(t);try{return yield e(i)}finally{r()}},new((n=void 0)||(n=Promise))((function(e,t){function s(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}c((o=o.apply(i,r||[])).next())}));var i,r,n,o}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()}))}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach((e=>e.forEach((e=>e.reject(this._cancelError))))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const i=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(!i)continue;const r=this._value,n=t;this._value-=t,t=this._value+1,i.resolve([r,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((e=>e())),this._weightedWaiters[e-1]=[])}}class p{constructor(e){this._semaphore=new c(1,e)}acquire(){return e=this,t=void 0,r=function*(){const[,e]=yield this._semaphore.acquire();return e},new((i=void 0)||(i=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}));var e,t,i,r}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const u="safari"in window,l=(navigator.userAgent.match(/(crios)|(fxios)/i),!!navigator.platform.match(/iPhone|iPad|iPod/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1),d=(navigator.userAgent.match(/android/i),navigator.userAgent.toLowerCase().indexOf("firefox"),window.AudioContext||window.webkitAudioContext);function h(e,t=100){return new Promise(((i,r)=>{setTimeout((()=>r(new Error("timeout"))),t),e.then(i,r)}))}class _{constructor(e){this.emulationService=e,this.initialize=()=>this.mutex.runExclusive((()=>t(this,void 0,void 0,(function*(){if(!this.initialized){try{this.context=new d}catch(e){return console.error(e),void console.error("web audio not available")}try{this.context.destination.channelCount=1}catch(e){console.warn("audio driver: failed to set channel count")}try{yield this.start()}catch(e){return console.error(e),void console.error("failed to initialize audio context")}this.context.addEventListener("statechange",(()=>{var e;"interrupted"===(null===(e=this.context)||void 0===e?void 0:e.state)&&this.updateState()})),this.gainNode=this.context.createGain(),this.gainNode.channelCount=1,this.gainNode.channelInterpretation="speakers",this.gainNode.gain.value=this.gain(),this.gainNode.connect(this.context.destination),this.applyPwmUpdate(),this.initialized=!0}})))),this.updateState=(e=!1)=>this.mutex.runExclusive((()=>t(this,void 0,void 0,(function*(){if(!this.context)return;if(this.isRunning()===this.shouldRun())return;e||this.isRunning()||!this.shouldRun()||this.applyPwmUpdate();const t=this.context.state;if(this.shouldRun())try{this.updateGain(),yield h(this.context.resume()),console.log("resume audio context")}catch(e){console.error(`failed to resume audio from state ${t}`)}else try{yield h(this.context.suspend()),console.log("suspend audio context")}catch(e){console.error(`failed to suspend audio from state ${t}`)}console.log(`audio context state change ${t} -> ${this.context.state}`)})))),this.onPwmUpdate=e=>t(this,void 0,void 0,(function*(){this.pendingPwmUpdate=e,this.initialized&&(this.shouldRun()!==this.isRunning()&&this.updateState(!0),this.shouldRun()&&this.applyPwmUpdate())})),this.mutex=new p,this.initialized=!1,this.muted=!1,this.emulationService.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.emulationService.emulationStateChangeEvent.addHandler((()=>this.updateState())),this.emulationService.powerOffChangeEvent.addHandler((()=>this.updateState())),l||document.addEventListener("visibilitychange",(()=>this.updateState()))}isInitialized(){return this.initialized}mute(e){this.muted=e,this.updateState()}isMuted(){return this.muted}shouldRun(){return this.emulationService.isRunning()&&!this.emulationService.isPowerOff()&&!this.muted&&this.gain()>0&&("hidden"!==document.visibilityState||l||this.runHidden())}updateGain(){this.gainNode&&(this.gainNode.gain.value=this.gain())}start(){return t(this,void 0,void 0,(function*(){this.context&&(yield h(this.context.resume()),this.updateState(),console.log("audio context initialized"))}))}isRunning(){var e;return"running"===(null===(e=this.context)||void 0===e?void 0:e.state)}applyPwmUpdate(){if(!this.context||!this.pendingPwmUpdate)return;const{frequency:e,dutyCycle:t}=this.pendingPwmUpdate,i=this.context.sampleRate;if(this.pendingPwmUpdate=void 0,e<=0||t<=0||e>=i)return void this.disconnectSource();const r=this.context.createBuffer(1,Math.round(i/e),i),n=r.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=e/n.length<t?1:0;const o=this.context.createBufferSource();o.channelCount=1,o.channelInterpretation="speakers",o.loop=!0,o.buffer=r,this.disconnectSource(),o.connect(this.gainNode),o.start(),this.bufferSourceNode=o,this.pendingPwmUpdate=void 0}disconnectSource(){this.bufferSourceNode&&(this.bufferSourceNode.stop(),this.bufferSourceNode.disconnect(),this.bufferSourceNode=void 0)}gain(){return this.getVolume()/2}}class m extends _{constructor(){super(...arguments),this.volume=.5}setVolume(e){this.volume=Math.max(Math.min(e,1),0),this.updateGain()}getVolume(){return this.volume}runHidden(){return!1}}function y(e,i){let r,n;const o=document.createElement("canvas");return(s,a)=>t(this,void 0,void 0,(function*(){if(r===s&&n===a)return o;o.width=s,o.height=a;const t=o.getContext("2d");if(!t)throw new Error("get a new browser");return t.drawImage(yield e,0,0,o.width,o.height),(u||l)&&(yield i).indexOf("data:image")>=0&&(yield new Promise((e=>setTimeout(e,0))),t.drawImage(yield e,0,0,o.width,o.height)),r=s,n=a,o}))}function f(e){return new Promise(((t,i)=>{const r=new Image;r.onload=()=>t(r),r.onerror=()=>i(),r.src=e}))}const v=e=>`data:image/svg+xml;base64,${btoa(e)}`;var g,b;function S(e){switch(e){case n.i710:case n.m520:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.handera330:case n.handera330c:case n.lp168:return{screenSize:2,width:240,height:320,silkscreenHeight:0};case n.pegS300:case n.pegS320:case n.pegS500c:return{screenSize:0,width:160,height:160,silkscreenHeight:76};case n.pegT600c:case n.pegT400:case n.pegT650c:return{screenSize:1,width:320,height:320,silkscreenHeight:140,silkscreenOvershoot:10};case n.pegN600c:case n.pegN700c:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.pegNR70:return{screenSize:3,width:320,height:480,silkscreenHeight:0};case n.acerS11:return{screenSize:0,width:160,height:160,silkscreenHeight:60,siklscreenShift:8};default:return{screenSize:0,width:160,height:160,silkscreenHeight:60}}}function C(e){switch(e){case n.pilot:case n.palmPilot:case n.iii:case n.palmV:case n.palmVx:case n.iiix:case n.iiixe:case n.iiie:case n.m100:case n.m105:case n.m125:case n.m500:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:case n.i705:case n.handera330:case n.pegS300:case n.pegS320:case n.pegT400:case n.acerS11:return!1;default:return!0}}(b=g||(g={})).sdcard="sdcard",b.memorystick="memorystick",b.none="none";var w=i(819);const I=[135,135,105],D=[0,0,0],G=new Array(16).fill(0).map(((e,t)=>D.map(((e,i)=>Math.floor((t*e+(15-t)*I[i])/15))))).map((([e,t,i])=>4278190080|i<<16|t<<8|e)),E=G.map((e=>{var t;return"#"+(null===(t=(16777215&e).toString(16).padStart(6,"0").match(/(..?)/g))||void 0===t?void 0:t.reverse().join(""))})),x=n.m515,k=E[2],M=E[0],P="rgba(0,0,0,0.2)";function R(e){const t=S(e),i=(0===t.screenSize?3:2)*devicePixelRatio,r={frameDevice:1,frameCanvas:i},n=e=>({frameDevice:e,frameCanvas:e*i}),o=e=>({frameDevice:e,frameCanvas:r.frameCanvas+e*i}),s=t.silkscreenHeight>0?n(1):n(0),a=n(function(e){switch(e){case 3:case 1:return 60;case 2:return 45;default:return 30}}(t.screenSize));return{scale:i,borderWidth:r,height:n(2*r.frameDevice+t.height+s.frameDevice+t.silkscreenHeight+a.frameDevice),width:n(2*r.frameDevice+t.width),screenHeight:n(t.height),screenWidth:n(t.width),screenLeft:o(0),screenTop:o(0),screenBottom:o(t.height),separatorHeight:s,silkscreenHeight:n(t.silkscreenHeight),silkscreenTop:o(t.height+s.frameDevice),silkscreenBottom:o(t.height+s.frameDevice+t.silkscreenHeight),softSilkscreenHeight:n(t.silkscreenHeight>0?0:t.height-t.width),buttonHeight:a,buttonWidth:a,buttonTop:o(t.height+s.frameDevice+t.silkscreenHeight),buttonBottom:o(t.height+s.frameDevice+t.silkscreenHeight+a.frameDevice)}}class z{constructor(e){this.skinLoader=e,this.layout=R(x),this.onResize=new w.j}get width(){switch(this.getOrientation()){case o.portrait:case o.portrait180:case void 0:return this.layout.width.frameCanvas;default:return this.layout.height.frameCanvas}}get height(){switch(this.getOrientation()){case o.portrait:case o.portrait180:case void 0:return this.layout.height.frameCanvas;default:return this.layout.width.frameCanvas}}updateEmulationCanvas(e){this.drawEmulationCanvas(e),this.onAfterUpdateCanvas()}eventToPalmCoordinates(e,t=!1){if(!this.ctx)return;const i=this.ctx.canvas.getBoundingClientRect();let r,n,s,a;i.width/i.height>this.width/this.height?(a=i.height,s=this.width/this.height*i.height,n=i.top,r=i.left+(i.width-s)/2):(s=i.width,a=this.height/this.width*i.width,r=i.left,n=i.top+(i.height-a)/2);let c=(e.clientX-r)/s*this.width/this.layout.scale,p=(e.clientY-n)/a*this.height/this.layout.scale;switch(this.getOrientation()){case o.landscape90:{const e=p;p=this.layout.height.frameDevice-c,c=e;break}case o.landscape270:{const e=p;p=c,c=this.layout.width.frameDevice-e;break}case o.portrait180:c=this.layout.width.frameDevice-c,p=this.layout.height.frameDevice-p}c-=this.layout.borderWidth.frameDevice,p-=this.layout.borderWidth.frameDevice,p>=this.layout.screenHeight.frameDevice&&(p<=this.layout.screenHeight.frameDevice+this.layout.separatorHeight.frameDevice?p=this.layout.screenHeight.frameDevice:p-=this.layout.separatorHeight.frameDevice);const u=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice;if(t)c<0&&(c=0),c>=this.layout.screenWidth.frameDevice&&(c=this.layout.screenWidth.frameDevice-1),p<0&&(p=0),p>=u&&(p=u-1);else if(c<0||c>=this.layout.screenWidth.frameDevice||p<0||p>=u)return;return[c,p]}isSilkscreen(e){const[,t]=e;return!this.isButtons(e)&&t>=this.layout.screenHeight.frameDevice}isButtons([,e]){return e>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice}determineButton([e,t]){return e>=this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice?3:e>=this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice?2:e>=2*this.layout.buttonWidth.frameDevice?t>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice/2?5:4:e>=this.layout.buttonWidth.frameDevice?1:0}initWithCanvas(e){var i;return void 0===e&&(e=null===(i=this.ctx)||void 0===i?void 0:i.canvas),t(this,void 0,void 0,(function*(){if(!e)return;this.layout=R(this.getDeviceId()),this.onResize.dispatch(),e.width=this.width,e.height=this.height;const t=e.getContext("2d");if(!t)throw new Error("canvas not supported - get a new browser");this.ctx=t,this.setupTransformation(),this.fillCanvasRect(0,0,this.layout.width.frameCanvas,this.layout.height.frameCanvas,this.frameColor()),this.fillRect(0,0,this.layout.screenWidth.frameDevice,this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.separatorHeight.frameDevice+this.layout.buttonHeight.frameDevice,this.backgroundColor()),this.drawEmulationCanvas(),yield Promise.all([this.drawSilkscreen(),this.drawButtons()])}))}drawButtons(e=[]){return t(this,void 0,void 0,(function*(){this.ctx&&(this.setupTransformation(),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.buttonsImage()(this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),this.layout.screenLeft.frameCanvas,this.layout.buttonTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),e.includes(0)&&this.fillRect(0,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,P),e.includes(1)&&this.fillRect(this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,P),e.includes(2)&&this.fillRect(this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,P),e.includes(3)&&this.fillRect(this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,P),e.includes(4)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,P),e.includes(5)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice+this.layout.buttonHeight.frameDevice/2,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,P))}))}onAfterUpdateCanvas(){}setupTransformation(){var e;if(this.ctx)switch(null===(e=this.ctx)||void 0===e||e.resetTransform(),this.getOrientation()){case o.portrait:case void 0:break;case o.landscape90:this.ctx.translate(this.layout.height.frameCanvas,0),this.ctx.rotate(Math.PI/2);break;case o.landscape270:this.ctx.translate(0,this.layout.width.frameCanvas),this.ctx.rotate(3*Math.PI/2);break;case o.portrait180:this.ctx.translate(this.layout.width.frameCanvas,this.layout.height.frameCanvas),this.ctx.rotate(Math.PI)}}drawSilkscreen(){return t(this,void 0,void 0,(function*(){0!==this.layout.silkscreenHeight.frameCanvas&&this.ctx&&(this.setupTransformation(),this.fillRect(this.layout.screenLeft.frameDevice,this.layout.silkscreenTop.frameDevice,this.layout.screenWidth.frameDevice,this.layout.silkscreenHeight.frameDevice,k),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.silkscreenImage()(this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas),this.layout.borderWidth.frameCanvas,this.layout.silkscreenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas))}))}drawEmulationCanvas(e=this.lastEmulationCanvas){e&&this.ctx&&(this.lastEmulationCanvas=e,this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(e,this.layout.screenLeft.frameCanvas,this.layout.screenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.screenHeight.frameCanvas))}fillRect(e,t,i,r,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(this.layout.borderWidth.frameCanvas+this.layout.scale*e,this.layout.borderWidth.frameCanvas+this.layout.scale*t,this.layout.scale*i,this.layout.scale*r),this.ctx.fillStyle=n,this.ctx.fill())}fillCanvasRect(e,t,i,r,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(e,t,i,r),this.ctx.fillStyle=n,this.ctx.fill())}silkscreenImage(){return this.skinLoader.loadSkinElement(this.silkscreenSkinElement())}silkscreenSkinElement(){switch(this.getDeviceId()){case n.pegT600c:case n.pegT650c:return"silkscreen/clie-t600.svg";case n.pegN700c:case n.pegN600c:return"silkscreen/clie-n610.svg";case n.pegS320:case n.pegS300:return"silkscreen/clie-s300.svg";case n.pegS500c:return"silkscreen/clie-s500.svg";case n.pegT400:return"silkscreen/clie-t415.svg";case n.acerS11:return"silkscreen/acer-s10.svg";case n.palmPilot:case n.pilot:case n.iii:case n.palmVII:return"silkscreen/pilot.svg";case n.m500:return"silkscreen/m500.svg";case n.m505:case n.m515:case n.m520:return"silkscreen/m515.svg";case n.iiic:return"silkscreen/iiic.svg";case n.m100:case n.m105:case n.m125:return"silkscreen/m100.svg";case n.m130:return"silkscreen/m130.svg";case n.i710:return"silkscreen/tungstenw.svg";case n.i705:return"silkscreen/i705.svg";case n.iiic:case n.iiix:case n.iiixe:case n.palmVx:case n.palmV:case n.palmVIIEZ:case n.palmVIIx:default:return"silkscreen/v.svg"}}buttonsImage(){return this.skinLoader.loadSkinElement(this.buttonsSkinElement())}buttonsSkinElement(){switch(this.getDeviceId()){case n.acerS11:return"hard-buttons/acer-s10.svg";case n.pegNR70:return"hard-buttons/clie-nr70.svg";case n.pegN700c:return"hard-buttons/clie-n700.svg";case n.pegN600c:return"hard-buttons/clie-n610.svg";case n.pegS300:return"hard-buttons/clie-s300.svg";case n.pegS500c:return"hard-buttons/clie-s500.svg";case n.pegS320:return"hard-buttons/clie-s320.svg";case n.pegT400:case n.pegT600c:case n.pegT650c:return"hard-buttons/clie-t415.svg";case n.pilot:case n.palmPilot:return"hard-buttons/pilot.svg";case n.m500:return"hard-buttons/m500.svg";case n.m505:case n.m515:case n.m520:return"hard-buttons/m515.svg";case n.iiic:return"hard-buttons/iiic.svg";case n.m100:case n.m105:return"hard-buttons/m100.svg";case n.m125:return"hard-buttons/m125.svg";case n.m130:return"hard-buttons/m130.svg";case n.i710:return"hard-buttons/tungstenw.svg";case n.iii:case n.iiix:case n.iiixe:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:return"hard-buttons/iiix.svg";case n.iiie:return"hard-buttons/iiie.svg";case n.i705:return"hard-buttons/i705.svg";case n.handera330:return"hard-buttons/handera330.svg";case n.handera330c:return"hard-buttons/handera330c.svg";case n.lp168:return"hard-buttons/lp168.svg";case n.palmVx:case n.palmV:default:return"hard-buttons/v.svg"}}backgroundColor(){return C(this.getDeviceId())?"white":M}frameColor(){return C(this.getDeviceId())?"white":"#ccc"}}const H='<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Game Controller</title><path d="M467.51 248.83c-18.4-83.18-45.69-136.24-89.43-149.17A91.5 91.5 0 00352 96c-26.89 0-48.11 16-96 16s-69.15-16-96-16a99.09 99.09 0 00-27.2 3.66C89 112.59 61.94 165.7 43.33 248.83c-19 84.91-15.56 152 21.58 164.88 26 9 49.25-9.61 71.27-37 25-31.2 55.79-40.8 119.82-40.8s93.62 9.6 118.66 40.8c22 27.41 46.11 45.79 71.42 37.16 41.02-14.01 40.44-79.13 21.43-165.04z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><circle cx="292" cy="224" r="20"/><path d="M336 288a20 20 0 1120-19.95A20 20 0 01336 288z"/><circle cx="336" cy="180" r="20"/><circle cx="380" cy="224" r="20"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 176v96M208 224h-96"/></svg>',A=y(f(v(H)),H);class N extends z{constructor(){super(...arguments),this.deviceId=n.m515,this.orientation=o.portrait,this.gameModeIndicatorEnabled=!0,this.gameModeActive=!1,this.lastActiveButtons=void 0}initialize(e,i=this.deviceId,r=this.orientation){var n;return t(this,void 0,void 0,(function*(){this.deviceId=i,this.orientation=r;const t=e||(null===(n=this.ctx)||void 0===n?void 0:n.canvas);t&&(t.width=this.width,t.height=this.height,t.style.objectFit="contain"),yield this.initWithCanvas(e)}))}updateOrientation(e){this.orientation=e,this.initialize()}toggleGameModeIndicator(e){this.gameModeActive=e,this.drawButtons(this.lastActiveButtons)}setGameModeIndicatorEnabled(e){this.gameModeIndicatorEnabled=e,this.drawButtons(this.lastActiveButtons)}isGameModeIndicatorEnabled(){return this.gameModeIndicatorEnabled}getCanvas(){var e;return null===(e=this.ctx)||void 0===e?void 0:e.canvas}drawButtons(e=[]){const i=Object.create(null,{drawButtons:{get:()=>super.drawButtons}});return t(this,void 0,void 0,(function*(){this.lastActiveButtons=e,yield i.drawButtons.call(this,e),this.gameModeActive&&this.gameModeIndicatorEnabled&&(yield this.drawGameModeIndicator())}))}getDeviceId(){return this.deviceId}getOrientation(){return this.orientation}drawGameModeIndicator(){return t(this,void 0,void 0,(function*(){if(!this.ctx)return;const e=Math.floor(.1*this.layout.screenWidth.frameCanvas),t=Math.floor(.8*e),i=Math.floor(.1*e),r=Math.floor(.11*e);this.fillCanvasRect(this.layout.screenLeft.frameCanvas-i+this.layout.screenWidth.frameCanvas-e,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-e-i,e,e,"rgba(200, 200, 200, 0.7)"),this.ctx.drawImage(yield A(e,e),this.layout.screenLeft.frameCanvas+this.layout.screenWidth.frameCanvas-i-e+r,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-e-i+r,t,t)}))}}var T=i(650);const F=((e,t)=>{let i=null;return()=>{if(null!==i)return i;const e=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),t=URL.createObjectURL(e);return i=(e=>{const t=new Map([[0,()=>{}]]),i=new Map([[0,()=>{}]]),r=new Map,n=new Worker(e);return n.addEventListener("message",(({data:e})=>{if(void 0!==(n=e).method&&"call"===n.method){const{params:{timerId:n,timerType:o}}=e;if("interval"===o){const e=t.get(n);if("number"==typeof e){const t=r.get(e);if(void 0===t||t.timerId!==n||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===o){const e=i.get(n);if("number"==typeof e){const t=r.get(e);if(void 0===t||t.timerId!==n||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),i.delete(n)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:n}=e,o=r.get(n);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:s,timerType:a}=o;r.delete(n),"interval"===a?t.delete(s):i.delete(s)}}var n})),{clearInterval:e=>{const i=(0,T.generateUniqueNumber)(r);r.set(i,{timerId:e,timerType:"interval"}),t.set(e,i),n.postMessage({id:i,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=(0,T.generateUniqueNumber)(r);r.set(t,{timerId:e,timerType:"timeout"}),i.set(e,t),n.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,i)=>{const r=(0,T.generateUniqueNumber)(t);return t.set(r,(()=>{e(),"function"==typeof t.get(r)&&n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:r,timerType:"interval"}})})),n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:r,timerType:"interval"}}),r},setTimeout:(e,t)=>{const r=(0,T.generateUniqueNumber)(i);return i.set(r,e),n.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:r,timerType:"timeout"}}),r}}})(t),setTimeout((()=>URL.revokeObjectURL(t))),i}})();var L;!function(e){e[e.animationFrame=0]="animationFrame",e[e.timeout=1]="timeout"}(L||(L={}));class U{constructor(e){this.callback=e}schedule(){void 0===this.handle&&(this.handle=requestAnimationFrame((e=>{this.handle=void 0,this.callback(e)})))}cancel(){void 0!==this.handle&&(cancelAnimationFrame(this.handle),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return L.animationFrame}}class B{constructor(e,t=60){this.callback=e,this.fps=t}schedule(){if(void 0!==this.handle)return;const e=performance.now(),t=1e3*Math.ceil(e/1e3*this.fps)/this.fps;var i,r;this.handle=(i=()=>{this.handle=void 0,this.callback(performance.now())},r=Math.max(t-e,0),F().setTimeout(i,r))}cancel(){var e;void 0!==this.handle&&(e=this.handle,F().clearTimeout(e),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return L.timeout}}class j{constructor(e,t){this.queue=new Array(e).fill(0),this.reset(t)}reset(e=0){this.next=1,this.size=1,this.queue[0]=e}push(e){return this.queue[this.next]=e,this.next=(this.next+1)%this.queue.length,this.size<this.queue.length&&this.size++,this}calculateAverage(){let e=0;for(let t=0;t<this.size;t++)e+=this.queue[t];return e/this.size}}class O{constructor(e){this.start=0,this.size=0,this.buffer=new Array(e)}push(e){return this.size<this.buffer.length?this.buffer[(this.start+this.size++)%this.buffer.length]=e:(this.start=(this.start+1)%this.buffer.length,this.buffer[(this.start+this.size-1)%this.buffer.length]=e),this}pop(){if(0===this.size)return;const e=this.buffer[this.start];return this.start=(this.start+1)%this.buffer.length,this.size--,e}peekLast(){if(0!==this.size)return this.buffer[(this.start+this.size-1)%this.buffer.length]}replaceLast(e){return this.size>0&&(this.buffer[(this.start+this.size-1)%this.buffer.length]=e),this}count(){return this.size}flush(){return this.start=0,this.size=0,this}}class W{constructor(){this.onPwmUpdate=e=>{this.pendingPwmUpdates.count()>0&&this.pendingPwmUpdates.peekLast().frequency<0?this.pendingPwmUpdates.replaceLast(e):this.pendingPwmUpdates.push(e)},this.advanceEmulation=e=>{if(this.isDirty=!1,!this.cloudpilotInstance||this.hasFatalError()||e<this.clockEmulator)return;const t=this.cloudpilotInstance.isSuspended();let i=!1;this.cloudpilotInstance.setClockFactor(this.emulationSpeed*this.getConfiguredSpeed()),e-this.clockEmulator>1e3/30&&(this.clockEmulator=e-1e3/30);const r=(e-this.clockEmulator)/1e3*this.cloudpilotInstance.cyclesPerSecond(),n=performance.now();let o=0;for(;o<r;)if(o+=this.cloudpilotInstance.runEmulation(Math.ceil(r-o)),this.cloudpilotInstance.isSuspended()){i=!0;break}const s=o/this.cloudpilotInstance.cyclesPerSecond()*1e3,a=performance.now()-n;if(this.clockEmulator+=Math.max(s,a),this.speedAverage.push(s/(a>0?a:s/1e3)*this.emulationSpeed),this.updateEmulationSpeed(this.speedAverage.calculateAverage()),i&&!t)return void this.handleSuspend();const c=this.cloudpilotInstance.isPowerOff(),p=this.cloudpilotInstance.isUiInitialized();if(c!==this.powerOff||p!==this.uiInitialized){const e=this.powerOff;this.powerOff=c,this.uiInitialized=p,e!==this.powerOff&&this.powerOffChangeEvent.dispatch(this.powerOff),this.isDirty=!0}p&&!c&&this.manageHotsyncName()&&this.checkAndUpdateHotsyncName(),this.onAfterAdvanceEmulation(e,o)},this.newFrameEvent=new w.j,this.pwmUpdateEvent=new w.j,this.emulationStateChangeEvent=new w.j,this.powerOffChangeEvent=new w.j,this.deviceId=n.m515,this.clockEmulator=0,this.scheduler=new U((e=>this.onSchedule(e))),this.canvas=document.createElement("canvas"),this.canvasTmp=document.createElement("canvas"),this.lastPenUpdate=0,this.penDown=!1,this.running=!1,this.powerOff=!1,this.uiInitialized=!1,this.pendingPwmUpdates=new O(10),this.lastPwmUpdateEvent=0,this.emulationSpeed=1,this.speedAverage=new j(20),this.timePerFrameAverage=new j(60),this.timestampLastFrame=0,this.frameCounter=0,this.isDirty=!1}handlePointerMove(e,t,i){if(!this.handleInput())return;const r=performance.now();if(this.penDown=!0,!(r-this.lastPenUpdate<25)&&this.cloudpilotInstance){if(i){const i=S(this.deviceId);e=this.transformSilkscreenX(e,i),t=this.transformSilkscreenY(t,i)}this.cloudpilotInstance.queuePenMove(Math.floor(e),Math.floor(t)),this.lastPenUpdate=r}}handlePointerUp(){this.handleInput()&&(this.cloudpilotInstance&&this.penDown&&this.cloudpilotInstance.queuePenUp(),this.lastPenUpdate=0,this.penDown=!1)}handleButtonDown(e){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonDown(e)}handleButtonUp(e){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonUp(e)}handleKeyDown(e,t=!1){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueKeyboardEvent(e,t)}reset(){this.cloudpilotInstance&&this.cloudpilotInstance.reset()}resetNoExtensions(){this.cloudpilotInstance&&this.cloudpilotInstance.resetNoExtensions()}resetHard(){this.cloudpilotInstance&&this.cloudpilotInstance.resetHard()}isRunning(){return this.running}isPowerOff(){return this.powerOff}isUiInitialized(){return this.uiInitialized}getCanvas(){return this.canvas}getStatistics(){return{hostSpeed:this.speedAverage.calculateAverage(),emulationSpeed:this.emulationSpeed,averageFps:this.calculateFPS()}}getEmulationSpeed(){return this.emulationSpeed}isSuspended(){return!!this.cloudpilotInstance&&this.cloudpilotInstance.isSuspended()}onAfterAdvanceEmulation(e,t){}handleSuspend(){}callScheduler(){this.scheduler.schedule()}handleInput(){return!0}openSession(e,t,i,r,n){let o=!1;return!!e.initializeSession(t,i)&&(r&&(r.length%4!=0?console.warn("memory size is not a multiple of 4; ignoring image"):(o=e.loadMemory(new Uint32Array(r.buffer,r.byteOffset,r.length>>>2)),o||console.warn("failed to load memory"))),o&&n&&e.loadState(n),e.remountCards(),this.cloudpilotInstance&&this.cloudpilotInstance.pwmUpdateEvent.removeHandler(this.onPwmUpdate),e.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.cloudpilotInstance=e,this.deviceId=i,this.resetCanvas(),this.pendingPwmUpdates.flush(),this.lastPwmUpdateEvent=0,this.deviceHotsyncName=void 0,this.emulationSpeed=1,this.frameCounter=0,this.speedAverage.reset(1),this.powerOff=e.isPowerOff(),this.uiInitialized=e.isUiInitialized(),this.frameCounter=0,!0)}resetCanvas(){const e=S(this.deviceId);this.canvas.width=this.canvasTmp.width=e.width,this.canvas.height=this.canvasTmp.height=e.height;const t=this.canvas.getContext("2d");if(!t)throw new Error("get a new browser");this.context=t;const i=this.canvasTmp.getContext("2d");if(!i)throw new Error("get a new browser");this.contextTmp=i,this.clearCanvas(),this.imageData=void 0}doResume(){this.cloudpilotInstance&&(this.clockEmulator=performance.now(),this.schedule(),this.setRunning(!0),this.resetFPS())}doPause(){this.stopLoop()}doStop(){this.stopLoop()}stopLoop(){this.running&&(this.scheduler.cancel(),void 0!==this.advanceEmulationHandle&&(window.clearTimeout(this.advanceEmulationHandle),this.advanceEmulationHandle=void 0),this.setRunning(!1))}resetFPS(){this.timePerFrameAverage.reset(),this.timestampLastFrame=performance.now()}calculateFPS(){const e=this.timePerFrameAverage.calculateAverage();return e&&1e3/e}transformSilkscreenX(e,t){if(void 0===t.silkscreenOvershoot)return e;const i=t.width/(t.width+2*t.silkscreenOvershoot);return(e-t.width/2)/i+t.width/2}transformSilkscreenY(e,t){return void 0===t.siklscreenShift?e:e+t.siklscreenShift}setRunning(e){e!==this.running&&(this.running=e,this.emulationStateChangeEvent.dispatch(e))}updateEmulationSpeed(e){if(e>=1&&this.emulationSpeed>=1)return;const t=Math.min(Math.max(Math.floor(10*e)/10,.1),1);t<=this.emulationSpeed?this.emulationSpeed=t:this.emulationSpeed=e-t>=.05?t:this.emulationSpeed}performScreenUpdate(){var e;(null===(e=this.cloudpilotInstance)||void 0===e?void 0:e.isScreenDirty())&&(this.updateScreen(),this.cloudpilotInstance.markScreenClean(),this.frameCounter++)}onSchedule(e){this.hasFatalError()||(this.skipEmulationUpdate()||(this.performScreenUpdate(),this.pendingPwmUpdates.count()>0&&e-this.lastPwmUpdateEvent>10&&(this.pwmUpdateEvent.dispatch(this.pendingPwmUpdates.pop()),this.lastPwmUpdateEvent=e),void 0===this.advanceEmulationHandle&&(this.advanceEmulationHandle=window.setTimeout((()=>{this.advanceEmulationHandle=void 0,this.advanceEmulation(e)}),0)),this.timePerFrameAverage.push(Math.max(0,e-this.timestampLastFrame)),this.timestampLastFrame=e),this.schedule())}schedule(){this.scheduler.cancel(),this.getConfiguredSchdedulerKind()!==this.scheduler.getKind()&&(this.scheduler=this.getConfiguredSchdedulerKind()===L.animationFrame?new U((e=>this.onSchedule(e))):new B((e=>this.onSchedule(e)))),this.callScheduler()}checkAndUpdateHotsyncName(){if(!this.cloudpilotInstance)return;void 0===this.deviceHotsyncName&&(this.deviceHotsyncName=this.cloudpilotInstance.getHotsyncName());const e=this.getConfiguredHotsyncName();void 0===e?this.updateConfiguredHotsyncName(this.deviceHotsyncName):e!==this.deviceHotsyncName&&e.length<=40&&this.cloudpilotInstance.isSetupComplete()&&(this.cloudpilotInstance.setHotsyncName(e),this.deviceHotsyncName=e)}clearCanvas(){const e=this.deviceId,t=S(e);this.context.beginPath(),this.context.rect(0,0,t.width,t.height),this.context.fillStyle=C(e)?"white":E[0],this.context.fill()}updateScreen(){if(!this.cloudpilotInstance)return;const e=this.cloudpilotInstance.getFrame();if(this.cloudpilotInstance.isPowerOff())return this.clearCanvas(),void this.newFrameEvent.dispatch(this.canvas);if(!e.hasChanges)return;if(e.lines*e.scaleY===this.canvas.height&&e.lineWidth*e.scaleX===this.canvas.width){this.imageData&&this.imageData.width===e.lineWidth&&this.imageData.height===e.lines||(this.imageData=new ImageData(e.lineWidth,e.lines));const t=new Uint32Array(this.imageData.data.buffer);switch(e.bpp){case 1:{const i=G[15],r=G[0];let n=0;for(let o=e.firstDirtyLine;o<=e.lastDirtyLine;o++){const s=o*e.bytesPerLine;for(let o=e.margin;o<e.lineWidth+e.margin;o++)t[n++]=e.buffer[s+(o>>>3)]&128>>>(7&o)?i:r}break}case 2:{const i=this.cloudpilotInstance.getPalette2bitMapping(),r=[G[15&i],G[i>>>4&15],G[i>>>8&15],G[i>>>12&15]];let n=0;for(let i=e.firstDirtyLine;i<=e.lastDirtyLine;i++){const o=i*e.bytesPerLine;for(let i=e.margin;i<e.lineWidth+e.margin;i++)t[n++]=r[e.buffer[o+(i>>>2)]>>6-2*(3&i)&3]}break}case 4:{let i=0;for(let r=e.firstDirtyLine;r<=e.lastDirtyLine;r++){const n=r*e.bytesPerLine;for(let r=e.margin;r<e.lineWidth+e.margin;r++)t[i++]=G[e.buffer[n+(r>>>1)]>>>4-4*(1&r)&15]}break}case 24:{const i=new Uint32Array(e.buffer.buffer,e.buffer.byteOffset,e.buffer.byteLength>>>2);if(0===e.margin)t.subarray(0,e.lineWidth*(e.lastDirtyLine-e.firstDirtyLine+1)).set(i.subarray(e.firstDirtyLine*e.lineWidth,e.lineWidth*(e.lastDirtyLine+1)));else{let r=0;for(let n=e.firstDirtyLine;n<=e.lastDirtyLine;n++){let o=n*(e.bytesPerLine>>>2)+e.margin;for(let n=0;n<e.lineWidth;n++)t[r++]=i[o++]}}}}}if(!this.imageData)return;const t=1!==e.scaleX||1!==e.scaleY;(t?this.contextTmp:this.context).putImageData(this.imageData,0,e.firstDirtyLine,0,0,e.lineWidth,e.lastDirtyLine-e.firstDirtyLine+1),t&&(this.context.imageSmoothingEnabled=!1,this.context.drawImage(this.canvasTmp,0,e.firstDirtyLine,e.lineWidth,e.lastDirtyLine-e.firstDirtyLine+1,0,e.firstDirtyLine*e.scaleY,e.lineWidth*e.scaleX,(e.lastDirtyLine-e.firstDirtyLine+1)*e.scaleY)),this.newFrameEvent.dispatch(this.canvas)}}class V extends W{constructor(){super(...arguments),this.timesliceEvent=new w.j}pause(){this.doPause()}resume(){this.doResume()}initWithRom(e,t,i,r){return this.isRunning()&&(this.doStop(),this.session=void 0),e.clearExternalStorage(),!!this.openSession(e,t,i)&&(this.session=r,!0)}initWithSessionImage(e,t,i){return this.isRunning()&&(this.doStop(),this.session=void 0),e.clearExternalStorage(),!!this.openSession(e,t.rom,t.deviceId,t.memory,t.savestate)&&(this.session=i,!0)}getSession(){return this.session}forceUpdateHotsyncName(){this.cloudpilotInstance&&this.cloudpilotInstance.isUiInitialized()&&!this.cloudpilotInstance.isPowerOff()&&this.checkAndUpdateHotsyncName()}getConfiguredSpeed(){var e,t;return null!==(t=null===(e=this.session)||void 0===e?void 0:e.speed)&&void 0!==t?t:1}manageHotsyncName(){return!0}getConfiguredHotsyncName(){var e;return null===(e=this.session)||void 0===e?void 0:e.hotsyncName}updateConfiguredHotsyncName(e){this.session&&(this.session.hotsyncName=e)}getConfiguredSchdedulerKind(){var e;return(null===(e=this.session)||void 0===e?void 0:e.runInBackground)?L.timeout:L.animationFrame}hasFatalError(){var e;return!!(null===(e=this.cloudpilotInstance)||void 0===e?void 0:e.hasFatalError())}skipEmulationUpdate(){return!1}onAfterAdvanceEmulation(e,t){this.timesliceEvent.dispatch()}handleInput(){return this.isRunning()}}class q{constructor(e,t){this.emulationService=e,this.canvasDisplayService=t,this.handleMouseDown=e=>{if(0!==e.button)return;const t=this.canvasDisplayService.eventToPalmCoordinates(e);if(!t)return;const i=this.determineArea(t);if(2===i){const e=this.canvasDisplayService.determineButton(t);this.interactionMouse={area:i,buttonPrimary:e},this.handleButtonDown(e)}else this.interactionMouse={area:i},this.emulationService.handlePointerMove(...t,1===i)},this.handleMouseMove=e=>{var t,i;if(!(1&e.buttons&&this.interactionMouse&&2!==(null===(t=this.interactionMouse)||void 0===t?void 0:t.area)))return;const r=this.canvasDisplayService.eventToPalmCoordinates(e,!0);r&&this.emulationService.handlePointerMove(...r,1===(null===(i=this.interactionMouse)||void 0===i?void 0:i.area))},this.handeMouseUp=e=>{if(0!==e.button)return;const t=this.interactionMouse;switch(this.interactionMouse=void 0,null==t?void 0:t.area){case 2:this.handleButtonUp(t.buttonPrimary);break;case 0:case 1:this.emulationService.handlePointerUp()}},this.handleTouchStart=e=>{let t=!1;for(let i=0;i<e.changedTouches.length;i++){const r=e.changedTouches.item(i);if(!r)continue;const n=this.canvasDisplayService.eventToPalmCoordinates(r);if(!n)continue;t=!0;const o=this.determineArea(n);if(2===o){const e=this.canvasDisplayService.determineButton(n);this.interactionsTouch.set(r.identifier,{area:o,buttonPrimary:e}),this.handleButtonDown(e)}else this.interactionsTouch.set(r.identifier,{area:o}),this.emulationService.handlePointerMove(...n,1===o)}t&&!1!==e.cancelable&&e.preventDefault()},this.handleTouchMove=e=>{let t=!1;for(let i=0;i<e.changedTouches.length;i++){const r=e.changedTouches.item(i);if(!r)continue;const n=this.interactionsTouch.get(r.identifier);if(!n)continue;t=!0;const o=n.area;switch(o){case 2:{const e=this.canvasDisplayService.eventToPalmCoordinates(r);if(!e||2!==this.determineArea(e)){this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0;break}const t=this.canvasDisplayService.determineButton(e);t===n.buttonPrimary?(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0):t!==n.buttonSecondary&&(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=t,this.handleButtonDown(t));break}case 0:case 1:{const e=this.canvasDisplayService.eventToPalmCoordinates(r,!0);if(!e)continue;this.emulationService.handlePointerMove(...e,1===o);break}default:continue}}t&&!1!==e.cancelable&&e.preventDefault()},this.handleTouchEnd=e=>{let t=!1;for(let i=0;i<e.changedTouches.length;i++){const r=e.changedTouches.item(i);if(!r)continue;const n=this.interactionsTouch.get(r.identifier);switch(n&&(t=!0),this.interactionsTouch.delete(r.identifier),null==n?void 0:n.area){case 2:this.handleButtonUp(n.buttonPrimary),this.handleButtonUp(n.buttonSecondary);break;case 0:case 1:this.emulationService.handlePointerUp()}}t&&!1!==e.cancelable&&e.preventDefault()},this.handleKeyDown=e=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;if(this.isToggleGameMode(e))return e.preventDefault(),this.gameMode=!this.gameMode,void this.onToggleGameMode();const t=this.buttonFromEvent(e);if(void 0!==t)return this.handleButtonDown(t),void e.preventDefault();const i=this.keyCodeFromEvent(e);void 0!==i&&(this.emulationService.handleKeyDown(i),e.preventDefault())},this.handleKeyUp=e=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;const t=this.buttonFromEvent(e);if(void 0!==t)return this.handleButtonUp(t),void e.preventDefault();if("Control"===e.key){for(const e of this.activeButtons)this.emulationService.handleButtonUp(e);this.activeButtons.clear(),this.canvasDisplayService.drawButtons([])}},this.keyEventTarget=window,this.interactionsTouch=new Map,this.activeButtons=new Set,this.gameMode=!1,this.enableGamemodeHotkey=!0}bind(e,t=window){this.pointerEventTarget&&this.release(),this.pointerEventTarget=e,this.keyEventTarget=t||window,this.addEventListener(e,"mousedown",this.handleMouseDown),this.addEventListener(window,"mouseup",this.handeMouseUp),this.addEventListener(window,"mousemove",this.handleMouseMove),this.addEventListener(e,"touchstart",this.handleTouchStart),this.addEventListener(e,"touchmove",this.handleTouchMove),this.addEventListener(e,"touchend",this.handleTouchEnd),this.addEventListener(e,"touchcancel",this.handleTouchEnd),this.addEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.addEventListener(this.keyEventTarget,"keyup",this.handleKeyUp)}release(){if(this.pointerEventTarget){this.removeEventListener(this.pointerEventTarget,"mousedown",this.handleMouseDown),this.removeEventListener(window,"mouseup",this.handeMouseUp),this.removeEventListener(window,"mousemove",this.handleMouseMove),this.removeEventListener(this.pointerEventTarget,"touchstart",this.handleTouchStart),this.removeEventListener(this.pointerEventTarget,"touchmove",this.handleTouchMove),this.removeEventListener(this.pointerEventTarget,"touchend",this.handleTouchEnd),this.removeEventListener(this.pointerEventTarget,"touchcancel",this.handleTouchEnd),this.removeEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.removeEventListener(this.keyEventTarget,"keyup",this.handleKeyUp);for(const e of this.activeButtons)this.handleButtonUp(e);this.activeButtons.clear(),this.interactionsTouch.clear(),this.interactionMouse=void 0,this.pointerEventTarget=void 0}}isGameMode(){return this.gameMode}setGameMode(e){this.gameMode=e,this.onToggleGameMode()}setGameModeHotkeyEnabled(e){this.enableGamemodeHotkey=e}isGameModeHotkeyEnabled(){return this.enableGamemodeHotkey}enableKeyboardEvents(){return!0}onToggleGameMode(){}addEventListener(e,t,i,r){e.addEventListener(t,i,r)}removeEventListener(e,t,i,r){e.removeEventListener(t,i,r)}determineArea(e){return this.canvasDisplayService.isButtons(e)?2:this.canvasDisplayService.isSilkscreen(e)?1:0}handleButtonDown(e){this.activeButtons.has(e)||(this.activeButtons.add(e),this.emulationService.handleButtonDown(e),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}handleButtonUp(e){void 0!==e&&this.activeButtons.has(e)&&(this.activeButtons.delete(e),this.emulationService.handleButtonUp(e),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}isToggleGameMode(e){return this.isGameModeHotkeyEnabled()&&("Shift"===e.key&&e.ctrlKey||"Control"===e.key&&e.shiftKey)}isGameModeActive(e){return!this.gameMode&&e.ctrlKey||this.gameMode&&!e.ctrlKey}buttonFromEvent(e){switch(e.key){case"PageUp":return 4;case"PageDown":return 5}if(this.isGameModeActive(e))switch(e.key){case"w":case"i":case"ArrowUp":return 4;case"s":case"k":case"ArrowDown":return 5;case"a":case"j":case"y":case"z":case"ArrowLeft":return 0;case"q":case"u":case"x":return 1;case"e":case"o":case"c":return 2;case"d":case"l":case"v":case"ArrowRight":return 3}}keyCodeFromEvent(e){if(!this.isGameModeActive(e)){if(1===e.key.length&&e.key.charCodeAt(0)<=255)return e.key.charCodeAt(0);switch(e.key){case"ArrowLeft":return 28;case"ArrowRight":return 29;case"ArrowUp":return 30;case"ArrowDown":return 31;case"Backspace":return 8;case"Tab":return 9;case"Enter":return 10;default:return}}}}class Y extends q{constructor(e,t){super(e,t),this.gameModeChangeEvent=new w.j,this.canvasDisplayService=t}onToggleGameMode(){this.canvasDisplayService.toggleGameModeIndicator(this.isGameMode()),this.gameModeChangeEvent.dispatch(this.isGameMode())}}class K{constructor(e){this.cloudpilot=e,this.images=new Map}loadSkinElement(e){if(this.images.has(e))return this.images.get(e);const t=this.cloudpilot.then((t=>t.loadSkin(e))).then((t=>t?Promise.all([t,f(v(t))]):Promise.reject(new Error(`failed to load skin ${e}`)))),i=y(t.then((([,e])=>e)),t.then((([e])=>e)));return this.images.set(e,i),i}}class Z{constructor(e){this.query=e,this.changeEvent=new w.j,this.last=e()}update(){const e=this.query();e!==this.last&&(this.changeEvent.dispatch(e),this.last=e)}}const Q={hotsyncName:void 0,orientation:o.portrait,runInBackground:!1,speed:1,deviceId:n.m515},$="MEMORY_CARD";class X{constructor(e){this.cloudpilot=e,this.onTimeslice=()=>{this.powerOffWatcher.update(),this.uiInitializedWatcher.update(),this.hotsyncNameWatcher.update()},this.audioInitializedEvent=new w.j,this.session=Object.assign({},Q),this.emulationService=new V,this.canvasDisplayService=new N(new K(Promise.resolve(e))),this.eventHandlingService=new Y(this.emulationService,this.canvasDisplayService),this.audioService=new m(this.emulationService),this.emulationService.newFrameEvent.addHandler((e=>this.canvasDisplayService.updateEmulationCanvas(e))),this.timesliceEvent.addHandler(this.onTimeslice),this.powerOffWatcher=new Z((()=>this.isPowerOff())),this.uiInitializedWatcher=new Z((()=>this.isUiInitialized())),this.hotsyncNameWatcher=new Z((()=>this.getHotsyncName()||""))}getStatistics(){return this.emulationService.getStatistics()}loadRom(e,t){if(void 0===t){const i=this.cloudpilot.getRomInfo(e);if(!i||0===i.supportedDevices.length)throw new Error("unsupported device");t=i.supportedDevices[0]}if(this.session=Object.assign(Object.assign({},Q),{deviceId:t}),this.emulationService.initWithRom(this.cloudpilot,e,t,this.session))return this.canvasDisplayService.initialize(void 0,t,this.session.orientation),this;throw new Error("failed to initialize session")}loadSession(e){var t,i,r,n,s;const a=this.cloudpilot.deserializeSessionImage(e);if(!a)throw new Error("bad session image");if(this.session={hotsyncName:null===(t=a.metadata)||void 0===t?void 0:t.hotsyncName,speed:null!==(r=null===(i=a.metadata)||void 0===i?void 0:i.speed)&&void 0!==r?r:1,orientation:null!==(s=null===(n=a.metadata)||void 0===n?void 0:n.deviceOrientation)&&void 0!==s?s:o.portrait,runInBackground:!1,deviceId:a.deviceId},this.emulationService.initWithSessionImage(this.cloudpilot,a,this.session))return this.canvasDisplayService.initialize(void 0,a.deviceId,this.session.orientation),this;throw new Error("failed to initialize session")}insertCompressedCardImage(e){if(!this.cloudpilot.decompressCard($,e))throw new Error("failed to decompress and mount card image");if(!this.cloudpilot.mountCard($))throw new Error("failed to mount card image");return this}insertCardImage(e){if(e.length%512!=0)throw new Error("card image size must be a multiple of 512");if(!this.cloudpilot.allocateCard($,e.length))throw new Error("failed to allocate card image");const t=this.cloudpilot.getCardData($);if(!t)throw new Error("failed to allocate card image");if(t.set(new Uint32Array(e.buffer,e.byteOffset,e.byteLength>>>2)),!this.cloudpilot.mountCard($))throw new Error("failed to mount card image");return this}ejectCard(){if(!this.isCardMounted())return this;if(!this.cloudpilot.removeCard($))throw new Error("failed to eject card");return this}isCardMounted(){return this.cloudpilot.getMountedKey()===$}setCanvas(e){return this.canvasDisplayService.initialize(e,this.session.deviceId,this.session.orientation),this}bindInput(e){const t=this.canvasDisplayService.getCanvas();if(!t)throw new Error("you must set up the canvas setCanvas before calling bindInput");return this.eventHandlingService.bind(t,e),this}releaseInput(){return this.eventHandlingService.release(),this}installDatabase(e){if(this.cloudpilot.installDb(e)<0)throw new Error("failed to install database");return this}installAndLaunchDatabase(e){return this.installDatabase(e).launchDatabase(e)}installFromZipfile(e){return this.installFromZipfileAndLaunch(e)}installFromZipfileAndLaunch(e,t){let i;if(this.cloudpilot.withZipfileWalkerSync(e,(e=>{for(;0===e.GetState();){const r=e.GetCurrentEntryContent(),n=e.GetCurrentEntryName();if(!r)throw new Error(`unable to read ${n} from zupfile`);this.installDatabase(r),n.toLowerCase()===(null==t?void 0:t.toLowerCase())&&(i=r.subarray(0,32).slice()),e.Next()}if(-1===e.GetState())throw new Error("error reading zipfile")})),void 0!==t&&!i)throw new Error(`database ${t} not found `);return i&&this.launchDatabase(i),this}launchByName(e){if(!this.cloudpilot.launchAppByName(e))throw new Error(`failed to launch ${e}`);return this}launchDatabase(e){if(!this.cloudpilot.launchAppByDbHeader(e))throw new Error("failed to launch database");return this}reset(){return this.emulationService.reset(),this}resetNoExtensions(){return this.emulationService.resetNoExtensions(),this}resetHard(){return this.emulationService.resetHard(),this}isRunning(){return this.emulationService.isRunning()}isPowerOff(){return this.emulationService.isPowerOff()}isUiInitialized(){return this.emulationService.isUiInitialized()}resume(){return this.emulationService.resume(),this}pause(){return this.emulationService.pause(),this}buttonDown(e){return this.emulationService.handleButtonDown(e),this}buttonUp(e){return this.emulationService.handleButtonUp(e),this}setSpeed(e){return this.session.speed=e,this}getSpeed(){return this.session.speed}setVolume(e){return this.audioService.setVolume(e),this}getVolume(){return this.audioService.getVolume()}initializeAudio(){return t(this,void 0,void 0,(function*(){return yield this.audioService.initialize(),this.audioService.isInitialized()}))}isAudioInitialized(){return this.audioService.isInitialized()}setOrientation(e){return this.session.orientation=e,this.canvasDisplayService.updateOrientation(this.session.orientation),this}getOrientation(){return this.session.orientation}setHotsyncName(e){return this.session.hotsyncName=e,this.emulationService.forceUpdateHotsyncName(),this}getHotsyncName(){return this.session.hotsyncName}setRunHidden(e){return this.session.runInBackground=e,this}getRunHidden(){return this.session.runInBackground}isGameMode(){return this.eventHandlingService.isGameMode()}setGameMode(e){return this.eventHandlingService.setGameMode(e),this}isGameModeHotkeyEnabled(){return this.eventHandlingService.isGameModeHotkeyEnabled()}setGameModeHotkeyEnabled(e){return this.eventHandlingService.setGameModeHotkeyEnabled(e),this}isGameModeIndicatorEnabled(){return this.canvasDisplayService.isGameModeIndicatorEnabled()}setGameModeIndicatorEnabled(e){return this.canvasDisplayService.setGameModeIndicatorEnabled(e),this}get powerOffChangeEvent(){return this.powerOffWatcher.changeEvent}get isUiInitializedChangeEvent(){return this.uiInitializedWatcher.changeEvent}get hotsyncNameChangeEvent(){return this.hotsyncNameWatcher.changeEvent}get gameModeChangeEvent(){return this.eventHandlingService.gameModeChangeEvent}get timesliceEvent(){return this.emulationService.timesliceEvent}}var J=i(492),ee=i.n(J);const te=[n.palmPilot,n.pilot,n.iii,n.palmVx,n.palmV,n.palmVII,n.palmVIIEZ,n.palmVIIx,n.iiixe,n.iiix,n.iiie,n.m500,n.m505,n.m515,n.m520,n.iiic,n.m100,n.m105,n.m125,n.m130,n.i705,n.i710,n.handera330,n.handera330c,n.pegS300,n.pegS320,n.pegS500c,n.pegT400,n.pegN600c,n.pegT600c,n.pegN700c,n.pegT650c,n.pegNR70,n.acerS11,n.lp168];function ie(){return(e,t,i)=>{const r=i.value;return i.value=function(e,t){return this.guard((()=>r.call(this,e,t)))},i}}class re{constructor(e){this.module=e,this.fatalErrorEvent=new w.j,this.pwmUpdateEvent=new w.j,this.proxyDisconnectEvent=new w.j,this.amIdead=!1,this.cloudpilot=new e.Cloudpilot,this.cloudpilot.RegisterPwmHandler(e.addFunction(((e,t)=>this.pwmUpdateEvent.dispatch({frequency:e,dutyCycle:t})),"vdd")),this.cloudpilot.RegisterProxyDisconnectHandler(e.addFunction((t=>this.proxyDisconnectEvent.dispatch(e.UTF8ToString(t))),"vi"))}static create(e){return t(this,void 0,void 0,(function*(){return new re(yield ee()(Object.assign(Object.assign({print:e=>console.log(e),printErr:e=>console.error(e)},"string"==typeof e?{locateFile:()=>e}:{}),"function"==typeof e?{instantiateWasm:e}:{})))}))}destroy(){this.module.destroy(this.cloudpilot)}hasFatalError(){return this.amIdead}getRomInfo(e){const t=this.copyIn(e),i=new this.module.RomInfo(t,e.length);let r;return i.IsValid()&&(r={cardVersion:i.CardVersion(),cardName:i.CardName(),romVersion:i.RomVersion(),romVersionString:i.RomVersionString(),supportedDevices:te.filter(i.Supports.bind(i))}),this.cloudpilot.Free(t),this.module.destroy(i),r}initializeSession(e,t){const i=this.copyIn(e),r=this.cloudpilot.InitializeSession(i,e.length,t);return this.cloudpilot.Free(i),r}cyclesPerSecond(){return this.cloudpilot.GetCyclesPerSecond()}runEmulation(e){return this.cloudpilot.RunEmulation(e)}getFrame(){const e=this.cloudpilot.CopyFrame(),t=this.module.getPointer(e.GetBuffer());return{bpp:e.GetBpp(),bytesPerLine:e.GetBytesPerLine(),lines:e.GetLines(),lineWidth:e.GetLineWidth(),margin:e.GetMargin(),firstDirtyLine:e.GetFirstDirtyLine(),lastDirtyLine:e.GetLastDirtyLine(),hasChanges:e.GetHasChanges(),scaleX:e.GetScaleX(),scaleY:e.GetScaleY(),buffer:this.module.HEAPU8.subarray(t,t+e.GetBufferSize())}}isScreenDirty(){return this.cloudpilot.IsScreenDirty()}markScreenClean(){this.cloudpilot.MarkScreenClean()}minRamForDevice(e){return 1024*this.cloudpilot.MinMemoryForDevice(e)}framebufferSizeForDevice(e){return 1024*this.cloudpilot.FramebufferSizeForDevice(e)}totalMemorySizeForDevice(e){return 1024*this.cloudpilot.TotalMemoryForDevice(e)}queuePenMove(e,t){this.cloudpilot.QueuePenMove(e,t)}queuePenUp(){this.cloudpilot.QueuePenUp()}queueButtonDown(e){this.cloudpilot.QueueButtonDown(e)}queueButtonUp(e){this.cloudpilot.QueueButtonUp(e)}queueKeyboardEvent(e,t){this.cloudpilot.QueueKeyboardEvent(e,t)}isPowerOff(){return!!this.cloudpilot.IsPowerOff()}isUiInitialized(){return!!this.cloudpilot.IsUIInitialized()}isSetupComplete(){return!!this.cloudpilot.IsSetupComplete()}getOSVersion(){return this.cloudpilot.GetOSVersion()}reset(){this.cloudpilot.Reset()}resetNoExtensions(){this.cloudpilot.ResetNoExtensions()}resetHard(){this.cloudpilot.ResetHard()}installDb(e){const t=this.copyIn(e),i=this.cloudpilot.InstallDb(t,e.length);return this.cloudpilot.Free(t),i}getPalette2bitMapping(){return this.cloudpilot.GetPalette2bitMapping()}getMemory(){const e=this.module.getPointer(this.cloudpilot.GetMemoryPtr());return this.module.HEAPU8.subarray(e,e+this.cloudpilot.GetMemorySize())}getMemory32(){let e=this.module.getPointer(this.cloudpilot.GetMemoryPtr());if(3&e)throw new Error("unaligned pointer");return e>>>=2,this.module.HEAPU32.subarray(e,e+(this.cloudpilot.GetMemorySize()>>>2))}getDirtyPages(){const e=this.module.getPointer(this.cloudpilot.GetDirtyPagesPtr()),t=this.cloudpilot.GetMemorySize(),i=(t>>>13)+(t%8192==0?0:1);return this.module.HEAPU8.subarray(e,e+i)}loadMemory(e){const t=this.getMemory32();if((()=>{if(e.length!==t.length||e.length<256)return!1;for(let i=256;i>0;i--){if(e[e.length-i]!==t[t.length-i])return!1;if(4294967295===t[t.length-i])break}return!0})())return t.set(e),!0;{const t=this.copyIn32(e),i=this.cloudpilot.ImportMemoryImage(t,e.length<<2);return this.cloudpilot.Free(t),i}}getRomImage(){const e=this.module.getPointer(this.cloudpilot.GetRomPtr());return this.module.HEAPU8.subarray(e,e+this.cloudpilot.GetRomSize())}getSavestate(){const e=this.module.getPointer(this.cloudpilot.GetSavestatePtr());return this.module.HEAPU8.subarray(e,e+this.cloudpilot.GetSavestateSize())}saveState(){return!!this.cloudpilot.SaveState()}loadState(e){const t=this.copyIn(e),i=this.cloudpilot.LoadState(t,e.length);return this.cloudpilot.Free(t),i}getHotsyncName(){return this.cloudpilot.GetHotsyncName()}setClockFactor(e){this.cloudpilot.SetClockFactor(e)}setHotsyncName(e){this.cloudpilot.SetHotsyncName(e)}backup(e){return t(this,void 0,void 0,(function*(){const t=this.guard((()=>this.cloudpilot.StartBackup()));try{return yield e(this.wrap(t))}finally{this.module.destroy(t)}}))}getArchive(e){const t=e.GetArchiveSize();return this.copyOut(e.GetArchivePtr(),t)}setClipboardIntegration(e){this.cloudpilot.SetClipboardIntegration(e)}getClipboardIntegration(){return this.cloudpilot.GetClipboardIntegration()}isSuspended(){return this.cloudpilot.IsSuspended()}getSuspendKind(){return this.cloudpilot.GetSuspendContext().GetKind()}cancelSuspend(){this.cloudpilot.GetSuspendContext().Cancel()}getSuspendContextClipboardCopy(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardCopy())}getSuspendContextClipboardPaste(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardPaste())}setNetworkRedirection(e){this.cloudpilot.SetNetworkRedirection(e)}getNetworkRedirection(){return this.cloudpilot.GetNetworkRedirection()}getSuspendContextNetworkConnect(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkConnect())}getSuspendContextNetworkRpc(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkRpc())}copyBuffer(e){return this.copyIn(e)}freeBuffer(e){this.cloudpilot.Free(e)}setHotsyncNameManagement(e){this.cloudpilot.SetHotsyncNameManagement(e)}resolveBuffer(e,t){const i=this.module.getPointer(e);return this.module.HEAPU8.subarray(i,i+t)}withZipfileWalker(e,i){return t(this,void 0,void 0,(function*(){const t=this.guard((()=>{const t=this.copyIn(e),i=new this.module.ZipfileWalker(e.length,t);return this.cloudpilot.Free(t),i}));try{return yield i(function(e,t){return Object.setPrototypeOf({GetCurrentEntryContent:()=>{const i=t.getPointer(e.GetCurrentEntryContent()),r=e.GetCurrentEntrySize();return i>0&&r>0?t.HEAPU8.subarray(i,i+r):void 0}},e)}(this.wrap(t),this.module))}finally{this.module.destroy(t)}}))}withZipfileWalkerSync(e,t){const i=this.guard((()=>{const t=this.copyIn(e),i=new this.module.ZipfileWalker(e.length,t);return this.cloudpilot.Free(t),i}));try{return t(this.wrap(Object.setPrototypeOf({GetCurrentEntryContent:()=>this.copyOut(i.GetCurrentEntryContent(),i.GetCurrentEntrySize())},i)))}finally{this.module.destroy(i)}}serializeSessionImage(e){var t,i;const r=new this.module.SessionImage,n=this.cloudpilot.Nullptr(),o=this.copyIn(e.rom),s=e.memory?this.copyIn(e.memory):n,a=void 0!==e.savestate?this.copyIn(e.savestate):n;let c=n,p=0;if(void 0!==e.metadata){const t=(new TextEncoder).encode(JSON.stringify(e.metadata));p=t.length,c=this.copyIn(t)}r.SetRomImage(o,e.rom.length),r.SetMemoryImage(s,(null===(t=e.memory)||void 0===t?void 0:t.length)||0),r.SetDeviceId(e.deviceId),r.SetSavestate(a,(null===(i=e.savestate)||void 0===i?void 0:i.length)||0),r.SetMetadata(c,p);const u=r.Serialize()?this.copyOut(r.GetSerializedImage(),r.GetSerializedImageSize()):void 0;return this.module.destroy(r),[o,s,a,c].forEach((e=>this.cloudpilot.Free(e))),u}deserializeSessionImage(e){if(!e)return;const t=new this.module.SessionImage,i=this.copyIn(e),r=(()=>{if(!t.Deserialize(i,e.length))return;const r=this.copyOut(t.GetRomImage(),t.GetRomImageSize()),n=this.copyOut(t.GetMemoryImage(),t.GetMemoryImageSize()),o=this.copyOut(t.GetSavestate(),t.GetSavestateSize()),s=t.GetDeviceId();if(!te.includes(s))return void console.warn(`unsupported device ${s}`);let a;const c=this.copyOut(t.GetMetadata(),t.GetMetadataSize());if(c)try{a=JSON.parse((new TextDecoder).decode(c))}catch(e){console.warn("invalid metadata",e)}return{deviceId:s,rom:r,memory:n,savestate:o,metadata:a,version:t.GetVersion()}})();return this.module.destroy(t),this.cloudpilot.Free(i),r}launchAppByName(e){return this.cloudpilot.LaunchAppByName(e)}launchAppByDbHeader(e){if(e.length<32)return!1;const t=this.copyIn(e.subarray(0,32)),i=this.cloudpilot.LaunchAppByDbHeader(t,32);return this.cloudpilot.Free(t),i}deviceSupportsCardSize(e){return this.cloudpilot.DeviceSupportsCardSize(e)}clearExternalStorage(){this.cloudpilot.ClearExternalStorage()}allocateCard(e,t){return this.cloudpilot.AllocateCard(e,t>>>9)}decompressCard(e,t){const i=this.copyIn(t);let r;try{for(r=new this.module.GunzipContext(i,t.length,524288);0===r.GetState();)r.Continue();return-1===r.GetState()?(console.error(`gunzip failed: ${r.GetError()}`),!1):r.GetUncompressedSize()%512!=0?(console.error("failed to allocate card: invalid size of decompressed image"),!1):this.cloudpilot.AdoptCard(e,r.ReleaseUncompressedData(),r.GetUncompressedSize()>>>9)}finally{this.cloudpilot.Free(i),r&&this.module.destroy(r)}}getCardData(e){const t=this.module.getPointer(this.cloudpilot.GetCardData(e));if(0!==t)return this.module.HEAPU32.subarray(t>>>2,t+this.cloudpilot.GetCardSize(e)>>2)}getCardDirtyPages(e){const t=this.module.getPointer(this.cloudpilot.GetCardDirtyPages(e));if(0===t)return;const i=function(e){const t=(e>>>13)+(e%8192>0?1:0);return(t>>>3)+(t%8>0?1:0)}(this.cloudpilot.GetCardSize(e));return this.module.HEAPU8.subarray(t,t+i)}getMountedKey(){return this.cloudpilot.GetMountedKey()}mountCard(e){return this.cloudpilot.MountCard(e)}removeCard(e){return this.cloudpilot.RemoveCard(e)}remountCards(){this.cloudpilot.RemountCards()}getCardSupportLevel(e){return this.cloudpilot.GetSupportLevel(e)}loadSkin(e){const t=new this.module.SkinLoader(e);try{const e=this.module.getPointer(t.GetData());if(0===e)return;return(new TextDecoder).decode(this.module.HEAPU8.subarray(e,e+t.GetSize()))}finally{this.module.destroy(t)}}guard(e){if(this.amIdead)throw new Error("cloudpilot instance is dead");try{return e()}catch(e){throw this.amIdead=!0,this.cloudpilot=void 0,this.fatalErrorEvent.dispatch(e instanceof Error?e:new Error("unknown error")),e}}copyIn(e){const t=this.cloudpilot.Malloc(e.length),i=this.module.getPointer(t);return this.module.HEAPU8.subarray(i,i+e.length).set(e),t}copyIn32(e){const t=this.cloudpilot.Malloc(e.length<<2),i=this.module.getPointer(t);return this.module.HEAPU32.subarray(i>>>2,(i>>>2)+e.length).set(e),t}copyOut(e,t){const i=this.module.getPointer(e);return i>0&&t>0?this.module.HEAPU8.subarray(i,i+t).slice():void 0}wrap(e){return new Proxy(e,{get:(e,t)=>{const i=e[t];return"function"!=typeof i?i:(...t)=>this.guard((()=>i.apply(e,t)))}})}}var ne;e([ie()],re.prototype,"getRomInfo",null),e([ie()],re.prototype,"initializeSession",null),e([ie()],re.prototype,"cyclesPerSecond",null),e([ie()],re.prototype,"runEmulation",null),e([ie()],re.prototype,"getFrame",null),e([ie()],re.prototype,"isScreenDirty",null),e([ie()],re.prototype,"markScreenClean",null),e([ie()],re.prototype,"minRamForDevice",null),e([ie()],re.prototype,"framebufferSizeForDevice",null),e([ie()],re.prototype,"totalMemorySizeForDevice",null),e([ie()],re.prototype,"queuePenMove",null),e([ie()],re.prototype,"queuePenUp",null),e([ie()],re.prototype,"queueButtonDown",null),e([ie()],re.prototype,"queueButtonUp",null),e([ie()],re.prototype,"queueKeyboardEvent",null),e([ie()],re.prototype,"isPowerOff",null),e([ie()],re.prototype,"isUiInitialized",null),e([ie()],re.prototype,"isSetupComplete",null),e([ie()],re.prototype,"getOSVersion",null),e([ie()],re.prototype,"reset",null),e([ie()],re.prototype,"resetNoExtensions",null),e([ie()],re.prototype,"resetHard",null),e([ie()],re.prototype,"installDb",null),e([ie()],re.prototype,"getPalette2bitMapping",null),e([ie()],re.prototype,"getMemory",null),e([ie()],re.prototype,"getMemory32",null),e([ie()],re.prototype,"getDirtyPages",null),e([ie()],re.prototype,"loadMemory",null),e([ie()],re.prototype,"getRomImage",null),e([ie()],re.prototype,"getSavestate",null),e([ie()],re.prototype,"saveState",null),e([ie()],re.prototype,"loadState",null),e([ie()],re.prototype,"getHotsyncName",null),e([ie()],re.prototype,"setClockFactor",null),e([ie()],re.prototype,"setHotsyncName",null),e([ie()],re.prototype,"setClipboardIntegration",null),e([ie()],re.prototype,"getClipboardIntegration",null),e([ie()],re.prototype,"isSuspended",null),e([ie()],re.prototype,"getSuspendKind",null),e([ie()],re.prototype,"cancelSuspend",null),e([ie()],re.prototype,"getSuspendContextClipboardCopy",null),e([ie()],re.prototype,"getSuspendContextClipboardPaste",null),e([ie()],re.prototype,"setNetworkRedirection",null),e([ie()],re.prototype,"getNetworkRedirection",null),e([ie()],re.prototype,"getSuspendContextNetworkConnect",null),e([ie()],re.prototype,"getSuspendContextNetworkRpc",null),e([ie()],re.prototype,"copyBuffer",null),e([ie()],re.prototype,"freeBuffer",null),e([ie()],re.prototype,"setHotsyncNameManagement",null),e([ie()],re.prototype,"resolveBuffer",null),e([ie()],re.prototype,"serializeSessionImage",null),e([ie()],re.prototype,"deserializeSessionImage",null),e([ie()],re.prototype,"launchAppByName",null),e([ie()],re.prototype,"launchAppByDbHeader",null),e([ie()],re.prototype,"deviceSupportsCardSize",null),e([ie()],re.prototype,"clearExternalStorage",null),e([ie()],re.prototype,"allocateCard",null),e([ie()],re.prototype,"decompressCard",null),e([ie()],re.prototype,"getCardData",null),e([ie()],re.prototype,"getCardDirtyPages",null),e([ie()],re.prototype,"getMountedKey",null),e([ie()],re.prototype,"mountCard",null),e([ie()],re.prototype,"removeCard",null),e([ie()],re.prototype,"remountCards",null),e([ie()],re.prototype,"getCardSupportLevel",null),e([ie()],re.prototype,"loadSkin",null),function(e){e[e.cal=0]="cal",e[e.phone=1]="phone",e[e.todo=2]="todo",e[e.notes=3]="notes",e[e.up=4]="up",e[e.down=5]="down",e[e.power=6]="power",e[e.cradle=7]="cradle"}(ne||(ne={}));const oe="1.9.5";function se(e){return t(this,void 0,void 0,(function*(){return new X(yield re.create(e))}))}function ae(e){const i=function(e){const i=WebAssembly.compileStreaming?WebAssembly.compileStreaming(fetch(e)):fetch(e).then((e=>e.arrayBuffer())).then((e=>WebAssembly.compile(e)));return(e,r)=>t(this,void 0,void 0,(function*(){return r(yield WebAssembly.instantiate(yield i,e))}))}(null!=e?e:"cloudpilot_web.wasm");return()=>re.create(i).then((e=>new X(e)))}})(),r})()));
//# sourceMappingURL=cloudpilot-emu.js.map