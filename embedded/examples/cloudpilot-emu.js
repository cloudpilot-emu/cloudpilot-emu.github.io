!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cloudpilot=e():t.cloudpilot=e()}(self,()=>(()=>{var t={84:(t,e,i)=>{"use strict";var n=i(360);e.J=n.default},360:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=[];i[0]=function(){return function(){}},i[1]=function(t,e){return void 0===e?t:function(i){t(i,e)}};var n=function(){function t(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return t.prototype.addHandler=function(t,e){return this.isHandlerAttached(t,e)||(this._handlers.push(t),this._contexts.push(e),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.removeHandler=function(t,e){var i=this._getHandlerIndex(t,e);return void 0!==i&&(this._handlers.splice(i,1),this._contexts.splice(i,1),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.isHandlerAttached=function(t,e){return void 0!==this._getHandlerIndex(t,e)},t.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},t.prototype._getHandlerIndex=function(t,e){var i,n=this._handlers.length;for(i=0;i<n&&(this._handlers[i]!==t||this._contexts[i]!==e);i++);return i<n?i:void 0},t.prototype._createDispatcher=function(){var t;this.dispatch=(t=this._handlers.length,i[t]||(i[t]=function(t){for(var e="return function dispatcher"+t+"(payload) {\n",i=[],n=[],r=0;r<t;r++)i.push("cb"+r),n.push("ctx"+r),e+="    cb"+r+"(payload, ctx"+r+");\n";return e+="};",new(Function.bind.apply(Function,[void 0].concat(i.concat(n),[e])))}(t)),i[t]).apply(this,this._handlers.concat(this._contexts))},t}();e.default=n},389:function(t,e){!function(t){"use strict";var e,i=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,r=1073741824,o=new WeakMap,s=function(t,e){return function(o){var s=e.get(o),a=void 0===s?o.size:s<r?s+1:0;if(!o.has(a))return t(o,a);if(o.size<n){for(;o.has(a);)a=Math.floor(Math.random()*r);return t(o,a)}if(o.size>i)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(a);)a=Math.floor(Math.random()*i);return t(o,a)}}((e=o,function(t,i){return e.set(t,i),i}),o),a=function(t){return function(e){var i=t(e);return e.add(i),i}}(s);t.addUniqueNumber=a,t.generateUniqueNumber=s}(e)},666:t=>{var e,i=(e="undefined"!=typeof document?document.currentScript?.src:void 0,async function(t={}){var i=t,n="object"==typeof window,r="undefined"!=typeof WorkerGlobalScope,o=("object"==typeof process&&process.versions?.node&&process.type,"./this.program"),s=(t,e)=>{throw e};r&&(e=self.location.href);var a,c,p="";if(n||r){try{p=new URL(".",e).href}catch{}r&&(c=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),a=async t=>{var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)}}var u,l,d,h,m,v,y,f,_,g,S,b=console.log.bind(console),w=console.error.bind(console),C=!1;function E(t,e){t||P(e)}function I(){if(!C){var t=Gr();0==t&&(t+=4);var e=_[t>>2],i=_[t+4>>2];34821223==e&&2310721022==i||P(`Stack overflow! Stack cookie has been overwritten at ${j(t)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${j(i)} ${j(e)}`),1668509029!=_[0]&&P("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var D=!1;function x(){var t=m.buffer;v=new Int8Array(t),new Int16Array(t),i.HEAPU8=y=new Uint8Array(t),new Uint16Array(t),f=new Int32Array(t),i.HEAPU32=_=new Uint32Array(t),new Float32Array(t),g=new Float64Array(t),S=new BigInt64Array(t),new BigUint64Array(t)}var G,M=0,k=null;function P(t){i.onAbort?.(t),w(t="Aborted("+t+")"),C=!0,t+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(t);throw h?.(e),e}async function R(t,e,i){if(!t&&"function"==typeof WebAssembly.instantiateStreaming)try{var n=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,i)}catch(t){w(`wasm streaming compile failed: ${t}`),w("falling back to ArrayBuffer instantiation")}return async function(t,e){try{var i=await async function(t){if(!u)try{var e=await a(t);return new Uint8Array(e)}catch{}return function(t){if(t==G&&u)return new Uint8Array(u);if(c)return c(t);throw"both async and sync fetching of the wasm failed"}(t)}(t);return await WebAssembly.instantiate(i,e)}catch(t){w(`failed to asynchronously prepare wasm: ${t}`),P(t)}}(e,i)}class z{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var H,T,N=t=>{for(;t.length>0;)t.shift()(i)},A=[],U=t=>A.push(t),B=[],F=t=>B.push(t),L=!0,j=t=>"0x"+(t>>>=0).toString(16).padStart(8,"0"),O="undefined"!=typeof TextDecoder?new TextDecoder:void 0,W=(t,e=0,i=NaN)=>{for(var n=e+i,r=e;t[r]&&!(r>=n);)++r;if(r-e>16&&t.buffer&&O)return O.decode(t.subarray(e,r));for(var o="";e<r;){var s=t[e++];if(128&s){var a=63&t[e++];if(192!=(224&s)){var c=63&t[e++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&t[e++])<65536)o+=String.fromCharCode(s);else{var p=s-65536;o+=String.fromCharCode(55296|p>>10,56320|1023&p)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o},V=(t,e)=>t?W(y,t,e):"",q=t=>t<-9007199254740992||t>9007199254740992?NaN:Number(t),K=0,$=[0,31,60,91,121,152,182,213,244,274,305,335],J=[0,31,59,90,120,151,181,212,243,273,304,334],Q=t=>{var e;return((e=t.getFullYear())%4!=0||e%100==0&&e%400!=0?J:$)[t.getMonth()]+t.getDate()-1},Y={},Z=t=>{if(t instanceof z||"unwind"==t)return l;I(),t instanceof WebAssembly.RuntimeError&&Pr()<=0&&w("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 1048576)"),s(0,t)},X=()=>L||K>0,tt=t=>{l=t,X()||(i.onExit?.(t),C=!0),s(0,new z(t))},et=(t,e)=>{l=t,tt(t)},it=et,nt=()=>performance.now(),rt=(t,e,i,n)=>{if(!(n>0))return 0;for(var r=i,o=i+n-1,s=0;s<t.length;++s){var a=t.codePointAt(s);if(a<=127){if(i>=o)break;e[i++]=a}else if(a<=2047){if(i+1>=o)break;e[i++]=192|a>>6,e[i++]=128|63&a}else if(a<=65535){if(i+2>=o)break;e[i++]=224|a>>12,e[i++]=128|a>>6&63,e[i++]=128|63&a}else{if(i+3>=o)break;e[i++]=240|a>>18,e[i++]=128|a>>12&63,e[i++]=128|a>>6&63,e[i++]=128|63&a,s++}}return e[i]=0,i-r},ot=(t,e,i)=>rt(t,y,e,i),st=()=>Date.now(),at=[],ct=(t,e)=>Math.ceil(t/e)*e,pt=t=>{var e=(t-m.buffer.byteLength+65535)/65536|0;try{return m.grow(e),x(),1}catch(t){}},ut={},lt=()=>{if(!lt.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:o||"./this.program"};for(var e in ut)void 0===ut[e]?delete t[e]:t[e]=ut[e];var i=[];for(var e in t)i.push(`${e}=${t[e]}`);lt.strings=i}return lt.strings},dt=t=>{for(var e=0,i=0;i<t.length;++i){var n=t.charCodeAt(i);n<=127?e++:n<=2047?e+=2:n>=55296&&n<=57343?(e+=4,++i):e+=3}return e},ht=[null,[],[]],mt=(t,e)=>{var i=ht[t];0===e||10===e?((1===t?b:w)(W(i)),i.length=0):i.push(e)},vt=[],yt=(t,e)=>{t<128?e.push(t):e.push(t%128|128,t>>7)},ft=[],_t=t=>{var e=ft[t];return e||(ft[t]=e=H.get(t)),e},gt=[],St=(t,e)=>{H.set(t,e),ft[t]=H.get(t)};i.noExitRuntime&&(L=i.noExitRuntime),i.print&&(b=i.print),i.printErr&&(w=i.printErr),i.wasmBinary&&(u=i.wasmBinary),i.arguments&&i.arguments,i.thisProgram&&(o=i.thisProgram),i.addFunction=(t,e)=>{var i=(t=>(T||(T=new WeakMap,((t,e)=>{if(T)for(var i=0;i<0+e;i++){var n=_t(i);n&&T.set(n,i)}})(0,H.length)),T.get(t)||0))(t);if(i)return i;var n=(()=>{if(gt.length)return gt.pop();try{H.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return H.length-1})();try{St(n,t)}catch(i){if(!(i instanceof TypeError))throw i;var r=((t,e)=>{if("function"==typeof WebAssembly.Function)return new WebAssembly.Function((t=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==t[0]?[]:[e[t[0]]]},n=1;n<t.length;++n)i.parameters.push(e[t[n]]);return i})(e),t);var i=[1];((t,e)=>{var i=t.slice(0,1),n=t.slice(1),r={i:127,p:127,j:126,f:125,d:124,e:111};for(var o of(e.push(96),yt(n.length,e),n))e.push(r[o]);"v"==i?e.push(0):e.push(1,r[i])})(e,i);var n=[0,97,115,109,1,0,0,0,1];yt(i.length,n),n.push(...i),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var r=new WebAssembly.Module(new Uint8Array(n));return new WebAssembly.Instance(r,{e:{f:t}}).exports.f})(t,e);St(n,r)}return T.set(t,n),n},i.UTF8ToString=V;var bt,wt,Ct,Et,It,Dt,xt,Gt,Mt,kt,Pt,Rt,zt,Ht,Tt,Nt,At,Ut,Bt,Ft,Lt,jt,Ot,Wt,Vt,qt,Kt,$t,Jt,Qt,Yt,Zt,Xt,te,ee,ie,ne,re,oe,se,ae,ce,pe,ue,le,de,he,me,ve,ye,fe,_e,ge,Se,be,we,Ce,Ee,Ie,De,xe,Ge,Me,ke,Pe,Re,ze,He,Te,Ne,Ae,Ue,Be,Fe,Le,je,Oe,We,Ve,qe,Ke,$e,Je,Qe,Ye,Ze,Xe,ti,ei,ii,ni,ri,oi,si,ai,ci,pi,ui,li,di,hi,mi,vi,yi,fi,_i,gi,Si,bi,wi,Ci,Ei,Ii,Di,xi,Gi,Mi,ki,Pi,Ri,zi,Hi,Ti,Ni,Ai,Ui,Bi,Fi,Li,ji,Oi,Wi,Vi,qi,Ki,$i,Ji,Qi,Yi,Zi,Xi,tn,en,nn,rn,on,sn,an,cn,pn,un,ln,dn,hn,mn,vn,yn,fn,_n,gn,Sn,bn,wn,Cn,En,In,Dn,xn,Gn,Mn,kn,Pn,Rn,zn,Hn,Tn,Nn,An,Un,Bn,Fn,Ln,jn,On,Wn,Vn,qn,Kn,$n,Jn,Qn,Yn,Zn,Xn,tr,er,ir,nr,rr,or,sr,ar,cr,pr,ur,lr,dr,hr,mr,vr,yr,fr,_r,gr,Sr,br,wr,Cr,Er,Ir,Dr,xr,Gr,Mr,kr,Pr,Rr={433568:t=>{H.grow(65536);for(let e=0;e<=65535;e++)H.set(H.length-65535-1+e,H.get(_[(t>>>2)+e]));return H.length-65535-1}},zr={a:(t,e,i,n)=>P(`Assertion failed: ${V(t)}, at: `+[e?V(e):"unknown filename",i,n?V(n):"unknown function"]),s:function(t){const e=new Error(V(t));throw e.isAssert=!0,e},c:function(t,e){e=q(e)},h:()=>P(""),j:()=>{L=!1,K=0},p:function(t,e){t=q(t);var i=new Date(1e3*t);f[e>>2]=i.getSeconds(),f[e+4>>2]=i.getMinutes(),f[e+8>>2]=i.getHours(),f[e+12>>2]=i.getDate(),f[e+16>>2]=i.getMonth(),f[e+20>>2]=i.getFullYear()-1900,f[e+24>>2]=i.getDay();var n=0|Q(i);f[e+28>>2]=n,f[e+36>>2]=-60*i.getTimezoneOffset();var r=new Date(i.getFullYear(),0,1),o=new Date(i.getFullYear(),6,1).getTimezoneOffset(),s=r.getTimezoneOffset(),a=0|(o!=s&&i.getTimezoneOffset()==Math.min(s,o));f[e+32>>2]=a},q:function(t){var e=(()=>{var e=new Date(f[t+20>>2]+1900,f[t+16>>2],f[t+12>>2],f[t+8>>2],f[t+4>>2],f[t>>2],0),i=f[t+32>>2],n=e.getTimezoneOffset(),r=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),s=r.getTimezoneOffset(),a=Math.min(s,o);if(i<0)f[t+32>>2]=Number(o!=s&&a==n);else if(i>0!=(a==n)){var c=Math.max(s,o),p=i>0?a:c;e.setTime(e.getTime()+6e4*(p-n))}f[t+24>>2]=e.getDay();var u=0|Q(e);f[t+28>>2]=u,f[t>>2]=e.getSeconds(),f[t+4>>2]=e.getMinutes(),f[t+8>>2]=e.getHours(),f[t+12>>2]=e.getDate(),f[t+16>>2]=e.getMonth(),f[t+20>>2]=e.getYear();var l=e.getTime();return isNaN(l)?-1:l/1e3})();return BigInt(e)},k:(t,e)=>{if(Y[t]&&(clearTimeout(Y[t].id),delete Y[t]),!e)return 0;var i=setTimeout(()=>{delete Y[t],(t=>{if(!C)try{t(),(()=>{if(!X())try{it(l)}catch(t){Z(t)}})()}catch(t){Z(t)}})(()=>Mr(t,nt()))},e);return Y[t]={id:i,timeout_ms:e},0},r:(t,e,i,n)=>{var r=(new Date).getFullYear(),o=new Date(r,0,1),s=new Date(r,6,1),a=o.getTimezoneOffset(),c=s.getTimezoneOffset(),p=Math.max(a,c);_[t>>2]=60*p,f[e>>2]=Number(a!=c);var u=t=>{var e=t>=0?"-":"+",i=Math.abs(t);return`UTC${e}${String(Math.floor(i/60)).padStart(2,"0")}${String(i%60).padStart(2,"0")}`},l=u(a),d=u(c);c<a?(ot(l,i,17),ot(d,n,17)):(ot(l,n,17),ot(d,i,17))},n:function(t,e,i){if(e=q(e),!((n=t)>=0&&n<=3))return 28;var n,r;r=0===t?st():nt();var o=Math.round(1e3*r*1e3);return S[i>>3]=BigInt(o),0},t:(t,e,i)=>((t,e,i)=>{var n=((t,e)=>{var i;for(at.length=0;i=y[t++];){var n=105!=i;e+=(n&=112!=i)&&e%8?4:0,at.push(112==i?_[e>>2]:106==i?S[e>>3]:105==i?f[e>>2]:g[e>>3]),e+=n?8:4}return at})(e,i);return Rr[t](...n)})(t,e,i),g:st,o:t=>{var e=y.length,i=2147483648;if((t>>>=0)>i)return!1;for(var n=1;n<=4;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var o=Math.min(i,ct(Math.max(t,r),65536));if(pt(o))return!0}return!1},l:(t,e)=>{var i=0,n=0;for(var r of lt()){var o=e+i;_[t+n>>2]=o,i+=ot(r,o,1/0)+1,n+=4}return 0},m:(t,e)=>{var i=lt();_[t>>2]=i.length;var n=0;for(var r of i)n+=dt(r)+1;return _[e>>2]=n,0},d:t=>52,f:(t,e,i,n)=>52,b:function(t,e,i,n){return e=q(e),70},e:(t,e,i,n)=>{for(var r=0,o=0;o<i;o++){var s=_[e>>2],a=_[e+4>>2];e+=8;for(var c=0;c<a;c++)mt(t,y[s+c]);r+=a}return _[n>>2]=r,0},i:tt},Hr=await async function(){function t(t,e){return Hr=t.exports,m=Hr.u,x(),H=Hr.Ed,function(t){i._main=bt=t.w,i._webidl_free=t.x,i._webidl_malloc=t.y,i._emscripten_bind_VoidPtr___destroy___0=wt=t.z,i._emscripten_bind_Cloudpilot_Cloudpilot_0=Ct=t.A,i._emscripten_bind_Cloudpilot_Malloc_1=Et=t.B,i._emscripten_bind_Cloudpilot_Free_1=It=t.C,i._emscripten_bind_Cloudpilot_Nullptr_0=Dt=t.D,i._emscripten_bind_Cloudpilot_EnableLogging_1=xt=t.E,i._emscripten_bind_Cloudpilot_InitializeSession_3=Gt=t.F,i._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=Mt=t.G,i._emscripten_bind_Cloudpilot_RunEmulation_1=kt=t.H,i._emscripten_bind_Cloudpilot_SetClockFactor_1=Pt=t.I,i._emscripten_bind_Cloudpilot_CopyFrame_0=Rt=t.J,i._emscripten_bind_Cloudpilot_IsScreenDirty_0=zt=t.K,i._emscripten_bind_Cloudpilot_MarkScreenClean_0=Ht=t.L,i._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=Tt=t.M,i._emscripten_bind_Cloudpilot_FramebufferSizeForDevice_1=Nt=t.N,i._emscripten_bind_Cloudpilot_TotalMemoryForDevice_1=At=t.O,i._emscripten_bind_Cloudpilot_QueuePenMove_2=Ut=t.P,i._emscripten_bind_Cloudpilot_QueuePenUp_0=Bt=t.Q,i._emscripten_bind_Cloudpilot_QueueButtonDown_1=Ft=t.R,i._emscripten_bind_Cloudpilot_QueueButtonUp_1=Lt=t.S,i._emscripten_bind_Cloudpilot_QueueKeyboardEvent_1=jt=t.T,i._emscripten_bind_Cloudpilot_IsPowerOff_0=Ot=t.U,i._emscripten_bind_Cloudpilot_IsUIInitialized_0=Wt=t.V,i._emscripten_bind_Cloudpilot_GetOSVersion_0=Vt=t.W,i._emscripten_bind_Cloudpilot_IsSetupComplete_0=qt=t.X,i._emscripten_bind_Cloudpilot_Reset_0=Kt=t.Y,i._emscripten_bind_Cloudpilot_ResetNoExtensions_0=$t=t.Z,i._emscripten_bind_Cloudpilot_ResetHard_0=Jt=t._,i._emscripten_bind_Cloudpilot_InstallDb_2=Qt=t.$,i._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=Yt=t.aa,i._emscripten_bind_Cloudpilot_GetMemoryPtr_0=Zt=t.ba,i._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=Xt=t.ca,i._emscripten_bind_Cloudpilot_GetMemorySize_0=te=t.da,i._emscripten_bind_Cloudpilot_ImportMemoryImage_2=ee=t.ea,i._emscripten_bind_Cloudpilot_GetRomPtr_0=ie=t.fa,i._emscripten_bind_Cloudpilot_GetRomSize_0=ne=t.ga,i._emscripten_bind_Cloudpilot_GetSavestatePtr_0=re=t.ha,i._emscripten_bind_Cloudpilot_GetSavestateSize_0=oe=t.ia,i._emscripten_bind_Cloudpilot_SaveState_0=se=t.ja,i._emscripten_bind_Cloudpilot_LoadState_2=ae=t.ka,i._emscripten_bind_Cloudpilot_GetHotsyncName_0=ce=t.la,i._emscripten_bind_Cloudpilot_SetHotsyncName_1=pe=t.ma,i._emscripten_bind_Cloudpilot_RegisterPwmHandler_1=ue=t.na,i._emscripten_bind_Cloudpilot_StartBackup_0=le=t.oa,i._emscripten_bind_Cloudpilot_SetClipboardIntegration_1=de=t.pa,i._emscripten_bind_Cloudpilot_GetClipboardIntegration_0=he=t.qa,i._emscripten_bind_Cloudpilot_IsSuspended_0=me=t.ra,i._emscripten_bind_Cloudpilot_GetSuspendContext_0=ve=t.sa,i._emscripten_bind_Cloudpilot_SetNetworkRedirection_1=ye=t.ta,i._emscripten_bind_Cloudpilot_GetNetworkRedirection_0=fe=t.ua,i._emscripten_bind_Cloudpilot_RegisterProxyDisconnectHandler_1=_e=t.va,i._emscripten_bind_Cloudpilot_SetHotsyncNameManagement_1=ge=t.wa,i._emscripten_bind_Cloudpilot_LaunchAppByName_1=Se=t.xa,i._emscripten_bind_Cloudpilot_LaunchAppByDbHeader_2=be=t.ya,i._emscripten_bind_Cloudpilot_ClearExternalStorage_0=we=t.za,i._emscripten_bind_Cloudpilot_AllocateCard_2=Ce=t.Aa,i._emscripten_bind_Cloudpilot_AdoptCard_3=Ee=t.Ba,i._emscripten_bind_Cloudpilot_MountCard_1=Ie=t.Ca,i._emscripten_bind_Cloudpilot_RemoveCard_1=De=t.Da,i._emscripten_bind_Cloudpilot_GetCardData_1=xe=t.Ea,i._emscripten_bind_Cloudpilot_GetCardDirtyPages_1=Ge=t.Fa,i._emscripten_bind_Cloudpilot_GetCardSize_1=Me=t.Ga,i._emscripten_bind_Cloudpilot_RemountCards_0=ke=t.Ha,i._emscripten_bind_Cloudpilot_GetSupportLevel_1=Pe=t.Ia,i._emscripten_bind_Cloudpilot_GetMountedKey_0=Re=t.Ja,i._emscripten_bind_Cloudpilot_GetTransportIR_0=ze=t.Ka,i._emscripten_bind_Cloudpilot_GetTransportSerial_0=He=t.La,i._emscripten_bind_Cloudpilot___destroy___0=Te=t.Ma,i._emscripten_bind_RomInfo_RomInfo_2=Ne=t.Na,i._emscripten_bind_RomInfo_IsValid_0=Ae=t.Oa,i._emscripten_bind_RomInfo_CardVersion_0=Ue=t.Pa,i._emscripten_bind_RomInfo_CardName_0=Be=t.Qa,i._emscripten_bind_RomInfo_RomVersion_0=Fe=t.Ra,i._emscripten_bind_RomInfo_RomVersionString_0=Le=t.Sa,i._emscripten_bind_RomInfo_Supports_1=je=t.Ta,i._emscripten_bind_RomInfo___destroy___0=Oe=t.Ua,i._emscripten_bind_Frame_GetLineWidth_0=We=t.Va,i._emscripten_bind_Frame_GetBpp_0=Ve=t.Wa,i._emscripten_bind_Frame_GetLines_0=qe=t.Xa,i._emscripten_bind_Frame_GetMargin_0=Ke=t.Ya,i._emscripten_bind_Frame_GetBytesPerLine_0=$e=t.Za,i._emscripten_bind_Frame_GetFirstDirtyLine_0=Je=t._a,i._emscripten_bind_Frame_GetLastDirtyLine_0=Qe=t.$a,i._emscripten_bind_Frame_GetHasChanges_0=Ye=t.ab,i._emscripten_bind_Frame_GetBuffer_0=Ze=t.bb,i._emscripten_bind_Frame_GetBufferSize_0=Xe=t.cb,i._emscripten_bind_Frame_GetScaleX_0=ti=t.db,i._emscripten_bind_Frame_GetScaleY_0=ei=t.eb,i._emscripten_bind_Frame___destroy___0=ii=t.fb,i._emscripten_bind_DbBackup_Init_1=ni=t.gb,i._emscripten_bind_DbBackup_IsInProgress_0=ri=t.hb,i._emscripten_bind_DbBackup_IsDone_0=oi=t.ib,i._emscripten_bind_DbBackup_GetCurrentDatabase_0=si=t.jb,i._emscripten_bind_DbBackup_Save_0=ai=t.kb,i._emscripten_bind_DbBackup_Skip_0=ci=t.lb,i._emscripten_bind_DbBackup_GetArchivePtr_0=pi=t.mb,i._emscripten_bind_DbBackup_GetArchiveSize_0=ui=t.nb,i._emscripten_bind_DbBackup___destroy___0=li=t.ob,i._emscripten_bind_SuspendContextClipboardCopy_Cancel_0=di=t.pb,i._emscripten_bind_SuspendContextClipboardCopy_Resume_0=hi=t.qb,i._emscripten_bind_SuspendContextClipboardCopy_GetClipboardContent_0=mi=t.rb,i._emscripten_bind_SuspendContextClipboardCopy___destroy___0=vi=t.sb,i._emscripten_bind_SuspendContextClipboardPaste_Cancel_0=yi=t.tb,i._emscripten_bind_SuspendContextClipboardPaste_Resume_1=fi=t.ub,i._emscripten_bind_SuspendContextClipboardPaste___destroy___0=_i=t.vb,i._emscripten_bind_SuspendContextNetworkConnect_Cancel_0=gi=t.wb,i._emscripten_bind_SuspendContextNetworkConnect_Resume_0=Si=t.xb,i._emscripten_bind_SuspendContextNetworkConnect___destroy___0=bi=t.yb,i._emscripten_bind_SuspendContextNetworkRpc_Cancel_0=wi=t.zb,i._emscripten_bind_SuspendContextNetworkRpc_GetRequestSize_0=Ci=t.Ab,i._emscripten_bind_SuspendContextNetworkRpc_GetRequestData_0=Ei=t.Bb,i._emscripten_bind_SuspendContextNetworkRpc_ReceiveResponse_2=Ii=t.Cb,i._emscripten_bind_SuspendContextNetworkRpc___destroy___0=Di=t.Db,i._emscripten_bind_SuspendContextSerialSync_Cancel_0=xi=t.Eb,i._emscripten_bind_SuspendContextSerialSync_Resume_0=Gi=t.Fb,i._emscripten_bind_SuspendContextSerialSync___destroy___0=Mi=t.Gb,i._emscripten_bind_SuspendContext_GetKind_0=ki=t.Hb,i._emscripten_bind_SuspendContext_Cancel_0=Pi=t.Ib,i._emscripten_bind_SuspendContext_AsContextClipboardCopy_0=Ri=t.Jb,i._emscripten_bind_SuspendContext_AsContextClipboardPaste_0=zi=t.Kb,i._emscripten_bind_SuspendContext_AsContextNetworkConnect_0=Hi=t.Lb,i._emscripten_bind_SuspendContext_AsContextNetworkRpc_0=Ti=t.Mb,i._emscripten_bind_SuspendContext_AsContextSerialSync_0=Ni=t.Nb,i._emscripten_bind_SuspendContext___destroy___0=Ai=t.Ob,i._emscripten_bind_SessionImage_SessionImage_0=Ui=t.Pb,i._emscripten_bind_SessionImage_GetDeviceId_0=Bi=t.Qb,i._emscripten_bind_SessionImage_SetDeviceId_1=Fi=t.Rb,i._emscripten_bind_SessionImage_GetRomImage_0=Li=t.Sb,i._emscripten_bind_SessionImage_GetRomImageSize_0=ji=t.Tb,i._emscripten_bind_SessionImage_SetRomImage_2=Oi=t.Ub,i._emscripten_bind_SessionImage_GetMemoryImage_0=Wi=t.Vb,i._emscripten_bind_SessionImage_GetMemoryImageSize_0=Vi=t.Wb,i._emscripten_bind_SessionImage_SetMemoryImage_2=qi=t.Xb,i._emscripten_bind_SessionImage_GetMetadata_0=Ki=t.Yb,i._emscripten_bind_SessionImage_GetMetadataSize_0=$i=t.Zb,i._emscripten_bind_SessionImage_SetMetadata_2=Ji=t._b,i._emscripten_bind_SessionImage_GetSavestate_0=Qi=t.$b,i._emscripten_bind_SessionImage_GetSavestateSize_0=Yi=t.ac,i._emscripten_bind_SessionImage_SetSavestate_2=Zi=t.bc,i._emscripten_bind_SessionImage_GetVersion_0=Xi=t.cc,i._emscripten_bind_SessionImage_Serialize_0=tn=t.dc,i._emscripten_bind_SessionImage_GetSerializedImage_0=en=t.ec,i._emscripten_bind_SessionImage_GetSerializedImageSize_0=nn=t.fc,i._emscripten_bind_SessionImage_Deserialize_2=rn=t.gc,i._emscripten_bind_SessionImage___destroy___0=on=t.hc,i._emscripten_bind_SkinLoader_SkinLoader_1=sn=t.ic,i._emscripten_bind_SkinLoader_GetData_0=an=t.jc,i._emscripten_bind_SkinLoader_GetSize_0=cn=t.kc,i._emscripten_bind_SkinLoader___destroy___0=pn=t.lc,i._emscripten_bind_EmTransportSerialBuffer_RxBytesPending_0=un=t.mc,i._emscripten_bind_EmTransportSerialBuffer_Receive_0=ln=t.nc,i._emscripten_bind_EmTransportSerialBuffer_Send_3=dn=t.oc,i._emscripten_bind_EmTransportSerialBuffer_IsOpen_0=hn=t.pc,i._emscripten_bind_EmTransportSerialBuffer_Rts_0=mn=t.qc,i._emscripten_bind_EmTransportSerialBuffer_Dtr_0=vn=t.rc,i._emscripten_bind_EmTransportSerialBuffer_IsBreak_0=yn=t.sc,i._emscripten_bind_EmTransportSerialBuffer_BufferSize_0=fn=t.tc,i._emscripten_bind_EmTransportSerialBuffer_GetBaud_0=_n=t.uc,i._emscripten_bind_EmTransportSerialBuffer_GetParity_0=gn=t.vc,i._emscripten_bind_EmTransportSerialBuffer_GetStopBits_0=Sn=t.wc,i._emscripten_bind_EmTransportSerialBuffer_GetDataBits_0=bn=t.xc,i._emscripten_bind_EmTransportSerialBuffer_GetHwrHandshake_0=wn=t.yc,i._emscripten_bind_EmTransportSerialBuffer_GetModeSync_0=Cn=t.zc,i._emscripten_bind_EmTransportSerialBuffer_SetModeSync_1=En=t.Ac,i._emscripten_bind_EmTransportSerialBuffer_IsFrameComplete_0=In=t.Bc,i._emscripten_bind_EmTransportSerialBuffer_SetRequestTransferCallback_1=Dn=t.Cc,i._emscripten_bind_EmTransportSerialBuffer___destroy___0=xn=t.Dc,i._emscripten_bind_GunzipContext_GunzipContext_3=Gn=t.Ec,i._emscripten_bind_GunzipContext_GetState_0=Mn=t.Fc,i._emscripten_bind_GunzipContext_Continue_0=kn=t.Gc,i._emscripten_bind_GunzipContext_GetUncompressedData_0=Pn=t.Hc,i._emscripten_bind_GunzipContext_ReleaseUncompressedData_0=Rn=t.Ic,i._emscripten_bind_GunzipContext_GetUncompressedSize_0=zn=t.Jc,i._emscripten_bind_GunzipContext_GetError_0=Hn=t.Kc,i._emscripten_bind_GunzipContext___destroy___0=Tn=t.Lc,i._emscripten_bind_ZipfileWalker_ZipfileWalker_2=Nn=t.Mc,i._emscripten_bind_ZipfileWalker_GetState_0=An=t.Nc,i._emscripten_bind_ZipfileWalker_Next_0=Un=t.Oc,i._emscripten_bind_ZipfileWalker_GetTotalEntries_0=Bn=t.Pc,i._emscripten_bind_ZipfileWalker_GetCurrentEntrySize_0=Fn=t.Qc,i._emscripten_bind_ZipfileWalker_GetCurrentEntryName_0=Ln=t.Rc,i._emscripten_bind_ZipfileWalker_GetCurrentEntryContent_0=jn=t.Sc,i._emscripten_bind_ZipfileWalker___destroy___0=On=t.Tc,i._emscripten_bind_SessionFile5_SessionFile5_0=Wn=t.Uc,i._emscripten_bind_SessionFile5_IsSessionFile_2=Vn=t.Vc,i._emscripten_bind_SessionFile5_GetDeviceId_0=qn=t.Wc,i._emscripten_bind_SessionFile5_SetDeviceId_1=Kn=t.Xc,i._emscripten_bind_SessionFile5_GetMetadata_0=$n=t.Yc,i._emscripten_bind_SessionFile5_GetMetadataSize_0=Jn=t.Zc,i._emscripten_bind_SessionFile5_SetMetadata_2=Qn=t._c,i._emscripten_bind_SessionFile5_GetNor_0=Yn=t.$c,i._emscripten_bind_SessionFile5_GetNorSize_0=Zn=t.ad,i._emscripten_bind_SessionFile5_SetNor_2=Xn=t.bd,i._emscripten_bind_SessionFile5_GetNand_0=tr=t.cd,i._emscripten_bind_SessionFile5_GetNandSize_0=er=t.dd,i._emscripten_bind_SessionFile5_SetNand_2=ir=t.ed,i._emscripten_bind_SessionFile5_GetMemory_0=nr=t.fd,i._emscripten_bind_SessionFile5_GetMemorySize_0=rr=t.gd,i._emscripten_bind_SessionFile5_SetMemory_2=or=t.hd,i._emscripten_bind_SessionFile5_GetSavestate_0=sr=t.id,i._emscripten_bind_SessionFile5_GetSavestateSize_0=ar=t.jd,i._emscripten_bind_SessionFile5_SetSavestate_2=cr=t.kd,i._emscripten_bind_SessionFile5_GetRamSize_0=pr=t.ld,i._emscripten_bind_SessionFile5_SetRamSize_1=ur=t.md,i._emscripten_bind_SessionFile5_Serialize_0=lr=t.nd,i._emscripten_bind_SessionFile5_GetSerializedSession_0=dr=t.od,i._emscripten_bind_SessionFile5_GetSerializedSessionSize_0=hr=t.pd,i._emscripten_bind_SessionFile5_GetVersion_0=mr=t.qd,i._emscripten_bind_SessionFile5_Deserialize_2=vr=t.rd,i._emscripten_bind_SessionFile5___destroy___0=yr=t.sd,i._emscripten_bind_RomInfo5_RomInfo5_2=fr=t.td,i._emscripten_bind_RomInfo5_IsValid_0=_r=t.ud,i._emscripten_bind_RomInfo5_GetCardName_0=gr=t.vd,i._emscripten_bind_RomInfo5_GetManufacturer_0=Sr=t.wd,i._emscripten_bind_RomInfo5_GetRomName_0=br=t.xd,i._emscripten_bind_RomInfo5_GetCompanyId_0=wr=t.yd,i._emscripten_bind_RomInfo5_GetHalId_0=Cr=t.zd,i._emscripten_bind_RomInfo5_NeedsNand_0=Er=t.Ad,i._emscripten_bind_RomInfo5_GetDeviceType_0=Ir=t.Bd,i._emscripten_bind_RomInfo5_GetRecommendedRamSize_0=Dr=t.Cd,i._emscripten_bind_RomInfo5___destroy___0=xr=t.Dd,Gr=t.Fd,Mr=t.Gd,kr=t.Hd,Pr=t.Id,i.___original_main=t.Jd}(Hr),function(){if(M--,i.monitorRunDependencies?.(M),0==M&&k){var t=k;k=null,t()}}(),Hr}M++,i.monitorRunDependencies?.(M);var e,n={a:zr};return i.instantiateWasm?new Promise((e,r)=>{i.instantiateWasm(n,(i,n)=>{e(t(i))})}):(G??=(e="cloudpilot_web.wasm",i.locateFile?i.locateFile(e,p):p+e),t((await R(u,G,n)).instance))}();function Tr(){}function Nr(t){return(t||Tr).__cache__}function Ar(t,e){var i=Nr(e),n=i[t];return n||((n=Object.create((e||Tr).prototype)).ptr=t,i[t]=n)}!function(){if(i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.shift()()}(),function t(){function e(){i.calledRun=!0,C||(D=!0,I(),N(vt),Hr.v(),I(),d?.(i),i.onRuntimeInitialized?.(),i.noInitialRun||function(){var t=bt;try{var e=t(0,0);return et(e),e}catch(t){return Z(t)}}(),function(){if(I(),i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)U(i.postRun.shift());N(A)}())}var n;M>0?k=t:(kr(),0==(n=Gr())&&(n+=4),_[n>>2]=34821223,_[n+4>>2]=2310721022,_[0]=1668509029,function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)F(i.preRun.shift());N(B)}(),M>0?k=t:(i.setStatus?(i.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>i.setStatus(""),1),e()},1)):e(),I()))}(),Tr.prototype=Object.create(Tr.prototype),Tr.prototype.constructor=Tr,Tr.prototype.__class__=Tr,Tr.__cache__={},i.WrapperObject=Tr,i.getCache=Nr,i.wrapPointer=Ar,i.castObject=function(t,e){return Ar(t.ptr,e)},i.NULL=Ar(0),i.destroy=function(t){if(!t.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";t.__destroy__(),delete Nr(t.__class__)[t.ptr]},i.compare=function(t,e){return t.ptr===e.ptr},i.getPointer=function(t){return t.ptr},i.getClass=function(t){return t.__class__};var Ur={buffer:0,size:0,pos:0,temps:[],needed:0,prepare(){if(Ur.needed){for(var t=0;t<Ur.temps.length;t++)i._webidl_free(Ur.temps[t]);Ur.temps.length=0,i._webidl_free(Ur.buffer),Ur.buffer=0,Ur.size+=Ur.needed,Ur.needed=0}Ur.buffer||(Ur.size+=128,Ur.buffer=i._webidl_malloc(Ur.size),E(Ur.buffer)),Ur.pos=0},alloc(t,e){E(Ur.buffer);var n,r=e.BYTES_PER_ELEMENT,o=t.length*r;return o=ct(o,8),Ur.pos+o>=Ur.size?(E(o>0),Ur.needed+=o,n=i._webidl_malloc(o),Ur.temps.push(n)):(n=Ur.buffer+Ur.pos,Ur.pos+=o),n},copy(t,e,i){i/=e.BYTES_PER_ELEMENT;for(var n=0;n<t.length;n++)e[i+n]=t[n]}};function Br(t){if("string"==typeof t){var e=(r=dt(n=t)+1,o=new Array(r),rt(n,o,0,o.length),o),i=Ur.alloc(e,v);return Ur.copy(e,v,i),i}var n,r,o;return t}function Fr(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Lr(){this.ptr=Ct(),Nr(Lr)[this.ptr]=this}function jr(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Ne(t,e),Nr(jr)[this.ptr]=this}function Or(){throw"cannot construct a Frame, no constructor in IDL"}function Wr(){throw"cannot construct a DbBackup, no constructor in IDL"}function Vr(){throw"cannot construct a SuspendContextClipboardCopy, no constructor in IDL"}function qr(){throw"cannot construct a SuspendContextClipboardPaste, no constructor in IDL"}function Kr(){throw"cannot construct a SuspendContextNetworkConnect, no constructor in IDL"}function $r(){throw"cannot construct a SuspendContextNetworkRpc, no constructor in IDL"}function Jr(){throw"cannot construct a SuspendContextSerialSync, no constructor in IDL"}function Qr(){throw"cannot construct a SuspendContext, no constructor in IDL"}function Yr(){this.ptr=Ui(),Nr(Yr)[this.ptr]=this}function Zr(t){Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),this.ptr=sn(t),Nr(Zr)[this.ptr]=this}function Xr(){throw"cannot construct a EmTransportSerialBuffer, no constructor in IDL"}function to(t,e,i){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),i&&"object"==typeof i&&(i=i.ptr),this.ptr=Gn(t,e,i),Nr(to)[this.ptr]=this}function eo(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Nn(t,e),Nr(eo)[this.ptr]=this}function io(){this.ptr=Wn(),Nr(io)[this.ptr]=this}function no(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=fr(t,e),Nr(no)[this.ptr]=this}return Fr.prototype=Object.create(Tr.prototype),Fr.prototype.constructor=Fr,Fr.prototype.__class__=Fr,Fr.__cache__={},i.VoidPtr=Fr,Fr.prototype.__destroy__=Fr.prototype.__destroy__=function(){var t=this.ptr;wt(t)},Lr.prototype=Object.create(Tr.prototype),Lr.prototype.constructor=Lr,Lr.prototype.__class__=Lr,Lr.__cache__={},i.Cloudpilot=Lr,Lr.prototype.Malloc=Lr.prototype.Malloc=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Ar(Et(e,t),Fr)},Lr.prototype.Free=Lr.prototype.Free=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),It(e,t)},Lr.prototype.Nullptr=Lr.prototype.Nullptr=function(){var t=this.ptr;return Ar(Dt(t),Fr)},Lr.prototype.EnableLogging=Lr.prototype.EnableLogging=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),xt(e,t)},Lr.prototype.InitializeSession=Lr.prototype.InitializeSession=function(t,e,i){var n=this.ptr;return Ur.prepare(),t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),i=i&&"object"==typeof i?i.ptr:Br(i),!!Gt(n,t,e,i)},Lr.prototype.GetCyclesPerSecond=Lr.prototype.GetCyclesPerSecond=function(){var t=this.ptr;return Mt(t)},Lr.prototype.RunEmulation=Lr.prototype.RunEmulation=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),kt(e,t)},Lr.prototype.SetClockFactor=Lr.prototype.SetClockFactor=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Pt(e,t)},Lr.prototype.CopyFrame=Lr.prototype.CopyFrame=function(){var t=this.ptr;return Ar(Rt(t),Or)},Lr.prototype.IsScreenDirty=Lr.prototype.IsScreenDirty=function(){var t=this.ptr;return!!zt(t)},Lr.prototype.MarkScreenClean=Lr.prototype.MarkScreenClean=function(){var t=this.ptr;Ht(t)},Lr.prototype.MinMemoryForDevice=Lr.prototype.MinMemoryForDevice=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Tt(e,t)},Lr.prototype.FramebufferSizeForDevice=Lr.prototype.FramebufferSizeForDevice=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Nt(e,t)},Lr.prototype.TotalMemoryForDevice=Lr.prototype.TotalMemoryForDevice=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),At(e,t)},Lr.prototype.QueuePenMove=Lr.prototype.QueuePenMove=function(t,e){var i=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ut(i,t,e)},Lr.prototype.QueuePenUp=Lr.prototype.QueuePenUp=function(){var t=this.ptr;Bt(t)},Lr.prototype.QueueButtonDown=Lr.prototype.QueueButtonDown=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Ft(e,t)},Lr.prototype.QueueButtonUp=Lr.prototype.QueueButtonUp=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Lt(e,t)},Lr.prototype.QueueKeyboardEvent=Lr.prototype.QueueKeyboardEvent=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),jt(e,t)},Lr.prototype.IsPowerOff=Lr.prototype.IsPowerOff=function(){var t=this.ptr;return!!Ot(t)},Lr.prototype.IsUIInitialized=Lr.prototype.IsUIInitialized=function(){var t=this.ptr;return!!Wt(t)},Lr.prototype.GetOSVersion=Lr.prototype.GetOSVersion=function(){var t=this.ptr;return Vt(t)},Lr.prototype.IsSetupComplete=Lr.prototype.IsSetupComplete=function(){var t=this.ptr;return!!qt(t)},Lr.prototype.Reset=Lr.prototype.Reset=function(){var t=this.ptr;Kt(t)},Lr.prototype.ResetNoExtensions=Lr.prototype.ResetNoExtensions=function(){var t=this.ptr;$t(t)},Lr.prototype.ResetHard=Lr.prototype.ResetHard=function(){var t=this.ptr;Jt(t)},Lr.prototype.InstallDb=Lr.prototype.InstallDb=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Qt(i,t,e)},Lr.prototype.GetPalette2bitMapping=Lr.prototype.GetPalette2bitMapping=function(){var t=this.ptr;return Yt(t)},Lr.prototype.GetMemoryPtr=Lr.prototype.GetMemoryPtr=function(){var t=this.ptr;return Ar(Zt(t),Fr)},Lr.prototype.GetDirtyPagesPtr=Lr.prototype.GetDirtyPagesPtr=function(){var t=this.ptr;return Ar(Xt(t),Fr)},Lr.prototype.GetMemorySize=Lr.prototype.GetMemorySize=function(){var t=this.ptr;return te(t)},Lr.prototype.ImportMemoryImage=Lr.prototype.ImportMemoryImage=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ee(i,t,e)},Lr.prototype.GetRomPtr=Lr.prototype.GetRomPtr=function(){var t=this.ptr;return Ar(ie(t),Fr)},Lr.prototype.GetRomSize=Lr.prototype.GetRomSize=function(){var t=this.ptr;return ne(t)},Lr.prototype.GetSavestatePtr=Lr.prototype.GetSavestatePtr=function(){var t=this.ptr;return Ar(re(t),Fr)},Lr.prototype.GetSavestateSize=Lr.prototype.GetSavestateSize=function(){var t=this.ptr;return oe(t)},Lr.prototype.SaveState=Lr.prototype.SaveState=function(){var t=this.ptr;return!!se(t)},Lr.prototype.LoadState=Lr.prototype.LoadState=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ae(i,t,e)},Lr.prototype.GetHotsyncName=Lr.prototype.GetHotsyncName=function(){var t=this.ptr;return V(ce(t))},Lr.prototype.SetHotsyncName=Lr.prototype.SetHotsyncName=function(t){var e=this.ptr;Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),pe(e,t)},Lr.prototype.RegisterPwmHandler=Lr.prototype.RegisterPwmHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ue(e,t)},Lr.prototype.StartBackup=Lr.prototype.StartBackup=function(){var t=this.ptr;return Ar(le(t),Wr)},Lr.prototype.SetClipboardIntegration=Lr.prototype.SetClipboardIntegration=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),de(e,t)},Lr.prototype.GetClipboardIntegration=Lr.prototype.GetClipboardIntegration=function(){var t=this.ptr;return!!he(t)},Lr.prototype.IsSuspended=Lr.prototype.IsSuspended=function(){var t=this.ptr;return!!me(t)},Lr.prototype.GetSuspendContext=Lr.prototype.GetSuspendContext=function(){var t=this.ptr;return Ar(ve(t),Qr)},Lr.prototype.SetNetworkRedirection=Lr.prototype.SetNetworkRedirection=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ye(e,t)},Lr.prototype.GetNetworkRedirection=Lr.prototype.GetNetworkRedirection=function(){var t=this.ptr;return!!fe(t)},Lr.prototype.RegisterProxyDisconnectHandler=Lr.prototype.RegisterProxyDisconnectHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),_e(e,t)},Lr.prototype.SetHotsyncNameManagement=Lr.prototype.SetHotsyncNameManagement=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ge(e,t)},Lr.prototype.LaunchAppByName=Lr.prototype.LaunchAppByName=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),!!Se(e,t)},Lr.prototype.LaunchAppByDbHeader=Lr.prototype.LaunchAppByDbHeader=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!be(i,t,e)},Lr.prototype.ClearExternalStorage=Lr.prototype.ClearExternalStorage=function(){var t=this.ptr;we(t)},Lr.prototype.AllocateCard=Lr.prototype.AllocateCard=function(t,e){var i=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),e&&"object"==typeof e&&(e=e.ptr),!!Ce(i,t,e)},Lr.prototype.AdoptCard=Lr.prototype.AdoptCard=function(t,e,i){var n=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),e&&"object"==typeof e&&(e=e.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Ee(n,t,e,i)},Lr.prototype.MountCard=Lr.prototype.MountCard=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),!!Ie(e,t)},Lr.prototype.RemoveCard=Lr.prototype.RemoveCard=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),!!De(e,t)},Lr.prototype.GetCardData=Lr.prototype.GetCardData=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Ar(xe(e,t),Fr)},Lr.prototype.GetCardDirtyPages=Lr.prototype.GetCardDirtyPages=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Ar(Ge(e,t),Fr)},Lr.prototype.GetCardSize=Lr.prototype.GetCardSize=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Me(e,t)},Lr.prototype.RemountCards=Lr.prototype.RemountCards=function(){var t=this.ptr;ke(t)},Lr.prototype.GetSupportLevel=Lr.prototype.GetSupportLevel=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Pe(e,t)},Lr.prototype.GetMountedKey=Lr.prototype.GetMountedKey=function(){var t=this.ptr;return V(Re(t))},Lr.prototype.GetTransportIR=Lr.prototype.GetTransportIR=function(){var t=this.ptr;return Ar(ze(t),Xr)},Lr.prototype.GetTransportSerial=Lr.prototype.GetTransportSerial=function(){var t=this.ptr;return Ar(He(t),Xr)},Lr.prototype.__destroy__=Lr.prototype.__destroy__=function(){var t=this.ptr;Te(t)},jr.prototype=Object.create(Tr.prototype),jr.prototype.constructor=jr,jr.prototype.__class__=jr,jr.__cache__={},i.RomInfo=jr,jr.prototype.IsValid=jr.prototype.IsValid=function(){var t=this.ptr;return!!Ae(t)},jr.prototype.CardVersion=jr.prototype.CardVersion=function(){var t=this.ptr;return Ue(t)},jr.prototype.CardName=jr.prototype.CardName=function(){var t=this.ptr;return V(Be(t))},jr.prototype.RomVersion=jr.prototype.RomVersion=function(){var t=this.ptr;return Fe(t)},jr.prototype.RomVersionString=jr.prototype.RomVersionString=function(){var t=this.ptr;return V(Le(t))},jr.prototype.Supports=jr.prototype.Supports=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),!!je(e,t)},jr.prototype.__destroy__=jr.prototype.__destroy__=function(){var t=this.ptr;Oe(t)},Or.prototype=Object.create(Tr.prototype),Or.prototype.constructor=Or,Or.prototype.__class__=Or,Or.__cache__={},i.Frame=Or,Or.prototype.GetLineWidth=Or.prototype.GetLineWidth=function(){var t=this.ptr;return We(t)},Or.prototype.GetBpp=Or.prototype.GetBpp=function(){var t=this.ptr;return Ve(t)},Or.prototype.GetLines=Or.prototype.GetLines=function(){var t=this.ptr;return qe(t)},Or.prototype.GetMargin=Or.prototype.GetMargin=function(){var t=this.ptr;return Ke(t)},Or.prototype.GetBytesPerLine=Or.prototype.GetBytesPerLine=function(){var t=this.ptr;return $e(t)},Or.prototype.GetFirstDirtyLine=Or.prototype.GetFirstDirtyLine=function(){var t=this.ptr;return Je(t)},Or.prototype.GetLastDirtyLine=Or.prototype.GetLastDirtyLine=function(){var t=this.ptr;return Qe(t)},Or.prototype.GetHasChanges=Or.prototype.GetHasChanges=function(){var t=this.ptr;return!!Ye(t)},Or.prototype.GetBuffer=Or.prototype.GetBuffer=function(){var t=this.ptr;return Ar(Ze(t),Fr)},Or.prototype.GetBufferSize=Or.prototype.GetBufferSize=function(){var t=this.ptr;return Xe(t)},Or.prototype.GetScaleX=Or.prototype.GetScaleX=function(){var t=this.ptr;return ti(t)},Or.prototype.GetScaleY=Or.prototype.GetScaleY=function(){var t=this.ptr;return ei(t)},Or.prototype.__destroy__=Or.prototype.__destroy__=function(){var t=this.ptr;ii(t)},Wr.prototype=Object.create(Tr.prototype),Wr.prototype.constructor=Wr,Wr.prototype.__class__=Wr,Wr.__cache__={},i.DbBackup=Wr,Wr.prototype.Init=Wr.prototype.Init=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),!!ni(e,t)},Wr.prototype.IsInProgress=Wr.prototype.IsInProgress=function(){var t=this.ptr;return!!ri(t)},Wr.prototype.IsDone=Wr.prototype.IsDone=function(){var t=this.ptr;return!!oi(t)},Wr.prototype.GetCurrentDatabase=Wr.prototype.GetCurrentDatabase=function(){var t=this.ptr;return V(si(t))},Wr.prototype.Save=Wr.prototype.Save=function(){var t=this.ptr;return!!ai(t)},Wr.prototype.Skip=Wr.prototype.Skip=function(){var t=this.ptr;ci(t)},Wr.prototype.GetArchivePtr=Wr.prototype.GetArchivePtr=function(){var t=this.ptr;return Ar(pi(t),Fr)},Wr.prototype.GetArchiveSize=Wr.prototype.GetArchiveSize=function(){var t=this.ptr;return ui(t)},Wr.prototype.__destroy__=Wr.prototype.__destroy__=function(){var t=this.ptr;li(t)},Vr.prototype=Object.create(Tr.prototype),Vr.prototype.constructor=Vr,Vr.prototype.__class__=Vr,Vr.__cache__={},i.SuspendContextClipboardCopy=Vr,Vr.prototype.Cancel=Vr.prototype.Cancel=function(){var t=this.ptr;di(t)},Vr.prototype.Resume=Vr.prototype.Resume=function(){var t=this.ptr;hi(t)},Vr.prototype.GetClipboardContent=Vr.prototype.GetClipboardContent=function(){var t=this.ptr;return V(mi(t))},Vr.prototype.__destroy__=Vr.prototype.__destroy__=function(){var t=this.ptr;vi(t)},qr.prototype=Object.create(Tr.prototype),qr.prototype.constructor=qr,qr.prototype.__class__=qr,qr.__cache__={},i.SuspendContextClipboardPaste=qr,qr.prototype.Cancel=qr.prototype.Cancel=function(){var t=this.ptr;yi(t)},qr.prototype.Resume=qr.prototype.Resume=function(t){var e=this.ptr;Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),fi(e,t)},qr.prototype.__destroy__=qr.prototype.__destroy__=function(){var t=this.ptr;_i(t)},Kr.prototype=Object.create(Tr.prototype),Kr.prototype.constructor=Kr,Kr.prototype.__class__=Kr,Kr.__cache__={},i.SuspendContextNetworkConnect=Kr,Kr.prototype.Cancel=Kr.prototype.Cancel=function(){var t=this.ptr;gi(t)},Kr.prototype.Resume=Kr.prototype.Resume=function(){var t=this.ptr;Si(t)},Kr.prototype.__destroy__=Kr.prototype.__destroy__=function(){var t=this.ptr;bi(t)},$r.prototype=Object.create(Tr.prototype),$r.prototype.constructor=$r,$r.prototype.__class__=$r,$r.__cache__={},i.SuspendContextNetworkRpc=$r,$r.prototype.Cancel=$r.prototype.Cancel=function(){var t=this.ptr;wi(t)},$r.prototype.GetRequestSize=$r.prototype.GetRequestSize=function(){var t=this.ptr;return Ci(t)},$r.prototype.GetRequestData=$r.prototype.GetRequestData=function(){var t=this.ptr;return Ar(Ei(t),Fr)},$r.prototype.ReceiveResponse=$r.prototype.ReceiveResponse=function(t,e){var i=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ii(i,t,e)},$r.prototype.__destroy__=$r.prototype.__destroy__=function(){var t=this.ptr;Di(t)},Jr.prototype=Object.create(Tr.prototype),Jr.prototype.constructor=Jr,Jr.prototype.__class__=Jr,Jr.__cache__={},i.SuspendContextSerialSync=Jr,Jr.prototype.Cancel=Jr.prototype.Cancel=function(){var t=this.ptr;xi(t)},Jr.prototype.Resume=Jr.prototype.Resume=function(){var t=this.ptr;Gi(t)},Jr.prototype.__destroy__=Jr.prototype.__destroy__=function(){var t=this.ptr;Mi(t)},Qr.prototype=Object.create(Tr.prototype),Qr.prototype.constructor=Qr,Qr.prototype.__class__=Qr,Qr.__cache__={},i.SuspendContext=Qr,Qr.prototype.GetKind=Qr.prototype.GetKind=function(){var t=this.ptr;return ki(t)},Qr.prototype.Cancel=Qr.prototype.Cancel=function(){var t=this.ptr;Pi(t)},Qr.prototype.AsContextClipboardCopy=Qr.prototype.AsContextClipboardCopy=function(){var t=this.ptr;return Ar(Ri(t),Vr)},Qr.prototype.AsContextClipboardPaste=Qr.prototype.AsContextClipboardPaste=function(){var t=this.ptr;return Ar(zi(t),qr)},Qr.prototype.AsContextNetworkConnect=Qr.prototype.AsContextNetworkConnect=function(){var t=this.ptr;return Ar(Hi(t),Kr)},Qr.prototype.AsContextNetworkRpc=Qr.prototype.AsContextNetworkRpc=function(){var t=this.ptr;return Ar(Ti(t),$r)},Qr.prototype.AsContextSerialSync=Qr.prototype.AsContextSerialSync=function(){var t=this.ptr;return Ar(Ni(t),Jr)},Qr.prototype.__destroy__=Qr.prototype.__destroy__=function(){var t=this.ptr;Ai(t)},Yr.prototype=Object.create(Tr.prototype),Yr.prototype.constructor=Yr,Yr.prototype.__class__=Yr,Yr.__cache__={},i.SessionImage=Yr,Yr.prototype.GetDeviceId=Yr.prototype.GetDeviceId=function(){var t=this.ptr;return V(Bi(t))},Yr.prototype.SetDeviceId=Yr.prototype.SetDeviceId=function(t){var e=this.ptr;return Ur.prepare(),t=t&&"object"==typeof t?t.ptr:Br(t),Ar(Fi(e,t),Yr)},Yr.prototype.GetRomImage=Yr.prototype.GetRomImage=function(){var t=this.ptr;return Ar(Li(t),Fr)},Yr.prototype.GetRomImageSize=Yr.prototype.GetRomImageSize=function(){var t=this.ptr;return ji(t)},Yr.prototype.SetRomImage=Yr.prototype.SetRomImage=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(Oi(i,t,e),Yr)},Yr.prototype.GetMemoryImage=Yr.prototype.GetMemoryImage=function(){var t=this.ptr;return Ar(Wi(t),Fr)},Yr.prototype.GetMemoryImageSize=Yr.prototype.GetMemoryImageSize=function(){var t=this.ptr;return Vi(t)},Yr.prototype.SetMemoryImage=Yr.prototype.SetMemoryImage=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(qi(i,t,e),Yr)},Yr.prototype.GetMetadata=Yr.prototype.GetMetadata=function(){var t=this.ptr;return Ar(Ki(t),Fr)},Yr.prototype.GetMetadataSize=Yr.prototype.GetMetadataSize=function(){var t=this.ptr;return $i(t)},Yr.prototype.SetMetadata=Yr.prototype.SetMetadata=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(Ji(i,t,e),Yr)},Yr.prototype.GetSavestate=Yr.prototype.GetSavestate=function(){var t=this.ptr;return Ar(Qi(t),Fr)},Yr.prototype.GetSavestateSize=Yr.prototype.GetSavestateSize=function(){var t=this.ptr;return Yi(t)},Yr.prototype.SetSavestate=Yr.prototype.SetSavestate=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(Zi(i,t,e),Yr)},Yr.prototype.GetVersion=Yr.prototype.GetVersion=function(){var t=this.ptr;return Xi(t)},Yr.prototype.Serialize=Yr.prototype.Serialize=function(){var t=this.ptr;return!!tn(t)},Yr.prototype.GetSerializedImage=Yr.prototype.GetSerializedImage=function(){var t=this.ptr;return Ar(en(t),Fr)},Yr.prototype.GetSerializedImageSize=Yr.prototype.GetSerializedImageSize=function(){var t=this.ptr;return nn(t)},Yr.prototype.Deserialize=Yr.prototype.Deserialize=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!rn(i,t,e)},Yr.prototype.__destroy__=Yr.prototype.__destroy__=function(){var t=this.ptr;on(t)},Zr.prototype=Object.create(Tr.prototype),Zr.prototype.constructor=Zr,Zr.prototype.__class__=Zr,Zr.__cache__={},i.SkinLoader=Zr,Zr.prototype.GetData=Zr.prototype.GetData=function(){var t=this.ptr;return Ar(an(t),Fr)},Zr.prototype.GetSize=Zr.prototype.GetSize=function(){var t=this.ptr;return cn(t)},Zr.prototype.__destroy__=Zr.prototype.__destroy__=function(){var t=this.ptr;pn(t)},Xr.prototype=Object.create(Tr.prototype),Xr.prototype.constructor=Xr,Xr.prototype.__class__=Xr,Xr.__cache__={},i.EmTransportSerialBuffer=Xr,Xr.prototype.RxBytesPending=Xr.prototype.RxBytesPending=function(){var t=this.ptr;return un(t)},Xr.prototype.Receive=Xr.prototype.Receive=function(){var t=this.ptr;return Ar(ln(t),Fr)},Xr.prototype.Send=Xr.prototype.Send=function(t,e,i){var n=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),i&&"object"==typeof i&&(i=i.ptr),dn(n,t,e,i)},Xr.prototype.IsOpen=Xr.prototype.IsOpen=function(){var t=this.ptr;return!!hn(t)},Xr.prototype.Rts=Xr.prototype.Rts=function(){var t=this.ptr;return mn(t)},Xr.prototype.Dtr=Xr.prototype.Dtr=function(){var t=this.ptr;return!!vn(t)},Xr.prototype.IsBreak=Xr.prototype.IsBreak=function(){var t=this.ptr;return!!yn(t)},Xr.prototype.BufferSize=Xr.prototype.BufferSize=function(){var t=this.ptr;return fn(t)},Xr.prototype.GetBaud=Xr.prototype.GetBaud=function(){var t=this.ptr;return _n(t)},Xr.prototype.GetParity=Xr.prototype.GetParity=function(){var t=this.ptr;return gn(t)},Xr.prototype.GetStopBits=Xr.prototype.GetStopBits=function(){var t=this.ptr;return Sn(t)},Xr.prototype.GetDataBits=Xr.prototype.GetDataBits=function(){var t=this.ptr;return bn(t)},Xr.prototype.GetHwrHandshake=Xr.prototype.GetHwrHandshake=function(){var t=this.ptr;return wn(t)},Xr.prototype.GetModeSync=Xr.prototype.GetModeSync=function(){var t=this.ptr;return!!Cn(t)},Xr.prototype.SetModeSync=Xr.prototype.SetModeSync=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),En(e,t)},Xr.prototype.IsFrameComplete=Xr.prototype.IsFrameComplete=function(){var t=this.ptr;return!!In(t)},Xr.prototype.SetRequestTransferCallback=Xr.prototype.SetRequestTransferCallback=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Dn(e,t)},Xr.prototype.__destroy__=Xr.prototype.__destroy__=function(){var t=this.ptr;xn(t)},to.prototype=Object.create(Tr.prototype),to.prototype.constructor=to,to.prototype.__class__=to,to.__cache__={},i.GunzipContext=to,to.prototype.GetState=to.prototype.GetState=function(){var t=this.ptr;return Mn(t)},to.prototype.Continue=to.prototype.Continue=function(){var t=this.ptr;return kn(t)},to.prototype.GetUncompressedData=to.prototype.GetUncompressedData=function(){var t=this.ptr;return Ar(Pn(t),Fr)},to.prototype.ReleaseUncompressedData=to.prototype.ReleaseUncompressedData=function(){var t=this.ptr;return Ar(Rn(t),Fr)},to.prototype.GetUncompressedSize=to.prototype.GetUncompressedSize=function(){var t=this.ptr;return zn(t)},to.prototype.GetError=to.prototype.GetError=function(){var t=this.ptr;return V(Hn(t))},to.prototype.__destroy__=to.prototype.__destroy__=function(){var t=this.ptr;Tn(t)},eo.prototype=Object.create(Tr.prototype),eo.prototype.constructor=eo,eo.prototype.__class__=eo,eo.__cache__={},i.ZipfileWalker=eo,eo.prototype.GetState=eo.prototype.GetState=function(){var t=this.ptr;return An(t)},eo.prototype.Next=eo.prototype.Next=function(){var t=this.ptr;return Un(t)},eo.prototype.GetTotalEntries=eo.prototype.GetTotalEntries=function(){var t=this.ptr;return Bn(t)},eo.prototype.GetCurrentEntrySize=eo.prototype.GetCurrentEntrySize=function(){var t=this.ptr;return Fn(t)},eo.prototype.GetCurrentEntryName=eo.prototype.GetCurrentEntryName=function(){var t=this.ptr;return V(Ln(t))},eo.prototype.GetCurrentEntryContent=eo.prototype.GetCurrentEntryContent=function(){var t=this.ptr;return Ar(jn(t),Fr)},eo.prototype.__destroy__=eo.prototype.__destroy__=function(){var t=this.ptr;On(t)},io.prototype=Object.create(Tr.prototype),io.prototype.constructor=io,io.prototype.__class__=io,io.__cache__={},i.SessionFile5=io,io.prototype.IsSessionFile=io.prototype.IsSessionFile=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!Vn(i,t,e)},io.prototype.GetDeviceId=io.prototype.GetDeviceId=function(){var t=this.ptr;return qn(t)},io.prototype.SetDeviceId=io.prototype.SetDeviceId=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Ar(Kn(e,t),io)},io.prototype.GetMetadata=io.prototype.GetMetadata=function(){var t=this.ptr;return Ar($n(t),Fr)},io.prototype.GetMetadataSize=io.prototype.GetMetadataSize=function(){var t=this.ptr;return Jn(t)},io.prototype.SetMetadata=io.prototype.SetMetadata=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(Qn(i,t,e),io)},io.prototype.GetNor=io.prototype.GetNor=function(){var t=this.ptr;return Ar(Yn(t),Fr)},io.prototype.GetNorSize=io.prototype.GetNorSize=function(){var t=this.ptr;return Zn(t)},io.prototype.SetNor=io.prototype.SetNor=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(Xn(i,t,e),io)},io.prototype.GetNand=io.prototype.GetNand=function(){var t=this.ptr;return Ar(tr(t),Fr)},io.prototype.GetNandSize=io.prototype.GetNandSize=function(){var t=this.ptr;return er(t)},io.prototype.SetNand=io.prototype.SetNand=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(ir(i,t,e),io)},io.prototype.GetMemory=io.prototype.GetMemory=function(){var t=this.ptr;return Ar(nr(t),Fr)},io.prototype.GetMemorySize=io.prototype.GetMemorySize=function(){var t=this.ptr;return rr(t)},io.prototype.SetMemory=io.prototype.SetMemory=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(or(i,t,e),io)},io.prototype.GetSavestate=io.prototype.GetSavestate=function(){var t=this.ptr;return Ar(sr(t),Fr)},io.prototype.GetSavestateSize=io.prototype.GetSavestateSize=function(){var t=this.ptr;return ar(t)},io.prototype.SetSavestate=io.prototype.SetSavestate=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ar(cr(i,t,e),io)},io.prototype.GetRamSize=io.prototype.GetRamSize=function(){var t=this.ptr;return pr(t)},io.prototype.SetRamSize=io.prototype.SetRamSize=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Ar(ur(e,t),io)},io.prototype.Serialize=io.prototype.Serialize=function(){var t=this.ptr;return!!lr(t)},io.prototype.GetSerializedSession=io.prototype.GetSerializedSession=function(){var t=this.ptr;return Ar(dr(t),Fr)},io.prototype.GetSerializedSessionSize=io.prototype.GetSerializedSessionSize=function(){var t=this.ptr;return hr(t)},io.prototype.GetVersion=io.prototype.GetVersion=function(){var t=this.ptr;return mr(t)},io.prototype.Deserialize=io.prototype.Deserialize=function(t,e){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!vr(i,t,e)},io.prototype.__destroy__=io.prototype.__destroy__=function(){var t=this.ptr;yr(t)},no.prototype=Object.create(Tr.prototype),no.prototype.constructor=no,no.prototype.__class__=no,no.__cache__={},i.RomInfo5=no,no.prototype.IsValid=no.prototype.IsValid=function(){var t=this.ptr;return!!_r(t)},no.prototype.GetCardName=no.prototype.GetCardName=function(){var t=this.ptr;return V(gr(t))},no.prototype.GetManufacturer=no.prototype.GetManufacturer=function(){var t=this.ptr;return V(Sr(t))},no.prototype.GetRomName=no.prototype.GetRomName=function(){var t=this.ptr;return V(br(t))},no.prototype.GetCompanyId=no.prototype.GetCompanyId=function(){var t=this.ptr;return wr(t)},no.prototype.GetHalId=no.prototype.GetHalId=function(){var t=this.ptr;return Cr(t)},no.prototype.NeedsNand=no.prototype.NeedsNand=function(){var t=this.ptr;return!!Er(t)},no.prototype.GetDeviceType=no.prototype.GetDeviceType=function(){var t=this.ptr;return Ir(t)},no.prototype.GetRecommendedRamSize=no.prototype.GetRecommendedRamSize=function(){var t=this.ptr;return Dr(t)},no.prototype.__destroy__=no.prototype.__destroy__=function(){var t=this.ptr;xr(t)},D?i:new Promise((t,e)=>{d=t,h=e})});t.exports=i,t.exports.default=i}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.m=t,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.u=t=>({744:"pcm-worklet",893:"uarm-worker"}[t]+".js"),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),i.b=document.baseURI||self.location.href;var n={};return(()=>{"use strict";function t(t,e,i,n){var r,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}function e(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}i.r(n),i.d(n,{Button:()=>wt,DeviceId:()=>r,DeviceOrientation:()=>g,VERSION:()=>Ct,createEmulator:()=>It,createEmulatorFactory:()=>Dt}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var r,o,s=i(666),a=i.n(s),c=i(84);(o=r||(r={})).palmPilot="PalmPilot",o.pilot="Pilot",o.iii="PalmIII",o.palmVx="PalmVx",o.palmV="PalmV",o.palmVII="PalmVII",o.palmVIIEZ="PalmVIIEZ",o.palmVIIx="PalmVIIx",o.iiic="PalmIIIc",o.iiix="PalmIIIx",o.iiixe="PalmIIIxe",o.iiie="PalmIIIe",o.m500="PalmM500",o.m505="PalmM505",o.m515="PalmM515",o.m520="PalmM520",o.m100="PalmM100",o.m105="PalmM105",o.m125="PalmM125",o.m130="PalmM130",o.i705="Palmi705",o.i710="PalmI710",o.handera330="HandEra330",o.handera330c="HandEra330c",o.pegS300="PEG-S300",o.pegS320="PEG-S320",o.pegS500c="PEG-S500C",o.pegT400="PEG-T400",o.pegN600c="PEG-N600C/N610C",o.pegT600c="PEG-T600",o.pegN700c="PEG-N700C/N710C",o.pegT650c="YSX1230",o.pegNR70="NR70",o.acerS11="Acer-S11",o.lp168="Legend-P168",o.te2="Tungsten-E2",o.frankene2="Franken-E2";let p=0;const u=[r.palmPilot,r.pilot,r.iii,r.palmVx,r.palmV,r.palmVII,r.palmVIIEZ,r.palmVIIx,r.iiixe,r.iiix,r.iiie,r.m500,r.m505,r.m515,r.m520,r.iiic,r.m100,r.m105,r.m125,r.m130,r.i705,r.i710,r.handera330,r.handera330c,r.pegS300,r.pegS320,r.pegS500c,r.pegT400,r.pegN600c,r.pegT600c,r.pegN700c,r.pegT650c,r.pegNR70,r.acerS11,r.lp168];function l(){return(t,e,i)=>{const n=i.value;return i.value=function(t,e){return this.guard(()=>n.call(this,t,e))},i}}function d(t){switch(t){case 0:return r.te2;case 1:return r.frankene2;default:return}}class h{constructor(t){this.module=t,this.fatalErrorEvent=new c.J,this.pwmUpdateEvent=new c.J,this.proxyDisconnectEvent=new c.J,this.amIdead=!1,this.cloudpilot=new t.Cloudpilot,this.cloudpilot.RegisterPwmHandler(t.addFunction((t,e)=>this.pwmUpdateEvent.dispatch({frequency:t,dutyCycle:e}),"vdd")),this.cloudpilot.RegisterProxyDisconnectHandler(t.addFunction(()=>this.proxyDisconnectEvent.dispatch(),"v")),this.transportIR=this.wrapTransport(this.cloudpilot.GetTransportIR()),this.transportSerial=this.wrapTransport(this.cloudpilot.GetTransportSerial())}static create(t){return e(this,void 0,void 0,function*(){const e=p++;return new h(yield a()(Object.assign(Object.assign({print:t=>console.log(`${e}: ${t}`),printErr:t=>console.warn(`${e}: ${t}`)},"string"==typeof t?{locateFile:()=>t}:{}),"function"==typeof t?{instantiateWasm:t}:{})))})}destroy(){this.module.destroy(this.cloudpilot)}hasFatalError(){return this.amIdead}enableLogging(t){this.cloudpilot.EnableLogging(t)}getRomInfo(t){const e=this.copyIn(t);try{return this.getRomInfoCloudpilot(e,t.length)||this.getRomInfoUarm(e,t.length)}finally{this.cloudpilot.Free(e)}}initializeSession(t,e){const i=this.copyIn(t);return this.cloudpilot.InitializeSession(i,t.length,e)}cyclesPerSecond(){return this.cloudpilot.GetCyclesPerSecond()}runEmulation(t){return this.cloudpilot.RunEmulation(t)}getFrame(){const t=this.cloudpilot.CopyFrame(),e=this.module.getPointer(t.GetBuffer());return{bpp:t.GetBpp(),bytesPerLine:t.GetBytesPerLine(),lines:t.GetLines(),lineWidth:t.GetLineWidth(),margin:t.GetMargin(),firstDirtyLine:t.GetFirstDirtyLine(),lastDirtyLine:t.GetLastDirtyLine(),hasChanges:t.GetHasChanges(),scaleX:t.GetScaleX(),scaleY:t.GetScaleY(),buffer:this.module.HEAPU8.subarray(e,e+t.GetBufferSize())}}isScreenDirty(){return this.cloudpilot.IsScreenDirty()}markScreenClean(){this.cloudpilot.MarkScreenClean()}minRamForDevice(t){return 1024*this.cloudpilot.MinMemoryForDevice(t)}framebufferSizeForDevice(t){return 1024*this.cloudpilot.FramebufferSizeForDevice(t)}totalMemorySizeForDevice(t){return 1024*this.cloudpilot.TotalMemoryForDevice(t)}queuePenMove(t,e){this.cloudpilot.QueuePenMove(t,e)}queuePenUp(){this.cloudpilot.QueuePenUp()}queueButtonDown(t){this.cloudpilot.QueueButtonDown(t)}queueButtonUp(t){this.cloudpilot.QueueButtonUp(t)}queueKeyboardEvent(t){this.cloudpilot.QueueKeyboardEvent(t)}isPowerOff(){return!!this.cloudpilot.IsPowerOff()}isUiInitialized(){return!!this.cloudpilot.IsUIInitialized()}isSetupComplete(){return!!this.cloudpilot.IsSetupComplete()}getOSVersion(){return this.cloudpilot.GetOSVersion()}reset(){this.cloudpilot.Reset()}resetNoExtensions(){this.cloudpilot.ResetNoExtensions()}resetHard(){this.cloudpilot.ResetHard()}installDb(t){const e=this.copyIn(t),i=this.cloudpilot.InstallDb(e,t.length);return this.cloudpilot.Free(e),i}getPalette2bitMapping(){return this.cloudpilot.GetPalette2bitMapping()}getMemory(){const t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetMemorySize())}getMemory32(){let t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());if(3&t)throw new Error("unaligned pointer");return t>>>=2,this.module.HEAPU32.subarray(t,t+(this.cloudpilot.GetMemorySize()>>>2))}getDirtyPages(){const t=this.module.getPointer(this.cloudpilot.GetDirtyPagesPtr()),e=this.cloudpilot.GetMemorySize(),i=(e>>>13)+(e%8192==0?0:1);return this.module.HEAPU8.subarray(t,t+i)}loadMemory(t){const e=this.getMemory32();if((()=>{if(t.length!==e.length||t.length<256)return!1;for(let i=256;i>0;i--){if(t[t.length-i]!==e[e.length-i])return!1;if(4294967295===e[e.length-i])break}return!0})())return e.set(t),!0;{const e=this.copyIn32(t),i=this.cloudpilot.ImportMemoryImage(e,t.length<<2);return this.cloudpilot.Free(e),i}}getRomImage(){const t=this.module.getPointer(this.cloudpilot.GetRomPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetRomSize())}getSavestate(){const t=this.module.getPointer(this.cloudpilot.GetSavestatePtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetSavestateSize())}saveState(){return!!this.cloudpilot.SaveState()}loadState(t){const e=this.copyIn(t),i=this.cloudpilot.LoadState(e,t.length);return this.cloudpilot.Free(e),i}getHotsyncName(){return this.cloudpilot.GetHotsyncName()}setClockFactor(t){this.cloudpilot.SetClockFactor(t)}setHotsyncName(t){this.cloudpilot.SetHotsyncName(t)}backup(t){return e(this,void 0,void 0,function*(){const e=this.guard(()=>this.cloudpilot.StartBackup());try{return yield t(this.wrap(e))}finally{this.module.destroy(e)}})}getArchive(t){const e=t.GetArchiveSize();return this.copyOut(t.GetArchivePtr(),e)}setClipboardIntegration(t){this.cloudpilot.SetClipboardIntegration(t)}getClipboardIntegration(){return this.cloudpilot.GetClipboardIntegration()}isSuspended(){return this.cloudpilot.IsSuspended()}getSuspendKind(){return this.cloudpilot.IsSuspended()?this.cloudpilot.GetSuspendContext().GetKind():void 0}cancelSuspend(){this.cloudpilot.GetSuspendContext().Cancel()}getSuspendContextClipboardCopy(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardCopy())}getSuspendContextClipboardPaste(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardPaste())}setNetworkRedirection(t){this.cloudpilot.SetNetworkRedirection(t)}getNetworkRedirection(){return this.cloudpilot.GetNetworkRedirection()}getSuspendContextNetworkConnect(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkConnect())}getSuspendContextNetworkRpc(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkRpc())}getSuspendContextSerialSync(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextSerialSync())}copyBuffer(t){return this.copyIn(t)}freeBuffer(t){t&&this.cloudpilot.Free(t)}setHotsyncNameManagement(t){this.cloudpilot.SetHotsyncNameManagement(t)}resolveBuffer(t,e){const i=this.module.getPointer(t);return this.module.HEAPU8.subarray(i,i+e)}withZipfileWalker(t,i){return e(this,void 0,void 0,function*(){const e=this.guard(()=>{const e=this.copyIn(t),i=new this.module.ZipfileWalker(t.length,e);return this.cloudpilot.Free(e),i});try{return yield i(function(t,e){return Object.setPrototypeOf({GetCurrentEntryContent:()=>{const i=e.getPointer(t.GetCurrentEntryContent()),n=t.GetCurrentEntrySize();return i>0&&n>0?e.HEAPU8.subarray(i,i+n):void 0}},t)}(this.wrap(e),this.module))}finally{this.module.destroy(e)}})}serializeSessionImage(t){var e,i,n,r,o;if("cloudpilot"===t.engine&&t.nand)throw new Error("cloudpilot image cannot have nand");const s=this.copyIn(t.rom),a=t.memory&&this.copyIn(t.memory),c=t.savestate&&this.copyIn(t.savestate),p=t.nand&&this.copyIn(t.nand);let u,l;if(void 0!==t.metadata){const e=(new TextEncoder).encode(JSON.stringify(t.metadata));l=e.length,u=this.copyIn(e)}try{switch(t.engine){case"cloudpilot":return this.serializeSessionImageCloudpilot(t.deviceId,{rom:s,romLength:t.rom.length,memory:a,memoryLength:null===(e=t.memory)||void 0===e?void 0:e.length,savestate:c,savestateLength:null===(i=t.savestate)||void 0===i?void 0:i.length,metadata:u,metadataLength:l});case"uarm":return this.serializeSessionImageUarm(t.deviceId,{rom:s,romLength:t.rom.length,nand:p,nandLength:null===(n=t.nand)||void 0===n?void 0:n.length,memory:a,memoryLength:null===(r=t.memory)||void 0===r?void 0:r.length,savestate:c,savestateLength:null===(o=t.savestate)||void 0===o?void 0:o.length,metadata:u,metadataLength:l});default:throw new Error("unreachable")}}finally{[s,p,a,c,u].forEach(t=>this.freeBuffer(t))}}deserializeSessionImage(t){if(!t)return;const e=function(t){if(!(t.length<4))switch(new DataView(t.buffer,t.byteOffset).getUint32(0,!0)){case 538247427:return"cloudpilot";case 427821081:return"uarm";default:return}}(t);if(void 0===e)return;const i=this.copyIn(t);try{switch(e){case"cloudpilot":return this.deserializeSessionImageCloudpilot(i,t.length);case"uarm":return this.deserializeSessionImageUarm(i,t.length);default:return}}finally{this.cloudpilot.Free(i)}}launchAppByName(t){return this.cloudpilot.LaunchAppByName(t)}launchAppByDbHeader(t){if(t.length<32)return!1;const e=this.copyIn(t.subarray(0,32)),i=this.cloudpilot.LaunchAppByDbHeader(e,32);return this.cloudpilot.Free(e),i}clearExternalStorage(){this.cloudpilot.ClearExternalStorage()}allocateCard(t,e){return this.cloudpilot.AllocateCard(t,e>>>9)}decompress(t){const e=this.copyIn(t);let i;try{for(i=new this.module.GunzipContext(e,t.length,524288);0===i.GetState();)i.Continue();return-1===i.GetState()?void console.error(`gunzip failed: ${i.GetError()}`):this.copyOut(i.ReleaseUncompressedData(),i.GetUncompressedSize())}finally{this.cloudpilot.Free(e),i&&this.module.destroy(i)}}getCardData(t){const e=this.module.getPointer(this.cloudpilot.GetCardData(t));if(0!==e)return this.module.HEAPU32.subarray(e>>>2,e+this.cloudpilot.GetCardSize(t)>>2)}getCardDirtyPages(t){const e=this.module.getPointer(this.cloudpilot.GetCardDirtyPages(t));if(0===e)return;const i=function(t){const e=(t>>>13)+(t%8192>0?1:0);return(e>>>3)+(e%8>0?1:0)}(this.cloudpilot.GetCardSize(t));return this.module.HEAPU8.subarray(e,e+i)}getMountedKey(){return this.cloudpilot.GetMountedKey()||void 0}mountCard(t){return this.cloudpilot.MountCard(t)}removeCard(t){return this.cloudpilot.RemoveCard(t)}remountCards(){this.cloudpilot.RemountCards()}remountFailed(){return this.cloudpilot.RemountFailed()}getCardSupportLevel(t){return this.cloudpilot.GetSupportLevel(t)}loadSkin(t){const e=new this.module.SkinLoader(t);try{const t=this.module.getPointer(e.GetData());if(0===t)return;return(new TextDecoder).decode(this.module.HEAPU8.subarray(t,t+e.GetSize()))}finally{this.module.destroy(e)}}getTransportIR(){return this.transportIR}getTransportSerial(){return this.transportSerial}guard(t){if(this.amIdead)throw new Error("cloudpilot instance is dead");try{return t()}catch(t){throw this.amIdead=!0,this.cloudpilot=void 0,this.fatalErrorEvent.dispatch(t instanceof Error?t:new Error("unknown error")),t}}getRomInfoCloudpilot(t,e){const i=new this.module.RomInfo(t,e);try{return i.IsValid()?{engine:"cloudpilot",cardVersion:i.CardVersion(),cardName:i.CardName(),romVersion:i.RomVersion(),romVersionString:i.RomVersionString(),supportedDevices:u.filter(i.Supports.bind(i))}:void 0}finally{this.module.destroy(i)}}getRomInfoUarm(t,e){const i=new this.module.RomInfo5(t,e);if(!i.IsValid())return;const n=i.GetDeviceType(),r=d(n);if(void 0!==r)try{return i.IsValid()?{engine:"uarm",romName:i.GetRomName(),cardName:i.GetCardName(),manufacturer:i.GetManufacturer(),companyId:i.GetCompanyId(),halId:i.GetHalId(),needsNand:i.NeedsNand(),deviceType:n,recommendedRamSize:i.GetRecommendedRamSize(),supportedDevices:[r]}:void 0}finally{this.module.destroy(i)}}deserializeSessionImageCloudpilot(t,e){const i=new this.module.SessionImage;try{if(!i.Deserialize(t,e))return;const n=i.GetDeviceId();if(!u.includes(n))throw new Error(`unsupported device ${n}`);const r=this.copyOut(i.GetRomImage(),i.GetRomImageSize()),o=this.copyOut(i.GetMemoryImage(),i.GetMemoryImageSize()),s=this.copyOut(i.GetSavestate(),i.GetSavestateSize());if(!r)throw new Error("invalid session image: no ROM or memory");let a;const c=this.copyOut(i.GetMetadata(),i.GetMetadataSize());if(c)try{a=Object.assign({engine:"cloudpilot"},JSON.parse((new TextDecoder).decode(c)))}catch(t){console.warn("ignoring invalid metadata",t)}return{engine:"cloudpilot",deviceId:n,rom:r,memory:o,savestate:s,metadata:a,version:i.GetVersion()}}catch(t){console.error(t)}finally{this.module.destroy(i)}}deserializeSessionImageUarm(t,e){const i=new this.module.SessionFile5;try{if(!i.Deserialize(e,t))return;const n=d(i.GetDeviceId());if(void 0===n)throw new Error(`unsupported uARM device ${n}`);const r=this.copyOut(i.GetNor(),i.GetNorSize()),o=this.copyOut(i.GetMemory(),i.GetMemorySize()),s=this.copyOut(i.GetNand(),i.GetNandSize()),a=this.copyOut(i.GetSavestate(),i.GetSavestateSize());if(!r)throw new Error("invalid session image: no ROM or memory");const c=this.copyOut(i.GetMetadata(),i.GetMetadataSize());let p;if(c)try{p=Object.assign({engine:"uarm"},JSON.parse((new TextDecoder).decode(c)))}catch(t){console.warn("invalid metadata",t)}return{engine:"uarm",deviceId:n,rom:r,memory:o,nand:s,savestate:a,metadata:p,version:i.GetVersion()}}finally{this.module.destroy(i)}}serializeSessionImageCloudpilot(t,{rom:e,romLength:i,memory:n,memoryLength:r,savestate:o,savestateLength:s,metadata:a,metadataLength:c}){const p=new this.module.SessionImage;try{return p.SetDeviceId(t),p.SetRomImage(e,i),n&&p.SetMemoryImage(n,null!=r?r:0),o&&p.SetSavestate(o,null!=s?s:0),a&&p.SetMetadata(a,null!=c?c:0),p.Serialize()?this.copyOut(p.GetSerializedImage(),p.GetSerializedImageSize()):void 0}finally{this.module.destroy(p)}}serializeSessionImageUarm(t,{rom:e,romLength:i,memory:n,memoryLength:o,nand:s,nandLength:a,savestate:c,savestateLength:p,metadata:u,metadataLength:l}){const d=new this.module.SessionFile5;try{return d.SetDeviceId(function(t){switch(t){case r.te2:return 0;case r.frankene2:return 1;default:return-1}}(t)),d.SetNor(i,e),n&&d.SetMemory(null!=o?o:0,n),s&&d.SetNand(null!=a?a:0,s),c&&d.SetSavestate(null!=p?p:0,c),u&&d.SetMetadata(null!=l?l:0,u),d.Serialize()?this.copyOut(d.GetSerializedSession(),d.GetSerializedSessionSize()):void 0}finally{this.module.destroy(d)}}copyIn(t){const e=this.cloudpilot.Malloc(t.length),i=this.module.getPointer(e);return this.module.HEAPU8.subarray(i,i+t.length).set(t),e}copyIn32(t){const e=this.cloudpilot.Malloc(t.length<<2),i=this.module.getPointer(e);return this.module.HEAPU32.subarray(i>>>2,(i>>>2)+t.length).set(t),e}copyOut(t,e){const i=this.module.getPointer(t);return i>0&&e>0?this.module.HEAPU8.subarray(i,i+e).slice():void 0}wrap(t){return new Proxy(t,{get:(t,e)=>{const i=t[e];return"function"!=typeof i?i:(...e)=>this.guard(()=>i.apply(t,e))}})}wrapTransport(t){const e=new c.J;return t.SetRequestTransferCallback(this.module.addFunction(()=>e.dispatch(),"v")),this.wrap(Object.setPrototypeOf({Receive:()=>{const e=t.RxBytesPending();return this.copyOut(t.Receive(),e)},Send:(e,i)=>{var n;const r=e&&this.copyIn(e);t.Send(null!==(n=null==e?void 0:e.length)&&void 0!==n?n:0,null!=r?r:this.cloudpilot.Nullptr(),i),r&&this.cloudpilot.Free(r)},frameCompleteEvent:e},t))}}t([l()],h.prototype,"enableLogging",null),t([l()],h.prototype,"getRomInfo",null),t([l()],h.prototype,"initializeSession",null),t([l()],h.prototype,"cyclesPerSecond",null),t([l()],h.prototype,"runEmulation",null),t([l()],h.prototype,"getFrame",null),t([l()],h.prototype,"isScreenDirty",null),t([l()],h.prototype,"markScreenClean",null),t([l()],h.prototype,"minRamForDevice",null),t([l()],h.prototype,"framebufferSizeForDevice",null),t([l()],h.prototype,"totalMemorySizeForDevice",null),t([l()],h.prototype,"queuePenMove",null),t([l()],h.prototype,"queuePenUp",null),t([l()],h.prototype,"queueButtonDown",null),t([l()],h.prototype,"queueButtonUp",null),t([l()],h.prototype,"queueKeyboardEvent",null),t([l()],h.prototype,"isPowerOff",null),t([l()],h.prototype,"isUiInitialized",null),t([l()],h.prototype,"isSetupComplete",null),t([l()],h.prototype,"getOSVersion",null),t([l()],h.prototype,"reset",null),t([l()],h.prototype,"resetNoExtensions",null),t([l()],h.prototype,"resetHard",null),t([l()],h.prototype,"installDb",null),t([l()],h.prototype,"getPalette2bitMapping",null),t([l()],h.prototype,"getMemory",null),t([l()],h.prototype,"getMemory32",null),t([l()],h.prototype,"getDirtyPages",null),t([l()],h.prototype,"loadMemory",null),t([l()],h.prototype,"getRomImage",null),t([l()],h.prototype,"getSavestate",null),t([l()],h.prototype,"saveState",null),t([l()],h.prototype,"loadState",null),t([l()],h.prototype,"getHotsyncName",null),t([l()],h.prototype,"setClockFactor",null),t([l()],h.prototype,"setHotsyncName",null),t([l()],h.prototype,"setClipboardIntegration",null),t([l()],h.prototype,"getClipboardIntegration",null),t([l()],h.prototype,"isSuspended",null),t([l()],h.prototype,"getSuspendKind",null),t([l()],h.prototype,"cancelSuspend",null),t([l()],h.prototype,"getSuspendContextClipboardCopy",null),t([l()],h.prototype,"getSuspendContextClipboardPaste",null),t([l()],h.prototype,"setNetworkRedirection",null),t([l()],h.prototype,"getNetworkRedirection",null),t([l()],h.prototype,"getSuspendContextNetworkConnect",null),t([l()],h.prototype,"getSuspendContextNetworkRpc",null),t([l()],h.prototype,"getSuspendContextSerialSync",null),t([l()],h.prototype,"copyBuffer",null),t([l()],h.prototype,"freeBuffer",null),t([l()],h.prototype,"setHotsyncNameManagement",null),t([l()],h.prototype,"resolveBuffer",null),t([l()],h.prototype,"serializeSessionImage",null),t([l()],h.prototype,"deserializeSessionImage",null),t([l()],h.prototype,"launchAppByName",null),t([l()],h.prototype,"launchAppByDbHeader",null),t([l()],h.prototype,"clearExternalStorage",null),t([l()],h.prototype,"allocateCard",null),t([l()],h.prototype,"decompress",null),t([l()],h.prototype,"getCardData",null),t([l()],h.prototype,"getCardDirtyPages",null),t([l()],h.prototype,"getMountedKey",null),t([l()],h.prototype,"mountCard",null),t([l()],h.prototype,"removeCard",null),t([l()],h.prototype,"remountCards",null),t([l()],h.prototype,"remountFailed",null),t([l()],h.prototype,"getCardSupportLevel",null),t([l()],h.prototype,"loadSkin",null);const m="application/wasm";function v(t){return e(this,void 0,void 0,function*(){var e;const i=yield fetch(t);if(!i.ok)throw new Error(`request for ${t} failed with ${i.status}: ${i.statusText}`);const n=null!==(e=i.headers.get("Content-Type"))&&void 0!==e?e:"no mime type";if(n!==m&&console.warn(`response for ${t} has wrong mime type: expected ${m}, got ${n}`),n===m&&WebAssembly.compileStreaming)return WebAssembly.compileStreaming(i);const r=yield i.arrayBuffer();return WebAssembly.compile(r)})}function y(t){switch(t){case r.i710:case r.m520:case r.te2:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case r.handera330:case r.handera330c:case r.lp168:return{screenSize:2,width:240,height:320,silkscreenHeight:0};case r.pegS300:case r.pegS320:case r.pegS500c:return{screenSize:0,width:160,height:160,silkscreenHeight:76};case r.pegT600c:case r.pegT400:case r.pegT650c:return{screenSize:1,width:320,height:320,silkscreenHeight:140,silkscreenOvershoot:10};case r.pegN600c:case r.pegN700c:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case r.pegNR70:case r.frankene2:return{screenSize:3,width:320,height:480,silkscreenHeight:0};case r.acerS11:return{screenSize:0,width:160,height:160,silkscreenHeight:60,siklscreenShift:8};default:return{screenSize:0,width:160,height:160,silkscreenHeight:60}}}function f(t){switch(t){case r.pilot:case r.palmPilot:case r.iii:case r.palmV:case r.palmVx:case r.iiix:case r.iiixe:case r.iiie:case r.m100:case r.m105:case r.m125:case r.m500:case r.palmVII:case r.palmVIIEZ:case r.palmVIIx:case r.i705:case r.handera330:case r.pegS300:case r.pegS320:case r.pegT400:case r.acerS11:return!1;default:return!0}}function _(t){switch(t){case r.te2:case r.frankene2:return"uarm";default:return"cloudpilot"}}var g;!function(t){t.portrait="portrait",t.landscape90="landscape90",t.landscape270="landscape270",t.portrait180="portrait180"}(g||(g={}));const S="safari"in window,b=!!navigator.platform.match(/iPhone|iPad|iPod/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;function w(t,i){let n,r;const o=document.createElement("canvas");return(s,a)=>e(this,void 0,void 0,function*(){if(n===s&&r===a)return o;o.width=s,o.height=a;const e=o.getContext("2d");if(!e)throw new Error("get a new browser");return e.drawImage(yield t,0,0,o.width,o.height),(S||b)&&(yield i).indexOf("data:image")>=0&&(yield new Promise(t=>setTimeout(t,0)),e.drawImage(yield t,0,0,o.width,o.height)),n=s,r=a,o})}function C(t){return new Promise((e,i)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>i(),n.src=t})}b&&navigator.userAgent.match(/(crios)|(fxios)/i),navigator.userAgent.match(/pwashell/i),S||b||!!navigator.userAgent.match(/Safari/)&&navigator.userAgent.match(/Chrome/),navigator.userAgent.match(/android/i),navigator.userAgent.toLowerCase().indexOf("firefox");const E=t=>`data:image/svg+xml;base64,${btoa(t)}`;class I{constructor(t){this.cloudpilot=t,this.images=new Map}loadSkinElement(t){if(this.images.has(t))return this.images.get(t);const e=this.cloudpilot.then(e=>e.loadSkin(t)).then(e=>e?Promise.all([e,C(E(e))]):Promise.reject(new Error(`failed to load skin ${t}`))),i=w(e.then(([,t])=>t),e.then(([t])=>t));return this.images.set(t,i),i}}new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const D=new Error("request for lock canceled");class x{constructor(t,e=D){this._value=t,this._cancelError=e,this._queue=[],this._weightedWaiters=[]}acquire(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((i,n)=>{const r={resolve:i,reject:n,weight:t,priority:e},o=G(this._queue,t=>e<=t.priority);-1===o&&t<=this._value?this._dispatchItem(r):this._queue.splice(o+1,0,r)})}runExclusive(t){return e=this,i=arguments,r=function*(t,e=1,i=0){const[n,r]=yield this.acquire(e,i);try{return yield t(n)}finally{r()}},new((n=void 0)||(n=Promise))(function(t,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n(function(t){t(i)})).then(s,a)}c((r=r.apply(e,i||[])).next())});var e,i,n,r}waitForUnlock(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,e)?Promise.resolve():new Promise(i=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),function(t,e){const i=G(t,t=>e.priority<=t.priority);t.splice(i+1,0,e)}(this._weightedWaiters[t-1],{resolve:i,priority:e})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const e=this._value;this._value-=t.weight,t.resolve([e,this._newReleaser(t.weight)])}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let t=this._value;t>0;t--){const e=this._weightedWaiters[t-1];e&&(e.forEach(t=>t.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let e=this._value;e>0;e--){const i=this._weightedWaiters[e-1];if(!i)continue;const n=i.findIndex(e=>e.priority<=t);(-1===n?i:i.splice(0,n)).forEach(t=>t.resolve())}}}_couldLockImmediately(t,e){return(0===this._queue.length||this._queue[0].priority<e)&&t<=this._value}}function G(t,e){for(let i=t.length-1;i>=0;i--)if(e(t[i]))return i;return-1}class M{constructor(t){this._semaphore=new x(1,t)}acquire(){return t=this,e=arguments,n=function*(t=0){const[,e]=yield this._semaphore.acquire(1,t);return e},new((i=void 0)||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())});var t,e,i,n}runExclusive(t,e=0){return this._semaphore.runExclusive(()=>t(),1,e)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class k{constructor(t){this.query=t,this.changeEvent=new c.J,this.last=t()}update(){const t=this.query();t!==this.last&&(this.changeEvent.dispatch(t),this.last=t)}}const P=window.AudioContext||window.webkitAudioContext;function R(t,e=500){return new Promise((i,n)=>{setTimeout(()=>n(new Error("timeout")),e),t.then(i,n)})}class z{constructor(t,i){this.emulationService=t,this.pcmWorkletUrl=i,this.initialize=()=>this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){return this.initializeAudioUnguarded()})),this.updateState=()=>{this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){if(!this.audio)return;if(this.updateGain(),this.shouldRun()?this.emulationService.enablePcmStreaming():this.emulationService.disablePcmStreaming(),this.isRunning()===this.shouldRun())return;const t=this.audio.context.state;switch(t){case"interrupted":break;case"closed":return void console.warn("audio context closed unexpectedly, no more audio will be played")}if(this.shouldRun())try{yield R(this.audio.context.resume()),console.log("resume audio context")}catch(e){console.error(`failed to resume audio from state ${t}`,e)}else try{yield R(this.audio.context.suspend()),console.log("suspend audio context")}catch(e){console.error(`failed to suspend audio from state ${t}`,e)}}))},this.onPwmUpdate=t=>e(this,void 0,void 0,function*(){this.pendingPwmUpdate=t,this.applyPwmUpdate()}),this.onContextStateChange=()=>{if(this.audio)switch(console.log(`audio context state change ${this.oldAudioState} -> ${this.audio.context.state}`),this.oldAudioState=this.audio.context.state,this.audio.context.state){case"suspended":"interrupted"===this.oldAudioState&&this.shouldRun()&&this.updateState(),this.emulationService.disablePcmStreaming();break;case"running":this.emulationService.enablePcmStreaming(),this.audio.gainNode.gain.value=this.shouldMute()?0:this.gain()}},this.mutex=new M,this.muted=!1,this.workletBound=!1,this.oldAudioState="[new]",this.bind(),this.emulationService.openSessionEvent.addHandler(()=>this.bind()),this.emulationService.emulationStateChangeEvent.addHandler(()=>this.updateState()),this.emulationService.palmosStateChangeEvent.addHandler(()=>this.updateState()),document.addEventListener("visibilitychange",()=>{b&&"visible"===document.visibilityState?setTimeout(()=>this.updateState(),500):this.updateState()}),window.__cpeAudioDriver=this}isInitialized(){return void 0!==this.audio}mute(t){this.muted=t,this.updateState()}isMuted(){return this.muted}reactivateRequired(){var t,e,i;return null!==(t=this.audio)&&void 0!==t&&t&&("suspended"===(null===(e=this.audio)||void 0===e?void 0:e.context.state)||"interrupted"===(null===(i=this.audio)||void 0===i?void 0:i.context.state))&&this.shouldRun()}reactivate(){this.mute(!1),this.updateState()}shouldRun(){return this.gain()>0&&("hidden"!==document.visibilityState||this.runHidden())}shouldMute(){return!this.emulationService.isRunning()||this.emulationService.isPowerOff()||this.muted}updateGain(){this.audio&&(this.audio.gainNode.gain.value=this.shouldMute()?0:this.gain())}bind(){var t;this.unbind(),this.pwmUpdateEvent=this.emulationService.pwmUpdateEvent(),null===(t=this.pwmUpdateEvent)||void 0===t||t.addHandler(this.onPwmUpdate),this.emulationService.pcmPort()&&this.bindWorkletNode()}unbind(){var t;null===(t=this.pwmUpdateEvent)||void 0===t||t.removeHandler(this.onPwmUpdate),this.disconnectPwmSource(),this.pwmUpdateEvent=void 0,this.unbindWorkletNode()}registerWorklet(t){return e(this,void 0,void 0,function*(){const e=window.Worker;window.Worker=class{constructor(e){this.ready=t.audioWorklet.addModule(e)}};const n=void 0===this.pcmWorkletUrl?new Worker(new URL(i.p+i.u(744),i.b)):new Worker(this.pcmWorkletUrl);window.Worker=e,yield n.ready})}initializeAudioUnguarded(){return e(this,void 0,void 0,function*(){if(this.audio)return!0;let t,e;try{t=this.createAudioContext()}catch(t){return console.error("web audio not available",t),!1}try{t.destination.channelCount=2}catch(t){console.warn("audio driver: failed to set channel count",t)}try{yield this.registerWorklet(t),e=new AudioWorkletNode(t,"pcm-processor",{channelCount:2,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{sampleRateTo:t.sampleRate}})}catch(t){console.error("failed to load audio worklet, PCM audio not available",t)}const i=t.createGain();return i.channelInterpretation="speakers",i.gain.value=this.gain(),i.connect(t.destination),this.audio={context:t,gainNode:i,workletNode:e},t.addEventListener("statechange",this.onContextStateChange),this.updateState(),this.applyPwmUpdate(),this.bindWorkletNode(),console.log(`audio initialised at ${t.sampleRate}Hz`),!0})}createAudioContext(){try{return new P({sampleRate:44100,latencyHint:"interactive"})}catch(t){console.warn("failed to request context at 44100Hz , latency interactive",t)}try{return new P({latencyHint:"interactive"})}catch(t){console.warn("failed to request context at arbitrary rate, latency interactive",t)}try{return new P}catch(t){throw console.error("failed to request context at arbitrary rate and latency",t),t}}isRunning(){var t;return"running"===(null===(t=this.audio)||void 0===t?void 0:t.context.state)}applyPwmUpdate(){if(!this.audio||!this.pendingPwmUpdate)return;const{frequency:t,dutyCycle:e}=this.pendingPwmUpdate,i=this.audio.context.sampleRate;if(this.pendingPwmUpdate=void 0,t<=0||e<=0||t>=i)return void this.disconnectPwmSource();const n=this.audio.context.createBuffer(1,Math.round(i/t),i),r=n.getChannelData(0);for(let t=0;t<r.length;t++)r[t]=t/r.length<e?.5:0;const o=this.audio.context.createBufferSource();o.channelCount=1,o.channelInterpretation="speakers",o.loop=!0,o.buffer=n,this.disconnectPwmSource(),o.connect(this.audio.gainNode),o.start(),this.bufferSourceNode=o,this.pendingPwmUpdate=void 0}disconnectPwmSource(){this.bufferSourceNode&&(this.bufferSourceNode.stop(),this.bufferSourceNode.disconnect(),this.bufferSourceNode=void 0)}gain(){return this.getVolume()/2}dispatchPcmControlMessage(t,e){var i,n;null===(n=null===(i=this.audio)||void 0===i?void 0:i.workletNode)||void 0===n||n.port.postMessage(t,e)}bindWorkletNode(){var t;if(this.workletBound||!(null===(t=this.audio)||void 0===t?void 0:t.workletNode))return;const e=this.emulationService.pcmPort();e&&(this.audio.workletNode.connect(this.audio.gainNode),this.dispatchPcmControlMessage({type:"setStreamMessagePort",port:e},[e]),this.shouldRun()?this.emulationService.enablePcmStreaming():this.emulationService.disablePcmStreaming(),this.workletBound=!0,console.log("bound worklet"))}unbindWorkletNode(){var t,e;this.workletBound&&(null===(e=null===(t=this.audio)||void 0===t?void 0:t.workletNode)||void 0===e||e.disconnect(),this.dispatchPcmControlMessage({type:"reset"}),this.emulationService.disablePcmStreaming(),this.workletBound=!1,console.log("unbound worklet"))}}class H extends z{constructor(t,e,i){super(e,i),this.session=t,this.volume=.5}setVolume(t){this.volume=Math.max(Math.min(t,1),0),this.updateGain()}getVolume(){return this.volume}setSession(t){this.session=t,this.updateState()}runHidden(){return this.session.runInBackground}}const T=[135,135,105],N=[0,0,0],A=new Array(16).fill(0).map((t,e)=>N.map((t,i)=>Math.floor((e*t+(15-e)*T[i])/15))).map(([t,e,i])=>4278190080|i<<16|e<<8|t),U=A.map(t=>{var e;return"#"+(null===(e=(16777215&t).toString(16).padStart(6,"0").match(/(..?)/g))||void 0===e?void 0:e.reverse().join(""))}),B=r.m515,F=U[2],L=U[0],j="rgba(0,0,0,0.2)";function O(t,e){const i=y(t),n=(0===i.screenSize?3:2)*e,r={frameDevice:1,frameCanvas:n},o=t=>({frameDevice:t,frameCanvas:t*n}),s=t=>({frameDevice:t,frameCanvas:r.frameCanvas+t*n}),a=i.silkscreenHeight>0?o(1):o(0),c=o(function(t){switch(t){case 3:case 1:return 60;case 2:return 45;default:return 30}}(i.screenSize));return{scale:n,borderWidth:r,height:o(2*r.frameDevice+i.height+a.frameDevice+i.silkscreenHeight+c.frameDevice),width:o(2*r.frameDevice+i.width),screenHeight:o(i.height),screenWidth:o(i.width),screenLeft:s(0),screenTop:s(0),screenBottom:s(i.height),separatorHeight:a,silkscreenHeight:o(i.silkscreenHeight),silkscreenTop:s(i.height+a.frameDevice),silkscreenBottom:s(i.height+a.frameDevice+i.silkscreenHeight),softSilkscreenHeight:o(i.silkscreenHeight>0?0:i.height-i.width),buttonHeight:c,buttonWidth:c,buttonTop:s(i.height+a.frameDevice+i.silkscreenHeight),buttonBottom:s(i.height+a.frameDevice+i.silkscreenHeight+c.frameDevice),radiusDpadSelect:{frameCanvas:c.frameCanvas/5,frameDevice:c.frameDevice/5},angleDpad:Math.PI/2-Math.atan((i.width-4*c.frameDevice)/c.frameDevice)}}class W{constructor(t){this.skinLoader=t,this.layout=O(B,this.pixelRatio()),this.dpad=!1,this.onResize=new c.J}get width(){switch(this.getOrientation()){case g.portrait:case g.portrait180:case void 0:return this.layout.width.frameCanvas;default:return this.layout.height.frameCanvas}}get height(){switch(this.getOrientation()){case g.portrait:case g.portrait180:case void 0:return this.layout.height.frameCanvas;default:return this.layout.width.frameCanvas}}updateEmulationCanvas(t){this.setupTransformation(),this.drawEmulationCanvas(t),this.onAfterUpdateCanvas()}eventToPalmCoordinates(t,e=!1){if(!this.ctx)return;const i=this.ctx.canvas.getBoundingClientRect();let n,r,o,s;i.width/i.height>this.width/this.height?(s=i.height,o=this.width/this.height*i.height,r=i.top,n=i.left+(i.width-o)/2):(o=i.width,s=this.height/this.width*i.width,n=i.left,r=i.top+(i.height-s)/2);let a=(t.clientX-n)/o*this.width/this.layout.scale,c=(t.clientY-r)/s*this.height/this.layout.scale;switch(this.getOrientation()){case g.landscape90:{const t=c;c=this.layout.height.frameDevice-a,a=t;break}case g.landscape270:{const t=c;c=a,a=this.layout.width.frameDevice-t;break}case g.portrait180:a=this.layout.width.frameDevice-a,c=this.layout.height.frameDevice-c}a-=this.layout.borderWidth.frameDevice,c-=this.layout.borderWidth.frameDevice,c>=this.layout.screenHeight.frameDevice&&(c<=this.layout.screenHeight.frameDevice+this.layout.separatorHeight.frameDevice?c=this.layout.screenHeight.frameDevice:c-=this.layout.separatorHeight.frameDevice);const p=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice;if(e)a<0&&(a=0),a>=this.layout.screenWidth.frameDevice&&(a=this.layout.screenWidth.frameDevice-1),c<0&&(c=0),c>=p&&(c=p-1);else if(a<0||a>=this.layout.screenWidth.frameDevice||c<0||c>=p)return;return[a,c]}isSilkscreen(t){const[,e]=t;return!this.isButtons(t)&&e>=this.layout.screenHeight.frameDevice}isButtons([,t]){return t>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice}determineButton([t,e]){if(t>=this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice)return 3;if(t>=this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice)return 2;if(t>=2*this.layout.buttonWidth.frameDevice){if(this.dpad){const i={x:this.layout.screenWidth.frameDevice/2,y:this.layout.buttonTop.frameDevice+this.layout.buttonHeight.frameDevice/2},n={x:Math.abs(t-i.x),y:Math.abs(e-i.y)},r=Math.tan(this.layout.angleDpad);return Math.pow(n.x,2)+Math.pow(n.y,2)<=Math.pow(this.layout.radiusDpadSelect.frameDevice,2)?16:e<i.y&&n.y/n.x>=r?4:e>i.y&&n.y/n.x>=r?5:t<i.x&&n.y/n.x<r?14:15}return e>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice/2?5:4}return t>=this.layout.buttonWidth.frameDevice?1:0}initWithCanvas(t,i){return e(this,void 0,void 0,function*(){var e;if(void 0===i&&(i=null===(e=this.ctx)||void 0===e?void 0:e.canvas),!i)return;this.dpad=t,this.layout=O(this.getDeviceId(),this.pixelRatio()),this.onResize.dispatch(),i.width=this.width,i.height=this.height;const n=i.getContext("2d");if(!n)throw new Error("canvas not supported - get a new browser");this.ctx=n,this.setupTransformation(),this.fillCanvasRect(0,0,this.layout.width.frameCanvas,this.layout.height.frameCanvas,this.frameColor()),this.fillRect(0,0,this.layout.screenWidth.frameDevice,this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.separatorHeight.frameDevice+this.layout.buttonHeight.frameDevice,this.backgroundColor()),this.drawEmulationCanvas(),yield Promise.all([this.drawSilkscreen(),this.drawButtons()])})}drawButtons(){return e(this,arguments,void 0,function*(t=[]){if(this.ctx)if(this.setupTransformation(),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.buttonsImage()(this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),this.layout.screenLeft.frameCanvas,this.layout.buttonTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),t.includes(0)&&this.fillRect(0,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,j),t.includes(1)&&this.fillRect(this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,j),t.includes(2)&&this.fillRect(this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,j),t.includes(3)&&this.fillRect(this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,j),this.dpad){const e={x:this.layout.borderWidth.frameCanvas+this.layout.screenWidth.frameCanvas/2,y:this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas/2},i={x:this.layout.borderWidth.frameCanvas+2*this.layout.buttonWidth.frameCanvas,y:this.layout.buttonTop.frameCanvas},n={x:this.layout.borderWidth.frameCanvas+this.layout.screenWidth.frameCanvas-2*this.layout.buttonWidth.frameCanvas,y:this.layout.buttonTop.frameCanvas},r={x:i.x,y:this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas},o={x:n.x,y:this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas},s=this.layout.radiusDpadSelect.frameCanvas,a=this.layout.angleDpad;t.includes(4)&&(this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(n.x,n.y),this.ctx.lineTo(e.x+s*Math.cos(a),e.y-s*Math.sin(a)),this.ctx.arc(e.x,e.y,s,-a,a-Math.PI,!0),this.ctx.lineTo(i.x,i.y),this.ctx.fillStyle=j,this.ctx.fill()),t.includes(5)&&(this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(o.x,o.y),this.ctx.lineTo(e.x+s*Math.cos(a),e.y+s*Math.sin(a)),this.ctx.arc(e.x,e.y,s,a,Math.PI-a,!1),this.ctx.lineTo(r.x,r.y),this.ctx.fillStyle=j,this.ctx.fill()),t.includes(14)&&(this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(r.x,r.y),this.ctx.lineTo(e.x-s*Math.cos(a),e.y+s*Math.sin(a)),this.ctx.arc(e.x,e.y,s,Math.PI-a,Math.PI+a,!1),this.ctx.lineTo(i.x,i.y),this.ctx.fillStyle=j,this.ctx.fill()),t.includes(15)&&(this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y),this.ctx.lineTo(o.x,o.y),this.ctx.lineTo(e.x+s*Math.cos(a),e.y+s*Math.sin(a)),this.ctx.arc(e.x,e.y,s,a,-a,!0),this.ctx.lineTo(n.x,n.y),this.ctx.fillStyle=j,this.ctx.fill()),t.includes(16)&&(this.ctx.beginPath(),this.ctx.arc(e.x,e.y,s,0,2*Math.PI),this.ctx.fillStyle=j,this.ctx.fill())}else t.includes(4)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,j),t.includes(5)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice+this.layout.buttonHeight.frameDevice/2,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,j)})}onAfterUpdateCanvas(){}pixelRatio(){return devicePixelRatio}setupTransformation(){if(this.ctx)switch(this.ctx.resetTransform(),this.getOrientation()){case g.portrait:case void 0:break;case g.landscape90:this.ctx.translate(this.layout.height.frameCanvas,0),this.ctx.rotate(Math.PI/2);break;case g.landscape270:this.ctx.translate(0,this.layout.width.frameCanvas),this.ctx.rotate(3*Math.PI/2);break;case g.portrait180:this.ctx.translate(this.layout.width.frameCanvas,this.layout.height.frameCanvas),this.ctx.rotate(Math.PI)}}drawSilkscreen(){return e(this,void 0,void 0,function*(){0!==this.layout.silkscreenHeight.frameCanvas&&this.ctx&&(this.setupTransformation(),this.fillRect(this.layout.screenLeft.frameDevice,this.layout.silkscreenTop.frameDevice,this.layout.screenWidth.frameDevice,this.layout.silkscreenHeight.frameDevice,F),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.silkscreenImage()(this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas),this.layout.borderWidth.frameCanvas,this.layout.silkscreenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas))})}drawEmulationCanvas(t=this.lastEmulationCanvas){t&&this.ctx&&(this.lastEmulationCanvas=t,this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(t,this.layout.screenLeft.frameCanvas,this.layout.screenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.screenHeight.frameCanvas))}fillRect(t,e,i,n,r){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(this.layout.borderWidth.frameCanvas+this.layout.scale*t,this.layout.borderWidth.frameCanvas+this.layout.scale*e,this.layout.scale*i,this.layout.scale*n),this.ctx.fillStyle=r,this.ctx.fill())}fillCanvasRect(t,e,i,n,r){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(t,e,i,n),this.ctx.fillStyle=r,this.ctx.fill())}silkscreenImage(){return this.skinLoader.loadSkinElement(this.silkscreenSkinElement())}silkscreenSkinElement(){switch(this.getDeviceId()){case r.pegT600c:case r.pegT650c:return"silkscreen/clie-t600.svg";case r.pegN700c:case r.pegN600c:return"silkscreen/clie-n610.svg";case r.pegS320:case r.pegS300:return"silkscreen/clie-s300.svg";case r.pegS500c:return"silkscreen/clie-s500.svg";case r.pegT400:return"silkscreen/clie-t415.svg";case r.acerS11:return"silkscreen/acer-s10.svg";case r.palmPilot:case r.pilot:case r.iii:case r.palmVII:return"silkscreen/pilot.svg";case r.m500:return"silkscreen/m500.svg";case r.m505:case r.m515:case r.m520:return"silkscreen/m515.svg";case r.iiic:return"silkscreen/iiic.svg";case r.m100:case r.m105:case r.m125:return"silkscreen/m100.svg";case r.m130:return"silkscreen/m130.svg";case r.i710:case r.te2:return"silkscreen/tungstenw.svg";case r.i705:return"silkscreen/i705.svg";case r.iiix:case r.iiixe:case r.palmVx:case r.palmV:case r.palmVIIEZ:case r.palmVIIx:default:return"silkscreen/v.svg"}}buttonsImage(){return this.skinLoader.loadSkinElement(this.buttonsSkinElement())}buttonsSkinElement(){switch(this.getDeviceId()){case r.acerS11:return"hard-buttons/acer-s10.svg";case r.pegNR70:return"hard-buttons/clie-nr70.svg";case r.pegN700c:return"hard-buttons/clie-n700.svg";case r.pegN600c:return"hard-buttons/clie-n610.svg";case r.pegS300:return"hard-buttons/clie-s300.svg";case r.pegS500c:return"hard-buttons/clie-s500.svg";case r.pegS320:return"hard-buttons/clie-s320.svg";case r.pegT400:case r.pegT600c:case r.pegT650c:return"hard-buttons/clie-t415.svg";case r.pilot:case r.palmPilot:return"hard-buttons/pilot.svg";case r.m500:return"hard-buttons/m500.svg";case r.m505:case r.m515:case r.m520:return"hard-buttons/m515.svg";case r.iiic:return"hard-buttons/iiic.svg";case r.m100:case r.m105:return"hard-buttons/m100.svg";case r.m125:return"hard-buttons/m125.svg";case r.m130:return"hard-buttons/m130.svg";case r.i710:return"hard-buttons/tungstenw.svg";case r.te2:case r.frankene2:return"hard-buttons/te2.svg";case r.iii:case r.iiix:case r.iiixe:case r.palmVII:case r.palmVIIEZ:case r.palmVIIx:return"hard-buttons/iiix.svg";case r.iiie:return"hard-buttons/iiie.svg";case r.i705:return"hard-buttons/i705.svg";case r.handera330:return"hard-buttons/handera330.svg";case r.handera330c:return"hard-buttons/handera330c.svg";case r.lp168:return"hard-buttons/lp168.svg";case r.palmVx:case r.palmV:default:return"hard-buttons/v.svg"}}backgroundColor(){return f(this.getDeviceId())?"white":L}frameColor(){return f(this.getDeviceId())?"white":"#ccc"}}const V='<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Game Controller</title><path d="M467.51 248.83c-18.4-83.18-45.69-136.24-89.43-149.17A91.5 91.5 0 00352 96c-26.89 0-48.11 16-96 16s-69.15-16-96-16a99.09 99.09 0 00-27.2 3.66C89 112.59 61.94 165.7 43.33 248.83c-19 84.91-15.56 152 21.58 164.88 26 9 49.25-9.61 71.27-37 25-31.2 55.79-40.8 119.82-40.8s93.62 9.6 118.66 40.8c22 27.41 46.11 45.79 71.42 37.16 41.02-14.01 40.44-79.13 21.43-165.04z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><circle cx="292" cy="224" r="20"/><path d="M336 288a20 20 0 1120-19.95A20 20 0 01336 288z"/><circle cx="336" cy="180" r="20"/><circle cx="380" cy="224" r="20"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 176v96M208 224h-96"/></svg>',q=w(C(E(V)),V);class K extends W{constructor(){super(...arguments),this.initialize=(t,e,i)=>this.mutex.runExclusive(()=>this.initializeUnguarded(t,e,i)),this.deviceId=r.m515,this.orientation=g.portrait,this.dpadEnabled=!1,this.gameModeIndicatorEnabled=!0,this.gameModeActive=!1,this.lastActiveButtons=void 0,this.mutex=new M}setDpadEnabled(t){this.dpadEnabled=t}updateOrientation(t){this.orientation=t,this.initialize()}toggleGameModeIndicator(t){this.gameModeActive=t,this.drawButtons(this.lastActiveButtons)}setGameModeIndicatorEnabled(t){this.gameModeIndicatorEnabled=t,this.drawButtons(this.lastActiveButtons)}isGameModeIndicatorEnabled(){return this.gameModeIndicatorEnabled}getCanvas(){var t;return null===(t=this.ctx)||void 0===t?void 0:t.canvas}drawButtons(){const t=Object.create(null,{drawButtons:{get:()=>super.drawButtons}});return e(this,arguments,void 0,function*(e=[]){this.lastActiveButtons=e,yield t.drawButtons.call(this,e),this.gameModeActive&&this.gameModeIndicatorEnabled&&"cloudpilot"===_(this.deviceId)&&(yield this.drawGameModeIndicator())})}getDeviceId(){return this.deviceId}getOrientation(){return this.orientation}drawGameModeIndicator(){return e(this,void 0,void 0,function*(){if(!this.ctx)return;const t=Math.floor(.1*this.layout.screenWidth.frameCanvas),e=Math.floor(.8*t),i=Math.floor(.1*t),n=Math.floor(.11*t);this.fillCanvasRect(this.layout.screenLeft.frameCanvas-i+this.layout.screenWidth.frameCanvas-t,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-i,t,t,"rgba(200, 200, 200, 0.7)"),this.ctx.drawImage(yield q(t,t),this.layout.screenLeft.frameCanvas+this.layout.screenWidth.frameCanvas-i-t+n,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-i+n,e,e)})}initializeUnguarded(t){return e(this,arguments,void 0,function*(t,e=this.deviceId,i=this.orientation){var n;this.deviceId=e,this.orientation=i;const r=t||(null===(n=this.ctx)||void 0===n?void 0:n.canvas);r&&(r.width=this.width,r.height=this.height,r.style.objectFit="contain"),yield this.initWithCanvas(this.dpadEnabled,t)})}}class ${constructor(t,e){this.queue=new Array(t).fill(0),this.reset(e)}reset(t=0){this.next=1,this.size=1,this.queue[0]=t}push(t){return this.queue[this.next]=t,this.next=(this.next+1)%this.queue.length,this.size<this.queue.length&&this.size++,this}calculateAverage(){let t=0;for(let e=0;e<this.size;e++)t+=this.queue[e];return t/this.size}}class J{constructor(t){this.start=0,this.size=0,this.buffer=new Array(t)}push(t){return this.size<this.buffer.length?this.buffer[(this.start+this.size++)%this.buffer.length]=t:(this.start=(this.start+1)%this.buffer.length,this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}pop(){if(0===this.size)return;const t=this.buffer[this.start];return this.start=(this.start+1)%this.buffer.length,this.size--,t}peekLast(){if(0!==this.size)return this.buffer[(this.start+this.size-1)%this.buffer.length]}replaceLast(t){return this.size>0&&(this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}count(){return this.size}flush(){return this.start=0,this.size=0,this}}var Q=i(389);const Y=new WeakMap,Z=new WeakMap,X=new Map([[0,null]]),tt=new Map([[0,null]]),et=(t=>{const e=(i=t,{...i,connect:({call:t})=>async()=>{const{port1:e,port2:i}=new MessageChannel,n=await t("connect",{port:e},[e]);return Y.set(i,n),i},disconnect:({call:t})=>async e=>{const i=Y.get(e);if(void 0===i)throw new Error("The given port is not connected.");await t("disconnect",{portId:i})},isSupported:({call:t})=>()=>t("isSupported")});var i;return t=>{const i=(t=>{if(Z.has(t))return Z.get(t);const e=new Map;return Z.set(t,e),e})(t);t.addEventListener("message",({data:t})=>{const{id:e}=t;if(null!==e&&i.has(e)){const{reject:n,resolve:r}=i.get(e);i.delete(e),void 0===t.error?r(t.result):n(new Error(t.error.message))}}),(t=>"function"==typeof t.start)(t)&&t.start();const n=(e,n=null,r=[])=>new Promise((o,s)=>{const a=(0,Q.generateUniqueNumber)(i);i.set(a,{reject:s,resolve:o}),null===n?t.postMessage({id:a,method:e},r):t.postMessage({id:a,method:e,params:n},r)}),r=(e,i,n=[])=>{t.postMessage({id:null,method:e,params:i},n)};let o={};for(const[t,i]of Object.entries(e))o={...o,[t]:i({call:n,notify:r})};return{...o}}})({clearInterval:({call:t})=>e=>{"symbol"==typeof X.get(e)&&(X.set(e,null),t("clear",{timerId:e,timerType:"interval"}).then(()=>{X.delete(e)}))},clearTimeout:({call:t})=>e=>{"symbol"==typeof tt.get(e)&&(tt.set(e,null),t("clear",{timerId:e,timerType:"timeout"}).then(()=>{tt.delete(e)}))},setInterval:({call:t})=>(e,i=0,...n)=>{const r=Symbol(),o=(0,Q.generateUniqueNumber)(X);X.set(o,r);const s=()=>t("set",{delay:i,now:performance.timeOrigin+performance.now(),timerId:o,timerType:"interval"}).then(()=>{const t=X.get(o);if(void 0===t)throw new Error("The timer is in an undefined state.");t===r&&(e(...n),X.get(o)===r&&s())});return s(),o},setTimeout:({call:t})=>(e,i=0,...n)=>{const r=Symbol(),o=(0,Q.generateUniqueNumber)(tt);return tt.set(o,r),t("set",{delay:i,now:performance.timeOrigin+performance.now(),timerId:o,timerType:"timeout"}).then(()=>{const t=tt.get(o);if(void 0===t)throw new Error("The timer is in an undefined state.");t===r&&(tt.delete(o),e(...n))}),o}}),it=(()=>{let t=null;return()=>{if(null!==t)return t;const e=new Blob(['(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,s=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<s?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*s);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,u=r(i),c=a(u,i),l=t(c);e.addUniqueNumber=l,e.generateUniqueNumber=c}(t)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,o=(e,t)=>Object.assign(new Error(e),{status:t}),s=t=>o(\'The handler of the method called "\'.concat(t,\'" returned an unexpected result.\'),e),a=(t,r)=>async({data:{id:a,method:i,params:u}})=>{const c=r[i];try{if(void 0===c)throw(e=>o(\'The requested method called "\'.concat(e,\'" is not supported.\'),n))(i);const r=void 0===u?c():c(u);if(void 0===r)throw(t=>o(\'The handler of the method called "\'.concat(t,\'" returned no required result.\'),e))(i);const l=r instanceof Promise?await r:r;if(null===a){if(void 0!==l.result)throw s(i)}else{if(void 0===l.result)throw s(i);const{result:e,transferables:r=[]}=l;t.postMessage({id:a,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:a})}};var i=r(455);const u=new Map,c=(e,r,n)=>({...r,connect:({port:t})=>{t.start();const n=e(t,r),o=(0,i.generateUniqueNumber)(u);return u.set(o,()=>{n(),t.close(),u.delete(o)}),{result:o}},disconnect:({portId:e})=>{const r=u.get(e);if(void 0===r)throw(e=>o(\'The specified parameter called "portId" with the given value "\'.concat(e,\'" does not identify a port connected to this worker.\'),t))(e);return r(),{result:null}},isSupported:async()=>{if(await new Promise(e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=({data:t})=>e(null!==t),n.postMessage(t,[t])})){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),l=(e,t,r=()=>!0)=>{const n=c(l,t,r),o=a(e,n);return e.addEventListener("message",o),()=>e.removeEventListener("message",o)},d=(e,t)=>r=>{const n=t.get(r);if(void 0===n)return Promise.resolve(!1);const[o,s]=n;return e(o),t.delete(r),s(!1),Promise.resolve(!0)},f=(e,t,r,n)=>(o,s,a)=>{const i=o+s-t.timeOrigin,u=i-t.now();return new Promise(t=>{e.set(a,[r(n,u,i,e,t,a),t])})},m=new Map,h=d(globalThis.clearTimeout,m),p=new Map,v=d(globalThis.clearTimeout,p),w=((e,t)=>{const r=(n,o,s,a)=>{const i=n-e.now();i>0?o.set(a,[t(r,i,n,o,s,a),s]):(o.delete(a),s(!0))};return r})(performance,globalThis.setTimeout),g=f(m,performance,globalThis.setTimeout,w),T=f(p,performance,globalThis.setTimeout,w);l(self,{clear:async({timerId:e,timerType:t})=>({result:await("interval"===t?h(e):v(e))}),set:async({delay:e,now:t,timerId:r,timerType:n})=>({result:await("interval"===n?g:T)(e,t,r)})})})()})();'],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(e);return t=(t=>{const e=new Worker(t);return et(e)})(i),setTimeout(()=>URL.revokeObjectURL(i)),t}})();class nt{constructor(t){this.callback=t}schedule(){void 0===this.handle&&(this.handle=requestAnimationFrame(t=>{this.handle=void 0,this.callback(t)}))}cancel(){void 0!==this.handle&&(cancelAnimationFrame(this.handle),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return 0}}class rt{constructor(t,e=60){this.callback=t,this.fps=e}schedule(){if(void 0!==this.handle)return;const t=performance.now(),e=1e3*Math.ceil(t/1e3*this.fps)/this.fps;this.handle=((...t)=>it().setTimeout(...t))(()=>{this.handle=void 0,this.callback(performance.now())},Math.max(e-t,0))}cancel(){var t;void 0!==this.handle&&(t=this.handle,it().clearTimeout(t),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return 1}}class ot{constructor(){this.onFrameComplete=()=>{this.transport&&this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()})},this.receiveEvent=new c.J,this.dispatchEvent=new c.J,this.isSync=!1}bind(t){this.transport!==t&&(this.unbind(),t.frameCompleteEvent.addHandler(this.onFrameComplete),t.SetModeSync(this.isSync),this.transport=t)}unbind(){this.transport&&(this.transport.frameCompleteEvent.removeHandler(this.onFrameComplete),this.transport=void 0)}send(t,e){this.transport&&(this.transport.IsOpen()||!this.transport.GetModeSync()?(this.transport.Send(t,e),setTimeout(()=>this.dispatchEvent.dispatch(),0)):this.receiveEvent.dispatch({data:void 0,isFrameComplete:!0}))}setModeSync(t){var e;this.isSync=t,null===(e=this.transport)||void 0===e||e.SetModeSync(t)}getModeSync(){var t,e;return null!==(e=null===(t=this.transport)||void 0===t?void 0:t.GetModeSync())&&void 0!==e&&e}dispatch(){if(!this.transport)return;const t=this.transport.RxBytesPending();0!==t&&(this.transport.GetModeSync()&&t<1024||this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()}))}}const st=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);class at{constructor(){this.timer=0}reset(){this.timer=0}exec(t){const e=performance.now();try{return t()}finally{this.timer+=performance.now()-e}}get(){return this.timer}}class ct{constructor(t){this.cloudpilotInstance=t,this.materialize=()=>this.timed.exec(()=>{var t,e;if(this.cloudpilotInstance.isSuspended())return this.state="idle",!1;switch(this.state){case"scheduled":break;case"materialized":this.mergeBack();break;default:throw new Error(`bad snapshot state in materialize: ${this.state}`)}if(!this.snapshotMemory)throw new Error("snapshot not initialized");this.materializeSnapshot(this.snapshotMemory,this.cloudpilotInstance.getDirtyPages(),this.cloudpilotInstance.getMemory32()),this.updateMemoryCrc(),this.size=this.snapshotMemory.pageCount*this.snapshotMemory.pageSize*4;const i=this.cloudpilotInstance.getMountedKey()||void 0;if(this.updateSnapshotStorage(i),this.snapshotStorage){if(void 0===this.storageKey)throw new Error("unreachable");const t=this.cloudpilotInstance.getCardDirtyPages(this.storageKey),e=this.cloudpilotInstance.getCardData(this.storageKey);if(void 0===t||void 0===e)throw new Error(`storage key ${this.storageKey} not registered`);this.materializeSnapshot(this.snapshotStorage,t,e),this.size+=this.snapshotStorage.pageCount*this.snapshotStorage.pageSize*4}return this.savestate=this.cloudpilotInstance.saveState()?this.cloudpilotInstance.getSavestate():void 0,this.size+=null!==(e=null===(t=this.savestate)||void 0===t?void 0:t.length)&&void 0!==e?e:0,this.state="materialized",!0}),this.snapshotDoneEvent=new c.J,this.snapshotReleaseEvent=new c.J,this.state="idle",this.memoryCrcCheck=!1,this.timed=new at,this.timestampStart=0,this.size=0}initializeMemory(){const t=this.cloudpilotInstance.getMemory32(),e=t.length>>>8;this.snapshotMemory={pageSize:256,pageCount:0,pageCountTotal:e,pages:new Uint32Array(e),offsets:new Uint32Array(e),pageData:t}}schedule(t){if("idle"!==this.state)throw new Error("snapshot already in progress");return this.state="scheduled",this.memoryCrcCheck=t,this.timed.reset(),this.timestampStart=Date.now(),this}isIdle(){return"idle"===this.state}getStorageKey(){return this.storageKey}refresh(){return e(this,void 0,void 0,function*(){})}release(t,e,i){try{this.timed.exec(()=>{const e=this.state;this.state="idle","materialized"===e&&(t||this.mergeBack())}),this.snapshotDoneEvent.dispatch({success:t,size:this.size,timeBlocking:e+this.timed.get(),timeTotal:e+i+this.timed.get(),timestamp:this.timestampStart})}finally{this.snapshotReleaseEvent.dispatch()}}getSnapshotMemory(){if(!this.snapshotMemory)throw new Error("snapshot not initialized");if("materialized"!==this.state)throw new Error("snapshot not materialized");return this.snapshotMemory}getSnapshotNand(){}getSnapshotStorage(){if("materialized"!==this.state)throw new Error("snapshot not materialized");return this.snapshotStorage}getSavestate(){if("materialized"!==this.state||!this.savestate)throw new Error("snapshot not materialized");return this.savestate}getMemoryCrc(){return this.memoryCrc}mergeBackSnapshot(t,e){for(let i=0;i<t.pageCount;i++){const n=t.pages[i];e[n>>>3]|=1<<(7&n)}}mergeBack(){if(!this.snapshotMemory)throw new Error("snapshot not materialized");if(this.mergeBackSnapshot(this.snapshotMemory,this.cloudpilotInstance.getDirtyPages()),this.snapshotStorage){if(void 0===this.storageKey)throw new Error("unreachable");const t=this.cloudpilotInstance.getCardDirtyPages(this.storageKey);void 0===t?console.warn(`seems like storage ${this.storageKey} was ejected; nothing to merge back, changes are lost`):this.mergeBackSnapshot(this.snapshotStorage,t)}}materializeSnapshot(t,e,i){const{pageCountTotal:n,pageSize:r,pages:o,offsets:s}=t;let a=0,c=0;for(let t=0;t<e.length;t++){const i=e[t];if(e[t]=0,0!==i)for(let t=1;t<256&&!(c>=n);t<<=1)i&t&&(o[a]=c,s[a]=c*r,a++),c++;else c+=8}t.pageCount=a,t.pageData=i}updateMemoryCrc(){if(this.memoryCrcCheck){const t=this.cloudpilotInstance.getMemory32();this.memoryCrc=function(t){let e=-1;for(let i=0;i<t.length;i++)e=st[255&(e^t[i])]^e>>>8;return~e}(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}else this.memoryCrc=void 0}updateSnapshotStorage(t){if(this.storageKey===t)return;if(this.storageKey=t,this.snapshotStorage=void 0,void 0===t)return;const e=this.cloudpilotInstance.getCardData(t);if(!e)throw new Error(`storage key ${t} not registered`);const i=e.length>>>11;this.snapshotStorage={pageSize:2048,pageCount:0,pageCountTotal:i,pages:new Uint32Array(i),offsets:new Uint32Array(i),pageData:e}}}class pt{constructor(t,e,i){this.cloudpilotInstance=t,this.clandestineExecute=e,this.settings=i,this.type="cloudpilot",this.onPwmUpdate=t=>{this.pendingPwmUpdates.count()>0&&this.pendingPwmUpdates.peekLast().frequency<0?this.pendingPwmUpdates.replaceLast(t):this.pendingPwmUpdates.push(t)},this.onSerialPortDispatch=()=>{this.processTimesliceNow()},this.onSchedule=t=>{this.cloudpilotInstance.isScreenDirty()&&this.newFrameEvent.dispatch(),this.pendingPwmUpdates.count()>0&&t-this.lastPwmUpdateEvent>10&&(this.pwmUpdateEvent.dispatch(this.pendingPwmUpdates.pop()),this.lastPwmUpdateEvent=t),void 0===this.advanceEmulationHandle&&(this.advanceEmulationHandle=window.setTimeout(()=>{this.advanceEmulationHandle=void 0,this.advanceEmulation(t)},0)),this.timePerFrameAverage.push(Math.max(0,t-this.timestampLastFrame)),this.timestampLastFrame=t,this.schedule()},this.onSnapshotRelease=()=>{0!==this.snapshotReleaseCallbacks.length&&(this.snapshotReleaseCallbacks.forEach(t=>t()),this.snapshotReleaseCallbacks=[])},this.pwmUpdateEvent=new c.J,this.configuredHotsyncNameUpdateEvent=new c.J,this.newFrameEvent=new c.J,this.timesliceEvent=new c.J,this.suspendEvent=new c.J,this.snapshotEvent=new c.J,this.palmosStateChangeEvent=new c.J,this.running=!1,this.powerOff=!1,this.uiInitialized=!1,this.suspended=!1,this.emulationSpeed=1,this.speedAverage=new $(20),this.timePerFrameAverage=new $(60),this.timestampLastFrame=0,this.frameCounter=0,this.clockEmulator=0,this.scheduler=new nt(t=>this.onSchedule(t)),this.serialPortIR=new ot,this.serialPortSerial=new ot,this.pendingPwmUpdates=new J(10),this.lastPwmUpdateEvent=0,this.canvasTmp=document.createElement("canvas"),this.serialSyncStartedAt=0,this.lastSnapshotAt=0,this.snapshotReleaseCallbacks=[],this.snapshotContainer=new ct(t),this.snapshotContainer.snapshotReleaseEvent.addHandler(this.onSnapshotRelease),t.clearExternalStorage(),this.serialPortIR.bind(t.getTransportIR()),this.serialPortSerial.bind(t.getTransportSerial()),this.serialPortIR.dispatchEvent.addHandler(this.onSerialPortDispatch),this.serialPortSerial.dispatchEvent.addHandler(this.onSerialPortDispatch),t.pwmUpdateEvent.addHandler(this.onPwmUpdate)}supportsKeyboardIO(){return!0}shutdown(){this.serialPortIR.unbind(),this.serialPortSerial.unbind(),this.serialPortIR.dispatchEvent.removeHandler(this.onSerialPortDispatch),this.serialPortSerial.dispatchEvent.removeHandler(this.onSerialPortDispatch),this.cloudpilotInstance.pwmUpdateEvent.removeHandler(this.onPwmUpdate)}get fatalError(){return this.cloudpilotInstance.fatalErrorEvent}get snapshotDoneEvent(){return this.snapshotContainer.snapshotDoneEvent}penDown(t,e){this.cloudpilotInstance.queuePenMove(t,e)}penUp(){this.cloudpilotInstance.queuePenUp()}buttonDown(t){this.cloudpilotInstance.queueButtonDown(t)}buttonUp(t){this.cloudpilotInstance.queueButtonUp(t)}keyStroke(t){this.cloudpilotInstance.queueKeyboardEvent(t)}reset(){return e(this,void 0,void 0,function*(){this.cloudpilotInstance.reset()})}resetNoExtensions(){return e(this,void 0,void 0,function*(){this.cloudpilotInstance.resetNoExtensions()})}resetHard(){return e(this,void 0,void 0,function*(){this.cloudpilotInstance.resetHard()})}isRunning(){return this.running}isPowerOff(){return this.powerOff}isLcdEnabled(){return!this.isPowerOff()}isUIInitialized(){return this.uiInitialized}isSuspended(){return this.suspended}isSlowdown(){return this.emulationSpeed<1}getDeviceId(){var t;return null!==(t=this.deviceId)&&void 0!==t?t:r.m515}openSession(t,i,n,r,o,s){return e(this,void 0,void 0,function*(){if(n)throw new Error("Cloudpilot devices do not support NAND");let e=!1;if(this.cloudpilotInstance.clearExternalStorage(),s&&(yield s.load(this)),!this.cloudpilotInstance.initializeSession(t,i))return!1;r&&(r.length%4!=0?console.warn("memory size is not a multiple of 4; ignoring image"):(e=this.cloudpilotInstance.loadMemory(new Uint32Array(r.buffer,r.byteOffset,r.length>>>2)),e||console.warn("failed to load memory"))),e&&o&&this.cloudpilotInstance.loadState(o),this.cloudpilotInstance.remountCards(),void 0===this.cloudpilotInstance.getMountedKey()&&s&&!this.cloudpilotInstance.remountFailed()&&this.cloudpilotInstance.mountCard(s.storageKey),this.deviceId=i,this.speedAverage.reset(1),this.powerOff=this.cloudpilotInstance.isPowerOff(),this.uiInitialized=this.cloudpilotInstance.isUiInitialized();const a=y(i);return this.canvasTmp.width=a.width,this.canvasTmp.height=a.height,this.snapshotContainer.initializeMemory(),!0})}resume(){return e(this,void 0,void 0,function*(){this.running||(this.clockEmulator=performance.now(),this.schedule(),this.running=!0,this.resetFPS())})}stop(){return e(this,void 0,void 0,function*(){this.running&&(this.scheduler.cancel(),void 0!==this.advanceEmulationHandle&&(window.clearTimeout(this.advanceEmulationHandle),this.advanceEmulationHandle=void 0),this.running=!1)})}processTimesliceNow(){this.advanceEmulation(performance.now())}requestSnapshot(){return e(this,void 0,void 0,function*(){return this.snapshotContainer.schedule(this.settings.memoryCrc)})}waitForPendingSnapshot(){return e(this,void 0,void 0,function*(){if(!this.snapshotContainer.isIdle())return new Promise(t=>this.snapshotReleaseCallbacks.push(t))})}blitFrame(t){if(!this.cloudpilotInstance.isScreenDirty()||this.cloudpilotInstance.isPowerOff())return;const e=this.cloudpilotInstance.getFrame();if(!e.hasChanges)return;if(e.lines*e.scaleY===t.height&&e.lineWidth*e.scaleX===t.width){this.imageData&&this.imageData.width===e.lineWidth&&this.imageData.height===e.lines||(this.imageData=new ImageData(e.lineWidth,e.lines));const t=new Uint32Array(this.imageData.data.buffer);switch(e.bpp){case 1:{const i=A[15],n=A[0];let r=0;for(let o=e.firstDirtyLine;o<=e.lastDirtyLine;o++){const s=o*e.bytesPerLine;for(let o=e.margin;o<e.lineWidth+e.margin;o++)t[r++]=e.buffer[s+(o>>>3)]&128>>>(7&o)?i:n}break}case 2:{const i=this.cloudpilotInstance.getPalette2bitMapping(),n=[A[15&i],A[i>>>4&15],A[i>>>8&15],A[i>>>12&15]];let r=0;for(let i=e.firstDirtyLine;i<=e.lastDirtyLine;i++){const o=i*e.bytesPerLine;for(let i=e.margin;i<e.lineWidth+e.margin;i++)t[r++]=n[e.buffer[o+(i>>>2)]>>6-2*(3&i)&3]}break}case 4:{let i=0;for(let n=e.firstDirtyLine;n<=e.lastDirtyLine;n++){const r=n*e.bytesPerLine;for(let n=e.margin;n<e.lineWidth+e.margin;n++)t[i++]=A[e.buffer[r+(n>>>1)]>>>4-4*(1&n)&15]}break}case 24:{const i=new Uint32Array(e.buffer.buffer,e.buffer.byteOffset,e.buffer.byteLength>>>2);if(0===e.margin)t.subarray(0,e.lineWidth*(e.lastDirtyLine-e.firstDirtyLine+1)).set(i.subarray(e.firstDirtyLine*e.lineWidth,e.lineWidth*(e.lastDirtyLine+1)));else{let n=0;for(let r=e.firstDirtyLine;r<=e.lastDirtyLine;r++){let o=r*(e.bytesPerLine>>>2)+e.margin;for(let r=0;r<e.lineWidth;r++)t[n++]=i[o++]}}}}}if(!this.imageData)return;const i=1!==e.scaleX||1!==e.scaleY,n=t.getContext("2d"),r=i?this.canvasTmp.getContext("2d"):void 0;if(!n||i&&!r)throw new Error("unable to retrieve rendering context");(i?r:n).putImageData(this.imageData,0,e.firstDirtyLine,0,0,e.lineWidth,e.lastDirtyLine-e.firstDirtyLine+1),i&&(n.imageSmoothingEnabled=!1,n.drawImage(this.canvasTmp,0,e.firstDirtyLine,e.lineWidth,e.lastDirtyLine-e.firstDirtyLine+1,0,e.firstDirtyLine*e.scaleY,e.lineWidth*e.scaleX,(e.lastDirtyLine-e.firstDirtyLine+1)*e.scaleY)),this.cloudpilotInstance.markScreenClean(),this.frameCounter++}updateSettings(t){this.cloudpilotInstance.getClipboardIntegration()!==t.clipboardIntegration&&this.cloudpilotInstance.setClipboardIntegration(t.clipboardIntegration),this.cloudpilotInstance.getNetworkRedirection()!==t.networkIntegration&&this.cloudpilotInstance.setNetworkRedirection(this.settings.networkIntegration),this.cloudpilotInstance.setHotsyncNameManagement(t.manageHotsyncName),this.settings=t}allocateCard(t,e){if(!this.cloudpilotInstance.allocateCard(t,e))throw new Error(`failed to allocate card "${t}" @ ${e} bytes`);const i=this.cloudpilotInstance.getCardData(t);if(!i)throw new Error(`failed to get card data for key ${t}`);return i}releaseCard(t){return e(this,void 0,void 0,function*(){this.cloudpilotInstance.removeCard(t)||console.warn(`failed to release card for key ${t}`)})}getMountedKey(){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.getMountedKey()})}getCardData(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.getCardData(t)})}mountCard(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.mountCard(t)})}getFullState(){return e(this,void 0,void 0,function*(){if(void 0!==this.deviceId)return this.cloudpilotInstance.saveState(),{rom:this.cloudpilotInstance.getRomImage().slice(),memory:this.cloudpilotInstance.getMemory().slice(),savestate:this.cloudpilotInstance.getSavestate().slice()}})}getSerialPortSerial(){return this.serialPortSerial}getSerialPortIR(){return this.serialPortIR}getStatistics(){return{type:"cloudpilot",hostSpeed:this.speedAverage.calculateAverage(),emulationSpeed:this.emulationSpeed,averageFps:this.calculateFPS()}}getOSVersion(){return this.cloudpilotInstance.getOSVersion()}installDb(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.installDb(t)})}backup(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.backup(i=>e(this,void 0,void 0,function*(){const e=[];for(i.Init(t);i.IsInProgress();){const t=i.GetCurrentDatabase();i.Save()||e.push(t),yield new Promise(t=>setTimeout(t,0))}const n=this.cloudpilotInstance.getArchive(i);return n?{archive:n,failedDatabases:e}:void 0}))})}launchAppByName(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.launchAppByName(t)})}launchAppByHeader(t){return e(this,void 0,void 0,function*(){return this.cloudpilotInstance.launchAppByDbHeader(t)})}schedule(){this.scheduler.cancel(),this.settings.schedulerKind!==this.scheduler.getKind()&&(this.scheduler=0===this.settings.schedulerKind?new nt(t=>this.onSchedule(t)):new rt(t=>this.onSchedule(t))),this.clandestineExecute(()=>this.scheduler.schedule())}resetFPS(){this.timePerFrameAverage.reset(),this.timestampLastFrame=performance.now()}calculateFPS(){const t=this.timePerFrameAverage.calculateAverage();return t&&1e3/t}updateEmulationSpeed(t){if(t>=1&&this.emulationSpeed>=1)return;const e=Math.min(Math.max(Math.floor(10*t)/10,.1),1);e<=this.emulationSpeed?this.emulationSpeed=e:this.emulationSpeed=t-e>=.05?e:this.emulationSpeed}checkAndUpdateHotsyncName(){if(!this.cloudpilotInstance)return;void 0===this.deviceHotsyncName&&(this.deviceHotsyncName=this.cloudpilotInstance.getHotsyncName());const t=this.settings.hotsyncName;void 0===t?this.configuredHotsyncNameUpdateEvent.dispatch(this.deviceHotsyncName):t!==this.deviceHotsyncName&&t.length<=40&&this.cloudpilotInstance.isSetupComplete()&&(this.cloudpilotInstance.setHotsyncName(t),this.deviceHotsyncName=t)}advanceEmulation(t){if(!this.isRunning)return;if(t<this.clockEmulator)return;this.cloudpilotInstance.isSuspended()&&5===this.cloudpilotInstance.getSuspendKind()&&t-this.serialSyncStartedAt>250&&(console.log("serial sync timeout, waking emulator"),this.cloudpilotInstance.getSuspendContextSerialSync().Cancel());const e=this.cloudpilotInstance.isSuspended();let i=!1;this.cloudpilotInstance.setClockFactor(this.emulationSpeed*this.settings.speed),t-this.clockEmulator>1e3/30&&(this.clockEmulator=t-1e3/30);const n=(t-this.clockEmulator)/1e3*this.cloudpilotInstance.cyclesPerSecond(),r=performance.now();let o=0;for(;o<n;)if(o+=this.cloudpilotInstance.runEmulation(Math.ceil(n-o)),this.cloudpilotInstance.isSuspended()){i=!0;break}const s=o/this.cloudpilotInstance.cyclesPerSecond()*1e3,a=performance.now()-r,c=Math.max(s,a);this.clockEmulator+=c,this.speedAverage.push(s/(a>0?a:s/1e3)*this.emulationSpeed),this.updateEmulationSpeed(this.speedAverage.calculateAverage()),i&&!e&&(5===this.cloudpilotInstance.getSuspendKind()?this.serialSyncStartedAt=performance.now():this.suspendEvent.dispatch());const p=this.cloudpilotInstance.isPowerOff(),u=this.cloudpilotInstance.isUiInitialized();p===this.powerOff&&u===this.uiInitialized||(this.powerOff=p,this.uiInitialized=u,this.palmosStateChangeEvent.dispatch()),u&&!p&&this.settings.manageHotsyncName&&!i&&this.checkAndUpdateHotsyncName(),this.serialPortIR.dispatch(),this.serialPortSerial.dispatch(),this.settings.automaticSnapshotInterval>0&&t-this.lastSnapshotAt>this.settings.automaticSnapshotInterval&&!this.cloudpilotInstance.isSuspended()&&(this.snapshotContainer.isIdle()&&this.snapshotEvent.dispatch(this.snapshotContainer.schedule(this.settings.memoryCrc)),this.lastSnapshotAt=t),this.timesliceEvent.dispatch(c)}}class ut{constructor(t){this.dispatchMessage=t,this.nextRpcId=0,this.pendingCalls=new Map}call(t,e,i){return new Promise((n,r)=>{const o=this.nextRpcId++;this.pendingCalls.set(o,{resolve:n,reject:r}),this.dispatchMessage({type:"rpcCall",id:o,method:t,args:e},i)})}dispatchRpcMessage(t){switch(t.type){case"rpcSuccess":this.getContext(t.id).resolve(t.result);break;case"rpcError":this.getContext(t.id).reject(t.error)}}getContext(t){const e=this.pendingCalls.get(t);if(!e)throw new Error(`RPC failed: no context with ID ${t}`);return this.pendingCalls.delete(t),e}}function lt(t){return t?[t.pagePool,t.scheduledPages]:[]}class dt{constructor(t,e,i,n){if(this.rpcHost=i,this.dispatch=n,this.snapshotDoneEvent=new c.J,this.savestate=new Uint8Array,this.sdSize=0,t%1024!=0)throw new Error("invalid memory size");if(e%4224!=0)throw new Error("invalid NAND size");const r=t>>>10,o=new Uint32Array(r);for(let t=0;t<r;t++)o[t]=256*t;this.snapshotMemory={pageCount:0,pageCountTotal:r,offsets:o,pages:new Uint32Array,pageData:new Uint32Array,pageSize:256};const s=e/4224|0,a=new Uint32Array(s);for(let t=0;t<s;t++)a[t]=1056*t;this.snapshotNand={pageCount:0,pageCountTotal:s,offsets:a,pages:new Uint32Array,pageData:new Uint32Array,pageSize:1056}}schedule(t){if(this.uarmSnapshot)throw new Error("snapshot already pending");return t.memory&&this.updateSnapshot(this.snapshotMemory,t.memory),t.nand&&this.updateSnapshot(this.snapshotNand,t.nand),this.updateSnapshotSd(t),this.savestate=new Uint8Array(t.savestate),this.uarmSnapshot=t,this}materialize(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");return!0}refresh(){return e(this,void 0,void 0,function*(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");const t=this.uarmSnapshot;this.uarmSnapshot=void 0,this.schedule(yield this.rpcHost.call("refreshSnapshot",t))})}release(t,e,i){var n,r,o,s,a;if(!this.uarmSnapshot)throw new Error("no pending snapshot");let c=1024*(null!==(r=null===(n=this.uarmSnapshot.memory)||void 0===n?void 0:n.scheduledPageCount)&&void 0!==r?r:0)+4224*(null!==(s=null===(o=this.uarmSnapshot.nand)||void 0===o?void 0:o.scheduledPageCount)&&void 0!==s?s:0)+this.uarmSnapshot.savestate.byteLength;this.uarmSnapshot.sd&&(c+=8192*this.uarmSnapshot.sd.snapshot.scheduledPageCount),this.dispatch({type:"returnSnapshot",snapshot:this.uarmSnapshot,success:t},[...lt(this.uarmSnapshot.memory),...lt(this.uarmSnapshot.nand),...lt(null===(a=this.uarmSnapshot.sd)||void 0===a?void 0:a.snapshot),this.uarmSnapshot.savestate]);const p=this.uarmSnapshot.time,u=p+i+e,l=this.uarmSnapshot.timestamp;this.uarmSnapshot=void 0,this.snapshotDoneEvent.dispatch({success:t,size:c,timeBlocking:p,timeTotal:u,timestamp:l})}getStorageKey(){var t;if(!this.uarmSnapshot)throw new Error("no pending snapshot");return null===(t=this.uarmSnapshot.sd)||void 0===t?void 0:t.key}getSnapshotMemory(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");return this.uarmSnapshot.memory?this.snapshotMemory:void 0}getSnapshotNand(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");return this.uarmSnapshot.nand?this.snapshotNand:void 0}getSnapshotStorage(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");return this.uarmSnapshot.sd?this.snapshotSd:void 0}getMemoryCrc(){var t;if(!this.uarmSnapshot)throw new Error("no pending snapshot");return null===(t=this.uarmSnapshot.memory)||void 0===t?void 0:t.crc}getSavestate(){if(!this.uarmSnapshot)throw new Error("no pending snapshot");return this.savestate}updateSnapshot(t,e){t.pageCount=e.scheduledPageCount,t.pages=new Uint32Array(e.scheduledPages),t.pageData=new Uint32Array(e.pagePool)}updateSnapshotSd(t){if(t.sd){if(this.snapshotSd||(this.snapshotSd={pageCount:0,pageCountTotal:0,offsets:new Uint32Array,pages:new Uint32Array,pageData:new Uint32Array,pageSize:2048}),this.sdSize!==t.sd.size){this.snapshotSd.pageCountTotal=t.sd.size>>>13,t.sd.size>this.snapshotSd.pageCountTotal<<13&&this.snapshotSd.pageCountTotal++,this.snapshotSd.offsets=new Uint32Array(this.snapshotSd.pageCountTotal);for(let t=0;t<this.snapshotSd.pageCountTotal;t++)this.snapshotSd.offsets[t]=2048*t;this.sdSize=t.sd.size}this.updateSnapshot(this.snapshotSd,t.sd.snapshot)}}}class ht{constructor(t,e,i){this.worker=t,this.settings=e,this.type="uarm",this.dispatchMessage=(t,e)=>{this.worker.postMessage(t,e)},this.onVisibilityChange=()=>{"hidden"===document.visibilityState?this.dispatchMessage({type:"setBackgrounded",backgrounded:!0}):this.dispatchMessage({type:"setBackgrounded",backgrounded:!1})},this.onMessage=t=>{const e=t.data;switch(e.type){case"ready":return this.fatal("duplicate ready event");case"rpcError":case"rpcSuccess":return this.rpcHost.dispatchRpcMessage(e);case"fatalError":return this.fatal(e.error);case"timeslice":{this.timesliceEvent.dispatch(e.sizeSeconds),this.currentIps=e.currentIps,this.currentIpsMax=e.currentIpsMax;const t=this.lcdEnabled;this.lcdEnabled=e.lcdEnabled,e.frame&&e.lcdEnabled?(this.returnPendingFrame(),this.pendingFrame=e.frame,this.newFrameEvent.dispatch()):e.lcdEnabled||null!=t&&!t||this.newFrameEvent.dispatch(),this.lcdEnabled=e.lcdEnabled;break}case"snapshot":try{if(!this.snapshotContainer)throw new Error("Unreachable: emulator runs, but snapshots are not initialized");this.snapshotEvent.dispatch(this.snapshotContainer.schedule(e.snapshot))}catch(t){throw this.fatal(`${t}`),t}break;case"systemStateChanged":this.uiInitialized=e.uiInitialized,this.osVersion=e.osVersion,this.palmosStateChangeEvent.dispatch()}},this.newFrameEvent=new c.J,this.timesliceEvent=new c.J,this.suspendEvent=new c.J,this.snapshotEvent=new c.J,this.palmosStateChangeEvent=new c.J,this.fatalError=new c.J,this.snapshotDoneEvent=new c.J,this.running=!1,this.currentIps=0,this.currentIpsMax=0,this.card={state:0},this.pcmChannel=new MessageChannel,this.uiInitialized=!1,this.rpcHost=new ut(this.dispatchMessage),i(()=>t.addEventListener("message",this.onMessage))}static create(t,n,r,o){return e(this,void 0,void 0,function*(){const e=void 0===o?new Worker(new URL(i.p+i.u(893),i.b)):new Worker(o);return(yield new Promise((t,i)=>{const o=[],s=()=>o.forEach(([t,i])=>e.removeEventListener(t,i)),a=t=>{s(),i(t.error)},c=o=>{s(),"ready"===o.data.type?t(new ht(e,n,r)):i(new Error("invalid message from worker"))};e.addEventListener("error",a),e.addEventListener("message",c,{once:!0}),o.push(["error",a],["message",c])})).initialize(t)})}supportsKeyboardIO(){return!1}shutdown(){this.worker.removeEventListener("message",this.onMessage),this.worker.terminate(),document.removeEventListener("visibilitychange",this.onVisibilityChange)}getStatistics(){return{type:"uarm",currentSpeedMips:this.currentIps/1e6|0,currentMaxSpeedMips:this.currentIpsMax/1e6|0}}getPcmPort(){return this.pcmChannel.port1}enablePcmStreaming(){console.log("streaming enabled"),this.dispatchMessage({type:"setPcmStreaming",pcmStreaming:!0})}disablePcmStreaming(){console.log("streaming disabled"),this.dispatchMessage({type:"setPcmStreaming",pcmStreaming:!1})}penDown(t,e){this.dispatchMessage({type:"penDown",x:t,y:e})}penUp(){this.dispatchMessage({type:"penUp"})}buttonDown(t){this.dispatchMessage({type:"buttonDown",button:t})}buttonUp(t){this.dispatchMessage({type:"buttonUp",button:t})}keyStroke(t,e){}reset(){return this.rpcHost.call("reset",0)}resetNoExtensions(){return this.rpcHost.call("reset",1)}resetHard(){return this.rpcHost.call("reset",2)}isRunning(){return this.running}isPowerOff(){return!1}isLcdEnabled(){var t;return null!==(t=this.lcdEnabled)&&void 0!==t&&t}isUIInitialized(){return this.uiInitialized}isSlowdown(){return this.currentIps/1e6<this.settings.targetMips*this.settings.warnSlowdownThreshold}getOSVersion(){var t;return null!==(t=this.osVersion)&&void 0!==t?t:0}getDeviceId(){if(void 0===this.deviceId)throw new Error("not initialized");return this.deviceId}openSession(t,i,n,r,o,s){return e(this,void 0,void 0,function*(){if(void 0!==this.deviceId)throw new Error("already initialized");this.deviceId=i,s&&(yield s.load(this));const e=1===this.card.state?[new Uint8Array(this.card.data.buffer),this.card.key]:void 0;if(!(yield this.rpcHost.call("openSession",{rom:t,nand:n,memory:r,state:o,card:e},[t.buffer,null==n?void 0:n.buffer,null==r?void 0:r.buffer,null==o?void 0:o.buffer,1===this.card.state?this.card.data.buffer:void 0].filter(t=>void 0!==t))))return!1;const a=yield this.rpcHost.call("getMemorySize",void 0);this.snapshotContainer=new dt(a.memory,a.nand,this.rpcHost,this.dispatchMessage),this.snapshotContainer.snapshotDoneEvent.addHandler(t=>this.snapshotDoneEvent.dispatch(t));const c=yield this.rpcHost.call("getSdCardState",void 0);return this.card=c.inserted?{state:2,key:c.key}:{state:0},!0})}resume(){return e(this,void 0,void 0,function*(){yield this.rpcHost.call("start",void 0),this.running=!0})}stop(){return e(this,void 0,void 0,function*(){yield this.rpcHost.call("stop",void 0),this.running=!1,this.returnPendingFrame()})}processTimesliceNow(){console.log("processTimesliceNow not implemented for uARM")}requestSnapshot(){return e(this,void 0,void 0,function*(){if(!this.snapshotContainer)throw new Error("emulator not initialized");return this.snapshotContainer.schedule(yield this.rpcHost.call("takeSnapshot",void 0))})}waitForPendingSnapshot(){return this.rpcHost.call("waitForPendingSnapshot",void 0)}blitFrame(t){var e;if(!this.pendingFrame)return;const i=new ImageData(new Uint8ClampedArray(this.pendingFrame),320);null===(e=t.getContext("2d"))||void 0===e||e.putImageData(i,0,0),this.returnPendingFrame()}updateSettings(t){this.settings=t,this.dispatchMessage({type:"updateSettings",settings:t})}allocateCard(t,e){if(0!==this.card.state)throw new Error(`bad card state ${this.card.state}`);if(3&e)throw new Error(`invalid card size ${e}`);return this.card={state:1,key:t,data:new Uint32Array(e>>>2)},this.card.data}releaseCard(t){return e(this,void 0,void 0,function*(){0!==this.card.state&&(yield this.rpcHost.call("sdCardEject",void 0),this.card={state:0})})}mountCard(t){return e(this,void 0,void 0,function*(){if(1!==this.card.state)throw new Error("no card allocated");if(this.card.key!==t)throw new Error(`wrong key: got ${t}, expected ${this.card.key}`);return(yield this.rpcHost.call("sdCardInsert",{data:this.card.data,key:this.card.key},[this.card.data.buffer]))?(this.card={state:2,key:t},!0):(this.card={state:0},!1)})}getMountedKey(){return e(this,void 0,void 0,function*(){return 2===this.card.state?this.card.key:void 0})}getCardData(t){if(2!==this.card.state)throw new Error("no card mounted");if(this.card.key!==t)throw new Error(`invalid key: expected ${this.card.key}, got ${t}`);return this.rpcHost.call("getSdCardData",void 0)}getFullState(){return e(this,void 0,void 0,function*(){return void 0===this.deviceId?void 0:this.rpcHost.call("getFullState",void 0)})}installDb(t){return this.rpcHost.call("installDb",t)}backup(t){return this.rpcHost.call("backup",{includeRom:t})}launchAppByName(t){return this.rpcHost.call("launchAppByName",t)}launchAppByHeader(t){return this.rpcHost.call("launchAppByHeader",t.subarray(0,32).slice())}initialize(t){return e(this,void 0,void 0,function*(){return yield this.rpcHost.call("initialize",{module:t,settings:this.settings,pcmPort:this.pcmChannel.port2},[this.pcmChannel.port2]),document.addEventListener("visibilitychange",this.onVisibilityChange),this})}fatal(t){this.fatalError.dispatch(t instanceof Error?t:new Error(t))}returnPendingFrame(){this.pendingFrame&&this.dispatchMessage({type:"returnFrame",frame:this.pendingFrame},[this.pendingFrame]),this.pendingFrame=void 0}}const mt={automaticSnapshotInterval:0,memoryCrc:!1,speed:1,hotsyncName:"",manageHotsyncName:!1,schedulerKind:0,networkIntegration:!1,clipboardIntegration:!1,disableAudio:!1,maxHostLoad:1,targetMips:100,warnSlowdownThreshold:.5,runInBackground:!1};class vt{constructor(t){this.cloudpilotPromise=t,this.onEngineNewFrameEvent=()=>{if(!this.engine)throw new Error("invalid state");this.engine.isLcdEnabled()?this.engine.blitFrame(this.canvas):this.clearCanvas(),this.newFrameEvent.dispatch(this.canvas)},this.onEngineTimesliceEvent=t=>this.onAfterAdvanceEmulation(t),this.onEngineSuspendEvent=()=>this.handleSuspend(),this.onEngineConfigureHotsyncNameEvent=t=>this.updateConfiguredHotsyncName(t),this.onSnapshotEvent=t=>this.handleSnapshot(t),this.onSnapshotDoneEvent=t=>this.snapshotDoneEvent.dispatch(t),this.onPalmosStateChangeEvent=()=>{this.handlePalmosStateChange(),this.palmosStateChangeEvent.dispatch()},this.onFatalError=t=>this.handleFatalInNativeCode(t),this.newFrameEvent=new c.J,this.newSessionEvent=new c.J,this.emulationStateChangeEvent=new c.J,this.palmosStateChangeEvent=new c.J,this.openSessionEvent=new c.J,this.snapshotDoneEvent=new c.J,this.canvas=document.createElement("canvas"),this.lastPenUpdate=0,this.penDown=!1,this.engineSettings=Object.assign({},mt),this.shouldRun=!1,this.blocked=!1,t.then(t=>t.fatalErrorEvent.addHandler(this.onFatalError))}handlePointerMove(t,e,i){var n;if(!(null===(n=this.engine)||void 0===n?void 0:n.isRunning()))return;const r=performance.now();if(this.penDown=!0,!(r-this.lastPenUpdate<25)){if(i){const i=y(this.deviceId());t=this.transformSilkscreenX(t,i),e=this.transformSilkscreenY(e,i)}this.engine.penDown(Math.floor(t),Math.floor(e)),this.lastPenUpdate=r}}handlePointerUp(){var t;(null===(t=this.engine)||void 0===t?void 0:t.isRunning())&&(this.engine&&this.penDown&&this.engine.penUp(),this.lastPenUpdate=0,this.penDown=!1)}handleButtonDown(t){var e,i;(null===(e=this.engine)||void 0===e?void 0:e.isRunning())&&(null===(i=this.engine)||void 0===i||i.buttonDown(t))}handleButtonUp(t){var e,i;(null===(e=this.engine)||void 0===e?void 0:e.isRunning())&&(null===(i=this.engine)||void 0===i||i.buttonUp(t))}handleKeyDown(t){var e,i;(null===(e=this.engine)||void 0===e?void 0:e.isRunning())&&(null===(i=this.engine)||void 0===i||i.keyStroke(t))}reset(){return e(this,void 0,void 0,function*(){var t;yield null===(t=this.engine)||void 0===t?void 0:t.reset()})}resetNoExtensions(){return e(this,void 0,void 0,function*(){var t;yield null===(t=this.engine)||void 0===t?void 0:t.resetNoExtensions()})}resetHard(){return e(this,void 0,void 0,function*(){var t;yield null===(t=this.engine)||void 0===t?void 0:t.resetHard()})}isRunning(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.isRunning())&&void 0!==e&&e}isPowerOff(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.isPowerOff())&&void 0!==e&&e}isUiInitialized(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.isUIInitialized())&&void 0!==e&&e}getCanvas(){return this.canvas}getStatistics(){var t;return null===(t=this.engine)||void 0===t?void 0:t.getStatistics()}isSlowdown(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.isSlowdown())&&void 0!==e&&e}isSuspended(){var t;return"cloudpilot"===(null===(t=this.engine)||void 0===t?void 0:t.type)&&this.engine.isSuspended()}isBlocked(){return this.blocked}getSerialPortSerial(){var t;return"cloudpilot"===(null===(t=this.engine)||void 0===t?void 0:t.type)?this.engine.getSerialPortSerial():void 0}getSerialPortIR(){var t;return"cloudpilot"===(null===(t=this.engine)||void 0===t?void 0:t.type)?this.engine.getSerialPortIR():void 0}updateEngineSettings(t){var e;this.engineSettings=Object.assign(Object.assign({},this.engineSettings),t),null===(e=this.engine)||void 0===e||e.updateSettings(this.engineSettings)}deviceId(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.getDeviceId())&&void 0!==e?e:r.m515}pwmUpdateEvent(){var t;return"cloudpilot"===(null===(t=this.engine)||void 0===t?void 0:t.type)?this.engine.pwmUpdateEvent:void 0}pcmPort(){var t;return"uarm"===(null===(t=this.engine)||void 0===t?void 0:t.type)?this.engine.getPcmPort():void 0}enablePcmStreaming(){var t;"uarm"===(null===(t=this.engine)||void 0===t?void 0:t.type)&&this.engine.enablePcmStreaming()}disablePcmStreaming(){var t;"uarm"===(null===(t=this.engine)||void 0===t?void 0:t.type)&&this.engine.disablePcmStreaming()}supportsKeyboardIO(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.supportsKeyboardIO())&&void 0!==e&&e}processTimesliceNow(){var t;null===(t=this.engine)||void 0===t||t.processTimesliceNow()}openSession(t,i,n,r,o,s){return e(this,void 0,void 0,function*(){var e;this.unbindEngineHandlers(this.engine),null===(e=this.engine)||void 0===e||e.shutdown(),this.engine=void 0,this.shouldRun=!1;const a=yield this.createEngine(_(i));return a.updateSettings(this.engineSettings),!!(yield a.openSession(t,i,n,r,o,s))&&(this.bindEngineHandlers(a),this.engine=a,this.resetCanvas(),this.openSessionEvent.dispatch(),!0)})}resetCanvas(){const t=y(this.deviceId());this.canvas.width=t.width,this.canvas.height=t.height,this.clearCanvas()}doResume(){return e(this,void 0,void 0,function*(){this.shouldRun=!0,yield this.enforceRunState()})}doStop(){return e(this,void 0,void 0,function*(){this.shouldRun=!1,yield this.enforceRunState()})}doBlock(){return e(this,void 0,void 0,function*(){this.blocked=!0,yield this.enforceRunState()})}doUnblock(){return e(this,void 0,void 0,function*(){this.blocked=!1,yield this.enforceRunState()})}clearCanvas(){const t=this.deviceId(),e=this.canvas.getContext("2d");if(!e)throw new Error("Unable to get rendering context. Get a new browser.");e.beginPath(),e.rect(0,0,this.canvas.width,this.canvas.height),e.fillStyle=f(t)?"white":U[0],e.fill()}transformSilkscreenX(t,e){if(void 0===e.silkscreenOvershoot)return t;const i=e.width/(e.width+2*e.silkscreenOvershoot);return(t-e.width/2)/i+e.width/2}transformSilkscreenY(t,e){return void 0===e.siklscreenShift?t:t+e.siklscreenShift}requestSnapshot(){return e(this,void 0,void 0,function*(){var t;return yield null===(t=this.engine)||void 0===t?void 0:t.requestSnapshot()})}getOSVersion(){var t,e;return null!==(e=null===(t=this.engine)||void 0===t?void 0:t.getOSVersion())&&void 0!==e?e:0}getUarmWorkerUrl(){}enforceRunState(){return e(this,void 0,void 0,function*(){this.engine&&(this.shouldRun&&!this.blocked?yield this.engine.resume():yield this.engine.stop(),this.emulationStateChangeEvent.dispatch(this.engine.isRunning()))})}createEngine(t){return e(this,void 0,void 0,function*(){switch(t){case"cloudpilot":return new pt(yield this.cloudpilotPromise,this.clandestineExecute,this.engineSettings);case"uarm":return ht.create(yield this.getUarmModule(),this.engineSettings,this.clandestineExecute,this.getUarmWorkerUrl());default:throw new Error("unreachable")}})}bindEngineHandlers(t){if(t)switch(t.newFrameEvent.addHandler(this.onEngineNewFrameEvent),t.suspendEvent.addHandler(this.onEngineSuspendEvent),t.timesliceEvent.addHandler(this.onEngineTimesliceEvent),t.snapshotEvent.addHandler(this.onSnapshotEvent),t.palmosStateChangeEvent.addHandler(this.onPalmosStateChangeEvent),t.snapshotDoneEvent.addHandler(this.onSnapshotDoneEvent),t.type){case"cloudpilot":t.configuredHotsyncNameUpdateEvent.addHandler(this.onEngineConfigureHotsyncNameEvent);break;case"uarm":t.fatalError.addHandler(this.onFatalError)}}unbindEngineHandlers(t){if(t)switch(t.newFrameEvent.removeHandler(this.onEngineNewFrameEvent),t.suspendEvent.removeHandler(this.onEngineSuspendEvent),t.timesliceEvent.removeHandler(this.onEngineTimesliceEvent),t.snapshotEvent.removeHandler(this.onSnapshotEvent),t.palmosStateChangeEvent.removeHandler(this.onPalmosStateChangeEvent),t.snapshotDoneEvent.removeHandler(this.onSnapshotDoneEvent),t.type){case"cloudpilot":t.configuredHotsyncNameUpdateEvent.removeHandler(this.onEngineConfigureHotsyncNameEvent);break;case"uarm":t.fatalError.removeHandler(this.onFatalError)}}}class yt extends vt{constructor(t,i,n){super(Promise.resolve(t)),this.uarmModuleFactory=i,this.uarmWorkerUrl=n,this.pause=()=>this.mutex.runExclusive(()=>this.doStop()),this.resume=()=>this.mutex.runExclusive(()=>this.doResume()),this.initWithRom=(t,i,n,r)=>this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){return this.isRunning()&&(yield this.doStop(),this.session=void 0),!!(yield this.openSession(t,n,i))&&(this.setSession(r),!0)})),this.initWithSessionImage=(t,i)=>this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){return this.isRunning()&&(yield this.doStop(),this.session=void 0),!!(yield this.openSession(t.rom,t.deviceId,t.nand,t.memory,t.savestate))&&(this.setSession(i),!0)})),this.clandestineExecute=t=>t(),this.mutex=new M,this.timesliceEvent=new c.J,this.syncSettings()}getSession(){return this.session}syncSettings(){var t,e,i,n,r,o,s,a,c,p,u,l;this.updateEngineSettings({manageHotsyncName:!0,hotsyncName:null===(t=this.session)||void 0===t?void 0:t.hotsyncName,speed:null!==(i=null===(e=this.session)||void 0===e?void 0:e.speed)&&void 0!==i?i:1,targetMips:100*(null!==(r=null===(n=this.session)||void 0===n?void 0:n.speed)&&void 0!==r?r:1),schedulerKind:(null===(o=this.session)||void 0===o?void 0:o.runInBackground)?1:0,runInBackground:null!==(a=null===(s=this.session)||void 0===s?void 0:s.runInBackground)&&void 0!==a&&a,disableAudio:null!==(p=null===(c=this.session)||void 0===c?void 0:c.disablePcmAudio)&&void 0!==p&&p,maxHostLoad:null!==(l=null===(u=this.session)||void 0===u?void 0:u.maxHostLoad)&&void 0!==l?l:1})}getEngine(){return this.engine}updateConfiguredHotsyncName(t){this.session&&(this.session.hotsyncName=t)}onAfterAdvanceEmulation(t){this.timesliceEvent.dispatch()}handleSuspend(){}handleSnapshot(t){t.release(!1,0,0)}getUarmModule(){return this.uarmModuleFactory()}handleFatalInNativeCode(t){console.error(t)}handlePalmosStateChange(){}getUarmWorkerUrl(){return this.uarmWorkerUrl}setSession(t){this.session=t,this.syncSettings()}}class ft{constructor(t,e){this.emulationService=t,this.canvasDisplayService=e,this.handleMouseDown=t=>{if(0!==t.button)return;const e=this.canvasDisplayService.eventToPalmCoordinates(t);if(!e)return;const i=this.determineArea(e);if(2===i){const t=this.canvasDisplayService.determineButton(e);this.interactionMouse={area:i,buttonPrimary:t},this.handleButtonDown(t)}else this.interactionMouse={area:i},this.emulationService.handlePointerMove(...e,1===i)},this.handleMouseMove=t=>{var e,i;if(!(1&t.buttons&&this.interactionMouse&&2!==(null===(e=this.interactionMouse)||void 0===e?void 0:e.area)))return;const n=this.canvasDisplayService.eventToPalmCoordinates(t,!0);n&&this.emulationService.handlePointerMove(...n,1===(null===(i=this.interactionMouse)||void 0===i?void 0:i.area))},this.handeMouseUp=t=>{if(0!==t.button)return;const e=this.interactionMouse;switch(this.interactionMouse=void 0,null==e?void 0:e.area){case 2:this.handleButtonUp(e.buttonPrimary);break;case 0:case 1:this.emulationService.handlePointerUp()}},this.handleTouchStart=t=>{let e=!1;for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches.item(i);if(!n)continue;const r=this.canvasDisplayService.eventToPalmCoordinates(n);if(!r)continue;e=!0;const o=this.determineArea(r);if(2===o){const t=this.canvasDisplayService.determineButton(r);this.interactionsTouch.set(n.identifier,{area:o,buttonPrimary:t}),this.handleButtonDown(t)}else this.interactionsTouch.set(n.identifier,{area:o}),this.emulationService.handlePointerMove(...r,1===o)}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchMove=t=>{let e=!1;for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches.item(i);if(!n)continue;const r=this.interactionsTouch.get(n.identifier);if(!r)continue;e=!0;const o=r.area;switch(o){case 2:{const t=this.canvasDisplayService.eventToPalmCoordinates(n);if(!t||2!==this.determineArea(t)){this.handleButtonUp(r.buttonSecondary),r.buttonSecondary=void 0;break}const e=this.canvasDisplayService.determineButton(t);e===r.buttonPrimary?(this.handleButtonUp(r.buttonSecondary),r.buttonSecondary=void 0):e!==r.buttonSecondary&&(this.handleButtonUp(r.buttonSecondary),r.buttonSecondary=e,this.handleButtonDown(e));break}case 0:case 1:{const t=this.canvasDisplayService.eventToPalmCoordinates(n,!0);if(!t)continue;this.emulationService.handlePointerMove(...t,1===o);break}default:continue}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchEnd=t=>{let e=!1;for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches.item(i);if(!n)continue;const r=this.interactionsTouch.get(n.identifier);switch(r&&(e=!0),this.interactionsTouch.delete(n.identifier),null==r?void 0:r.area){case 2:this.handleButtonUp(r.buttonPrimary),this.handleButtonUp(r.buttonSecondary);break;case 0:case 1:this.emulationService.handlePointerUp()}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleKeyDown=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;if(this.isToggleGameMode(t))return t.preventDefault(),this.gameMode=!this.gameMode,void this.onToggleGameMode();const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonDown(e),void t.preventDefault();const i=this.keyCodeFromEvent(t);void 0===i||t.ctrlKey||t.metaKey||(this.emulationService.handleKeyDown(i),t.preventDefault())},this.handleKeyUp=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonUp(e),void t.preventDefault();if("Control"===t.key){for(const t of this.activeButtons)this.emulationService.handleButtonUp(t);this.activeButtons.clear(),this.canvasDisplayService.drawButtons([])}},this.dpad=!1,this.keyEventTarget=window,this.interactionsTouch=new Map,this.activeButtons=new Set,this.gameMode=!1,this.enableGamemodeHotkey=!0}bind(t,e,i=window){this.dpad=e,this.pointerEventTarget&&this.release(),this.pointerEventTarget=t,this.keyEventTarget=i||window,this.addEventListener(t,"mousedown",this.handleMouseDown),this.addEventListener(window,"mouseup",this.handeMouseUp),this.addEventListener(window,"mousemove",this.handleMouseMove),this.addEventListener(t,"touchstart",this.handleTouchStart),this.addEventListener(t,"touchmove",this.handleTouchMove),this.addEventListener(t,"touchend",this.handleTouchEnd),this.addEventListener(t,"touchcancel",this.handleTouchEnd),this.addEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.addEventListener(this.keyEventTarget,"keyup",this.handleKeyUp)}release(){if(this.pointerEventTarget){this.removeEventListener(this.pointerEventTarget,"mousedown",this.handleMouseDown),this.removeEventListener(window,"mouseup",this.handeMouseUp),this.removeEventListener(window,"mousemove",this.handleMouseMove),this.removeEventListener(this.pointerEventTarget,"touchstart",this.handleTouchStart),this.removeEventListener(this.pointerEventTarget,"touchmove",this.handleTouchMove),this.removeEventListener(this.pointerEventTarget,"touchend",this.handleTouchEnd),this.removeEventListener(this.pointerEventTarget,"touchcancel",this.handleTouchEnd),this.removeEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.removeEventListener(this.keyEventTarget,"keyup",this.handleKeyUp);for(const t of this.activeButtons)this.handleButtonUp(t);this.activeButtons.clear(),this.interactionsTouch.clear(),this.interactionMouse=void 0,this.pointerEventTarget=void 0}}isGameMode(){return this.gameMode}setGameMode(t){this.gameMode=t,this.onToggleGameMode()}setGameModeHotkeyEnabled(t){this.enableGamemodeHotkey=t}isGameModeHotkeyEnabled(){return this.enableGamemodeHotkey}enableKeyboardEvents(){return!0}onToggleGameMode(){}addEventListener(t,e,i,n){t.addEventListener(e,i,n)}removeEventListener(t,e,i,n){t.removeEventListener(e,i,n)}determineArea(t){return this.canvasDisplayService.isButtons(t)?2:this.canvasDisplayService.isSilkscreen(t)?1:0}handleButtonDown(t){this.activeButtons.has(t)||(this.activeButtons.add(t),this.emulationService.handleButtonDown(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}handleButtonUp(t){void 0!==t&&this.activeButtons.has(t)&&(this.activeButtons.delete(t),this.emulationService.handleButtonUp(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}isToggleGameMode(t){return this.isGameModeHotkeyEnabled()&&("Shift"===t.key&&t.ctrlKey||"Control"===t.key&&t.shiftKey)}isGameModeActive(t){return!this.gameMode&&t.ctrlKey||this.gameMode&&!t.ctrlKey||!this.emulationService.supportsKeyboardIO()}buttonFromEvent(t){switch(t.key){case"PageUp":return 4;case"PageDown":return 5}if(this.isGameModeActive(t)){switch(t.key){case"w":case"i":case"ArrowUp":return 4;case"s":case"k":case"ArrowDown":return 5;case"a":case"j":case"y":case"z":return 0;case"ArrowLeft":return this.dpad?14:0;case"q":case"u":case"x":return 1;case"e":case"o":case"c":return 2;case"d":case"l":case"v":return 3;case"ArrowRight":return this.dpad?15:3}if(this.dpad)switch(t.key){case"Enter":case" ":return 16}}}keyCodeFromEvent(t){if(!this.isGameModeActive(t)){if(1===t.key.length&&t.key.charCodeAt(0)<=255)return t.key.charCodeAt(0);switch(t.key){case"ArrowLeft":return 28;case"ArrowRight":return 29;case"ArrowUp":return 30;case"ArrowDown":return 31;case"Backspace":return 8;case"Tab":return 9;case"Enter":return 10;default:return}}}}class _t extends ft{constructor(t,e){super(t,e),this.gameModeChangeEvent=new c.J,this.canvasDisplayService=e}setDpadEnabled(t){this.dpad=t}onToggleGameMode(){this.canvasDisplayService.toggleGameModeIndicator(this.isGameMode()),this.gameModeChangeEvent.dispatch(this.isGameMode())}}const gt={hotsyncName:void 0,orientation:g.portrait,runInBackground:!1,speed:1,deviceId:r.m515,maxHostLoad:1,disablePcmAudio:!1,disableDpad:!1},St="MEMORY_CARD";class bt{constructor(t,e,i,n){this.cloudpilot=t,this.onTimeslice=()=>{this.powerOffWatcher.update(),this.uiInitializedWatcher.update(),this.hotsyncNameWatcher.update()},this.audioInitializedEvent=new c.J,this.mutex=new M,this.session=Object.assign({},gt),this.emulationService=new yt(t,e,i),this.canvasDisplayService=new K(new I(Promise.resolve(t))),this.eventHandlingService=new _t(this.emulationService,this.canvasDisplayService),this.audioService=new H(this.session,this.emulationService,n),this.emulationService.newFrameEvent.addHandler(t=>this.canvasDisplayService.updateEmulationCanvas(t)),this.timesliceEvent.addHandler(this.onTimeslice),this.powerOffWatcher=new k(()=>this.emulationService.isPowerOff()),this.uiInitializedWatcher=new k(()=>this.emulationService.isUiInitialized()),this.hotsyncNameWatcher=new k(()=>{var t;return null!==(t=this.session.hotsyncName)&&void 0!==t?t:""})}getStatistics(){return this.emulationService.getStatistics()}loadRom(t,i,n){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){if(void 0===n){const e=this.cloudpilot.getRomInfo(t);if(!e||0===e.supportedDevices.length)throw new Error("unsupported device");n=e.supportedDevices[0]}if(this.session=Object.assign(Object.assign({},gt),{deviceId:n}),this.audioService.setSession(this.session),!(yield this.emulationService.initWithRom(t.slice(),null==i?void 0:i.slice(),n,this.session)))throw new Error("failed to initialize session");this.eventHandlingService.setDpadEnabled(this.enableDpad()),this.canvasDisplayService.setDpadEnabled(this.enableDpad()),yield this.canvasDisplayService.initialize(void 0,n,this.session.orientation)}))})}loadSession(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){var e,i,n,r,o,s,a,c,p;const u=this.cloudpilot.deserializeSessionImage(t);if(!u)throw new Error("bad session image");if(this.session={hotsyncName:null===(e=u.metadata)||void 0===e?void 0:e.hotsyncName,speed:null!==(n=null===(i=u.metadata)||void 0===i?void 0:i.speed)&&void 0!==n?n:1,orientation:null!==(o=null===(r=u.metadata)||void 0===r?void 0:r.deviceOrientation)&&void 0!==o?o:g.portrait,runInBackground:!1,deviceId:u.deviceId,maxHostLoad:null!==(a=null===(s=u.metadata)||void 0===s?void 0:s.maxHostLoad)&&void 0!==a?a:1,disablePcmAudio:null!==(p=null===(c=u.metadata)||void 0===c?void 0:c.disableAudio)&&void 0!==p&&p,disableDpad:!1},this.audioService.setSession(this.session),!(yield this.emulationService.initWithSessionImage(u,this.session)))throw new Error("failed to initialize session");this.eventHandlingService.setDpadEnabled(this.enableDpad()),this.canvasDisplayService.setDpadEnabled(this.enableDpad()),yield this.canvasDisplayService.initialize(void 0,u.deviceId,this.session.orientation)}))})}insertCompressedCardImage(t){return e(this,void 0,void 0,function*(){const e=this.cloudpilot.decompress(t);if(!e)throw new Error("failed to decompress and mount card image");yield this.insertCardImage(e)})}insertCardImage(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){const e=this.getEngine();if(t.length%512!=0)throw new Error("card image size must be a multiple of 512");if(yield this.isCardMountedUnguarded())throw new Error("card already mounted");if(e.allocateCard(St,t.length).set(new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>>2)),!(yield e.mountCard(St)))throw new Error("failed to mount card image")}))})}ejectCard(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){const t=this.getEngine();(yield this.isCardMountedUnguarded())&&(yield t.releaseCard(St))}))})}isCardMounted(){return e(this,void 0,void 0,function*(){return yield this.mutex.runExclusive(()=>this.isCardMountedUnguarded())})}setCanvas(t){this.canvas=t,this.canvasDisplayService.initialize(t,this.session.deviceId,this.session.orientation)}releaseCanvas(){this.canvas=void 0,this.canvasDisplayService.initialize(void 0,this.session.deviceId,this.session.orientation)}bindInput(t){if(!this.canvas)throw new Error("you must set up the canvas setCanvas before calling bindInput");this.eventHandlingService.bind(this.canvas,this.enableDpad(),t)}releaseInput(){this.eventHandlingService.release()}installDatabase(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.installDatabaseUnguarded(t))})}installAndLaunchDatabase(t){return e(this,void 0,void 0,function*(){yield this.installDatabase(t),yield this.launchDatabase(t)})}installFromZipfile(t){return e(this,void 0,void 0,function*(){yield this.installFromZipfileAndLaunch(t)})}installFromZipfileAndLaunch(t,i){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){let n;if(yield this.cloudpilot.withZipfileWalker(t,t=>e(this,void 0,void 0,function*(){for(;0===t.GetState();){const e=t.GetCurrentEntryContent(),r=t.GetCurrentEntryName();if(!e)throw new Error(`unable to read ${r} from zipfile`);yield this.installDatabaseUnguarded(e),r.toLowerCase()===(null==i?void 0:i.toLowerCase())&&(n=e.subarray(0,32).slice()),t.Next()}if(-1===t.GetState())throw new Error("error reading zipfile")})),void 0!==i&&!n)throw new Error(`database ${i} not found `);n&&(yield this.launchDatabaseUnguarded(n))}))})}launchByName(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>e(this,void 0,void 0,function*(){const e=this.getEngine();if(!(yield e.launchAppByName(t)))throw new Error(`failed to launch ${t}`)}))})}launchDatabase(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.launchDatabaseUnguarded(t))})}reset(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.emulationService.reset())})}resetNoExtensions(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.emulationService.resetNoExtensions())})}resetHard(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.emulationService.resetHard())})}isRunning(){return e(this,void 0,void 0,function*(){return yield this.mutex.runExclusive(()=>this.emulationService.isRunning())})}isPowerOff(){return e(this,void 0,void 0,function*(){return yield this.mutex.runExclusive(()=>this.emulationService.isPowerOff())})}isUiInitialized(){return e(this,void 0,void 0,function*(){return yield this.mutex.runExclusive(()=>this.emulationService.isUiInitialized())})}resume(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.emulationService.resume())})}pause(){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>this.emulationService.pause())})}buttonDown(t){this.emulationService.handleButtonDown(t)}buttonUp(t){this.emulationService.handleButtonUp(t)}setSpeed(t){this.session.speed=t,this.emulationService.syncSettings()}getSpeed(){return this.session.speed}setVolume(t){this.audioService.setVolume(t)}getVolume(){return this.audioService.getVolume()}setDisablePcmAudio(t){this.session.disablePcmAudio=t,this.emulationService.syncSettings()}getDisablePcmAudio(){return this.session.disablePcmAudio}setMaxHostLoad(t){this.session.maxHostLoad=t,this.emulationService.syncSettings()}getMaxHostLoad(){return this.session.maxHostLoad}setDisableDpad(t){this.session.disableDpad=t,this.eventHandlingService.setDpadEnabled(this.enableDpad()),this.canvasDisplayService.setDpadEnabled(this.enableDpad()),this.canvasDisplayService.initialize()}getDisableDpad(){return this.session.disableDpad}initializeAudio(){return e(this,void 0,void 0,function*(){return yield this.audioService.initialize(),this.audioService.isInitialized()})}isAudioInitialized(){return this.audioService.isInitialized()}setOrientation(t){this.session.orientation=t,this.canvasDisplayService.updateOrientation(this.session.orientation)}getOrientation(){return this.session.orientation}setHotsyncName(t){return e(this,void 0,void 0,function*(){yield this.mutex.runExclusive(()=>{this.session.hotsyncName=t,this.emulationService.syncSettings()})})}getHotsyncName(){return e(this,void 0,void 0,function*(){return this.mutex.runExclusive(()=>this.session.hotsyncName)})}setRunHidden(t){this.session.runInBackground=t,this.emulationService.syncSettings()}getRunHidden(){return this.session.runInBackground}isGameMode(){return this.eventHandlingService.isGameMode()}setGameMode(t){this.eventHandlingService.setGameMode(t)}isGameModeHotkeyEnabled(){return this.eventHandlingService.isGameModeHotkeyEnabled()}setGameModeHotkeyEnabled(t){this.eventHandlingService.setGameModeHotkeyEnabled(t)}isGameModeIndicatorEnabled(){return this.canvasDisplayService.isGameModeIndicatorEnabled()}setGameModeIndicatorEnabled(t){this.canvasDisplayService.setGameModeIndicatorEnabled(t)}getSerialPortIR(){return this.emulationService.getSerialPortIR()}getSerialPortSerial(){return this.emulationService.getSerialPortSerial()}get powerOffChangeEvent(){return this.powerOffWatcher.changeEvent}get isUiInitializedChangeEvent(){return this.uiInitializedWatcher.changeEvent}get hotsyncNameChangeEvent(){return this.hotsyncNameWatcher.changeEvent}get gameModeChangeEvent(){return this.eventHandlingService.gameModeChangeEvent}get timesliceEvent(){return this.emulationService.timesliceEvent}isCardMountedUnguarded(){return e(this,void 0,void 0,function*(){const t=this.emulationService.getEngine();return!!t&&(yield t.getMountedKey())===St})}installDatabaseUnguarded(t){return e(this,void 0,void 0,function*(){const e=this.getEngine();if((yield e.installDb(t))<0)throw new Error("failed to install database")})}launchDatabaseUnguarded(t){return e(this,void 0,void 0,function*(){const e=this.getEngine();if(!(yield e.launchAppByHeader(t)))throw new Error(`failed to launch ${name}`)})}getEngine(){const t=this.emulationService.getEngine();return function(t){if(!t)throw new Error("session not initialized")}(t),t}enableDpad(){return!this.session.disableDpad&&function(t){switch(t){case r.te2:case r.frankene2:return!0;default:return!1}}(this.session.deviceId)}}var wt;!function(t){t[t.cal=0]="cal",t[t.phone=1]="phone",t[t.todo=2]="todo",t[t.notes=3]="notes",t[t.up=4]="up",t[t.down=5]="down",t[t.power=6]="power",t[t.cradle=7]="cradle"}(wt||(wt={}));const Ct="2.1.3",Et=(t,e)=>{let i;const n=()=>(i||(i=v(e)),i);return t&&n(),n};function It(){return e(this,arguments,void 0,function*(t={}){return Dt(t)()})}function Dt(t={}){var e,i,n;const r=function(t){const e=v(t);return(t,i)=>{e.then(e=>WebAssembly.instantiate(e,t)).then(t=>i(t))}}(null!==(e=t.cloudpilotModuleUrl)&&void 0!==e?e:"cloudpilot_web.wasm"),o=Et(null!==(i=t.preloadUarm)&&void 0!==i&&i,null!==(n=t.uarmModuleUrl)&&void 0!==n?n:"uarm_web.wasm");return()=>h.create(r).then(e=>new bt(e,o,t.uarmWorkerUrl,t.pcmWorkletUrl))}})(),n})());
//# sourceMappingURL=cloudpilot-emu.js.map