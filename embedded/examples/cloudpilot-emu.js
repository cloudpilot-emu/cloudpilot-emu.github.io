!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cloudpilot=e():t.cloudpilot=e()}(self,(()=>(()=>{var t={492:t=>{var e,r=(e="undefined"!=typeof document?document.currentScript?.src:void 0,async function(t={}){var r=t,i="object"==typeof window,n="undefined"!=typeof WorkerGlobalScope,o=("object"==typeof process&&process.versions?.node&&process.type,"./this.program"),s=(t,e)=>{throw e};n&&(e=self.location.href);var a,c,p="";if(i||n){try{p=new URL(".",e).href}catch{}n&&(c=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),a=async t=>{var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)}}var u,l,h,d,m,y,_,f,v,g,b,S=console.log.bind(console),w=console.error.bind(console),C=!1;function I(t,e){t||M(e)}function E(){if(!C){var t=ji();0==t&&(t+=4);var e=v[t>>2],r=v[t+4>>2];34821223==e&&2310721022==r||M(`Stack overflow! Stack cookie has been overwritten at ${U(t)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${U(r)} ${U(e)}`),1668509029!=v[0]&&M("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var D=!1;function G(){var t=m.buffer;y=new Int8Array(t),new Int16Array(t),r.HEAPU8=_=new Uint8Array(t),new Uint16Array(t),f=new Int32Array(t),r.HEAPU32=v=new Uint32Array(t),new Float32Array(t),g=new Float64Array(t),b=new BigInt64Array(t),new BigUint64Array(t)}var x,P=0,k=null;function M(t){r.onAbort?.(t),w(t="Aborted("+t+")"),C=!0,t+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(t);throw d?.(e),e}async function R(t,e,r){if(!t&&"function"==typeof WebAssembly.instantiateStreaming)try{var i=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(i,r)}catch(t){w(`wasm streaming compile failed: ${t}`),w("falling back to ArrayBuffer instantiation")}return async function(t,e){try{var r=await async function(t){if(!u)try{var e=await a(t);return new Uint8Array(e)}catch{}return function(t){if(t==x&&u)return new Uint8Array(u);if(c)return c(t);throw"both async and sync fetching of the wasm failed"}(t)}(t);return await WebAssembly.instantiate(r,e)}catch(t){w(`failed to asynchronously prepare wasm: ${t}`),M(t)}}(e,r)}class T{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var z,H,A=t=>{for(;t.length>0;)t.shift()(r)},B=[],N=[],L=!0,U=t=>"0x"+(t>>>=0).toString(16).padStart(8,"0"),j="undefined"!=typeof TextDecoder?new TextDecoder:void 0,F=(t,e=0,r=NaN)=>{for(var i=e+r,n=e;t[n]&&!(n>=i);)++n;if(n-e>16&&t.buffer&&j)return j.decode(t.subarray(e,n));for(var o="";e<n;){var s=t[e++];if(128&s){var a=63&t[e++];if(192!=(224&s)){var c=63&t[e++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&t[e++])<65536)o+=String.fromCharCode(s);else{var p=s-65536;o+=String.fromCharCode(55296|p>>10,56320|1023&p)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o},O=(t,e)=>t?F(_,t,e):"",W=t=>t<-9007199254740992||t>9007199254740992?NaN:Number(t),V=0,q=[0,31,60,91,121,152,182,213,244,274,305,335],K=[0,31,59,90,120,151,181,212,243,273,304,334],$=t=>{var e;return((e=t.getFullYear())%4!=0||e%100==0&&e%400!=0?K:q)[t.getMonth()]+t.getDate()-1},Q={},Y=t=>{if(t instanceof T||"unwind"==t)return l;E(),t instanceof WebAssembly.RuntimeError&&Wi()<=0&&w("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 1048576)"),s(0,t)},Z=()=>L||V>0,X=t=>{l=t,Z()||(r.onExit?.(t),C=!0),s(0,new T(t))},J=(t,e)=>{l=t,X(t)},tt=J,et=()=>performance.now(),rt=(t,e,r,i)=>{if(!(i>0))return 0;for(var n=r,o=r+i-1,s=0;s<t.length;++s){var a=t.codePointAt(s);if(a<=127){if(r>=o)break;e[r++]=a}else if(a<=2047){if(r+1>=o)break;e[r++]=192|a>>6,e[r++]=128|63&a}else if(a<=65535){if(r+2>=o)break;e[r++]=224|a>>12,e[r++]=128|a>>6&63,e[r++]=128|63&a}else{if(r+3>=o)break;e[r++]=240|a>>18,e[r++]=128|a>>12&63,e[r++]=128|a>>6&63,e[r++]=128|63&a,s++}}return e[r]=0,r-n},it=(t,e,r)=>rt(t,_,e,r),nt=()=>Date.now(),ot=[],st=(t,e)=>Math.ceil(t/e)*e,at=t=>{var e=(t-m.buffer.byteLength+65535)/65536|0;try{return m.grow(e),G(),1}catch(t){}},ct={},pt=()=>{if(!pt.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:o||"./this.program"};for(var e in ct)void 0===ct[e]?delete t[e]:t[e]=ct[e];var r=[];for(var e in t)r.push(`${e}=${t[e]}`);pt.strings=r}return pt.strings},ut=t=>{for(var e=0,r=0;r<t.length;++r){var i=t.charCodeAt(r);i<=127?e++:i<=2047?e+=2:i>=55296&&i<=57343?(e+=4,++r):e+=3}return e},lt=[null,[],[]],ht=(t,e,r)=>{var i=r>0?r:ut(t)+1,n=new Array(i),o=rt(t,n,0,n.length);return e&&(n.length=o),n},dt=[],mt=(t,e)=>{t<128?e.push(t):e.push(t%128|128,t>>7)},yt=[],_t=[],ft=(t,e)=>{z.set(t,e),yt[t]=z.get(t)};r.noExitRuntime&&(L=r.noExitRuntime),r.print&&(S=r.print),r.printErr&&(w=r.printErr),r.wasmBinary&&(u=r.wasmBinary),r.arguments&&r.arguments,r.thisProgram&&(o=r.thisProgram),r.addFunction=(t,e)=>{var r=(t=>(H||(H=new WeakMap,((t,e)=>{if(H)for(var r=0;r<0+e;r++){var i=(o=void 0,(o=yt[n=r])||(yt[n]=o=z.get(n)),o);i&&H.set(i,r)}var n,o})(0,z.length)),H.get(t)||0))(t);if(r)return r;var i=(()=>{if(_t.length)return _t.pop();try{z.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return z.length-1})();try{ft(i,t)}catch(r){if(!(r instanceof TypeError))throw r;var n=((t,e)=>{if("function"==typeof WebAssembly.Function)return new WebAssembly.Function((t=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},r={parameters:[],results:"v"==t[0]?[]:[e[t[0]]]},i=1;i<t.length;++i)r.parameters.push(e[t[i]]);return r})(e),t);var r=[1];((t,e)=>{var r=t.slice(0,1),i=t.slice(1),n={i:127,p:127,j:126,f:125,d:124,e:111};for(var o of(e.push(96),mt(i.length,e),i))e.push(n[o]);"v"==r?e.push(0):e.push(1,n[r])})(e,r);var i=[0,97,115,109,1,0,0,0,1];mt(r.length,i),i.push(...r),i.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var n=new WebAssembly.Module(new Uint8Array(i));return new WebAssembly.Instance(n,{e:{f:t}}).exports.f})(t,e);ft(i,n)}return H.set(t,i),i},r.UTF8ToString=O;var vt,gt,bt,St,wt,Ct,It,Et,Dt,Gt,xt,Pt,kt,Mt,Rt,Tt,zt,Ht,At,Bt,Nt,Lt,Ut,jt,Ft,Ot,Wt,Vt,qt,Kt,$t,Qt,Yt,Zt,Xt,Jt,te,ee,re,ie,ne,oe,se,ae,ce,pe,ue,le,he,de,me,ye,_e,fe,ve,ge,be,Se,we,Ce,Ie,Ee,De,Ge,xe,Pe,ke,Me,Re,Te,ze,He,Ae,Be,Ne,Le,Ue,je,Fe,Oe,We,Ve,qe,Ke,$e,Qe,Ye,Ze,Xe,Je,tr,er,rr,ir,nr,or,sr,ar,cr,pr,ur,lr,hr,dr,mr,yr,_r,fr,vr,gr,br,Sr,wr,Cr,Ir,Er,Dr,Gr,xr,Pr,kr,Mr,Rr,Tr,zr,Hr,Ar,Br,Nr,Lr,Ur,jr,Fr,Or,Wr,Vr,qr,Kr,$r,Qr,Yr,Zr,Xr,Jr,ti,ei,ri,ii,ni,oi,si,ai,ci,pi,ui,li,hi,di,mi,yi,_i,fi,vi,gi,bi,Si,wi,Ci,Ii,Ei,Di,Gi,xi,Pi,ki,Mi,Ri,Ti,zi,Hi,Ai,Bi,Ni,Li,Ui,ji,Fi,Oi,Wi,Vi={428784:t=>{z.grow(65536);for(let e=0;e<=65535;e++)z.set(z.length-65535-1+e,z.get(v[(t>>>2)+e]));return z.length-65535-1}},qi={a:(t,e,r,i)=>M(`Assertion failed: ${O(t)}, at: `+[e?O(e):"unknown filename",r,i?O(i):"unknown function"]),s:function(t){const e=new Error(O(t));throw e.isAssert=!0,e},c:function(t,e){e=W(e)},h:()=>M(""),j:()=>{L=!1,V=0},p:function(t,e){t=W(t);var r=new Date(1e3*t);f[e>>2]=r.getSeconds(),f[e+4>>2]=r.getMinutes(),f[e+8>>2]=r.getHours(),f[e+12>>2]=r.getDate(),f[e+16>>2]=r.getMonth(),f[e+20>>2]=r.getFullYear()-1900,f[e+24>>2]=r.getDay();var i=0|$(r);f[e+28>>2]=i,f[e+36>>2]=-60*r.getTimezoneOffset();var n=new Date(r.getFullYear(),0,1),o=new Date(r.getFullYear(),6,1).getTimezoneOffset(),s=n.getTimezoneOffset(),a=0|(o!=s&&r.getTimezoneOffset()==Math.min(s,o));f[e+32>>2]=a},q:function(t){var e=(()=>{var e=new Date(f[t+20>>2]+1900,f[t+16>>2],f[t+12>>2],f[t+8>>2],f[t+4>>2],f[t>>2],0),r=f[t+32>>2],i=e.getTimezoneOffset(),n=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),s=n.getTimezoneOffset(),a=Math.min(s,o);if(r<0)f[t+32>>2]=Number(o!=s&&a==i);else if(r>0!=(a==i)){var c=Math.max(s,o),p=r>0?a:c;e.setTime(e.getTime()+6e4*(p-i))}f[t+24>>2]=e.getDay();var u=0|$(e);f[t+28>>2]=u,f[t>>2]=e.getSeconds(),f[t+4>>2]=e.getMinutes(),f[t+8>>2]=e.getHours(),f[t+12>>2]=e.getDate(),f[t+16>>2]=e.getMonth(),f[t+20>>2]=e.getYear();var l=e.getTime();return isNaN(l)?-1:l/1e3})();return BigInt(e)},k:(t,e)=>{if(Q[t]&&(clearTimeout(Q[t].id),delete Q[t]),!e)return 0;var r=setTimeout((()=>{delete Q[t],(t=>{if(!C)try{t(),(()=>{if(!Z())try{tt(l)}catch(t){Y(t)}})()}catch(t){Y(t)}})((()=>Fi(t,et())))}),e);return Q[t]={id:r,timeout_ms:e},0},r:(t,e,r,i)=>{var n=(new Date).getFullYear(),o=new Date(n,0,1),s=new Date(n,6,1),a=o.getTimezoneOffset(),c=s.getTimezoneOffset(),p=Math.max(a,c);v[t>>2]=60*p,f[e>>2]=Number(a!=c);var u=t=>{var e=t>=0?"-":"+",r=Math.abs(t);return`UTC${e}${String(Math.floor(r/60)).padStart(2,"0")}${String(r%60).padStart(2,"0")}`},l=u(a),h=u(c);c<a?(it(l,r,17),it(h,i,17)):(it(l,i,17),it(h,r,17))},n:function(t,e,r){if(e=W(e),!((i=t)>=0&&i<=3))return 28;var i,n;n=0===t?nt():et();var o=Math.round(1e3*n*1e3);return b[r>>3]=BigInt(o),0},t:(t,e,r)=>((t,e,r)=>{var i=((t,e)=>{var r;for(ot.length=0;r=_[t++];){var i=105!=r;e+=(i&=112!=r)&&e%8?4:0,ot.push(112==r?v[e>>2]:106==r?b[e>>3]:105==r?f[e>>2]:g[e>>3]),e+=i?8:4}return ot})(e,r);return Vi[t](...i)})(t,e,r),g:nt,o:t=>{var e=_.length,r=2147483648;if((t>>>=0)>r)return!1;for(var i=1;i<=4;i*=2){var n=e*(1+.2/i);n=Math.min(n,t+100663296);var o=Math.min(r,st(Math.max(t,n),65536));if(at(o))return!0}return!1},l:(t,e)=>{var r=0,i=0;for(var n of pt()){var o=e+r;v[t+i>>2]=o,r+=it(n,o,1/0)+1,i+=4}return 0},m:(t,e)=>{var r=pt();v[t>>2]=r.length;var i=0;for(var n of r)i+=ut(n)+1;return v[e>>2]=i,0},d:t=>52,f:(t,e,r,i)=>52,b:function(t,e,r,i){return e=W(e),70},e:(t,e,r,i)=>{for(var n,o,s,a=0,c=0;c<r;c++){var p=v[e>>2],u=v[e+4>>2];e+=8;for(var l=0;l<u;l++)n=t,o=_[p+l],s=void 0,s=lt[n],0===o||10===o?((1===n?S:w)(F(s)),s.length=0):s.push(o);a+=u}return v[i>>2]=a,0},i:X},Ki=await async function(){function t(t,e){return Ki=t.exports,m=Ki.u,G(),z=Ki.Xc,function(t){r._malloc=t.w,r._free=t.x,r._main=vt=t.y,r._webidl_free=t.z,r._webidl_malloc=t.A,r._emscripten_bind_VoidPtr___destroy___0=gt=t.B,r._emscripten_bind_Cloudpilot_Cloudpilot_0=bt=t.C,r._emscripten_bind_Cloudpilot_Malloc_1=St=t.D,r._emscripten_bind_Cloudpilot_Free_1=wt=t.E,r._emscripten_bind_Cloudpilot_Nullptr_0=Ct=t.F,r._emscripten_bind_Cloudpilot_EnableLogging_1=It=t.G,r._emscripten_bind_Cloudpilot_InitializeSession_3=Et=t.H,r._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=Dt=t.I,r._emscripten_bind_Cloudpilot_RunEmulation_1=Gt=t.J,r._emscripten_bind_Cloudpilot_SetClockFactor_1=xt=t.K,r._emscripten_bind_Cloudpilot_CopyFrame_0=Pt=t.L,r._emscripten_bind_Cloudpilot_IsScreenDirty_0=kt=t.M,r._emscripten_bind_Cloudpilot_MarkScreenClean_0=Mt=t.N,r._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=Rt=t.O,r._emscripten_bind_Cloudpilot_FramebufferSizeForDevice_1=Tt=t.P,r._emscripten_bind_Cloudpilot_TotalMemoryForDevice_1=zt=t.Q,r._emscripten_bind_Cloudpilot_QueuePenMove_2=Ht=t.R,r._emscripten_bind_Cloudpilot_QueuePenUp_0=At=t.S,r._emscripten_bind_Cloudpilot_QueueButtonDown_1=Bt=t.T,r._emscripten_bind_Cloudpilot_QueueButtonUp_1=Nt=t.U,r._emscripten_bind_Cloudpilot_QueueKeyboardEvent_2=Lt=t.V,r._emscripten_bind_Cloudpilot_IsPowerOff_0=Ut=t.W,r._emscripten_bind_Cloudpilot_IsUIInitialized_0=jt=t.X,r._emscripten_bind_Cloudpilot_GetOSVersion_0=Ft=t.Y,r._emscripten_bind_Cloudpilot_IsSetupComplete_0=Ot=t.Z,r._emscripten_bind_Cloudpilot_Reset_0=Wt=t._,r._emscripten_bind_Cloudpilot_ResetNoExtensions_0=Vt=t.$,r._emscripten_bind_Cloudpilot_ResetHard_0=qt=t.aa,r._emscripten_bind_Cloudpilot_InstallDb_2=Kt=t.ba,r._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=$t=t.ca,r._emscripten_bind_Cloudpilot_GetMemoryPtr_0=Qt=t.da,r._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=Yt=t.ea,r._emscripten_bind_Cloudpilot_GetMemorySize_0=Zt=t.fa,r._emscripten_bind_Cloudpilot_ImportMemoryImage_2=Xt=t.ga,r._emscripten_bind_Cloudpilot_GetRomPtr_0=Jt=t.ha,r._emscripten_bind_Cloudpilot_GetRomSize_0=te=t.ia,r._emscripten_bind_Cloudpilot_GetSavestatePtr_0=ee=t.ja,r._emscripten_bind_Cloudpilot_GetSavestateSize_0=re=t.ka,r._emscripten_bind_Cloudpilot_SaveState_0=ie=t.la,r._emscripten_bind_Cloudpilot_LoadState_2=ne=t.ma,r._emscripten_bind_Cloudpilot_GetHotsyncName_0=oe=t.na,r._emscripten_bind_Cloudpilot_SetHotsyncName_1=se=t.oa,r._emscripten_bind_Cloudpilot_RegisterPwmHandler_1=ae=t.pa,r._emscripten_bind_Cloudpilot_StartBackup_0=ce=t.qa,r._emscripten_bind_Cloudpilot_SetClipboardIntegration_1=pe=t.ra,r._emscripten_bind_Cloudpilot_GetClipboardIntegration_0=ue=t.sa,r._emscripten_bind_Cloudpilot_IsSuspended_0=le=t.ta,r._emscripten_bind_Cloudpilot_GetSuspendContext_0=he=t.ua,r._emscripten_bind_Cloudpilot_SetNetworkRedirection_1=de=t.va,r._emscripten_bind_Cloudpilot_GetNetworkRedirection_0=me=t.wa,r._emscripten_bind_Cloudpilot_RegisterProxyDisconnectHandler_1=ye=t.xa,r._emscripten_bind_Cloudpilot_SetHotsyncNameManagement_1=_e=t.ya,r._emscripten_bind_Cloudpilot_LaunchAppByName_1=fe=t.za,r._emscripten_bind_Cloudpilot_LaunchAppByDbHeader_2=ve=t.Aa,r._emscripten_bind_Cloudpilot_DeviceSupportsCardSize_1=ge=t.Ba,r._emscripten_bind_Cloudpilot_ClearExternalStorage_0=be=t.Ca,r._emscripten_bind_Cloudpilot_AllocateCard_2=Se=t.Da,r._emscripten_bind_Cloudpilot_AdoptCard_3=we=t.Ea,r._emscripten_bind_Cloudpilot_MountCard_1=Ce=t.Fa,r._emscripten_bind_Cloudpilot_RemoveCard_1=Ie=t.Ga,r._emscripten_bind_Cloudpilot_GetCardData_1=Ee=t.Ha,r._emscripten_bind_Cloudpilot_GetCardDirtyPages_1=De=t.Ia,r._emscripten_bind_Cloudpilot_GetCardSize_1=Ge=t.Ja,r._emscripten_bind_Cloudpilot_RemountCards_0=xe=t.Ka,r._emscripten_bind_Cloudpilot_GetSupportLevel_1=Pe=t.La,r._emscripten_bind_Cloudpilot_GetMountedKey_0=ke=t.Ma,r._emscripten_bind_Cloudpilot_GetTransportIR_0=Me=t.Na,r._emscripten_bind_Cloudpilot_GetTransportSerial_0=Re=t.Oa,r._emscripten_bind_Cloudpilot___destroy___0=Te=t.Pa,r._emscripten_bind_RomInfo_RomInfo_2=ze=t.Qa,r._emscripten_bind_RomInfo_IsValid_0=He=t.Ra,r._emscripten_bind_RomInfo_CardVersion_0=Ae=t.Sa,r._emscripten_bind_RomInfo_CardName_0=Be=t.Ta,r._emscripten_bind_RomInfo_RomVersion_0=Ne=t.Ua,r._emscripten_bind_RomInfo_RomVersionString_0=Le=t.Va,r._emscripten_bind_RomInfo_Supports_1=Ue=t.Wa,r._emscripten_bind_RomInfo___destroy___0=je=t.Xa,r._emscripten_bind_Frame_GetLineWidth_0=Fe=t.Ya,r._emscripten_bind_Frame_GetBpp_0=Oe=t.Za,r._emscripten_bind_Frame_GetLines_0=We=t._a,r._emscripten_bind_Frame_GetMargin_0=Ve=t.$a,r._emscripten_bind_Frame_GetBytesPerLine_0=qe=t.ab,r._emscripten_bind_Frame_GetFirstDirtyLine_0=Ke=t.bb,r._emscripten_bind_Frame_GetLastDirtyLine_0=$e=t.cb,r._emscripten_bind_Frame_GetHasChanges_0=Qe=t.db,r._emscripten_bind_Frame_GetBuffer_0=Ye=t.eb,r._emscripten_bind_Frame_GetBufferSize_0=Ze=t.fb,r._emscripten_bind_Frame_GetScaleX_0=Xe=t.gb,r._emscripten_bind_Frame_GetScaleY_0=Je=t.hb,r._emscripten_bind_Frame___destroy___0=tr=t.ib,r._emscripten_bind_DbBackup_Init_1=er=t.jb,r._emscripten_bind_DbBackup_IsInProgress_0=rr=t.kb,r._emscripten_bind_DbBackup_IsDone_0=ir=t.lb,r._emscripten_bind_DbBackup_GetCurrentDatabase_0=nr=t.mb,r._emscripten_bind_DbBackup_Save_0=or=t.nb,r._emscripten_bind_DbBackup_Skip_0=sr=t.ob,r._emscripten_bind_DbBackup_GetArchivePtr_0=ar=t.pb,r._emscripten_bind_DbBackup_GetArchiveSize_0=cr=t.qb,r._emscripten_bind_DbBackup___destroy___0=pr=t.rb,r._emscripten_bind_SuspendContextClipboardCopy_Cancel_0=ur=t.sb,r._emscripten_bind_SuspendContextClipboardCopy_Resume_0=lr=t.tb,r._emscripten_bind_SuspendContextClipboardCopy_GetClipboardContent_0=hr=t.ub,r._emscripten_bind_SuspendContextClipboardCopy___destroy___0=dr=t.vb,r._emscripten_bind_SuspendContextClipboardPaste_Cancel_0=mr=t.wb,r._emscripten_bind_SuspendContextClipboardPaste_Resume_1=yr=t.xb,r._emscripten_bind_SuspendContextClipboardPaste___destroy___0=_r=t.yb,r._emscripten_bind_SuspendContextNetworkConnect_Cancel_0=fr=t.zb,r._emscripten_bind_SuspendContextNetworkConnect_Resume_0=vr=t.Ab,r._emscripten_bind_SuspendContextNetworkConnect___destroy___0=gr=t.Bb,r._emscripten_bind_SuspendContextNetworkRpc_Cancel_0=br=t.Cb,r._emscripten_bind_SuspendContextNetworkRpc_GetRequestSize_0=Sr=t.Db,r._emscripten_bind_SuspendContextNetworkRpc_GetRequestData_0=wr=t.Eb,r._emscripten_bind_SuspendContextNetworkRpc_ReceiveResponse_2=Cr=t.Fb,r._emscripten_bind_SuspendContextNetworkRpc___destroy___0=Ir=t.Gb,r._emscripten_bind_SuspendContextSerialSync_Cancel_0=Er=t.Hb,r._emscripten_bind_SuspendContextSerialSync_Resume_0=Dr=t.Ib,r._emscripten_bind_SuspendContextSerialSync___destroy___0=Gr=t.Jb,r._emscripten_bind_SuspendContext_GetKind_0=xr=t.Kb,r._emscripten_bind_SuspendContext_Cancel_0=Pr=t.Lb,r._emscripten_bind_SuspendContext_AsContextClipboardCopy_0=kr=t.Mb,r._emscripten_bind_SuspendContext_AsContextClipboardPaste_0=Mr=t.Nb,r._emscripten_bind_SuspendContext_AsContextNetworkConnect_0=Rr=t.Ob,r._emscripten_bind_SuspendContext_AsContextNetworkRpc_0=Tr=t.Pb,r._emscripten_bind_SuspendContext_AsContextSerialSync_0=zr=t.Qb,r._emscripten_bind_SuspendContext___destroy___0=Hr=t.Rb,r._emscripten_bind_SessionImage_SessionImage_0=Ar=t.Sb,r._emscripten_bind_SessionImage_GetDeviceId_0=Br=t.Tb,r._emscripten_bind_SessionImage_SetDeviceId_1=Nr=t.Ub,r._emscripten_bind_SessionImage_GetRomImage_0=Lr=t.Vb,r._emscripten_bind_SessionImage_GetRomImageSize_0=Ur=t.Wb,r._emscripten_bind_SessionImage_SetRomImage_2=jr=t.Xb,r._emscripten_bind_SessionImage_GetMemoryImage_0=Fr=t.Yb,r._emscripten_bind_SessionImage_GetMemoryImageSize_0=Or=t.Zb,r._emscripten_bind_SessionImage_SetMemoryImage_2=Wr=t._b,r._emscripten_bind_SessionImage_GetMetadata_0=Vr=t.$b,r._emscripten_bind_SessionImage_GetMetadataSize_0=qr=t.ac,r._emscripten_bind_SessionImage_SetMetadata_2=Kr=t.bc,r._emscripten_bind_SessionImage_GetSavestate_0=$r=t.cc,r._emscripten_bind_SessionImage_GetSavestateSize_0=Qr=t.dc,r._emscripten_bind_SessionImage_SetSavestate_2=Yr=t.ec,r._emscripten_bind_SessionImage_GetVersion_0=Zr=t.fc,r._emscripten_bind_SessionImage_Serialize_0=Xr=t.gc,r._emscripten_bind_SessionImage_GetSerializedImage_0=Jr=t.hc,r._emscripten_bind_SessionImage_GetSerializedImageSize_0=ti=t.ic,r._emscripten_bind_SessionImage_Deserialize_2=ei=t.jc,r._emscripten_bind_SessionImage___destroy___0=ri=t.kc,r._emscripten_bind_SkinLoader_SkinLoader_1=ii=t.lc,r._emscripten_bind_SkinLoader_GetData_0=ni=t.mc,r._emscripten_bind_SkinLoader_GetSize_0=oi=t.nc,r._emscripten_bind_SkinLoader___destroy___0=si=t.oc,r._emscripten_bind_EmTransportSerialBuffer_RxBytesPending_0=ai=t.pc,r._emscripten_bind_EmTransportSerialBuffer_Receive_0=ci=t.qc,r._emscripten_bind_EmTransportSerialBuffer_Send_3=pi=t.rc,r._emscripten_bind_EmTransportSerialBuffer_IsOpen_0=ui=t.sc,r._emscripten_bind_EmTransportSerialBuffer_Rts_0=li=t.tc,r._emscripten_bind_EmTransportSerialBuffer_Dtr_0=hi=t.uc,r._emscripten_bind_EmTransportSerialBuffer_IsBreak_0=di=t.vc,r._emscripten_bind_EmTransportSerialBuffer_BufferSize_0=mi=t.wc,r._emscripten_bind_EmTransportSerialBuffer_GetBaud_0=yi=t.xc,r._emscripten_bind_EmTransportSerialBuffer_GetParity_0=_i=t.yc,r._emscripten_bind_EmTransportSerialBuffer_GetStopBits_0=fi=t.zc,r._emscripten_bind_EmTransportSerialBuffer_GetDataBits_0=vi=t.Ac,r._emscripten_bind_EmTransportSerialBuffer_GetHwrHandshake_0=gi=t.Bc,r._emscripten_bind_EmTransportSerialBuffer_GetModeSync_0=bi=t.Cc,r._emscripten_bind_EmTransportSerialBuffer_SetModeSync_1=Si=t.Dc,r._emscripten_bind_EmTransportSerialBuffer_IsFrameComplete_0=wi=t.Ec,r._emscripten_bind_EmTransportSerialBuffer_SetRequestTransferCallback_1=Ci=t.Fc,r._emscripten_bind_EmTransportSerialBuffer___destroy___0=Ii=t.Gc,r._emscripten_bind_GunzipContext_GunzipContext_3=Ei=t.Hc,r._emscripten_bind_GunzipContext_GetState_0=Di=t.Ic,r._emscripten_bind_GunzipContext_Continue_0=Gi=t.Jc,r._emscripten_bind_GunzipContext_GetUncompressedData_0=xi=t.Kc,r._emscripten_bind_GunzipContext_ReleaseUncompressedData_0=Pi=t.Lc,r._emscripten_bind_GunzipContext_GetUncompressedSize_0=ki=t.Mc,r._emscripten_bind_GunzipContext_GetError_0=Mi=t.Nc,r._emscripten_bind_GunzipContext___destroy___0=Ri=t.Oc,r._emscripten_bind_ZipfileWalker_ZipfileWalker_2=Ti=t.Pc,r._emscripten_bind_ZipfileWalker_GetState_0=zi=t.Qc,r._emscripten_bind_ZipfileWalker_Next_0=Hi=t.Rc,r._emscripten_bind_ZipfileWalker_GetTotalEntries_0=Ai=t.Sc,r._emscripten_bind_ZipfileWalker_GetCurrentEntrySize_0=Bi=t.Tc,r._emscripten_bind_ZipfileWalker_GetCurrentEntryName_0=Ni=t.Uc,r._emscripten_bind_ZipfileWalker_GetCurrentEntryContent_0=Li=t.Vc,r._emscripten_bind_ZipfileWalker___destroy___0=Ui=t.Wc,ji=t.Yc,Fi=t.Zc,Oi=t._c,Wi=t.$c,r.___original_main=t.ad}(Ki),function(t){if(P--,r.monitorRunDependencies?.(P),0==P&&k){var e=k;k=null,e()}}(),Ki}P++,r.monitorRunDependencies?.(P);var e,i={a:qi};return r.instantiateWasm?new Promise(((e,n)=>{r.instantiateWasm(i,((r,i)=>{e(t(r))}))})):(x??=(e="cloudpilot_web.wasm",r.locateFile?r.locateFile(e,p):p+e),t((await R(u,x,i)).instance))}();function $i(){}function Qi(t){return(t||$i).__cache__}function Yi(t,e){var r=Qi(e),i=r[t];return i||((i=Object.create((e||$i).prototype)).ptr=t,r[t]=i)}!function(){if(r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()()}(),function t(){function e(){r.calledRun=!0,C||(D=!0,E(),A(dt),Ki.v(),E(),h?.(r),r.onRuntimeInitialized?.(),r.noInitialRun||function(){var t=vt;try{var e=t(0,0);return J(e),e}catch(t){return Y(t)}}(),function(){if(E(),r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)t=r.postRun.shift(),B.push(t);var t;A(B)}())}var i;P>0?k=t:(Oi(),0==(i=ji())&&(i+=4),v[i>>2]=34821223,v[i+4>>2]=2310721022,v[0]=1668509029,function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)t=r.preRun.shift(),N.push(t);var t;A(N)}(),P>0?k=t:(r.setStatus?(r.setStatus("Running..."),setTimeout((()=>{setTimeout((()=>r.setStatus("")),1),e()}),1)):e(),E()))}(),$i.prototype=Object.create($i.prototype),$i.prototype.constructor=$i,$i.prototype.__class__=$i,$i.__cache__={},r.WrapperObject=$i,r.getCache=Qi,r.wrapPointer=Yi,r.castObject=function(t,e){return Yi(t.ptr,e)},r.NULL=Yi(0),r.destroy=function(t){if(!t.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";t.__destroy__(),delete Qi(t.__class__)[t.ptr]},r.compare=function(t,e){return t.ptr===e.ptr},r.getPointer=function(t){return t.ptr},r.getClass=function(t){return t.__class__};var Zi={buffer:0,size:0,pos:0,temps:[],needed:0,prepare(){if(Zi.needed){for(var t=0;t<Zi.temps.length;t++)r._webidl_free(Zi.temps[t]);Zi.temps.length=0,r._webidl_free(Zi.buffer),Zi.buffer=0,Zi.size+=Zi.needed,Zi.needed=0}Zi.buffer||(Zi.size+=128,Zi.buffer=r._webidl_malloc(Zi.size),I(Zi.buffer)),Zi.pos=0},alloc(t,e){I(Zi.buffer);var i,n=e.BYTES_PER_ELEMENT,o=t.length*n;return o=st(o,8),Zi.pos+o>=Zi.size?(I(o>0),Zi.needed+=o,i=r._webidl_malloc(o),Zi.temps.push(i)):(i=Zi.buffer+Zi.pos,Zi.pos+=o),i},copy(t,e,r){r/=e.BYTES_PER_ELEMENT;for(var i=0;i<t.length;i++)e[r+i]=t[i]}};function Xi(t){if("string"==typeof t){var e=ht(t),r=Zi.alloc(e,y);return Zi.copy(e,y,r),r}return t}function Ji(){throw"cannot construct a VoidPtr, no constructor in IDL"}function tn(){this.ptr=bt(),Qi(tn)[this.ptr]=this}function en(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=ze(t,e),Qi(en)[this.ptr]=this}function rn(){throw"cannot construct a Frame, no constructor in IDL"}function nn(){throw"cannot construct a DbBackup, no constructor in IDL"}function on(){throw"cannot construct a SuspendContextClipboardCopy, no constructor in IDL"}function sn(){throw"cannot construct a SuspendContextClipboardPaste, no constructor in IDL"}function an(){throw"cannot construct a SuspendContextNetworkConnect, no constructor in IDL"}function cn(){throw"cannot construct a SuspendContextNetworkRpc, no constructor in IDL"}function pn(){throw"cannot construct a SuspendContextSerialSync, no constructor in IDL"}function un(){throw"cannot construct a SuspendContext, no constructor in IDL"}function ln(){this.ptr=Ar(),Qi(ln)[this.ptr]=this}function hn(t){Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),this.ptr=ii(t),Qi(hn)[this.ptr]=this}function dn(){throw"cannot construct a EmTransportSerialBuffer, no constructor in IDL"}function mn(t,e,r){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),this.ptr=Ei(t,e,r),Qi(mn)[this.ptr]=this}function yn(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Ti(t,e),Qi(yn)[this.ptr]=this}return Ji.prototype=Object.create($i.prototype),Ji.prototype.constructor=Ji,Ji.prototype.__class__=Ji,Ji.__cache__={},r.VoidPtr=Ji,Ji.prototype.__destroy__=Ji.prototype.__destroy__=function(){var t=this.ptr;gt(t)},tn.prototype=Object.create($i.prototype),tn.prototype.constructor=tn,tn.prototype.__class__=tn,tn.__cache__={},r.Cloudpilot=tn,tn.prototype.Malloc=tn.prototype.Malloc=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Yi(St(e,t),Ji)},tn.prototype.Free=tn.prototype.Free=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),wt(e,t)},tn.prototype.Nullptr=tn.prototype.Nullptr=function(){var t=this.ptr;return Yi(Ct(t),Ji)},tn.prototype.EnableLogging=tn.prototype.EnableLogging=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),It(e,t)},tn.prototype.InitializeSession=tn.prototype.InitializeSession=function(t,e,r){var i=this.ptr;return Zi.prepare(),t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r=r&&"object"==typeof r?r.ptr:Xi(r),!!Et(i,t,e,r)},tn.prototype.GetCyclesPerSecond=tn.prototype.GetCyclesPerSecond=function(){var t=this.ptr;return Dt(t)},tn.prototype.RunEmulation=tn.prototype.RunEmulation=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Gt(e,t)},tn.prototype.SetClockFactor=tn.prototype.SetClockFactor=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),xt(e,t)},tn.prototype.CopyFrame=tn.prototype.CopyFrame=function(){var t=this.ptr;return Yi(Pt(t),rn)},tn.prototype.IsScreenDirty=tn.prototype.IsScreenDirty=function(){var t=this.ptr;return!!kt(t)},tn.prototype.MarkScreenClean=tn.prototype.MarkScreenClean=function(){var t=this.ptr;Mt(t)},tn.prototype.MinMemoryForDevice=tn.prototype.MinMemoryForDevice=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Rt(e,t)},tn.prototype.FramebufferSizeForDevice=tn.prototype.FramebufferSizeForDevice=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Tt(e,t)},tn.prototype.TotalMemoryForDevice=tn.prototype.TotalMemoryForDevice=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),zt(e,t)},tn.prototype.QueuePenMove=tn.prototype.QueuePenMove=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Ht(r,t,e)},tn.prototype.QueuePenUp=tn.prototype.QueuePenUp=function(){var t=this.ptr;At(t)},tn.prototype.QueueButtonDown=tn.prototype.QueueButtonDown=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Bt(e,t)},tn.prototype.QueueButtonUp=tn.prototype.QueueButtonUp=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Nt(e,t)},tn.prototype.QueueKeyboardEvent=tn.prototype.QueueKeyboardEvent=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Lt(r,t,e)},tn.prototype.IsPowerOff=tn.prototype.IsPowerOff=function(){var t=this.ptr;return!!Ut(t)},tn.prototype.IsUIInitialized=tn.prototype.IsUIInitialized=function(){var t=this.ptr;return!!jt(t)},tn.prototype.GetOSVersion=tn.prototype.GetOSVersion=function(){var t=this.ptr;return Ft(t)},tn.prototype.IsSetupComplete=tn.prototype.IsSetupComplete=function(){var t=this.ptr;return!!Ot(t)},tn.prototype.Reset=tn.prototype.Reset=function(){var t=this.ptr;Wt(t)},tn.prototype.ResetNoExtensions=tn.prototype.ResetNoExtensions=function(){var t=this.ptr;Vt(t)},tn.prototype.ResetHard=tn.prototype.ResetHard=function(){var t=this.ptr;qt(t)},tn.prototype.InstallDb=tn.prototype.InstallDb=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Kt(r,t,e)},tn.prototype.GetPalette2bitMapping=tn.prototype.GetPalette2bitMapping=function(){var t=this.ptr;return $t(t)},tn.prototype.GetMemoryPtr=tn.prototype.GetMemoryPtr=function(){var t=this.ptr;return Yi(Qt(t),Ji)},tn.prototype.GetDirtyPagesPtr=tn.prototype.GetDirtyPagesPtr=function(){var t=this.ptr;return Yi(Yt(t),Ji)},tn.prototype.GetMemorySize=tn.prototype.GetMemorySize=function(){var t=this.ptr;return Zt(t)},tn.prototype.ImportMemoryImage=tn.prototype.ImportMemoryImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!Xt(r,t,e)},tn.prototype.GetRomPtr=tn.prototype.GetRomPtr=function(){var t=this.ptr;return Yi(Jt(t),Ji)},tn.prototype.GetRomSize=tn.prototype.GetRomSize=function(){var t=this.ptr;return te(t)},tn.prototype.GetSavestatePtr=tn.prototype.GetSavestatePtr=function(){var t=this.ptr;return Yi(ee(t),Ji)},tn.prototype.GetSavestateSize=tn.prototype.GetSavestateSize=function(){var t=this.ptr;return re(t)},tn.prototype.SaveState=tn.prototype.SaveState=function(){var t=this.ptr;return!!ie(t)},tn.prototype.LoadState=tn.prototype.LoadState=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ne(r,t,e)},tn.prototype.GetHotsyncName=tn.prototype.GetHotsyncName=function(){var t=this.ptr;return O(oe(t))},tn.prototype.SetHotsyncName=tn.prototype.SetHotsyncName=function(t){var e=this.ptr;Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),se(e,t)},tn.prototype.RegisterPwmHandler=tn.prototype.RegisterPwmHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ae(e,t)},tn.prototype.StartBackup=tn.prototype.StartBackup=function(){var t=this.ptr;return Yi(ce(t),nn)},tn.prototype.SetClipboardIntegration=tn.prototype.SetClipboardIntegration=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),pe(e,t)},tn.prototype.GetClipboardIntegration=tn.prototype.GetClipboardIntegration=function(){var t=this.ptr;return!!ue(t)},tn.prototype.IsSuspended=tn.prototype.IsSuspended=function(){var t=this.ptr;return!!le(t)},tn.prototype.GetSuspendContext=tn.prototype.GetSuspendContext=function(){var t=this.ptr;return Yi(he(t),un)},tn.prototype.SetNetworkRedirection=tn.prototype.SetNetworkRedirection=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),de(e,t)},tn.prototype.GetNetworkRedirection=tn.prototype.GetNetworkRedirection=function(){var t=this.ptr;return!!me(t)},tn.prototype.RegisterProxyDisconnectHandler=tn.prototype.RegisterProxyDisconnectHandler=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),ye(e,t)},tn.prototype.SetHotsyncNameManagement=tn.prototype.SetHotsyncNameManagement=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),_e(e,t)},tn.prototype.LaunchAppByName=tn.prototype.LaunchAppByName=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),!!fe(e,t)},tn.prototype.LaunchAppByDbHeader=tn.prototype.LaunchAppByDbHeader=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ve(r,t,e)},tn.prototype.DeviceSupportsCardSize=tn.prototype.DeviceSupportsCardSize=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),!!ge(e,t)},tn.prototype.ClearExternalStorage=tn.prototype.ClearExternalStorage=function(){var t=this.ptr;be(t)},tn.prototype.AllocateCard=tn.prototype.AllocateCard=function(t,e){var r=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),e&&"object"==typeof e&&(e=e.ptr),!!Se(r,t,e)},tn.prototype.AdoptCard=tn.prototype.AdoptCard=function(t,e,r){var i=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),!!we(i,t,e,r)},tn.prototype.MountCard=tn.prototype.MountCard=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),!!Ce(e,t)},tn.prototype.RemoveCard=tn.prototype.RemoveCard=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),!!Ie(e,t)},tn.prototype.GetCardData=tn.prototype.GetCardData=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Yi(Ee(e,t),Ji)},tn.prototype.GetCardDirtyPages=tn.prototype.GetCardDirtyPages=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Yi(De(e,t),Ji)},tn.prototype.GetCardSize=tn.prototype.GetCardSize=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Ge(e,t)},tn.prototype.RemountCards=tn.prototype.RemountCards=function(){var t=this.ptr;xe(t)},tn.prototype.GetSupportLevel=tn.prototype.GetSupportLevel=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),Pe(e,t)},tn.prototype.GetMountedKey=tn.prototype.GetMountedKey=function(){var t=this.ptr;return O(ke(t))},tn.prototype.GetTransportIR=tn.prototype.GetTransportIR=function(){var t=this.ptr;return Yi(Me(t),dn)},tn.prototype.GetTransportSerial=tn.prototype.GetTransportSerial=function(){var t=this.ptr;return Yi(Re(t),dn)},tn.prototype.__destroy__=tn.prototype.__destroy__=function(){var t=this.ptr;Te(t)},en.prototype=Object.create($i.prototype),en.prototype.constructor=en,en.prototype.__class__=en,en.__cache__={},r.RomInfo=en,en.prototype.IsValid=en.prototype.IsValid=function(){var t=this.ptr;return!!He(t)},en.prototype.CardVersion=en.prototype.CardVersion=function(){var t=this.ptr;return Ae(t)},en.prototype.CardName=en.prototype.CardName=function(){var t=this.ptr;return O(Be(t))},en.prototype.RomVersion=en.prototype.RomVersion=function(){var t=this.ptr;return Ne(t)},en.prototype.RomVersionString=en.prototype.RomVersionString=function(){var t=this.ptr;return O(Le(t))},en.prototype.Supports=en.prototype.Supports=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),!!Ue(e,t)},en.prototype.__destroy__=en.prototype.__destroy__=function(){var t=this.ptr;je(t)},rn.prototype=Object.create($i.prototype),rn.prototype.constructor=rn,rn.prototype.__class__=rn,rn.__cache__={},r.Frame=rn,rn.prototype.GetLineWidth=rn.prototype.GetLineWidth=function(){var t=this.ptr;return Fe(t)},rn.prototype.GetBpp=rn.prototype.GetBpp=function(){var t=this.ptr;return Oe(t)},rn.prototype.GetLines=rn.prototype.GetLines=function(){var t=this.ptr;return We(t)},rn.prototype.GetMargin=rn.prototype.GetMargin=function(){var t=this.ptr;return Ve(t)},rn.prototype.GetBytesPerLine=rn.prototype.GetBytesPerLine=function(){var t=this.ptr;return qe(t)},rn.prototype.GetFirstDirtyLine=rn.prototype.GetFirstDirtyLine=function(){var t=this.ptr;return Ke(t)},rn.prototype.GetLastDirtyLine=rn.prototype.GetLastDirtyLine=function(){var t=this.ptr;return $e(t)},rn.prototype.GetHasChanges=rn.prototype.GetHasChanges=function(){var t=this.ptr;return!!Qe(t)},rn.prototype.GetBuffer=rn.prototype.GetBuffer=function(){var t=this.ptr;return Yi(Ye(t),Ji)},rn.prototype.GetBufferSize=rn.prototype.GetBufferSize=function(){var t=this.ptr;return Ze(t)},rn.prototype.GetScaleX=rn.prototype.GetScaleX=function(){var t=this.ptr;return Xe(t)},rn.prototype.GetScaleY=rn.prototype.GetScaleY=function(){var t=this.ptr;return Je(t)},rn.prototype.__destroy__=rn.prototype.__destroy__=function(){var t=this.ptr;tr(t)},nn.prototype=Object.create($i.prototype),nn.prototype.constructor=nn,nn.prototype.__class__=nn,nn.__cache__={},r.DbBackup=nn,nn.prototype.Init=nn.prototype.Init=function(t){var e=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),!!er(e,t)},nn.prototype.IsInProgress=nn.prototype.IsInProgress=function(){var t=this.ptr;return!!rr(t)},nn.prototype.IsDone=nn.prototype.IsDone=function(){var t=this.ptr;return!!ir(t)},nn.prototype.GetCurrentDatabase=nn.prototype.GetCurrentDatabase=function(){var t=this.ptr;return O(nr(t))},nn.prototype.Save=nn.prototype.Save=function(){var t=this.ptr;return!!or(t)},nn.prototype.Skip=nn.prototype.Skip=function(){var t=this.ptr;sr(t)},nn.prototype.GetArchivePtr=nn.prototype.GetArchivePtr=function(){var t=this.ptr;return Yi(ar(t),Ji)},nn.prototype.GetArchiveSize=nn.prototype.GetArchiveSize=function(){var t=this.ptr;return cr(t)},nn.prototype.__destroy__=nn.prototype.__destroy__=function(){var t=this.ptr;pr(t)},on.prototype=Object.create($i.prototype),on.prototype.constructor=on,on.prototype.__class__=on,on.__cache__={},r.SuspendContextClipboardCopy=on,on.prototype.Cancel=on.prototype.Cancel=function(){var t=this.ptr;ur(t)},on.prototype.Resume=on.prototype.Resume=function(){var t=this.ptr;lr(t)},on.prototype.GetClipboardContent=on.prototype.GetClipboardContent=function(){var t=this.ptr;return O(hr(t))},on.prototype.__destroy__=on.prototype.__destroy__=function(){var t=this.ptr;dr(t)},sn.prototype=Object.create($i.prototype),sn.prototype.constructor=sn,sn.prototype.__class__=sn,sn.__cache__={},r.SuspendContextClipboardPaste=sn,sn.prototype.Cancel=sn.prototype.Cancel=function(){var t=this.ptr;mr(t)},sn.prototype.Resume=sn.prototype.Resume=function(t){var e=this.ptr;Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),yr(e,t)},sn.prototype.__destroy__=sn.prototype.__destroy__=function(){var t=this.ptr;_r(t)},an.prototype=Object.create($i.prototype),an.prototype.constructor=an,an.prototype.__class__=an,an.__cache__={},r.SuspendContextNetworkConnect=an,an.prototype.Cancel=an.prototype.Cancel=function(){var t=this.ptr;fr(t)},an.prototype.Resume=an.prototype.Resume=function(){var t=this.ptr;vr(t)},an.prototype.__destroy__=an.prototype.__destroy__=function(){var t=this.ptr;gr(t)},cn.prototype=Object.create($i.prototype),cn.prototype.constructor=cn,cn.prototype.__class__=cn,cn.__cache__={},r.SuspendContextNetworkRpc=cn,cn.prototype.Cancel=cn.prototype.Cancel=function(){var t=this.ptr;br(t)},cn.prototype.GetRequestSize=cn.prototype.GetRequestSize=function(){var t=this.ptr;return Sr(t)},cn.prototype.GetRequestData=cn.prototype.GetRequestData=function(){var t=this.ptr;return Yi(wr(t),Ji)},cn.prototype.ReceiveResponse=cn.prototype.ReceiveResponse=function(t,e){var r=this.ptr;t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Cr(r,t,e)},cn.prototype.__destroy__=cn.prototype.__destroy__=function(){var t=this.ptr;Ir(t)},pn.prototype=Object.create($i.prototype),pn.prototype.constructor=pn,pn.prototype.__class__=pn,pn.__cache__={},r.SuspendContextSerialSync=pn,pn.prototype.Cancel=pn.prototype.Cancel=function(){var t=this.ptr;Er(t)},pn.prototype.Resume=pn.prototype.Resume=function(){var t=this.ptr;Dr(t)},pn.prototype.__destroy__=pn.prototype.__destroy__=function(){var t=this.ptr;Gr(t)},un.prototype=Object.create($i.prototype),un.prototype.constructor=un,un.prototype.__class__=un,un.__cache__={},r.SuspendContext=un,un.prototype.GetKind=un.prototype.GetKind=function(){var t=this.ptr;return xr(t)},un.prototype.Cancel=un.prototype.Cancel=function(){var t=this.ptr;Pr(t)},un.prototype.AsContextClipboardCopy=un.prototype.AsContextClipboardCopy=function(){var t=this.ptr;return Yi(kr(t),on)},un.prototype.AsContextClipboardPaste=un.prototype.AsContextClipboardPaste=function(){var t=this.ptr;return Yi(Mr(t),sn)},un.prototype.AsContextNetworkConnect=un.prototype.AsContextNetworkConnect=function(){var t=this.ptr;return Yi(Rr(t),an)},un.prototype.AsContextNetworkRpc=un.prototype.AsContextNetworkRpc=function(){var t=this.ptr;return Yi(Tr(t),cn)},un.prototype.AsContextSerialSync=un.prototype.AsContextSerialSync=function(){var t=this.ptr;return Yi(zr(t),pn)},un.prototype.__destroy__=un.prototype.__destroy__=function(){var t=this.ptr;Hr(t)},ln.prototype=Object.create($i.prototype),ln.prototype.constructor=ln,ln.prototype.__class__=ln,ln.__cache__={},r.SessionImage=ln,ln.prototype.GetDeviceId=ln.prototype.GetDeviceId=function(){var t=this.ptr;return O(Br(t))},ln.prototype.SetDeviceId=ln.prototype.SetDeviceId=function(t){var e=this.ptr;return Zi.prepare(),t=t&&"object"==typeof t?t.ptr:Xi(t),Yi(Nr(e,t),ln)},ln.prototype.GetRomImage=ln.prototype.GetRomImage=function(){var t=this.ptr;return Yi(Lr(t),Ji)},ln.prototype.GetRomImageSize=ln.prototype.GetRomImageSize=function(){var t=this.ptr;return Ur(t)},ln.prototype.SetRomImage=ln.prototype.SetRomImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Yi(jr(r,t,e),ln)},ln.prototype.GetMemoryImage=ln.prototype.GetMemoryImage=function(){var t=this.ptr;return Yi(Fr(t),Ji)},ln.prototype.GetMemoryImageSize=ln.prototype.GetMemoryImageSize=function(){var t=this.ptr;return Or(t)},ln.prototype.SetMemoryImage=ln.prototype.SetMemoryImage=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Yi(Wr(r,t,e),ln)},ln.prototype.GetMetadata=ln.prototype.GetMetadata=function(){var t=this.ptr;return Yi(Vr(t),Ji)},ln.prototype.GetMetadataSize=ln.prototype.GetMetadataSize=function(){var t=this.ptr;return qr(t)},ln.prototype.SetMetadata=ln.prototype.SetMetadata=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Yi(Kr(r,t,e),ln)},ln.prototype.GetSavestate=ln.prototype.GetSavestate=function(){var t=this.ptr;return Yi($r(t),Ji)},ln.prototype.GetSavestateSize=ln.prototype.GetSavestateSize=function(){var t=this.ptr;return Qr(t)},ln.prototype.SetSavestate=ln.prototype.SetSavestate=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Yi(Yr(r,t,e),ln)},ln.prototype.GetVersion=ln.prototype.GetVersion=function(){var t=this.ptr;return Zr(t)},ln.prototype.Serialize=ln.prototype.Serialize=function(){var t=this.ptr;return!!Xr(t)},ln.prototype.GetSerializedImage=ln.prototype.GetSerializedImage=function(){var t=this.ptr;return Yi(Jr(t),Ji)},ln.prototype.GetSerializedImageSize=ln.prototype.GetSerializedImageSize=function(){var t=this.ptr;return ti(t)},ln.prototype.Deserialize=ln.prototype.Deserialize=function(t,e){var r=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!ei(r,t,e)},ln.prototype.__destroy__=ln.prototype.__destroy__=function(){var t=this.ptr;ri(t)},hn.prototype=Object.create($i.prototype),hn.prototype.constructor=hn,hn.prototype.__class__=hn,hn.__cache__={},r.SkinLoader=hn,hn.prototype.GetData=hn.prototype.GetData=function(){var t=this.ptr;return Yi(ni(t),Ji)},hn.prototype.GetSize=hn.prototype.GetSize=function(){var t=this.ptr;return oi(t)},hn.prototype.__destroy__=hn.prototype.__destroy__=function(){var t=this.ptr;si(t)},dn.prototype=Object.create($i.prototype),dn.prototype.constructor=dn,dn.prototype.__class__=dn,dn.__cache__={},r.EmTransportSerialBuffer=dn,dn.prototype.RxBytesPending=dn.prototype.RxBytesPending=function(){var t=this.ptr;return ai(t)},dn.prototype.Receive=dn.prototype.Receive=function(){var t=this.ptr;return Yi(ci(t),Ji)},dn.prototype.Send=dn.prototype.Send=function(t,e,r){var i=this.ptr;return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),pi(i,t,e,r)},dn.prototype.IsOpen=dn.prototype.IsOpen=function(){var t=this.ptr;return!!ui(t)},dn.prototype.Rts=dn.prototype.Rts=function(){var t=this.ptr;return li(t)},dn.prototype.Dtr=dn.prototype.Dtr=function(){var t=this.ptr;return!!hi(t)},dn.prototype.IsBreak=dn.prototype.IsBreak=function(){var t=this.ptr;return!!di(t)},dn.prototype.BufferSize=dn.prototype.BufferSize=function(){var t=this.ptr;return mi(t)},dn.prototype.GetBaud=dn.prototype.GetBaud=function(){var t=this.ptr;return yi(t)},dn.prototype.GetParity=dn.prototype.GetParity=function(){var t=this.ptr;return _i(t)},dn.prototype.GetStopBits=dn.prototype.GetStopBits=function(){var t=this.ptr;return fi(t)},dn.prototype.GetDataBits=dn.prototype.GetDataBits=function(){var t=this.ptr;return vi(t)},dn.prototype.GetHwrHandshake=dn.prototype.GetHwrHandshake=function(){var t=this.ptr;return gi(t)},dn.prototype.GetModeSync=dn.prototype.GetModeSync=function(){var t=this.ptr;return!!bi(t)},dn.prototype.SetModeSync=dn.prototype.SetModeSync=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Si(e,t)},dn.prototype.IsFrameComplete=dn.prototype.IsFrameComplete=function(){var t=this.ptr;return!!wi(t)},dn.prototype.SetRequestTransferCallback=dn.prototype.SetRequestTransferCallback=function(t){var e=this.ptr;t&&"object"==typeof t&&(t=t.ptr),Ci(e,t)},dn.prototype.__destroy__=dn.prototype.__destroy__=function(){var t=this.ptr;Ii(t)},mn.prototype=Object.create($i.prototype),mn.prototype.constructor=mn,mn.prototype.__class__=mn,mn.__cache__={},r.GunzipContext=mn,mn.prototype.GetState=mn.prototype.GetState=function(){var t=this.ptr;return Di(t)},mn.prototype.Continue=mn.prototype.Continue=function(){var t=this.ptr;return Gi(t)},mn.prototype.GetUncompressedData=mn.prototype.GetUncompressedData=function(){var t=this.ptr;return Yi(xi(t),Ji)},mn.prototype.ReleaseUncompressedData=mn.prototype.ReleaseUncompressedData=function(){var t=this.ptr;return Yi(Pi(t),Ji)},mn.prototype.GetUncompressedSize=mn.prototype.GetUncompressedSize=function(){var t=this.ptr;return ki(t)},mn.prototype.GetError=mn.prototype.GetError=function(){var t=this.ptr;return O(Mi(t))},mn.prototype.__destroy__=mn.prototype.__destroy__=function(){var t=this.ptr;Ri(t)},yn.prototype=Object.create($i.prototype),yn.prototype.constructor=yn,yn.prototype.__class__=yn,yn.__cache__={},r.ZipfileWalker=yn,yn.prototype.GetState=yn.prototype.GetState=function(){var t=this.ptr;return zi(t)},yn.prototype.Next=yn.prototype.Next=function(){var t=this.ptr;return Hi(t)},yn.prototype.GetTotalEntries=yn.prototype.GetTotalEntries=function(){var t=this.ptr;return Ai(t)},yn.prototype.GetCurrentEntrySize=yn.prototype.GetCurrentEntrySize=function(){var t=this.ptr;return Bi(t)},yn.prototype.GetCurrentEntryName=yn.prototype.GetCurrentEntryName=function(){var t=this.ptr;return O(Ni(t))},yn.prototype.GetCurrentEntryContent=yn.prototype.GetCurrentEntryContent=function(){var t=this.ptr;return Yi(Li(t),Ji)},yn.prototype.__destroy__=yn.prototype.__destroy__=function(){var t=this.ptr;Ui(t)},D?r:new Promise(((t,e)=>{h=t,d=e}))});t.exports=r,t.exports.default=r},650:function(t,e){!function(t){"use strict";var e,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,i=536870912,n=1073741824,o=new WeakMap,s=function(t,e){return function(o){var s=e.get(o),a=void 0===s?o.size:s<n?s+1:0;if(!o.has(a))return t(o,a);if(o.size<i){for(;o.has(a);)a=Math.floor(Math.random()*n);return t(o,a)}if(o.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(a);)a=Math.floor(Math.random()*r);return t(o,a)}}((e=o,function(t,r){return e.set(t,r),r}),o),a=function(t){return function(e){var r=t(e);return e.add(r),r}}(s);t.addUniqueNumber=a,t.generateUniqueNumber=s}(e)},37:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=[];r[0]=function(){return function(){}},r[1]=function(t,e){return void 0===e?t:function(r){t(r,e)}};var i=function(){function t(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return t.prototype.addHandler=function(t,e){return this.isHandlerAttached(t,e)||(this._handlers.push(t),this._contexts.push(e),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.removeHandler=function(t,e){var r=this._getHandlerIndex(t,e);return void 0!==r&&(this._handlers.splice(r,1),this._contexts.splice(r,1),this._createDispatcher(),this._updateHasHandlers()),this},t.prototype.isHandlerAttached=function(t,e){return void 0!==this._getHandlerIndex(t,e)},t.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},t.prototype._getHandlerIndex=function(t,e){var r,i=this._handlers.length;for(r=0;r<i&&(this._handlers[r]!==t||this._contexts[r]!==e);r++);return r<i?r:void 0},t.prototype._createDispatcher=function(){var t;this.dispatch=(t=this._handlers.length,r[t]||(r[t]=function(t){for(var e="return function dispatcher"+t+"(payload) {\n",r=[],i=[],n=0;n<t;n++)r.push("cb"+n),i.push("ctx"+n),e+="    cb"+n+"(payload, ctx"+n+");\n";return e+="};",new(Function.bind.apply(Function,[void 0].concat(r.concat(i),[e])))}(t)),r[t]).apply(this,this._handlers.concat(this._contexts))},t}();e.default=i},819:(t,e,r)=>{"use strict";var i=r(37);e.j=i.default}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";function t(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function e(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))}var n,o,s;r.r(i),r.d(i,{Button:()=>st,DeviceId:()=>n,DeviceOrientation:()=>o,VERSION:()=>at,createEmulator:()=>ct,createEmulatorFactory:()=>pt}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError,(s=n||(n={})).palmPilot="PalmPilot",s.pilot="Pilot",s.iii="PalmIII",s.palmVx="PalmVx",s.palmV="PalmV",s.palmVII="PalmVII",s.palmVIIEZ="PalmVIIEZ",s.palmVIIx="PalmVIIx",s.iiic="PalmIIIc",s.iiix="PalmIIIx",s.iiixe="PalmIIIxe",s.iiie="PalmIIIe",s.m500="PalmM500",s.m505="PalmM505",s.m515="PalmM515",s.m520="PalmM520",s.m100="PalmM100",s.m105="PalmM105",s.m125="PalmM125",s.m130="PalmM130",s.i705="Palmi705",s.i710="PalmI710",s.handera330="HandEra330",s.handera330c="HandEra330c",s.pegS300="PEG-S300",s.pegS320="PEG-S320",s.pegS500c="PEG-S500C",s.pegT400="PEG-T400",s.pegN600c="PEG-N600C/N610C",s.pegT600c="PEG-T600",s.pegN700c="PEG-N700C/N710C",s.pegT650c="YSX1230",s.pegNR70="NR70",s.acerS11="Acer-S11",s.lp168="Legend-P168",function(t){t.portrait="portrait",t.landscape90="landscape90",t.landscape270="landscape270",t.portrait180="portrait180"}(o||(o={})),new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const a=new Error("request for lock canceled");class c{constructor(t,e=a){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise(((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()}))}runExclusive(t,e=1){return r=this,i=void 0,o=function*(){const[r,i]=yield this.acquire(e);try{return yield t(r)}finally{i()}},new((n=void 0)||(n=Promise))((function(t,e){function s(t){try{c(o.next(t))}catch(t){e(t)}}function a(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(s,a)}c((o=o.apply(r,i||[])).next())}));var r,i,n,o}waitForUnlock(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()}))}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach((t=>t.forEach((t=>t.reject(this._cancelError))))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){const r=null===(t=this._weightedQueues[e-1])||void 0===t?void 0:t.shift();if(!r)continue;const i=this._value,n=e;this._value-=e,e=this._value+1,r.resolve([i,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach((t=>t())),this._weightedWaiters[t-1]=[])}}class p{constructor(t){this._semaphore=new c(1,t)}acquire(){return t=this,e=void 0,i=function*(){const[,t]=yield this._semaphore.acquire();return t},new((r=void 0)||(r=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}));var t,e,r,i}runExclusive(t){return this._semaphore.runExclusive((()=>t()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const u="safari"in window,l=!!navigator.platform.match(/iPhone|iPad|iPod/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,h=(l&&navigator.userAgent.match(/(crios)|(fxios)/i),navigator.userAgent.match(/pwashell/i),navigator.userAgent.match(/android/i),navigator.userAgent.toLowerCase().indexOf("firefox"),window.AudioContext||window.webkitAudioContext);function d(t,e=100){return new Promise(((r,i)=>{setTimeout((()=>i(new Error("timeout"))),e),t.then(r,i)}))}class m{constructor(t){this.emulationService=t,this.initialize=()=>this.mutex.runExclusive((()=>e(this,void 0,void 0,(function*(){for(let t=0;t<3;t++)if(yield this.initializeAudioUnguarded())return!1;return!0})))),this.updateState=(t=!1)=>this.mutex.runExclusive((()=>e(this,void 0,void 0,(function*(){if(!this.context)return;if(this.isRunning()===this.shouldRun())return;t||this.isRunning()||!this.shouldRun()||this.applyPwmUpdate();const e=this.context.state;if(this.shouldRun())try{this.updateGain(),yield d(this.context.resume()),console.log("resume audio context")}catch(t){console.error(`failed to resume audio from state ${e}`)}else try{yield d(this.context.suspend()),console.log("suspend audio context")}catch(t){console.error(`failed to suspend audio from state ${e}`)}console.log(`audio context state change ${e} -> ${this.context.state}`)})))),this.onPwmUpdate=t=>e(this,void 0,void 0,(function*(){this.pendingPwmUpdate=t,this.initialized&&(this.shouldRun()!==this.isRunning()&&this.updateState(!0),this.shouldRun()&&this.applyPwmUpdate())})),this.mutex=new p,this.initialized=!1,this.muted=!1,this.emulationService.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.emulationService.emulationStateChangeEvent.addHandler((()=>this.updateState())),this.emulationService.powerOffChangeEvent.addHandler((()=>this.updateState())),l||document.addEventListener("visibilitychange",(()=>this.updateState()))}isInitialized(){return this.initialized}mute(t){this.muted=t,this.updateState()}isMuted(){return this.muted}shouldRun(){return this.emulationService.isRunning()&&!this.emulationService.isPowerOff()&&!this.muted&&this.gain()>0&&("hidden"!==document.visibilityState||l||this.runHidden())}updateGain(){this.gainNode&&(this.gainNode.gain.value=this.gain())}initializeAudioUnguarded(){return e(this,void 0,void 0,(function*(){if(this.initialized)return!0;try{this.context=new h}catch(t){return console.error(t),console.error("web audio not available"),!1}try{this.context.destination.channelCount=1}catch(t){console.warn("audio driver: failed to set channel count")}try{yield this.start()}catch(t){return console.error(t),console.error("failed to initialize audio context"),!1}return this.context.addEventListener("statechange",(()=>{var t;"interrupted"===(null===(t=this.context)||void 0===t?void 0:t.state)&&this.updateState()})),this.gainNode=this.context.createGain(),this.gainNode.channelCount=1,this.gainNode.channelInterpretation="speakers",this.gainNode.gain.value=this.gain(),this.gainNode.connect(this.context.destination),this.applyPwmUpdate(),this.initialized=!0,!0}))}start(){return e(this,void 0,void 0,(function*(){this.context&&(yield d(this.context.resume()),this.updateState(),console.log("audio context initialized"))}))}isRunning(){var t;return"running"===(null===(t=this.context)||void 0===t?void 0:t.state)}applyPwmUpdate(){if(!this.context||!this.pendingPwmUpdate)return;const{frequency:t,dutyCycle:e}=this.pendingPwmUpdate,r=this.context.sampleRate;if(this.pendingPwmUpdate=void 0,t<=0||e<=0||t>=r)return void this.disconnectSource();const i=this.context.createBuffer(1,Math.round(r/t),r),n=i.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=t/n.length<e?1:0;const o=this.context.createBufferSource();o.channelCount=1,o.channelInterpretation="speakers",o.loop=!0,o.buffer=i,this.disconnectSource(),o.connect(this.gainNode),o.start(),this.bufferSourceNode=o,this.pendingPwmUpdate=void 0}disconnectSource(){this.bufferSourceNode&&(this.bufferSourceNode.stop(),this.bufferSourceNode.disconnect(),this.bufferSourceNode=void 0)}gain(){return this.getVolume()/2}}class y extends m{constructor(){super(...arguments),this.volume=.5}setVolume(t){this.volume=Math.max(Math.min(t,1),0),this.updateGain()}getVolume(){return this.volume}runHidden(){return!1}}function _(t,r){let i,n;const o=document.createElement("canvas");return(s,a)=>e(this,void 0,void 0,(function*(){if(i===s&&n===a)return o;o.width=s,o.height=a;const e=o.getContext("2d");if(!e)throw new Error("get a new browser");return e.drawImage(yield t,0,0,o.width,o.height),(u||l)&&(yield r).indexOf("data:image")>=0&&(yield new Promise((t=>setTimeout(t,0))),e.drawImage(yield t,0,0,o.width,o.height)),i=s,n=a,o}))}function f(t){return new Promise(((e,r)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>r(),i.src=t}))}const v=t=>`data:image/svg+xml;base64,${btoa(t)}`;var g,b;function S(t){switch(t){case n.i710:case n.m520:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.handera330:case n.handera330c:case n.lp168:return{screenSize:2,width:240,height:320,silkscreenHeight:0};case n.pegS300:case n.pegS320:case n.pegS500c:return{screenSize:0,width:160,height:160,silkscreenHeight:76};case n.pegT600c:case n.pegT400:case n.pegT650c:return{screenSize:1,width:320,height:320,silkscreenHeight:140,silkscreenOvershoot:10};case n.pegN600c:case n.pegN700c:return{screenSize:1,width:320,height:320,silkscreenHeight:120};case n.pegNR70:return{screenSize:3,width:320,height:480,silkscreenHeight:0};case n.acerS11:return{screenSize:0,width:160,height:160,silkscreenHeight:60,siklscreenShift:8};default:return{screenSize:0,width:160,height:160,silkscreenHeight:60}}}function w(t){switch(t){case n.pilot:case n.palmPilot:case n.iii:case n.palmV:case n.palmVx:case n.iiix:case n.iiixe:case n.iiie:case n.m100:case n.m105:case n.m125:case n.m500:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:case n.i705:case n.handera330:case n.pegS300:case n.pegS320:case n.pegT400:case n.acerS11:return!1;default:return!0}}(b=g||(g={})).sdcard="sdcard",b.memorystick="memorystick",b.none="none";var C=r(819);const I=[135,135,105],E=[0,0,0],D=new Array(16).fill(0).map(((t,e)=>E.map(((t,r)=>Math.floor((e*t+(15-e)*I[r])/15))))).map((([t,e,r])=>4278190080|r<<16|e<<8|t)),G=D.map((t=>{var e;return"#"+(null===(e=(16777215&t).toString(16).padStart(6,"0").match(/(..?)/g))||void 0===e?void 0:e.reverse().join(""))})),x=n.m515,P=G[2],k=G[0],M="rgba(0,0,0,0.2)";function R(t){const e=S(t),r=(0===e.screenSize?3:2)*devicePixelRatio,i={frameDevice:1,frameCanvas:r},n=t=>({frameDevice:t,frameCanvas:t*r}),o=t=>({frameDevice:t,frameCanvas:i.frameCanvas+t*r}),s=e.silkscreenHeight>0?n(1):n(0),a=n(function(t){switch(t){case 3:case 1:return 60;case 2:return 45;default:return 30}}(e.screenSize));return{scale:r,borderWidth:i,height:n(2*i.frameDevice+e.height+s.frameDevice+e.silkscreenHeight+a.frameDevice),width:n(2*i.frameDevice+e.width),screenHeight:n(e.height),screenWidth:n(e.width),screenLeft:o(0),screenTop:o(0),screenBottom:o(e.height),separatorHeight:s,silkscreenHeight:n(e.silkscreenHeight),silkscreenTop:o(e.height+s.frameDevice),silkscreenBottom:o(e.height+s.frameDevice+e.silkscreenHeight),softSilkscreenHeight:n(e.silkscreenHeight>0?0:e.height-e.width),buttonHeight:a,buttonWidth:a,buttonTop:o(e.height+s.frameDevice+e.silkscreenHeight),buttonBottom:o(e.height+s.frameDevice+e.silkscreenHeight+a.frameDevice)}}class T{constructor(t){this.skinLoader=t,this.layout=R(x),this.onResize=new C.j}get width(){switch(this.getOrientation()){case o.portrait:case o.portrait180:case void 0:return this.layout.width.frameCanvas;default:return this.layout.height.frameCanvas}}get height(){switch(this.getOrientation()){case o.portrait:case o.portrait180:case void 0:return this.layout.height.frameCanvas;default:return this.layout.width.frameCanvas}}updateEmulationCanvas(t){this.setupTransformation(),this.drawEmulationCanvas(t),this.onAfterUpdateCanvas()}eventToPalmCoordinates(t,e=!1){if(!this.ctx)return;const r=this.ctx.canvas.getBoundingClientRect();let i,n,s,a;r.width/r.height>this.width/this.height?(a=r.height,s=this.width/this.height*r.height,n=r.top,i=r.left+(r.width-s)/2):(s=r.width,a=this.height/this.width*r.width,i=r.left,n=r.top+(r.height-a)/2);let c=(t.clientX-i)/s*this.width/this.layout.scale,p=(t.clientY-n)/a*this.height/this.layout.scale;switch(this.getOrientation()){case o.landscape90:{const t=p;p=this.layout.height.frameDevice-c,c=t;break}case o.landscape270:{const t=p;p=c,c=this.layout.width.frameDevice-t;break}case o.portrait180:c=this.layout.width.frameDevice-c,p=this.layout.height.frameDevice-p}c-=this.layout.borderWidth.frameDevice,p-=this.layout.borderWidth.frameDevice,p>=this.layout.screenHeight.frameDevice&&(p<=this.layout.screenHeight.frameDevice+this.layout.separatorHeight.frameDevice?p=this.layout.screenHeight.frameDevice:p-=this.layout.separatorHeight.frameDevice);const u=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice;if(e)c<0&&(c=0),c>=this.layout.screenWidth.frameDevice&&(c=this.layout.screenWidth.frameDevice-1),p<0&&(p=0),p>=u&&(p=u-1);else if(c<0||c>=this.layout.screenWidth.frameDevice||p<0||p>=u)return;return[c,p]}isSilkscreen(t){const[,e]=t;return!this.isButtons(t)&&e>=this.layout.screenHeight.frameDevice}isButtons([,t]){return t>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice}determineButton([t,e]){return t>=this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice?3:t>=this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice?2:t>=2*this.layout.buttonWidth.frameDevice?e>=this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.buttonHeight.frameDevice/2?5:4:t>=this.layout.buttonWidth.frameDevice?1:0}initWithCanvas(t){var r;return void 0===t&&(t=null===(r=this.ctx)||void 0===r?void 0:r.canvas),e(this,void 0,void 0,(function*(){if(!t)return;this.layout=R(this.getDeviceId()),this.onResize.dispatch(),t.width=this.width,t.height=this.height;const e=t.getContext("2d");if(!e)throw new Error("canvas not supported - get a new browser");this.ctx=e,this.setupTransformation(),this.fillCanvasRect(0,0,this.layout.width.frameCanvas,this.layout.height.frameCanvas,this.frameColor()),this.fillRect(0,0,this.layout.screenWidth.frameDevice,this.layout.screenHeight.frameDevice+this.layout.silkscreenHeight.frameDevice+this.layout.separatorHeight.frameDevice+this.layout.buttonHeight.frameDevice,this.backgroundColor()),this.drawEmulationCanvas(),yield Promise.all([this.drawSilkscreen(),this.drawButtons()])}))}drawButtons(t=[]){return e(this,void 0,void 0,(function*(){this.ctx&&(this.setupTransformation(),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.buttonsImage()(this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),this.layout.screenLeft.frameCanvas,this.layout.buttonTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.buttonHeight.frameCanvas),t.includes(0)&&this.fillRect(0,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,M),t.includes(1)&&this.fillRect(this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,M),t.includes(2)&&this.fillRect(this.layout.screenWidth.frameDevice-2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,M),t.includes(3)&&this.fillRect(this.layout.screenWidth.frameDevice-this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice,M),t.includes(4)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,M),t.includes(5)&&this.fillRect(2*this.layout.buttonWidth.frameDevice,this.layout.buttonTop.frameDevice+this.layout.buttonHeight.frameDevice/2,this.layout.screenWidth.frameDevice-4*this.layout.buttonWidth.frameDevice,this.layout.buttonHeight.frameDevice/2,M))}))}onAfterUpdateCanvas(){}setupTransformation(){if(this.ctx)switch(this.ctx.resetTransform(),this.getOrientation()){case o.portrait:case void 0:break;case o.landscape90:this.ctx.translate(this.layout.height.frameCanvas,0),this.ctx.rotate(Math.PI/2);break;case o.landscape270:this.ctx.translate(0,this.layout.width.frameCanvas),this.ctx.rotate(3*Math.PI/2);break;case o.portrait180:this.ctx.translate(this.layout.width.frameCanvas,this.layout.height.frameCanvas),this.ctx.rotate(Math.PI)}}drawSilkscreen(){return e(this,void 0,void 0,(function*(){0!==this.layout.silkscreenHeight.frameCanvas&&this.ctx&&(this.setupTransformation(),this.fillRect(this.layout.screenLeft.frameDevice,this.layout.silkscreenTop.frameDevice,this.layout.screenWidth.frameDevice,this.layout.silkscreenHeight.frameDevice,P),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(yield this.silkscreenImage()(this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas),this.layout.borderWidth.frameCanvas,this.layout.silkscreenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.silkscreenHeight.frameCanvas))}))}drawEmulationCanvas(t=this.lastEmulationCanvas){t&&this.ctx&&(this.lastEmulationCanvas=t,this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(t,this.layout.screenLeft.frameCanvas,this.layout.screenTop.frameCanvas,this.layout.screenWidth.frameCanvas,this.layout.screenHeight.frameCanvas))}fillRect(t,e,r,i,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(this.layout.borderWidth.frameCanvas+this.layout.scale*t,this.layout.borderWidth.frameCanvas+this.layout.scale*e,this.layout.scale*r,this.layout.scale*i),this.ctx.fillStyle=n,this.ctx.fill())}fillCanvasRect(t,e,r,i,n){this.ctx&&(this.ctx.beginPath(),this.ctx.rect(t,e,r,i),this.ctx.fillStyle=n,this.ctx.fill())}silkscreenImage(){return this.skinLoader.loadSkinElement(this.silkscreenSkinElement())}silkscreenSkinElement(){switch(this.getDeviceId()){case n.pegT600c:case n.pegT650c:return"silkscreen/clie-t600.svg";case n.pegN700c:case n.pegN600c:return"silkscreen/clie-n610.svg";case n.pegS320:case n.pegS300:return"silkscreen/clie-s300.svg";case n.pegS500c:return"silkscreen/clie-s500.svg";case n.pegT400:return"silkscreen/clie-t415.svg";case n.acerS11:return"silkscreen/acer-s10.svg";case n.palmPilot:case n.pilot:case n.iii:case n.palmVII:return"silkscreen/pilot.svg";case n.m500:return"silkscreen/m500.svg";case n.m505:case n.m515:case n.m520:return"silkscreen/m515.svg";case n.iiic:return"silkscreen/iiic.svg";case n.m100:case n.m105:case n.m125:return"silkscreen/m100.svg";case n.m130:return"silkscreen/m130.svg";case n.i710:return"silkscreen/tungstenw.svg";case n.i705:return"silkscreen/i705.svg";case n.iiic:case n.iiix:case n.iiixe:case n.palmVx:case n.palmV:case n.palmVIIEZ:case n.palmVIIx:default:return"silkscreen/v.svg"}}buttonsImage(){return this.skinLoader.loadSkinElement(this.buttonsSkinElement())}buttonsSkinElement(){switch(this.getDeviceId()){case n.acerS11:return"hard-buttons/acer-s10.svg";case n.pegNR70:return"hard-buttons/clie-nr70.svg";case n.pegN700c:return"hard-buttons/clie-n700.svg";case n.pegN600c:return"hard-buttons/clie-n610.svg";case n.pegS300:return"hard-buttons/clie-s300.svg";case n.pegS500c:return"hard-buttons/clie-s500.svg";case n.pegS320:return"hard-buttons/clie-s320.svg";case n.pegT400:case n.pegT600c:case n.pegT650c:return"hard-buttons/clie-t415.svg";case n.pilot:case n.palmPilot:return"hard-buttons/pilot.svg";case n.m500:return"hard-buttons/m500.svg";case n.m505:case n.m515:case n.m520:return"hard-buttons/m515.svg";case n.iiic:return"hard-buttons/iiic.svg";case n.m100:case n.m105:return"hard-buttons/m100.svg";case n.m125:return"hard-buttons/m125.svg";case n.m130:return"hard-buttons/m130.svg";case n.i710:return"hard-buttons/tungstenw.svg";case n.iii:case n.iiix:case n.iiixe:case n.palmVII:case n.palmVIIEZ:case n.palmVIIx:return"hard-buttons/iiix.svg";case n.iiie:return"hard-buttons/iiie.svg";case n.i705:return"hard-buttons/i705.svg";case n.handera330:return"hard-buttons/handera330.svg";case n.handera330c:return"hard-buttons/handera330c.svg";case n.lp168:return"hard-buttons/lp168.svg";case n.palmVx:case n.palmV:default:return"hard-buttons/v.svg"}}backgroundColor(){return w(this.getDeviceId())?"white":k}frameColor(){return w(this.getDeviceId())?"white":"#ccc"}}const z='<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Game Controller</title><path d="M467.51 248.83c-18.4-83.18-45.69-136.24-89.43-149.17A91.5 91.5 0 00352 96c-26.89 0-48.11 16-96 16s-69.15-16-96-16a99.09 99.09 0 00-27.2 3.66C89 112.59 61.94 165.7 43.33 248.83c-19 84.91-15.56 152 21.58 164.88 26 9 49.25-9.61 71.27-37 25-31.2 55.79-40.8 119.82-40.8s93.62 9.6 118.66 40.8c22 27.41 46.11 45.79 71.42 37.16 41.02-14.01 40.44-79.13 21.43-165.04z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><circle cx="292" cy="224" r="20"/><path d="M336 288a20 20 0 1120-19.95A20 20 0 01336 288z"/><circle cx="336" cy="180" r="20"/><circle cx="380" cy="224" r="20"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 176v96M208 224h-96"/></svg>',H=_(f(v(z)),z);class A extends T{constructor(){super(...arguments),this.deviceId=n.m515,this.orientation=o.portrait,this.gameModeIndicatorEnabled=!0,this.gameModeActive=!1,this.lastActiveButtons=void 0}initialize(t,r=this.deviceId,i=this.orientation){var n;return e(this,void 0,void 0,(function*(){this.deviceId=r,this.orientation=i;const e=t||(null===(n=this.ctx)||void 0===n?void 0:n.canvas);e&&(e.width=this.width,e.height=this.height,e.style.objectFit="contain"),yield this.initWithCanvas(t)}))}updateOrientation(t){this.orientation=t,this.initialize()}toggleGameModeIndicator(t){this.gameModeActive=t,this.drawButtons(this.lastActiveButtons)}setGameModeIndicatorEnabled(t){this.gameModeIndicatorEnabled=t,this.drawButtons(this.lastActiveButtons)}isGameModeIndicatorEnabled(){return this.gameModeIndicatorEnabled}getCanvas(){var t;return null===(t=this.ctx)||void 0===t?void 0:t.canvas}drawButtons(t=[]){const r=Object.create(null,{drawButtons:{get:()=>super.drawButtons}});return e(this,void 0,void 0,(function*(){this.lastActiveButtons=t,yield r.drawButtons.call(this,t),this.gameModeActive&&this.gameModeIndicatorEnabled&&(yield this.drawGameModeIndicator())}))}getDeviceId(){return this.deviceId}getOrientation(){return this.orientation}drawGameModeIndicator(){return e(this,void 0,void 0,(function*(){if(!this.ctx)return;const t=Math.floor(.1*this.layout.screenWidth.frameCanvas),e=Math.floor(.8*t),r=Math.floor(.1*t),i=Math.floor(.11*t);this.fillCanvasRect(this.layout.screenLeft.frameCanvas-r+this.layout.screenWidth.frameCanvas-t,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-r,t,t,"rgba(200, 200, 200, 0.7)"),this.ctx.drawImage(yield H(t,t),this.layout.screenLeft.frameCanvas+this.layout.screenWidth.frameCanvas-r-t+i,this.layout.buttonTop.frameCanvas+this.layout.buttonHeight.frameCanvas-t-r+i,e,e)}))}}var B=r(650);const N=((t,e)=>{let r=null;return()=>{if(null!==r)return r;const t=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),e=URL.createObjectURL(t);return r=(t=>{const e=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),i=new Map,n=new Worker(t);return n.addEventListener("message",(({data:t})=>{if(void 0!==(n=t).method&&"call"===n.method){const{params:{timerId:n,timerType:o}}=t;if("interval"===o){const t=e.get(n);if("number"==typeof t){const e=i.get(t);if(void 0===e||e.timerId!==n||e.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===t)throw new Error("The timer is in an undefined state.");t()}}else if("timeout"===o){const t=r.get(n);if("number"==typeof t){const e=i.get(t);if(void 0===e||e.timerId!==n||e.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===t)throw new Error("The timer is in an undefined state.");t(),r.delete(n)}}}else{if(!(t=>null===t.error&&"number"==typeof t.id)(t)){const{error:{message:e}}=t;throw new Error(e)}{const{id:n}=t,o=i.get(n);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:s,timerType:a}=o;i.delete(n),"interval"===a?e.delete(s):r.delete(s)}}var n})),{clearInterval:t=>{const r=(0,B.generateUniqueNumber)(i);i.set(r,{timerId:t,timerType:"interval"}),e.set(t,r),n.postMessage({id:r,method:"clear",params:{timerId:t,timerType:"interval"}})},clearTimeout:t=>{const e=(0,B.generateUniqueNumber)(i);i.set(e,{timerId:t,timerType:"timeout"}),r.set(t,e),n.postMessage({id:e,method:"clear",params:{timerId:t,timerType:"timeout"}})},setInterval:(t,r)=>{const i=(0,B.generateUniqueNumber)(e);return e.set(i,(()=>{t(),"function"==typeof e.get(i)&&n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}})})),n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(t,e)=>{const i=(0,B.generateUniqueNumber)(r);return r.set(i,t),n.postMessage({id:null,method:"set",params:{delay:e,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}})(e),setTimeout((()=>URL.revokeObjectURL(e))),r}})();var L;!function(t){t[t.animationFrame=0]="animationFrame",t[t.timeout=1]="timeout"}(L||(L={}));class U{constructor(t){this.callback=t}schedule(){void 0===this.handle&&(this.handle=requestAnimationFrame((t=>{this.handle=void 0,this.callback(t)})))}cancel(){void 0!==this.handle&&(cancelAnimationFrame(this.handle),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return L.animationFrame}}class j{constructor(t,e=60){this.callback=t,this.fps=e}schedule(){if(void 0!==this.handle)return;const t=performance.now(),e=1e3*Math.ceil(t/1e3*this.fps)/this.fps;var r,i;this.handle=(r=()=>{this.handle=void 0,this.callback(performance.now())},i=Math.max(e-t,0),N().setTimeout(r,i))}cancel(){var t;void 0!==this.handle&&(t=this.handle,N().clearTimeout(t),this.handle=void 0)}isScheduled(){return void 0!==this.handle}getKind(){return L.timeout}}class F{constructor(t,e){this.queue=new Array(t).fill(0),this.reset(e)}reset(t=0){this.next=1,this.size=1,this.queue[0]=t}push(t){return this.queue[this.next]=t,this.next=(this.next+1)%this.queue.length,this.size<this.queue.length&&this.size++,this}calculateAverage(){let t=0;for(let e=0;e<this.size;e++)t+=this.queue[e];return t/this.size}}class O{constructor(t){this.start=0,this.size=0,this.buffer=new Array(t)}push(t){return this.size<this.buffer.length?this.buffer[(this.start+this.size++)%this.buffer.length]=t:(this.start=(this.start+1)%this.buffer.length,this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}pop(){if(0===this.size)return;const t=this.buffer[this.start];return this.start=(this.start+1)%this.buffer.length,this.size--,t}peekLast(){if(0!==this.size)return this.buffer[(this.start+this.size-1)%this.buffer.length]}replaceLast(t){return this.size>0&&(this.buffer[(this.start+this.size-1)%this.buffer.length]=t),this}count(){return this.size}flush(){return this.start=0,this.size=0,this}}class W{constructor(){this.onFrameComplete=()=>{this.transport&&this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()})},this.receiveEvent=new C.j,this.dispatchEvent=new C.j,this.isSync=!1}bind(t){this.transport!==t&&(this.transport&&this.transport.frameCompleteEvent.removeHandler(this.onFrameComplete),t.frameCompleteEvent.addHandler(this.onFrameComplete),t.SetModeSync(this.isSync),this.transport=t)}send(t,e){this.transport&&(this.transport.IsOpen()||!this.transport.GetModeSync()?(this.transport.Send(t,e),setTimeout((()=>this.dispatchEvent.dispatch()),0)):this.receiveEvent.dispatch({data:void 0,isFrameComplete:!0}))}setModeSync(t){var e;this.isSync=t,null===(e=this.transport)||void 0===e||e.SetModeSync(t)}getModeSync(){var t,e,r;return null!==(r=null===(e=null===(t=this.transport)||void 0===t?void 0:t.GetModeSync)||void 0===e?void 0:e.call(t))&&void 0!==r&&r}dispatch(){if(!this.transport)return;const t=this.transport.RxBytesPending();0!==t&&(this.transport.GetModeSync()&&t<1024||this.receiveEvent.dispatch({data:this.transport.Receive(),isFrameComplete:this.transport.IsFrameComplete()}))}}class V{constructor(){this.onPwmUpdate=t=>{this.pendingPwmUpdates.count()>0&&this.pendingPwmUpdates.peekLast().frequency<0?this.pendingPwmUpdates.replaceLast(t):this.pendingPwmUpdates.push(t)},this.advanceEmulation=t=>{if(this.isDirty=!1,!this.isRunning)return;if(!this.cloudpilotInstance||this.hasFatalError()||t<this.clockEmulator)return;this.cloudpilotInstance.isSuspended()&&5===this.cloudpilotInstance.getSuspendKind()&&t-this.serialSyncStartedAt>250&&(console.log("serial sync timeout, waking emulator"),this.cloudpilotInstance.getSuspendContextSerialSync().Cancel());const e=this.cloudpilotInstance.isSuspended();let r=!1;this.cloudpilotInstance.setClockFactor(this.emulationSpeed*this.getConfiguredSpeed()),t-this.clockEmulator>1e3/30&&(this.clockEmulator=t-1e3/30);const i=(t-this.clockEmulator)/1e3*this.cloudpilotInstance.cyclesPerSecond(),n=performance.now();let o=0;for(;o<i;)if(o+=this.cloudpilotInstance.runEmulation(Math.ceil(i-o)),this.cloudpilotInstance.isSuspended()){r=!0;break}const s=o/this.cloudpilotInstance.cyclesPerSecond()*1e3,a=performance.now()-n;this.clockEmulator+=Math.max(s,a),this.speedAverage.push(s/(a>0?a:s/1e3)*this.emulationSpeed),this.updateEmulationSpeed(this.speedAverage.calculateAverage()),r&&!e&&(5===this.cloudpilotInstance.getSuspendKind()?this.serialSyncStartedAt=performance.now():this.handleSuspend());const c=this.cloudpilotInstance.isPowerOff(),p=this.cloudpilotInstance.isUiInitialized();if(c!==this.powerOff||p!==this.uiInitialized){const t=this.powerOff;this.powerOff=c,this.uiInitialized=p,t!==this.powerOff&&this.powerOffChangeEvent.dispatch(this.powerOff),this.isDirty=!0}p&&!c&&this.manageHotsyncName()&&!r&&this.checkAndUpdateHotsyncName(),this.serialPortIR.dispatch(),this.serialPortSerial.dispatch(),this.onAfterAdvanceEmulation(t,o)},this.newFrameEvent=new C.j,this.pwmUpdateEvent=new C.j,this.emulationStateChangeEvent=new C.j,this.powerOffChangeEvent=new C.j,this.deviceId=n.m515,this.clockEmulator=0,this.scheduler=new U((t=>this.onSchedule(t))),this.canvas=document.createElement("canvas"),this.canvasTmp=document.createElement("canvas"),this.lastPenUpdate=0,this.penDown=!1,this.running=!1,this.powerOff=!1,this.uiInitialized=!1,this.pendingPwmUpdates=new O(10),this.lastPwmUpdateEvent=0,this.emulationSpeed=1,this.speedAverage=new F(20),this.timePerFrameAverage=new F(60),this.timestampLastFrame=0,this.frameCounter=0,this.isDirty=!1,this.serialPortIR=new W,this.serialPortSerial=new W,this.serialSyncStartedAt=0,this.serialPortIR.dispatchEvent.addHandler((()=>this.advanceEmulation(performance.now()))),this.serialPortSerial.dispatchEvent.addHandler((()=>this.advanceEmulation(performance.now())))}handlePointerMove(t,e,r){if(!this.handleInput())return;const i=performance.now();if(this.penDown=!0,!(i-this.lastPenUpdate<25)&&this.cloudpilotInstance){if(r){const r=S(this.deviceId);t=this.transformSilkscreenX(t,r),e=this.transformSilkscreenY(e,r)}this.cloudpilotInstance.queuePenMove(Math.floor(t),Math.floor(e)),this.lastPenUpdate=i}}handlePointerUp(){this.handleInput()&&(this.cloudpilotInstance&&this.penDown&&this.cloudpilotInstance.queuePenUp(),this.lastPenUpdate=0,this.penDown=!1)}handleButtonDown(t){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonDown(t)}handleButtonUp(t){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonUp(t)}handleKeyDown(t,e=!1){this.handleInput()&&this.cloudpilotInstance&&this.cloudpilotInstance.queueKeyboardEvent(t,e)}reset(){this.cloudpilotInstance&&this.cloudpilotInstance.reset()}resetNoExtensions(){this.cloudpilotInstance&&this.cloudpilotInstance.resetNoExtensions()}resetHard(){this.cloudpilotInstance&&this.cloudpilotInstance.resetHard()}isRunning(){return this.running}isPowerOff(){return this.powerOff}isUiInitialized(){return this.uiInitialized}getCanvas(){return this.canvas}getStatistics(){return{hostSpeed:this.speedAverage.calculateAverage(),emulationSpeed:this.emulationSpeed,averageFps:this.calculateFPS()}}getEmulationSpeed(){return this.emulationSpeed}isSuspended(){return!!this.cloudpilotInstance&&this.cloudpilotInstance.isSuspended()}getSerialPortSerial(){if(!this.serialPortSerial)throw new Error("emulator not initialized");return this.serialPortSerial}getSerialPortIR(){if(!this.serialPortIR)throw new Error("emulator not initialized");return this.serialPortIR}onAfterAdvanceEmulation(t,e){}handleSuspend(){}callScheduler(){this.scheduler.schedule()}handleInput(){return!0}openSession(t,e,r,i,n){let o=!1;return!!t.initializeSession(e,r)&&(i&&(i.length%4!=0?console.warn("memory size is not a multiple of 4; ignoring image"):(o=t.loadMemory(new Uint32Array(i.buffer,i.byteOffset,i.length>>>2)),o||console.warn("failed to load memory"))),o&&n&&t.loadState(n),t.remountCards(),this.cloudpilotInstance&&this.cloudpilotInstance.pwmUpdateEvent.removeHandler(this.onPwmUpdate),t.pwmUpdateEvent.addHandler(this.onPwmUpdate),this.cloudpilotInstance!==t&&(this.serialPortIR.bind(t.getTransportIR()),this.serialPortSerial.bind(t.getTransportSerial())),this.cloudpilotInstance=t,this.deviceId=r,this.resetCanvas(),this.pendingPwmUpdates.flush(),this.lastPwmUpdateEvent=0,this.deviceHotsyncName=void 0,this.emulationSpeed=1,this.frameCounter=0,this.speedAverage.reset(1),this.powerOff=t.isPowerOff(),this.uiInitialized=t.isUiInitialized(),this.frameCounter=0,!0)}resetCanvas(){const t=S(this.deviceId);this.canvas.width=this.canvasTmp.width=t.width,this.canvas.height=this.canvasTmp.height=t.height;const e=this.canvas.getContext("2d");if(!e)throw new Error("get a new browser");this.context=e;const r=this.canvasTmp.getContext("2d");if(!r)throw new Error("get a new browser");this.contextTmp=r,this.clearCanvas(),this.imageData=void 0}doResume(){this.cloudpilotInstance&&(this.clockEmulator=performance.now(),this.schedule(),this.setRunning(!0),this.resetFPS())}doPause(){this.stopLoop()}doStop(){this.stopLoop()}stopLoop(){this.running&&(this.scheduler.cancel(),void 0!==this.advanceEmulationHandle&&(window.clearTimeout(this.advanceEmulationHandle),this.advanceEmulationHandle=void 0),this.setRunning(!1))}resetFPS(){this.timePerFrameAverage.reset(),this.timestampLastFrame=performance.now()}calculateFPS(){const t=this.timePerFrameAverage.calculateAverage();return t&&1e3/t}transformSilkscreenX(t,e){if(void 0===e.silkscreenOvershoot)return t;const r=e.width/(e.width+2*e.silkscreenOvershoot);return(t-e.width/2)/r+e.width/2}transformSilkscreenY(t,e){return void 0===e.siklscreenShift?t:t+e.siklscreenShift}setRunning(t){t!==this.running&&(this.running=t,this.emulationStateChangeEvent.dispatch(t))}updateEmulationSpeed(t){if(t>=1&&this.emulationSpeed>=1)return;const e=Math.min(Math.max(Math.floor(10*t)/10,.1),1);e<=this.emulationSpeed?this.emulationSpeed=e:this.emulationSpeed=t-e>=.05?e:this.emulationSpeed}performScreenUpdate(){var t;(null===(t=this.cloudpilotInstance)||void 0===t?void 0:t.isScreenDirty())&&(this.updateScreen(),this.cloudpilotInstance.markScreenClean(),this.frameCounter++)}onSchedule(t){this.hasFatalError()||(this.skipEmulationUpdate()||(this.performScreenUpdate(),this.pendingPwmUpdates.count()>0&&t-this.lastPwmUpdateEvent>10&&(this.pwmUpdateEvent.dispatch(this.pendingPwmUpdates.pop()),this.lastPwmUpdateEvent=t),void 0===this.advanceEmulationHandle&&(this.advanceEmulationHandle=window.setTimeout((()=>{this.advanceEmulationHandle=void 0,this.advanceEmulation(t)}),0)),this.timePerFrameAverage.push(Math.max(0,t-this.timestampLastFrame)),this.timestampLastFrame=t),this.schedule())}schedule(){this.scheduler.cancel(),this.getConfiguredSchdedulerKind()!==this.scheduler.getKind()&&(this.scheduler=this.getConfiguredSchdedulerKind()===L.animationFrame?new U((t=>this.onSchedule(t))):new j((t=>this.onSchedule(t)))),this.callScheduler()}checkAndUpdateHotsyncName(){if(!this.cloudpilotInstance)return;void 0===this.deviceHotsyncName&&(this.deviceHotsyncName=this.cloudpilotInstance.getHotsyncName());const t=this.getConfiguredHotsyncName();void 0===t?this.updateConfiguredHotsyncName(this.deviceHotsyncName):t!==this.deviceHotsyncName&&t.length<=40&&this.cloudpilotInstance.isSetupComplete()&&(this.cloudpilotInstance.setHotsyncName(t),this.deviceHotsyncName=t)}clearCanvas(){const t=this.deviceId,e=S(t);this.context.beginPath(),this.context.rect(0,0,e.width,e.height),this.context.fillStyle=w(t)?"white":G[0],this.context.fill()}updateScreen(){if(!this.cloudpilotInstance)return;const t=this.cloudpilotInstance.getFrame();if(this.cloudpilotInstance.isPowerOff())return this.clearCanvas(),void this.newFrameEvent.dispatch(this.canvas);if(!t.hasChanges)return;if(t.lines*t.scaleY===this.canvas.height&&t.lineWidth*t.scaleX===this.canvas.width){this.imageData&&this.imageData.width===t.lineWidth&&this.imageData.height===t.lines||(this.imageData=new ImageData(t.lineWidth,t.lines));const e=new Uint32Array(this.imageData.data.buffer);switch(t.bpp){case 1:{const r=D[15],i=D[0];let n=0;for(let o=t.firstDirtyLine;o<=t.lastDirtyLine;o++){const s=o*t.bytesPerLine;for(let o=t.margin;o<t.lineWidth+t.margin;o++)e[n++]=t.buffer[s+(o>>>3)]&128>>>(7&o)?r:i}break}case 2:{const r=this.cloudpilotInstance.getPalette2bitMapping(),i=[D[15&r],D[r>>>4&15],D[r>>>8&15],D[r>>>12&15]];let n=0;for(let r=t.firstDirtyLine;r<=t.lastDirtyLine;r++){const o=r*t.bytesPerLine;for(let r=t.margin;r<t.lineWidth+t.margin;r++)e[n++]=i[t.buffer[o+(r>>>2)]>>6-2*(3&r)&3]}break}case 4:{let r=0;for(let i=t.firstDirtyLine;i<=t.lastDirtyLine;i++){const n=i*t.bytesPerLine;for(let i=t.margin;i<t.lineWidth+t.margin;i++)e[r++]=D[t.buffer[n+(i>>>1)]>>>4-4*(1&i)&15]}break}case 24:{const r=new Uint32Array(t.buffer.buffer,t.buffer.byteOffset,t.buffer.byteLength>>>2);if(0===t.margin)e.subarray(0,t.lineWidth*(t.lastDirtyLine-t.firstDirtyLine+1)).set(r.subarray(t.firstDirtyLine*t.lineWidth,t.lineWidth*(t.lastDirtyLine+1)));else{let i=0;for(let n=t.firstDirtyLine;n<=t.lastDirtyLine;n++){let o=n*(t.bytesPerLine>>>2)+t.margin;for(let n=0;n<t.lineWidth;n++)e[i++]=r[o++]}}}}}if(!this.imageData)return;const e=1!==t.scaleX||1!==t.scaleY;(e?this.contextTmp:this.context).putImageData(this.imageData,0,t.firstDirtyLine,0,0,t.lineWidth,t.lastDirtyLine-t.firstDirtyLine+1),e&&(this.context.imageSmoothingEnabled=!1,this.context.drawImage(this.canvasTmp,0,t.firstDirtyLine,t.lineWidth,t.lastDirtyLine-t.firstDirtyLine+1,0,t.firstDirtyLine*t.scaleY,t.lineWidth*t.scaleX,(t.lastDirtyLine-t.firstDirtyLine+1)*t.scaleY)),this.newFrameEvent.dispatch(this.canvas)}}class q extends V{constructor(){super(...arguments),this.timesliceEvent=new C.j}pause(){this.doPause()}resume(){this.doResume()}initWithRom(t,e,r,i){return this.isRunning()&&(this.doStop(),this.session=void 0),t.clearExternalStorage(),!!this.openSession(t,e,r)&&(this.session=i,!0)}initWithSessionImage(t,e,r){return this.isRunning()&&(this.doStop(),this.session=void 0),t.clearExternalStorage(),!!this.openSession(t,e.rom,e.deviceId,e.memory,e.savestate)&&(this.session=r,!0)}getSession(){return this.session}forceUpdateHotsyncName(){this.cloudpilotInstance&&this.cloudpilotInstance.isUiInitialized()&&!this.cloudpilotInstance.isPowerOff()&&this.checkAndUpdateHotsyncName()}getConfiguredSpeed(){var t,e;return null!==(e=null===(t=this.session)||void 0===t?void 0:t.speed)&&void 0!==e?e:1}manageHotsyncName(){return!0}getConfiguredHotsyncName(){var t;return null===(t=this.session)||void 0===t?void 0:t.hotsyncName}updateConfiguredHotsyncName(t){this.session&&(this.session.hotsyncName=t)}getConfiguredSchdedulerKind(){var t;return(null===(t=this.session)||void 0===t?void 0:t.runInBackground)?L.timeout:L.animationFrame}hasFatalError(){var t;return!!(null===(t=this.cloudpilotInstance)||void 0===t?void 0:t.hasFatalError())}skipEmulationUpdate(){return!1}onAfterAdvanceEmulation(t,e){this.timesliceEvent.dispatch()}handleInput(){return this.isRunning()}}class K{constructor(t,e){this.emulationService=t,this.canvasDisplayService=e,this.handleMouseDown=t=>{if(0!==t.button)return;const e=this.canvasDisplayService.eventToPalmCoordinates(t);if(!e)return;const r=this.determineArea(e);if(2===r){const t=this.canvasDisplayService.determineButton(e);this.interactionMouse={area:r,buttonPrimary:t},this.handleButtonDown(t)}else this.interactionMouse={area:r},this.emulationService.handlePointerMove(...e,1===r)},this.handleMouseMove=t=>{var e,r;if(!(1&t.buttons&&this.interactionMouse&&2!==(null===(e=this.interactionMouse)||void 0===e?void 0:e.area)))return;const i=this.canvasDisplayService.eventToPalmCoordinates(t,!0);i&&this.emulationService.handlePointerMove(...i,1===(null===(r=this.interactionMouse)||void 0===r?void 0:r.area))},this.handeMouseUp=t=>{if(0!==t.button)return;const e=this.interactionMouse;switch(this.interactionMouse=void 0,null==e?void 0:e.area){case 2:this.handleButtonUp(e.buttonPrimary);break;case 0:case 1:this.emulationService.handlePointerUp()}},this.handleTouchStart=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.canvasDisplayService.eventToPalmCoordinates(i);if(!n)continue;e=!0;const o=this.determineArea(n);if(2===o){const t=this.canvasDisplayService.determineButton(n);this.interactionsTouch.set(i.identifier,{area:o,buttonPrimary:t}),this.handleButtonDown(t)}else this.interactionsTouch.set(i.identifier,{area:o}),this.emulationService.handlePointerMove(...n,1===o)}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchMove=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.interactionsTouch.get(i.identifier);if(!n)continue;e=!0;const o=n.area;switch(o){case 2:{const t=this.canvasDisplayService.eventToPalmCoordinates(i);if(!t||2!==this.determineArea(t)){this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0;break}const e=this.canvasDisplayService.determineButton(t);e===n.buttonPrimary?(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=void 0):e!==n.buttonSecondary&&(this.handleButtonUp(n.buttonSecondary),n.buttonSecondary=e,this.handleButtonDown(e));break}case 0:case 1:{const t=this.canvasDisplayService.eventToPalmCoordinates(i,!0);if(!t)continue;this.emulationService.handlePointerMove(...t,1===o);break}default:continue}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleTouchEnd=t=>{let e=!1;for(let r=0;r<t.changedTouches.length;r++){const i=t.changedTouches.item(r);if(!i)continue;const n=this.interactionsTouch.get(i.identifier);switch(n&&(e=!0),this.interactionsTouch.delete(i.identifier),null==n?void 0:n.area){case 2:this.handleButtonUp(n.buttonPrimary),this.handleButtonUp(n.buttonSecondary);break;case 0:case 1:this.emulationService.handlePointerUp()}}e&&!1!==t.cancelable&&t.preventDefault()},this.handleKeyDown=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;if(this.isToggleGameMode(t))return t.preventDefault(),this.gameMode=!this.gameMode,void this.onToggleGameMode();const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonDown(e),void t.preventDefault();const r=this.keyCodeFromEvent(t);void 0!==r&&(this.emulationService.handleKeyDown(r),t.preventDefault())},this.handleKeyUp=t=>{if(this.emulationService.isSuspended()||!this.enableKeyboardEvents())return;const e=this.buttonFromEvent(t);if(void 0!==e)return this.handleButtonUp(e),void t.preventDefault();if("Control"===t.key){for(const t of this.activeButtons)this.emulationService.handleButtonUp(t);this.activeButtons.clear(),this.canvasDisplayService.drawButtons([])}},this.keyEventTarget=window,this.interactionsTouch=new Map,this.activeButtons=new Set,this.gameMode=!1,this.enableGamemodeHotkey=!0}bind(t,e=window){this.pointerEventTarget&&this.release(),this.pointerEventTarget=t,this.keyEventTarget=e||window,this.addEventListener(t,"mousedown",this.handleMouseDown),this.addEventListener(window,"mouseup",this.handeMouseUp),this.addEventListener(window,"mousemove",this.handleMouseMove),this.addEventListener(t,"touchstart",this.handleTouchStart),this.addEventListener(t,"touchmove",this.handleTouchMove),this.addEventListener(t,"touchend",this.handleTouchEnd),this.addEventListener(t,"touchcancel",this.handleTouchEnd),this.addEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.addEventListener(this.keyEventTarget,"keyup",this.handleKeyUp)}release(){if(this.pointerEventTarget){this.removeEventListener(this.pointerEventTarget,"mousedown",this.handleMouseDown),this.removeEventListener(window,"mouseup",this.handeMouseUp),this.removeEventListener(window,"mousemove",this.handleMouseMove),this.removeEventListener(this.pointerEventTarget,"touchstart",this.handleTouchStart),this.removeEventListener(this.pointerEventTarget,"touchmove",this.handleTouchMove),this.removeEventListener(this.pointerEventTarget,"touchend",this.handleTouchEnd),this.removeEventListener(this.pointerEventTarget,"touchcancel",this.handleTouchEnd),this.removeEventListener(this.keyEventTarget,"keydown",this.handleKeyDown),this.removeEventListener(this.keyEventTarget,"keyup",this.handleKeyUp);for(const t of this.activeButtons)this.handleButtonUp(t);this.activeButtons.clear(),this.interactionsTouch.clear(),this.interactionMouse=void 0,this.pointerEventTarget=void 0}}isGameMode(){return this.gameMode}setGameMode(t){this.gameMode=t,this.onToggleGameMode()}setGameModeHotkeyEnabled(t){this.enableGamemodeHotkey=t}isGameModeHotkeyEnabled(){return this.enableGamemodeHotkey}enableKeyboardEvents(){return!0}onToggleGameMode(){}addEventListener(t,e,r,i){t.addEventListener(e,r,i)}removeEventListener(t,e,r,i){t.removeEventListener(e,r,i)}determineArea(t){return this.canvasDisplayService.isButtons(t)?2:this.canvasDisplayService.isSilkscreen(t)?1:0}handleButtonDown(t){this.activeButtons.has(t)||(this.activeButtons.add(t),this.emulationService.handleButtonDown(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}handleButtonUp(t){void 0!==t&&this.activeButtons.has(t)&&(this.activeButtons.delete(t),this.emulationService.handleButtonUp(t),this.canvasDisplayService.drawButtons(Array.from(this.activeButtons.values())))}isToggleGameMode(t){return this.isGameModeHotkeyEnabled()&&("Shift"===t.key&&t.ctrlKey||"Control"===t.key&&t.shiftKey)}isGameModeActive(t){return!this.gameMode&&t.ctrlKey||this.gameMode&&!t.ctrlKey}buttonFromEvent(t){switch(t.key){case"PageUp":return 4;case"PageDown":return 5}if(this.isGameModeActive(t))switch(t.key){case"w":case"i":case"ArrowUp":return 4;case"s":case"k":case"ArrowDown":return 5;case"a":case"j":case"y":case"z":case"ArrowLeft":return 0;case"q":case"u":case"x":return 1;case"e":case"o":case"c":return 2;case"d":case"l":case"v":case"ArrowRight":return 3}}keyCodeFromEvent(t){if(!this.isGameModeActive(t)){if(1===t.key.length&&t.key.charCodeAt(0)<=255)return t.key.charCodeAt(0);switch(t.key){case"ArrowLeft":return 28;case"ArrowRight":return 29;case"ArrowUp":return 30;case"ArrowDown":return 31;case"Backspace":return 8;case"Tab":return 9;case"Enter":return 10;default:return}}}}class $ extends K{constructor(t,e){super(t,e),this.gameModeChangeEvent=new C.j,this.canvasDisplayService=e}onToggleGameMode(){this.canvasDisplayService.toggleGameModeIndicator(this.isGameMode()),this.gameModeChangeEvent.dispatch(this.isGameMode())}}class Q{constructor(t){this.cloudpilot=t,this.images=new Map}loadSkinElement(t){if(this.images.has(t))return this.images.get(t);const e=this.cloudpilot.then((e=>e.loadSkin(t))).then((e=>e?Promise.all([e,f(v(e))]):Promise.reject(new Error(`failed to load skin ${t}`)))),r=_(e.then((([,t])=>t)),e.then((([t])=>t)));return this.images.set(t,r),r}}class Y{constructor(t){this.query=t,this.changeEvent=new C.j,this.last=t()}update(){const t=this.query();t!==this.last&&(this.changeEvent.dispatch(t),this.last=t)}}const Z={hotsyncName:void 0,orientation:o.portrait,runInBackground:!1,speed:1,deviceId:n.m515},X="MEMORY_CARD";class J{constructor(t){this.cloudpilot=t,this.onTimeslice=()=>{this.powerOffWatcher.update(),this.uiInitializedWatcher.update(),this.hotsyncNameWatcher.update()},this.audioInitializedEvent=new C.j,this.session=Object.assign({},Z),this.emulationService=new q,this.canvasDisplayService=new A(new Q(Promise.resolve(t))),this.eventHandlingService=new $(this.emulationService,this.canvasDisplayService),this.audioService=new y(this.emulationService),this.emulationService.newFrameEvent.addHandler((t=>this.canvasDisplayService.updateEmulationCanvas(t))),this.timesliceEvent.addHandler(this.onTimeslice),this.powerOffWatcher=new Y((()=>this.isPowerOff())),this.uiInitializedWatcher=new Y((()=>this.isUiInitialized())),this.hotsyncNameWatcher=new Y((()=>this.getHotsyncName()||""))}getStatistics(){return this.emulationService.getStatistics()}loadRom(t,e){if(void 0===e){const r=this.cloudpilot.getRomInfo(t);if(!r||0===r.supportedDevices.length)throw new Error("unsupported device");e=r.supportedDevices[0]}if(this.session=Object.assign(Object.assign({},Z),{deviceId:e}),this.emulationService.initWithRom(this.cloudpilot,t,e,this.session))return this.canvasDisplayService.initialize(void 0,e,this.session.orientation),this;throw new Error("failed to initialize session")}loadSession(t){var e,r,i,n,s;const a=this.cloudpilot.deserializeSessionImage(t);if(!a)throw new Error("bad session image");if(this.session={hotsyncName:null===(e=a.metadata)||void 0===e?void 0:e.hotsyncName,speed:null!==(i=null===(r=a.metadata)||void 0===r?void 0:r.speed)&&void 0!==i?i:1,orientation:null!==(s=null===(n=a.metadata)||void 0===n?void 0:n.deviceOrientation)&&void 0!==s?s:o.portrait,runInBackground:!1,deviceId:a.deviceId},this.emulationService.initWithSessionImage(this.cloudpilot,a,this.session))return this.canvasDisplayService.initialize(void 0,a.deviceId,this.session.orientation),this;throw new Error("failed to initialize session")}insertCompressedCardImage(t){if(!this.cloudpilot.decompressCard(X,t))throw new Error("failed to decompress and mount card image");if(!this.cloudpilot.mountCard(X))throw new Error("failed to mount card image");return this}insertCardImage(t){if(t.length%512!=0)throw new Error("card image size must be a multiple of 512");if(!this.cloudpilot.allocateCard(X,t.length))throw new Error("failed to allocate card image");const e=this.cloudpilot.getCardData(X);if(!e)throw new Error("failed to allocate card image");if(e.set(new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>>2)),!this.cloudpilot.mountCard(X))throw new Error("failed to mount card image");return this}ejectCard(){if(!this.isCardMounted())return this;if(!this.cloudpilot.removeCard(X))throw new Error("failed to eject card");return this}isCardMounted(){return this.cloudpilot.getMountedKey()===X}setCanvas(t){return this.canvasDisplayService.initialize(t,this.session.deviceId,this.session.orientation),this}bindInput(t){const e=this.canvasDisplayService.getCanvas();if(!e)throw new Error("you must set up the canvas setCanvas before calling bindInput");return this.eventHandlingService.bind(e,t),this}releaseInput(){return this.eventHandlingService.release(),this}installDatabase(t){if(this.cloudpilot.installDb(t)<0)throw new Error("failed to install database");return this}installAndLaunchDatabase(t){return this.installDatabase(t).launchDatabase(t)}installFromZipfile(t){return this.installFromZipfileAndLaunch(t)}installFromZipfileAndLaunch(t,e){let r;if(this.cloudpilot.withZipfileWalkerSync(t,(t=>{for(;0===t.GetState();){const i=t.GetCurrentEntryContent(),n=t.GetCurrentEntryName();if(!i)throw new Error(`unable to read ${n} from zupfile`);this.installDatabase(i),n.toLowerCase()===(null==e?void 0:e.toLowerCase())&&(r=i.subarray(0,32).slice()),t.Next()}if(-1===t.GetState())throw new Error("error reading zipfile")})),void 0!==e&&!r)throw new Error(`database ${e} not found `);return r&&this.launchDatabase(r),this}launchByName(t){if(!this.cloudpilot.launchAppByName(t))throw new Error(`failed to launch ${t}`);return this}launchDatabase(t){if(!this.cloudpilot.launchAppByDbHeader(t))throw new Error("failed to launch database");return this}reset(){return this.emulationService.reset(),this}resetNoExtensions(){return this.emulationService.resetNoExtensions(),this}resetHard(){return this.emulationService.resetHard(),this}isRunning(){return this.emulationService.isRunning()}isPowerOff(){return this.emulationService.isPowerOff()}isUiInitialized(){return this.emulationService.isUiInitialized()}resume(){return this.emulationService.resume(),this}pause(){return this.emulationService.pause(),this}buttonDown(t){return this.emulationService.handleButtonDown(t),this}buttonUp(t){return this.emulationService.handleButtonUp(t),this}setSpeed(t){return this.session.speed=t,this}getSpeed(){return this.session.speed}setVolume(t){return this.audioService.setVolume(t),this}getVolume(){return this.audioService.getVolume()}initializeAudio(){return e(this,void 0,void 0,(function*(){return yield this.audioService.initialize(),this.audioService.isInitialized()}))}isAudioInitialized(){return this.audioService.isInitialized()}setOrientation(t){return this.session.orientation=t,this.canvasDisplayService.updateOrientation(this.session.orientation),this}getOrientation(){return this.session.orientation}setHotsyncName(t){return this.session.hotsyncName=t,this.emulationService.forceUpdateHotsyncName(),this}getHotsyncName(){return this.session.hotsyncName}setRunHidden(t){return this.session.runInBackground=t,this}getRunHidden(){return this.session.runInBackground}isGameMode(){return this.eventHandlingService.isGameMode()}setGameMode(t){return this.eventHandlingService.setGameMode(t),this}isGameModeHotkeyEnabled(){return this.eventHandlingService.isGameModeHotkeyEnabled()}setGameModeHotkeyEnabled(t){return this.eventHandlingService.setGameModeHotkeyEnabled(t),this}isGameModeIndicatorEnabled(){return this.canvasDisplayService.isGameModeIndicatorEnabled()}setGameModeIndicatorEnabled(t){return this.canvasDisplayService.setGameModeIndicatorEnabled(t),this}getSerialPortIR(){return this.emulationService.getSerialPortIR()}getSerialPortSerial(){return this.emulationService.getSerialPortSerial()}get powerOffChangeEvent(){return this.powerOffWatcher.changeEvent}get isUiInitializedChangeEvent(){return this.uiInitializedWatcher.changeEvent}get hotsyncNameChangeEvent(){return this.hotsyncNameWatcher.changeEvent}get gameModeChangeEvent(){return this.eventHandlingService.gameModeChangeEvent}get timesliceEvent(){return this.emulationService.timesliceEvent}}var tt=r(492),et=r.n(tt);let rt=0;const it=[n.palmPilot,n.pilot,n.iii,n.palmVx,n.palmV,n.palmVII,n.palmVIIEZ,n.palmVIIx,n.iiixe,n.iiix,n.iiie,n.m500,n.m505,n.m515,n.m520,n.iiic,n.m100,n.m105,n.m125,n.m130,n.i705,n.i710,n.handera330,n.handera330c,n.pegS300,n.pegS320,n.pegS500c,n.pegT400,n.pegN600c,n.pegT600c,n.pegN700c,n.pegT650c,n.pegNR70,n.acerS11,n.lp168];function nt(){return(t,e,r)=>{const i=r.value;return r.value=function(t,e){return this.guard((()=>i.call(this,t,e)))},r}}class ot{constructor(t){this.module=t,this.fatalErrorEvent=new C.j,this.pwmUpdateEvent=new C.j,this.proxyDisconnectEvent=new C.j,this.amIdead=!1,this.cloudpilot=new t.Cloudpilot,this.cloudpilot.RegisterPwmHandler(t.addFunction(((t,e)=>this.pwmUpdateEvent.dispatch({frequency:t,dutyCycle:e})),"vdd")),this.cloudpilot.RegisterProxyDisconnectHandler(t.addFunction((()=>this.proxyDisconnectEvent.dispatch()),"v")),this.transportIR=this.wrapTransport(this.cloudpilot.GetTransportIR()),this.transportSerial=this.wrapTransport(this.cloudpilot.GetTransportSerial())}static create(t){return e(this,void 0,void 0,(function*(){const e=rt++;return new ot(yield et()(Object.assign(Object.assign({print:t=>console.log(`${e}: ${t}`),printErr:t=>console.error(`${e}: ${t}`)},"string"==typeof t?{locateFile:()=>t}:{}),"function"==typeof t?{instantiateWasm:t}:{})))}))}destroy(){this.module.destroy(this.cloudpilot)}hasFatalError(){return this.amIdead}enableLogging(t){this.cloudpilot.EnableLogging(t)}getRomInfo(t){const e=this.copyIn(t),r=new this.module.RomInfo(e,t.length);let i;return r.IsValid()&&(i={cardVersion:r.CardVersion(),cardName:r.CardName(),romVersion:r.RomVersion(),romVersionString:r.RomVersionString(),supportedDevices:it.filter(r.Supports.bind(r))}),this.cloudpilot.Free(e),this.module.destroy(r),i}initializeSession(t,e){const r=this.copyIn(t),i=this.cloudpilot.InitializeSession(r,t.length,e);return this.cloudpilot.Free(r),i}cyclesPerSecond(){return this.cloudpilot.GetCyclesPerSecond()}runEmulation(t){return this.cloudpilot.RunEmulation(t)}getFrame(){const t=this.cloudpilot.CopyFrame(),e=this.module.getPointer(t.GetBuffer());return{bpp:t.GetBpp(),bytesPerLine:t.GetBytesPerLine(),lines:t.GetLines(),lineWidth:t.GetLineWidth(),margin:t.GetMargin(),firstDirtyLine:t.GetFirstDirtyLine(),lastDirtyLine:t.GetLastDirtyLine(),hasChanges:t.GetHasChanges(),scaleX:t.GetScaleX(),scaleY:t.GetScaleY(),buffer:this.module.HEAPU8.subarray(e,e+t.GetBufferSize())}}isScreenDirty(){return this.cloudpilot.IsScreenDirty()}markScreenClean(){this.cloudpilot.MarkScreenClean()}minRamForDevice(t){return 1024*this.cloudpilot.MinMemoryForDevice(t)}framebufferSizeForDevice(t){return 1024*this.cloudpilot.FramebufferSizeForDevice(t)}totalMemorySizeForDevice(t){return 1024*this.cloudpilot.TotalMemoryForDevice(t)}queuePenMove(t,e){this.cloudpilot.QueuePenMove(t,e)}queuePenUp(){this.cloudpilot.QueuePenUp()}queueButtonDown(t){this.cloudpilot.QueueButtonDown(t)}queueButtonUp(t){this.cloudpilot.QueueButtonUp(t)}queueKeyboardEvent(t,e){this.cloudpilot.QueueKeyboardEvent(t,e)}isPowerOff(){return!!this.cloudpilot.IsPowerOff()}isUiInitialized(){return!!this.cloudpilot.IsUIInitialized()}isSetupComplete(){return!!this.cloudpilot.IsSetupComplete()}getOSVersion(){return this.cloudpilot.GetOSVersion()}reset(){this.cloudpilot.Reset()}resetNoExtensions(){this.cloudpilot.ResetNoExtensions()}resetHard(){this.cloudpilot.ResetHard()}installDb(t){const e=this.copyIn(t),r=this.cloudpilot.InstallDb(e,t.length);return this.cloudpilot.Free(e),r}getPalette2bitMapping(){return this.cloudpilot.GetPalette2bitMapping()}getMemory(){const t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetMemorySize())}getMemory32(){let t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());if(3&t)throw new Error("unaligned pointer");return t>>>=2,this.module.HEAPU32.subarray(t,t+(this.cloudpilot.GetMemorySize()>>>2))}getDirtyPages(){const t=this.module.getPointer(this.cloudpilot.GetDirtyPagesPtr()),e=this.cloudpilot.GetMemorySize(),r=(e>>>13)+(e%8192==0?0:1);return this.module.HEAPU8.subarray(t,t+r)}loadMemory(t){const e=this.getMemory32();if((()=>{if(t.length!==e.length||t.length<256)return!1;for(let r=256;r>0;r--){if(t[t.length-r]!==e[e.length-r])return!1;if(4294967295===e[e.length-r])break}return!0})())return e.set(t),!0;{const e=this.copyIn32(t),r=this.cloudpilot.ImportMemoryImage(e,t.length<<2);return this.cloudpilot.Free(e),r}}getRomImage(){const t=this.module.getPointer(this.cloudpilot.GetRomPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetRomSize())}getSavestate(){const t=this.module.getPointer(this.cloudpilot.GetSavestatePtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetSavestateSize())}saveState(){return!!this.cloudpilot.SaveState()}loadState(t){const e=this.copyIn(t),r=this.cloudpilot.LoadState(e,t.length);return this.cloudpilot.Free(e),r}getHotsyncName(){return this.cloudpilot.GetHotsyncName()}setClockFactor(t){this.cloudpilot.SetClockFactor(t)}setHotsyncName(t){this.cloudpilot.SetHotsyncName(t)}backup(t){return e(this,void 0,void 0,(function*(){const e=this.guard((()=>this.cloudpilot.StartBackup()));try{return yield t(this.wrap(e))}finally{this.module.destroy(e)}}))}getArchive(t){const e=t.GetArchiveSize();return this.copyOut(t.GetArchivePtr(),e)}setClipboardIntegration(t){this.cloudpilot.SetClipboardIntegration(t)}getClipboardIntegration(){return this.cloudpilot.GetClipboardIntegration()}isSuspended(){return this.cloudpilot.IsSuspended()}getSuspendKind(){return this.cloudpilot.IsSuspended()?this.cloudpilot.GetSuspendContext().GetKind():void 0}cancelSuspend(){this.cloudpilot.GetSuspendContext().Cancel()}getSuspendContextClipboardCopy(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardCopy())}getSuspendContextClipboardPaste(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextClipboardPaste())}setNetworkRedirection(t){this.cloudpilot.SetNetworkRedirection(t)}getNetworkRedirection(){return this.cloudpilot.GetNetworkRedirection()}getSuspendContextNetworkConnect(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkConnect())}getSuspendContextNetworkRpc(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextNetworkRpc())}getSuspendContextSerialSync(){return this.wrap(this.cloudpilot.GetSuspendContext().AsContextSerialSync())}copyBuffer(t){return this.copyIn(t)}freeBuffer(t){this.cloudpilot.Free(t)}setHotsyncNameManagement(t){this.cloudpilot.SetHotsyncNameManagement(t)}resolveBuffer(t,e){const r=this.module.getPointer(t);return this.module.HEAPU8.subarray(r,r+e)}withZipfileWalker(t,r){return e(this,void 0,void 0,(function*(){const e=this.guard((()=>{const e=this.copyIn(t),r=new this.module.ZipfileWalker(t.length,e);return this.cloudpilot.Free(e),r}));try{return yield r(function(t,e){return Object.setPrototypeOf({GetCurrentEntryContent:()=>{const r=e.getPointer(t.GetCurrentEntryContent()),i=t.GetCurrentEntrySize();return r>0&&i>0?e.HEAPU8.subarray(r,r+i):void 0}},t)}(this.wrap(e),this.module))}finally{this.module.destroy(e)}}))}withZipfileWalkerSync(t,e){const r=this.guard((()=>{const e=this.copyIn(t),r=new this.module.ZipfileWalker(t.length,e);return this.cloudpilot.Free(e),r}));try{return e(this.wrap(Object.setPrototypeOf({GetCurrentEntryContent:()=>this.copyOut(r.GetCurrentEntryContent(),r.GetCurrentEntrySize())},r)))}finally{this.module.destroy(r)}}serializeSessionImage(t){var e,r;const i=new this.module.SessionImage,n=this.cloudpilot.Nullptr(),o=this.copyIn(t.rom),s=t.memory?this.copyIn(t.memory):n,a=void 0!==t.savestate?this.copyIn(t.savestate):n;let c=n,p=0;if(void 0!==t.metadata){const e=(new TextEncoder).encode(JSON.stringify(t.metadata));p=e.length,c=this.copyIn(e)}i.SetRomImage(o,t.rom.length),i.SetMemoryImage(s,(null===(e=t.memory)||void 0===e?void 0:e.length)||0),i.SetDeviceId(t.deviceId),i.SetSavestate(a,(null===(r=t.savestate)||void 0===r?void 0:r.length)||0),i.SetMetadata(c,p);const u=i.Serialize()?this.copyOut(i.GetSerializedImage(),i.GetSerializedImageSize()):void 0;return this.module.destroy(i),[o,s,a,c].forEach((t=>this.cloudpilot.Free(t))),u}deserializeSessionImage(t){if(!t)return;const e=new this.module.SessionImage,r=this.copyIn(t),i=(()=>{if(!e.Deserialize(r,t.length))return;const i=this.copyOut(e.GetRomImage(),e.GetRomImageSize()),n=this.copyOut(e.GetMemoryImage(),e.GetMemoryImageSize()),o=this.copyOut(e.GetSavestate(),e.GetSavestateSize()),s=e.GetDeviceId();if(!it.includes(s))return void console.warn(`unsupported device ${s}`);let a;const c=this.copyOut(e.GetMetadata(),e.GetMetadataSize());if(c)try{a=JSON.parse((new TextDecoder).decode(c))}catch(t){console.warn("invalid metadata",t)}return{deviceId:s,rom:i,memory:n,savestate:o,metadata:a,version:e.GetVersion()}})();return this.module.destroy(e),this.cloudpilot.Free(r),i}launchAppByName(t){return this.cloudpilot.LaunchAppByName(t)}launchAppByDbHeader(t){if(t.length<32)return!1;const e=this.copyIn(t.subarray(0,32)),r=this.cloudpilot.LaunchAppByDbHeader(e,32);return this.cloudpilot.Free(e),r}deviceSupportsCardSize(t){return this.cloudpilot.DeviceSupportsCardSize(t)}clearExternalStorage(){this.cloudpilot.ClearExternalStorage()}allocateCard(t,e){return this.cloudpilot.AllocateCard(t,e>>>9)}decompressCard(t,e){const r=this.copyIn(e);let i;try{for(i=new this.module.GunzipContext(r,e.length,524288);0===i.GetState();)i.Continue();return-1===i.GetState()?(console.error(`gunzip failed: ${i.GetError()}`),!1):i.GetUncompressedSize()%512!=0?(console.error("failed to allocate card: invalid size of decompressed image"),!1):this.cloudpilot.AdoptCard(t,i.ReleaseUncompressedData(),i.GetUncompressedSize()>>>9)}finally{this.cloudpilot.Free(r),i&&this.module.destroy(i)}}getCardData(t){const e=this.module.getPointer(this.cloudpilot.GetCardData(t));if(0!==e)return this.module.HEAPU32.subarray(e>>>2,e+this.cloudpilot.GetCardSize(t)>>2)}getCardDirtyPages(t){const e=this.module.getPointer(this.cloudpilot.GetCardDirtyPages(t));if(0===e)return;const r=function(t){const e=(t>>>13)+(t%8192>0?1:0);return(e>>>3)+(e%8>0?1:0)}(this.cloudpilot.GetCardSize(t));return this.module.HEAPU8.subarray(e,e+r)}getMountedKey(){return this.cloudpilot.GetMountedKey()}mountCard(t){return this.cloudpilot.MountCard(t)}removeCard(t){return this.cloudpilot.RemoveCard(t)}remountCards(){this.cloudpilot.RemountCards()}getCardSupportLevel(t){return this.cloudpilot.GetSupportLevel(t)}loadSkin(t){const e=new this.module.SkinLoader(t);try{const t=this.module.getPointer(e.GetData());if(0===t)return;return(new TextDecoder).decode(this.module.HEAPU8.subarray(t,t+e.GetSize()))}finally{this.module.destroy(e)}}getTransportIR(){return this.transportIR}getTransportSerial(){return this.transportSerial}guard(t){if(this.amIdead)throw new Error("cloudpilot instance is dead");try{return t()}catch(t){throw this.amIdead=!0,this.cloudpilot=void 0,this.fatalErrorEvent.dispatch(t instanceof Error?t:new Error("unknown error")),t}}copyIn(t){const e=this.cloudpilot.Malloc(t.length),r=this.module.getPointer(e);return this.module.HEAPU8.subarray(r,r+t.length).set(t),e}copyIn32(t){const e=this.cloudpilot.Malloc(t.length<<2),r=this.module.getPointer(e);return this.module.HEAPU32.subarray(r>>>2,(r>>>2)+t.length).set(t),e}copyOut(t,e){const r=this.module.getPointer(t);return r>0&&e>0?this.module.HEAPU8.subarray(r,r+e).slice():void 0}wrap(t){return new Proxy(t,{get:(t,e)=>{const r=t[e];return"function"!=typeof r?r:(...e)=>this.guard((()=>r.apply(t,e)))}})}wrapTransport(t){const e=new C.j;return t.SetRequestTransferCallback(this.module.addFunction((()=>e.dispatch()),"v")),this.wrap(Object.setPrototypeOf({Receive:()=>{const e=t.RxBytesPending();return this.copyOut(t.Receive(),e)},Send:(e,r)=>{var i;const n=e&&this.copyIn(e);t.Send(null!==(i=null==e?void 0:e.length)&&void 0!==i?i:0,null!=n?n:this.cloudpilot.Nullptr(),r),n&&this.cloudpilot.Free(n)},frameCompleteEvent:e},t))}}var st;t([nt()],ot.prototype,"enableLogging",null),t([nt()],ot.prototype,"getRomInfo",null),t([nt()],ot.prototype,"initializeSession",null),t([nt()],ot.prototype,"cyclesPerSecond",null),t([nt()],ot.prototype,"runEmulation",null),t([nt()],ot.prototype,"getFrame",null),t([nt()],ot.prototype,"isScreenDirty",null),t([nt()],ot.prototype,"markScreenClean",null),t([nt()],ot.prototype,"minRamForDevice",null),t([nt()],ot.prototype,"framebufferSizeForDevice",null),t([nt()],ot.prototype,"totalMemorySizeForDevice",null),t([nt()],ot.prototype,"queuePenMove",null),t([nt()],ot.prototype,"queuePenUp",null),t([nt()],ot.prototype,"queueButtonDown",null),t([nt()],ot.prototype,"queueButtonUp",null),t([nt()],ot.prototype,"queueKeyboardEvent",null),t([nt()],ot.prototype,"isPowerOff",null),t([nt()],ot.prototype,"isUiInitialized",null),t([nt()],ot.prototype,"isSetupComplete",null),t([nt()],ot.prototype,"getOSVersion",null),t([nt()],ot.prototype,"reset",null),t([nt()],ot.prototype,"resetNoExtensions",null),t([nt()],ot.prototype,"resetHard",null),t([nt()],ot.prototype,"installDb",null),t([nt()],ot.prototype,"getPalette2bitMapping",null),t([nt()],ot.prototype,"getMemory",null),t([nt()],ot.prototype,"getMemory32",null),t([nt()],ot.prototype,"getDirtyPages",null),t([nt()],ot.prototype,"loadMemory",null),t([nt()],ot.prototype,"getRomImage",null),t([nt()],ot.prototype,"getSavestate",null),t([nt()],ot.prototype,"saveState",null),t([nt()],ot.prototype,"loadState",null),t([nt()],ot.prototype,"getHotsyncName",null),t([nt()],ot.prototype,"setClockFactor",null),t([nt()],ot.prototype,"setHotsyncName",null),t([nt()],ot.prototype,"setClipboardIntegration",null),t([nt()],ot.prototype,"getClipboardIntegration",null),t([nt()],ot.prototype,"isSuspended",null),t([nt()],ot.prototype,"getSuspendKind",null),t([nt()],ot.prototype,"cancelSuspend",null),t([nt()],ot.prototype,"getSuspendContextClipboardCopy",null),t([nt()],ot.prototype,"getSuspendContextClipboardPaste",null),t([nt()],ot.prototype,"setNetworkRedirection",null),t([nt()],ot.prototype,"getNetworkRedirection",null),t([nt()],ot.prototype,"getSuspendContextNetworkConnect",null),t([nt()],ot.prototype,"getSuspendContextNetworkRpc",null),t([nt()],ot.prototype,"getSuspendContextSerialSync",null),t([nt()],ot.prototype,"copyBuffer",null),t([nt()],ot.prototype,"freeBuffer",null),t([nt()],ot.prototype,"setHotsyncNameManagement",null),t([nt()],ot.prototype,"resolveBuffer",null),t([nt()],ot.prototype,"serializeSessionImage",null),t([nt()],ot.prototype,"deserializeSessionImage",null),t([nt()],ot.prototype,"launchAppByName",null),t([nt()],ot.prototype,"launchAppByDbHeader",null),t([nt()],ot.prototype,"deviceSupportsCardSize",null),t([nt()],ot.prototype,"clearExternalStorage",null),t([nt()],ot.prototype,"allocateCard",null),t([nt()],ot.prototype,"decompressCard",null),t([nt()],ot.prototype,"getCardData",null),t([nt()],ot.prototype,"getCardDirtyPages",null),t([nt()],ot.prototype,"getMountedKey",null),t([nt()],ot.prototype,"mountCard",null),t([nt()],ot.prototype,"removeCard",null),t([nt()],ot.prototype,"remountCards",null),t([nt()],ot.prototype,"getCardSupportLevel",null),t([nt()],ot.prototype,"loadSkin",null),function(t){t[t.cal=0]="cal",t[t.phone=1]="phone",t[t.todo=2]="todo",t[t.notes=3]="notes",t[t.up=4]="up",t[t.down=5]="down",t[t.power=6]="power",t[t.cradle=7]="cradle"}(st||(st={}));const at="1.10.11";function ct(t){return e(this,void 0,void 0,(function*(){return new J(yield ot.create(t))}))}function pt(t){const r=function(t){const r=WebAssembly.compileStreaming?WebAssembly.compileStreaming(fetch(t)):fetch(t).then((t=>t.arrayBuffer())).then((t=>WebAssembly.compile(t)));return(t,i)=>e(this,void 0,void 0,(function*(){return i(yield WebAssembly.instantiate(yield r,t))}))}(null!=t?t:"cloudpilot_web.wasm");return()=>ot.create(r).then((t=>new J(t)))}})(),i})()));
//# sourceMappingURL=cloudpilot-emu.js.map