(()=>{var vn={3948:(g,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});var T=[];T[0]=function(){return function(){}},T[1]=function(u,k){return typeof k>"u"?u:function(O){u(O,k)}};var W=function(){function u(){this.hasHandlers=!1,this._handlers=[],this._contexts=[],this._createDispatcher()}return u.prototype.addHandler=function(k,s){return this.isHandlerAttached(k,s)||(this._handlers.push(k),this._contexts.push(s),this._createDispatcher(),this._updateHasHandlers()),this},u.prototype.removeHandler=function(k,s){var O=this._getHandlerIndex(k,s);return typeof O<"u"&&(this._handlers.splice(O,1),this._contexts.splice(O,1),this._createDispatcher(),this._updateHasHandlers()),this},u.prototype.isHandlerAttached=function(k,s){return typeof this._getHandlerIndex(k,s)<"u"},u.prototype._updateHasHandlers=function(){this.hasHandlers=!!this._handlers.length},u.prototype._getHandlerIndex=function(k,s){var C,O=this._handlers.length;for(C=0;C<O&&(this._handlers[C]!==k||this._contexts[C]!==s);C++);return C<O?C:void 0},u.prototype._createDispatcher=function(){this.dispatch=function H(u){return T[u]||(T[u]=function L(u){for(var k="return function dispatcher"+u+"(payload) {\n",s=[],O=[],C=0;C<u;C++)s.push("cb"+C),O.push("ctx"+C),k+="    cb"+C+"(payload, ctx"+C+");\n";return k+="};",new(Function.bind.apply(Function,[void 0].concat(s.concat(O),[k])))}(u)),T[u]}(this._handlers.length).apply(this,this._handlers.concat(this._contexts))},u}();z.default=W},5e3:g=>{function z(H,L,W,u,k,s,O){try{var C=H[s](O),Z=C.value}catch(ye){return void W(ye)}C.done?L(Z):Promise.resolve(Z).then(u,k)}g.exports=function T(H){return function(){var L=this,W=arguments;return new Promise(function(u,k){var s=H.apply(L,W);function O(Z){z(s,u,k,O,C,"next",Z)}function C(Z){z(s,u,k,O,C,"throw",Z)}O(void 0)})}},g.exports.__esModule=!0,g.exports.default=g.exports},5259:function(){!function(g){"use strict";if(!g.setImmediate){var u,T=1,H={},L=!1,W=g.document,q=Object.getPrototypeOf&&Object.getPrototypeOf(g);q=q&&q.setTimeout?q:g,"[object process]"==={}.toString.call(g.process)?function Z(){u=function(P){process.nextTick(function(){C(P)})}}():function ye(){if(g.postMessage&&!g.importScripts){var P=!0,N=g.onmessage;return g.onmessage=function(){P=!1},g.postMessage("","*"),g.onmessage=N,P}}()?function Me(){var P="setImmediate$"+Math.random()+"$",N=function(I){I.source===g&&"string"==typeof I.data&&0===I.data.indexOf(P)&&C(+I.data.slice(P.length))};g.addEventListener?g.addEventListener("message",N,!1):g.attachEvent("onmessage",N),u=function(I){g.postMessage(P+I,"*")}}():g.MessageChannel?function Se(){var P=new MessageChannel;P.port1.onmessage=function(N){C(N.data)},u=function(N){P.port2.postMessage(N)}}():W&&"onreadystatechange"in W.createElement("script")?function oe(){var P=W.documentElement;u=function(N){var I=W.createElement("script");I.onreadystatechange=function(){C(N),I.onreadystatechange=null,P.removeChild(I),I=null},P.appendChild(I)}}():function fe(){u=function(P){setTimeout(C,0,P)}}(),q.setImmediate=function k(P){"function"!=typeof P&&(P=new Function(""+P));for(var N=new Array(arguments.length-1),I=0;I<N.length;I++)N[I]=arguments[I+1];return H[T]={callback:P,args:N},u(T),T++},q.clearImmediate=s}function s(P){delete H[P]}function C(P){if(L)setTimeout(C,0,P);else{var N=H[P];if(N){L=!0;try{!function O(P){var N=P.callback,I=P.args;switch(I.length){case 0:N();break;case 1:N(I[0]);break;case 2:N(I[0],I[1]);break;case 3:N(I[0],I[1],I[2]);break;default:N.apply(void 0,I)}}(N)}finally{s(P),L=!1}}}}}(typeof self>"u"?typeof global>"u"?this:global:self)},6702:(g,z,T)=>{var W,H=T(5e3).default,L=(W=typeof document<"u"?document.currentScript?.src:void 0,H(function*(u={}){var s=u,O="object"==typeof window,C=typeof WorkerGlobalScope<"u",Se=("object"==typeof process&&process.versions?.node&&process,"./this.program"),oe=(e,r)=>{throw r};C&&(W=self.location.href);var P,N,fe="";if(O||C){try{fe=new URL(".",W).href}catch{}C&&(N=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),P=function(){var e=H(function*(r){var o=yield fetch(r,{credentials:"same-origin"});if(o.ok)return o.arrayBuffer();throw new Error(o.status+" : "+o.url)});return function(o){return e.apply(this,arguments)}}()}var re,ve,I=console.log.bind(console),ae=console.error.bind(console),ge=!1;function we(e,r){e||pe(r)}var Ae,Pe,Ue,ne,_e,D,Y,ce,De,Be=!1;function Ee(){var e=Ue.buffer;ne=new Int8Array(e),new Int16Array(e),s.HEAPU8=_e=new Uint8Array(e),new Uint16Array(e),D=new Int32Array(e),s.HEAPU32=Y=new Uint32Array(e),new Float32Array(e),ce=new Float64Array(e),De=new BigInt64Array(e),new BigUint64Array(e)}var ze,h=0,m=null;function pe(e){s.onAbort?.(e),ae(e="Aborted("+e+")"),ge=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw Pe?.(r),r}function Ne(){return(Ne=H(function*(e){if(!re)try{var r=yield P(e);return new Uint8Array(r)}catch{}return function Te(e){if(e==ze&&re)return new Uint8Array(re);if(N)return N(e);throw"both async and sync fetching of the wasm failed"}(e)})).apply(this,arguments)}function E(){return E=H(function*(e,r){try{var o=yield function Ye(e){return Ne.apply(this,arguments)}(e);return yield WebAssembly.instantiate(o,r)}catch(S){ae(`failed to asynchronously prepare wasm: ${S}`),pe(S)}}),E.apply(this,arguments)}function se(){return se=H(function*(e,r,o){if(!e&&"function"==typeof WebAssembly.instantiateStreaming)try{var d=fetch(r,{credentials:"same-origin"});return yield WebAssembly.instantiateStreaming(d,o)}catch(G){ae(`wasm streaming compile failed: ${G}`),ae("falling back to ArrayBuffer instantiation")}return function Je(e,r){return E.apply(this,arguments)}(r,o)}),se.apply(this,arguments)}function be(){return be=H(function*(){function e(G,w){return Ue=(Ge=G.exports).memory,Ee(),s.wasmTable=de=Ge.__indirect_function_table,function ii(e){s._main=St=e.main,s._webidl_free=e.webidl_free,s._webidl_malloc=e.webidl_malloc,s._emscripten_bind_VoidPtr___destroy___0=gt=e.emscripten_bind_VoidPtr___destroy___0,s._emscripten_bind_Uarm_Uarm_0=vt=e.emscripten_bind_Uarm_Uarm_0,s._emscripten_bind_Uarm_SetRamSize_1=Pt=e.emscripten_bind_Uarm_SetRamSize_1,s._emscripten_bind_Uarm_SetNand_2=Ut=e.emscripten_bind_Uarm_SetNand_2,s._emscripten_bind_Uarm_SetMemory_2=Dt=e.emscripten_bind_Uarm_SetMemory_2,s._emscripten_bind_Uarm_SetSavestate_2=xt=e.emscripten_bind_Uarm_SetSavestate_2,s._emscripten_bind_Uarm_SetSd_3=Gt=e.emscripten_bind_Uarm_SetSd_3,s._emscripten_bind_Uarm_SetDefaultMips_1=Ct=e.emscripten_bind_Uarm_SetDefaultMips_1,s._emscripten_bind_Uarm_Launch_2=It=e.emscripten_bind_Uarm_Launch_2,s._emscripten_bind_Uarm_Cycle_1=Mt=e.emscripten_bind_Uarm_Cycle_1,s._emscripten_bind_Uarm_GetFrame_0=wt=e.emscripten_bind_Uarm_GetFrame_0,s._emscripten_bind_Uarm_ResetFrame_0=Ft=e.emscripten_bind_Uarm_ResetFrame_0,s._emscripten_bind_Uarm_GetTimesliceSizeUsec_0=zt=e.emscripten_bind_Uarm_GetTimesliceSizeUsec_0,s._emscripten_bind_Uarm_PenDown_2=Tt=e.emscripten_bind_Uarm_PenDown_2,s._emscripten_bind_Uarm_PenUp_0=Nt=e.emscripten_bind_Uarm_PenUp_0,s._emscripten_bind_Uarm_CurrentIps_0=kt=e.emscripten_bind_Uarm_CurrentIps_0,s._emscripten_bind_Uarm_CurrentIpsMax_0=jt=e.emscripten_bind_Uarm_CurrentIpsMax_0,s._emscripten_bind_Uarm_SetMaxLoad_1=Rt=e.emscripten_bind_Uarm_SetMaxLoad_1,s._emscripten_bind_Uarm_SetCyclesPerSecondLimit_1=Ot=e.emscripten_bind_Uarm_SetCyclesPerSecondLimit_1,s._emscripten_bind_Uarm_GetTimestampUsec_0=At=e.emscripten_bind_Uarm_GetTimestampUsec_0,s._emscripten_bind_Uarm_KeyDown_1=Bt=e.emscripten_bind_Uarm_KeyDown_1,s._emscripten_bind_Uarm_KeyUp_1=Et=e.emscripten_bind_Uarm_KeyUp_1,s._emscripten_bind_Uarm_PendingSamples_0=Ht=e.emscripten_bind_Uarm_PendingSamples_0,s._emscripten_bind_Uarm_PopQueuedSamples_0=Lt=e.emscripten_bind_Uarm_PopQueuedSamples_0,s._emscripten_bind_Uarm_GetSampleQueueSize_0=Vt=e.emscripten_bind_Uarm_GetSampleQueueSize_0,s._emscripten_bind_Uarm_SetPcmOutputEnabled_1=Kt=e.emscripten_bind_Uarm_SetPcmOutputEnabled_1,s._emscripten_bind_Uarm_SetPcmSuspended_1=Wt=e.emscripten_bind_Uarm_SetPcmSuspended_1,s._emscripten_bind_Uarm_GetRomDataSize_0=$t=e.emscripten_bind_Uarm_GetRomDataSize_0,s._emscripten_bind_Uarm_GetRomData_0=Qt=e.emscripten_bind_Uarm_GetRomData_0,s._emscripten_bind_Uarm_GetNandDataSize_0=Yt=e.emscripten_bind_Uarm_GetNandDataSize_0,s._emscripten_bind_Uarm_GetNandData_0=Jt=e.emscripten_bind_Uarm_GetNandData_0,s._emscripten_bind_Uarm_GetNandDirtyPages_0=Xt=e.emscripten_bind_Uarm_GetNandDirtyPages_0,s._emscripten_bind_Uarm_IsNandDirty_0=Zt=e.emscripten_bind_Uarm_IsNandDirty_0,s._emscripten_bind_Uarm_SetNandDirty_1=qt=e.emscripten_bind_Uarm_SetNandDirty_1,s._emscripten_bind_Uarm_GetSdCardDataSize_0=er=e.emscripten_bind_Uarm_GetSdCardDataSize_0,s._emscripten_bind_Uarm_GetSdCardData_0=tr=e.emscripten_bind_Uarm_GetSdCardData_0,s._emscripten_bind_Uarm_GetSdCardDirtyPages_0=rr=e.emscripten_bind_Uarm_GetSdCardDirtyPages_0,s._emscripten_bind_Uarm_IsSdCardDirty_0=nr=e.emscripten_bind_Uarm_IsSdCardDirty_0,s._emscripten_bind_Uarm_SetSdCardDirty_1=ir=e.emscripten_bind_Uarm_SetSdCardDirty_1,s._emscripten_bind_Uarm_GetMemoryDataSize_0=ar=e.emscripten_bind_Uarm_GetMemoryDataSize_0,s._emscripten_bind_Uarm_GetMemoryData_0=sr=e.emscripten_bind_Uarm_GetMemoryData_0,s._emscripten_bind_Uarm_GetMemoryDirtyPages_0=or=e.emscripten_bind_Uarm_GetMemoryDirtyPages_0,s._emscripten_bind_Uarm_GetDeviceType_0=_r=e.emscripten_bind_Uarm_GetDeviceType_0,s._emscripten_bind_Uarm_SdCardInsert_3=cr=e.emscripten_bind_Uarm_SdCardInsert_3,s._emscripten_bind_Uarm_SdCardEject_0=pr=e.emscripten_bind_Uarm_SdCardEject_0,s._emscripten_bind_Uarm_SdCardInitialized_0=ur=e.emscripten_bind_Uarm_SdCardInitialized_0,s._emscripten_bind_Uarm_GetSdCardId_0=dr=e.emscripten_bind_Uarm_GetSdCardId_0,s._emscripten_bind_Uarm_Reset_0=fr=e.emscripten_bind_Uarm_Reset_0,s._emscripten_bind_Uarm_Save_0=lr=e.emscripten_bind_Uarm_Save_0,s._emscripten_bind_Uarm_GetSavestateSize_0=mr=e.emscripten_bind_Uarm_GetSavestateSize_0,s._emscripten_bind_Uarm_GetSavestateData_0=hr=e.emscripten_bind_Uarm_GetSavestateData_0,s._emscripten_bind_Uarm_IsSdInserted_0=br=e.emscripten_bind_Uarm_IsSdInserted_0,s._emscripten_bind_Uarm_GetRamSize_0=yr=e.emscripten_bind_Uarm_GetRamSize_0,s._emscripten_bind_Uarm_JamKey_2=Sr=e.emscripten_bind_Uarm_JamKey_2,s._emscripten_bind_Uarm_IsUiInitialized_0=gr=e.emscripten_bind_Uarm_IsUiInitialized_0,s._emscripten_bind_Uarm_IsOsVersionSet_0=vr=e.emscripten_bind_Uarm_IsOsVersionSet_0,s._emscripten_bind_Uarm_GetOsVersion_0=Pr=e.emscripten_bind_Uarm_GetOsVersion_0,s._emscripten_bind_Uarm_IsLcdEnabled_0=Ur=e.emscripten_bind_Uarm_IsLcdEnabled_0,s._emscripten_bind_Uarm_InstallDatabase_2=Dr=e.emscripten_bind_Uarm_InstallDatabase_2,s._emscripten_bind_Uarm_NewDbBackup_1=xr=e.emscripten_bind_Uarm_NewDbBackup_1,s._emscripten_bind_Uarm___destroy___0=Gr=e.emscripten_bind_Uarm___destroy___0,s._emscripten_bind_DbBackup_Init_0=Cr=e.emscripten_bind_DbBackup_Init_0,s._emscripten_bind_DbBackup_GetState_0=Ir=e.emscripten_bind_DbBackup_GetState_0,s._emscripten_bind_DbBackup_Continue_0=Mr=e.emscripten_bind_DbBackup_Continue_0,s._emscripten_bind_DbBackup_HasLastProcessedDb_0=wr=e.emscripten_bind_DbBackup_HasLastProcessedDb_0,s._emscripten_bind_DbBackup_GetLastProcessedDb_0=Fr=e.emscripten_bind_DbBackup_GetLastProcessedDb_0,s._emscripten_bind_DbBackup_GetArchiveData_0=zr=e.emscripten_bind_DbBackup_GetArchiveData_0,s._emscripten_bind_DbBackup_GetArchiveSize_0=Tr=e.emscripten_bind_DbBackup_GetArchiveSize_0,s._emscripten_bind_DbBackup___destroy___0=Nr=e.emscripten_bind_DbBackup___destroy___0,s._emscripten_bind_Bridge_Bridge_0=kr=e.emscripten_bind_Bridge_Bridge_0,s._emscripten_bind_Bridge_Malloc_1=jr=e.emscripten_bind_Bridge_Malloc_1,s._emscripten_bind_Bridge_Free_1=Rr=e.emscripten_bind_Bridge_Free_1,s._emscripten_bind_Bridge___destroy___0=Or=e.emscripten_bind_Bridge___destroy___0,s._emscripten_bind_SessionFile5_SessionFile5_0=Ar=e.emscripten_bind_SessionFile5_SessionFile5_0,s._emscripten_bind_SessionFile5_IsSessionFile_2=Br=e.emscripten_bind_SessionFile5_IsSessionFile_2,s._emscripten_bind_SessionFile5_GetDeviceId_0=Er=e.emscripten_bind_SessionFile5_GetDeviceId_0,s._emscripten_bind_SessionFile5_SetDeviceId_1=Hr=e.emscripten_bind_SessionFile5_SetDeviceId_1,s._emscripten_bind_SessionFile5_GetMetadata_0=Lr=e.emscripten_bind_SessionFile5_GetMetadata_0,s._emscripten_bind_SessionFile5_GetMetadataSize_0=Vr=e.emscripten_bind_SessionFile5_GetMetadataSize_0,s._emscripten_bind_SessionFile5_SetMetadata_2=Kr=e.emscripten_bind_SessionFile5_SetMetadata_2,s._emscripten_bind_SessionFile5_GetNor_0=Wr=e.emscripten_bind_SessionFile5_GetNor_0,s._emscripten_bind_SessionFile5_GetNorSize_0=$r=e.emscripten_bind_SessionFile5_GetNorSize_0,s._emscripten_bind_SessionFile5_SetNor_2=Qr=e.emscripten_bind_SessionFile5_SetNor_2,s._emscripten_bind_SessionFile5_GetNand_0=Yr=e.emscripten_bind_SessionFile5_GetNand_0,s._emscripten_bind_SessionFile5_GetNandSize_0=Jr=e.emscripten_bind_SessionFile5_GetNandSize_0,s._emscripten_bind_SessionFile5_SetNand_2=Xr=e.emscripten_bind_SessionFile5_SetNand_2,s._emscripten_bind_SessionFile5_GetMemory_0=Zr=e.emscripten_bind_SessionFile5_GetMemory_0,s._emscripten_bind_SessionFile5_GetMemorySize_0=qr=e.emscripten_bind_SessionFile5_GetMemorySize_0,s._emscripten_bind_SessionFile5_SetMemory_2=en=e.emscripten_bind_SessionFile5_SetMemory_2,s._emscripten_bind_SessionFile5_GetSavestate_0=tn=e.emscripten_bind_SessionFile5_GetSavestate_0,s._emscripten_bind_SessionFile5_GetSavestateSize_0=rn=e.emscripten_bind_SessionFile5_GetSavestateSize_0,s._emscripten_bind_SessionFile5_SetSavestate_2=nn=e.emscripten_bind_SessionFile5_SetSavestate_2,s._emscripten_bind_SessionFile5_GetRamSize_0=an=e.emscripten_bind_SessionFile5_GetRamSize_0,s._emscripten_bind_SessionFile5_SetRamSize_1=sn=e.emscripten_bind_SessionFile5_SetRamSize_1,s._emscripten_bind_SessionFile5_Serialize_0=on=e.emscripten_bind_SessionFile5_Serialize_0,s._emscripten_bind_SessionFile5_GetSerializedSession_0=_n=e.emscripten_bind_SessionFile5_GetSerializedSession_0,s._emscripten_bind_SessionFile5_GetSerializedSessionSize_0=cn=e.emscripten_bind_SessionFile5_GetSerializedSessionSize_0,s._emscripten_bind_SessionFile5_GetVersion_0=pn=e.emscripten_bind_SessionFile5_GetVersion_0,s._emscripten_bind_SessionFile5_Deserialize_2=un=e.emscripten_bind_SessionFile5_Deserialize_2,s._emscripten_bind_SessionFile5___destroy___0=dn=e.emscripten_bind_SessionFile5___destroy___0,fn=e._emscripten_timeout}(Ge),function $e(){if(h--,s.monitorRunDependencies?.(h),0==h&&m){var r=m;m=null,r()}}(),Ge}!function ot(){h++,s.monitorRunDependencies?.(h)}();var o=function He(){return{env:hn,wasi_snapshot_preview1:hn}}();if(s.instantiateWasm)return new Promise((G,w)=>{s.instantiateWasm(o,(M,K)=>{G(e(M))})});ze??=function Qe(){return function q(e){return s.locateFile?s.locateFile(e,fe):fe+e}("uarm_web.wasm")}();var d=yield function V(e,r,o){return se.apply(this,arguments)}(re,ze,o);return function r(G){return e(G.instance)}(d)}),be.apply(this,arguments)}class i{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var de,t=e=>{for(;e.length>0;)e.shift()(s)},n=[],a=e=>n.push(e),_=[],c=e=>_.push(e),b=!0,A=typeof TextDecoder<"u"?new TextDecoder:void 0,ue=(e,r=0,o=NaN)=>{for(var d=r+o,S=r;e[S]&&!(S>=d);)++S;if(S-r>16&&e.buffer&&A)return A.decode(e.subarray(r,S));for(var G="";r<S;){var w=e[r++];if(128&w){var M=63&e[r++];if(192!=(224&w)){var K=63&e[r++];if((w=224==(240&w)?(15&w)<<12|M<<6|K:(7&w)<<18|M<<12|K<<6|63&e[r++])<65536)G+=String.fromCharCode(w);else{var Ie=w-65536;G+=String.fromCharCode(55296|Ie>>10,56320|1023&Ie)}}else G+=String.fromCharCode((31&w)<<6|M)}else G+=String.fromCharCode(w)}return G},F=(e,r)=>e?ue(_e,e,r):"",ee=e=>e<-9007199254740992||e>9007199254740992?NaN:Number(e),_t=0,Gn=[0,31,60,91,121,152,182,213,244,274,305,335],Cn=[0,31,59,90,120,151,181,212,243,273,304,334],ct=e=>((e=>e%4==0&&(e%100!=0||e%400==0))(e.getFullYear())?Gn:Cn)[e.getMonth()]+e.getDate()-1,ke={},Ze=e=>{if(e instanceof i||"unwind"==e)return ve;oe(0,e)},pt=()=>b||_t>0,ut=e=>{ve=e,pt()||(s.onExit?.(e),ge=!0),oe(0,new i(e))},dt=(e,r)=>{ve=e,ut(e)},wn=dt,ft=()=>performance.now(),lt=(e,r,o,d)=>{if(!(d>0))return 0;for(var S=o,G=o+d-1,w=0;w<e.length;++w){var M=e.codePointAt(w);if(M<=127){if(o>=G)break;r[o++]=M}else if(M<=2047){if(o+1>=G)break;r[o++]=192|M>>6,r[o++]=128|63&M}else if(M<=65535){if(o+2>=G)break;r[o++]=224|M>>12,r[o++]=128|M>>6&63,r[o++]=128|63&M}else{if(o+3>=G)break;r[o++]=240|M>>18,r[o++]=128|M>>12&63,r[o++]=128|M>>6&63,r[o++]=128|63&M,w++}}return r[o]=0,o-S},je=(e,r,o)=>lt(e,_e,r,o),mt=()=>Date.now(),qe=[],ht=(e,r)=>Math.ceil(e/r)*r,Hn=e=>{var o=(e-Ue.buffer.byteLength+65535)/65536|0;try{return Ue.grow(o),Ee(),1}catch{}},et={},Re=()=>{if(!Re.strings){var r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:Se||"./this.program"};for(var o in et)void 0===et[o]?delete r[o]:r[o]=et[o];var d=[];for(var o in r)d.push(`${o}=${r[o]}`);Re.strings=d}return Re.strings},bt=e=>{for(var r=0,o=0;o<e.length;++o){var d=e.charCodeAt(o);d<=127?r++:d<=2047?r+=2:d>=55296&&d<=57343?(r+=4,++o):r+=3}return r},tt=[null,[],[]],rt=(e,r)=>{var o=tt[e];0===r||10===r?((1===e?I:ae)(ue(o)),o.length=0):o.push(r)},yt=[];s.noExitRuntime&&(b=s.noExitRuntime),s.print&&(I=s.print),s.printErr&&(ae=s.printErr),s.wasmBinary&&(re=s.wasmBinary),s.thisProgram&&(Se=s.thisProgram),s.callMain=bn,s.wasmTable=de;var St,gt,vt,Pt,Ut,Dt,xt,Gt,Ct,It,Mt,wt,Ft,zt,Tt,Nt,kt,jt,Rt,Ot,At,Bt,Et,Ht,Lt,Vt,Kt,Wt,$t,Qt,Yt,Jt,Xt,Zt,qt,er,tr,rr,nr,ir,ar,sr,or,_r,cr,pr,ur,dr,fr,lr,mr,hr,br,yr,Sr,gr,vr,Pr,Ur,Dr,xr,Gr,Cr,Ir,Mr,wr,Fr,zr,Tr,Nr,kr,jr,Rr,Or,Ar,Br,Er,Hr,Lr,Vr,Kr,Wr,$r,Qr,Yr,Jr,Xr,Zr,qr,en,tn,rn,nn,an,sn,on,_n,cn,pn,un,dn,fn,Zn={72350:e=>{de.grow(65536);for(let r=0;r<=65535;r++)de.set(de.length-65535-1+r,de.get(Y[(e>>>2)+r]));return de.length-65535-1}},hn={__assert_fail:(e,r,o,d)=>pe(`Assertion failed: ${F(e)}, at: `+[r?F(r):"unknown filename",o,d?F(d):"unknown function"]),__emscripten_abort:function qn(){throw new Error("emulator terminated")},__syscall_ftruncate64:function Pn(e,r){r=ee(r)},_abort_js:()=>pe(""),_emscripten_runtime_keepalive_clear:()=>{b=!1,_t=0},_localtime_js:function In(e,r){e=ee(e);var o=new Date(1e3*e);D[r>>2]=o.getSeconds(),D[r+4>>2]=o.getMinutes(),D[r+8>>2]=o.getHours(),D[r+12>>2]=o.getDate(),D[r+16>>2]=o.getMonth(),D[r+20>>2]=o.getFullYear()-1900,D[r+24>>2]=o.getDay();var d=0|ct(o);D[r+28>>2]=d,D[r+36>>2]=-60*o.getTimezoneOffset();var S=new Date(o.getFullYear(),0,1),G=new Date(o.getFullYear(),6,1).getTimezoneOffset(),w=S.getTimezoneOffset(),M=0|(G!=w&&o.getTimezoneOffset()==Math.min(w,G));D[r+32>>2]=M},_mktime_js:function(e){var r=(()=>{var o=new Date(D[e+20>>2]+1900,D[e+16>>2],D[e+12>>2],D[e+8>>2],D[e+4>>2],D[e>>2],0),d=D[e+32>>2],S=o.getTimezoneOffset(),G=new Date(o.getFullYear(),0,1),w=new Date(o.getFullYear(),6,1).getTimezoneOffset(),M=G.getTimezoneOffset(),K=Math.min(M,w);if(d<0)D[e+32>>2]=+(w!=M&&K==S);else if(d>0!=(K==S)){var Ie=Math.max(M,w),Le=d>0?K:Ie;o.setTime(o.getTime()+6e4*(Le-S))}D[e+24>>2]=o.getDay();var Ve=0|ct(o);D[e+28>>2]=Ve,D[e>>2]=o.getSeconds(),D[e+4>>2]=o.getMinutes(),D[e+8>>2]=o.getHours(),D[e+12>>2]=o.getDate(),D[e+16>>2]=o.getMonth(),D[e+20>>2]=o.getYear();var Oe=o.getTime();return isNaN(Oe)?-1:Oe/1e3})();return BigInt(r)},_setitimer_js:(e,r)=>{if(ke[e]&&(clearTimeout(ke[e].id),delete ke[e]),!r)return 0;var o=setTimeout(()=>{delete ke[e],(e=>{if(!ge)try{e(),(()=>{if(!pt())try{wn(ve)}catch(e){Ze(e)}})()}catch(r){Ze(r)}})(()=>fn(e,ft()))},r);return ke[e]={id:o,timeout_ms:r},0},_tzset_js:(e,r,o,d)=>{var S=(new Date).getFullYear(),G=new Date(S,0,1),w=new Date(S,6,1),M=G.getTimezoneOffset(),K=w.getTimezoneOffset(),Ie=Math.max(M,K);Y[e>>2]=60*Ie,D[r>>2]=+(M!=K);var Le=Sn=>{var ui=Sn>=0?"-":"+",gn=Math.abs(Sn);return`UTC${ui}${String(Math.floor(gn/60)).padStart(2,"0")}${String(gn%60).padStart(2,"0")}`},Ve=Le(M),Oe=Le(K);K<M?(je(Ve,o,17),je(Oe,d,17)):(je(Ve,d,17),je(Oe,o,17))},clock_time_get:function Rn(e,r,o){if(r=ee(r),!(e=>e>=0&&e<=3)(e))return 28;var d;d=0===e?mt():ft();var S=Math.round(1e3*d*1e3);return De[o>>3]=BigInt(S),0},emscripten_asm_const_int:(e,r,o)=>((e,r,o)=>{var d=((e,r)=>{qe.length=0;for(var o;o=_e[e++];){var d=105!=o;r+=(d&=112!=o)&&r%8?4:0,qe.push(112==o?Y[r>>2]:106==o?De[r>>3]:105==o?D[r>>2]:ce[r>>3]),r+=d?8:4}return qe})(r,o);return Zn[e](...d)})(e,r,o),emscripten_date_now:mt,emscripten_resize_heap:e=>{var r=_e.length,o=2147483648;if((e>>>=0)>o)return!1;for(var d=1;d<=4;d*=2){var S=r*(1+.2/d);S=Math.min(S,e+100663296);var G=Math.min(o,ht(Math.max(e,S),65536));if(Hn(G))return!0}return!1},environ_get:(e,r)=>{var o=0,d=0;for(var S of Re()){var G=r+o;Y[e+d>>2]=G,o+=je(S,G,1/0)+1,d+=4}return 0},environ_sizes_get:(e,r)=>{var o=Re();Y[e>>2]=o.length;var d=0;for(var S of o)d+=bt(S)+1;return Y[r>>2]=d,0},fd_close:e=>52,fd_read:(e,r,o,d)=>52,fd_seek:function Yn(e,r,o,d){return r=ee(r),70},fd_write:(e,r,o,d)=>{for(var S=0,G=0;G<o;G++){var w=Y[r>>2],M=Y[r+4>>2];r+=8;for(var K=0;K<M;K++)rt(e,_e[w+K]);S+=M}return Y[d>>2]=S,0},proc_exit:ut},Ge=yield function Xe(){return be.apply(this,arguments)}();function bn(){var e=St;try{var d=e(0,0);return dt(d),d}catch(S){return Ze(S)}}function Q(){}function Ce(e){return(e||Q).__cache__}function x(e,r){var o=Ce(r),d=o[e];return d||((d=Object.create((r||Q).prototype)).ptr=e,o[e]=d)}(function ai(){if(s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.shift()()})(),function nt(){function e(){s.calledRun=!0,ge||(function We(){Be=!0,t(yt),Ge.__wasm_call_ctors()}(),Ae?.(s),s.onRuntimeInitialized?.(),s.noInitialRun||bn(),function Fe(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)a(s.postRun.shift());t(n)}())}h>0?m=nt:(function xe(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)c(s.preRun.shift());t(_)}(),h>0?m=nt:s.setStatus?(s.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>s.setStatus(""),1),e()},1)):e())}(),(Q.prototype=Object.create(Q.prototype)).constructor=Q,Q.prototype.__class__=Q,Q.__cache__={},s.WrapperObject=Q,s.getCache=Ce,s.wrapPointer=x,s.castObject=function si(e,r){return x(e.ptr,r)},s.NULL=x(0),s.destroy=function oi(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete Ce(e.__class__)[e.ptr]},s.compare=function _i(e,r){return e.ptr===r.ptr},s.getPointer=function ci(e){return e.ptr},s.getClass=function pi(e){return e.__class__};var v={buffer:0,size:0,pos:0,temps:[],needed:0,prepare(){if(v.needed){for(var e=0;e<v.temps.length;e++)s._webidl_free(v.temps[e]);v.temps.length=0,s._webidl_free(v.buffer),v.buffer=0,v.size+=v.needed,v.needed=0}v.buffer||(v.size+=128,v.buffer=s._webidl_malloc(v.size),we(v.buffer)),v.pos=0},alloc(e,r){we(v.buffer);var S,d=e.length*r.BYTES_PER_ELEMENT;return d=ht(d,8),v.pos+d>=v.size?(we(d>0),v.needed+=d,S=s._webidl_malloc(d),v.temps.push(S)):(S=v.buffer+v.pos,v.pos+=d),S},copy(e,r,o){o/=r.BYTES_PER_ELEMENT;for(var d=0;d<e.length;d++)r[o+d]=e[d]}};function yn(e){if("string"==typeof e){var r=(e=>{var d=bt(e)+1,S=new Array(d);lt(e,S,0,S.length);return S})(e),o=v.alloc(r,ne);return v.copy(r,ne,o),o}return e}function R(){throw"cannot construct a VoidPtr, no constructor in IDL"}function p(){this.ptr=vt(),Ce(p)[this.ptr]=this}function B(){throw"cannot construct a DbBackup, no constructor in IDL"}function J(){this.ptr=kr(),Ce(J)[this.ptr]=this}function l(){this.ptr=Ar(),Ce(l)[this.ptr]=this}return(R.prototype=Object.create(Q.prototype)).constructor=R,R.prototype.__class__=R,R.__cache__={},s.VoidPtr=R,R.prototype.__destroy__=R.prototype.__destroy__=function(){gt(this.ptr)},(p.prototype=Object.create(Q.prototype)).constructor=p,p.prototype.__class__=p,p.__cache__={},s.Uarm=p,p.prototype.SetRamSize=p.prototype.SetRamSize=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(Pt(this.ptr,e),p)},p.prototype.SetNand=p.prototype.SetNand=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(Ut(this.ptr,e,r),p)},p.prototype.SetMemory=p.prototype.SetMemory=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(Dt(this.ptr,e,r),p)},p.prototype.SetSavestate=p.prototype.SetSavestate=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(xt(this.ptr,e,r),p)},p.prototype.SetSd=p.prototype.SetSd=function(e,r,o){var d=this.ptr;return v.prepare(),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),o=o&&"object"==typeof o?o.ptr:yn(o),x(Gt(d,e,r,o),p)},p.prototype.SetDefaultMips=p.prototype.SetDefaultMips=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(Ct(this.ptr,e),p)},p.prototype.Launch=p.prototype.Launch=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),!!It(this.ptr,e,r)},p.prototype.Cycle=p.prototype.Cycle=function(e){return e&&"object"==typeof e&&(e=e.ptr),Mt(this.ptr,e)},p.prototype.GetFrame=p.prototype.GetFrame=function(){return x(wt(this.ptr),R)},p.prototype.ResetFrame=p.prototype.ResetFrame=function(){Ft(this.ptr)},p.prototype.GetTimesliceSizeUsec=p.prototype.GetTimesliceSizeUsec=function(){return zt(this.ptr)},p.prototype.PenDown=p.prototype.PenDown=function(e,r){e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),Tt(this.ptr,e,r)},p.prototype.PenUp=p.prototype.PenUp=function(){Nt(this.ptr)},p.prototype.CurrentIps=p.prototype.CurrentIps=function(){return kt(this.ptr)},p.prototype.CurrentIpsMax=p.prototype.CurrentIpsMax=function(){return jt(this.ptr)},p.prototype.SetMaxLoad=p.prototype.SetMaxLoad=function(e){e&&"object"==typeof e&&(e=e.ptr),Rt(this.ptr,e)},p.prototype.SetCyclesPerSecondLimit=p.prototype.SetCyclesPerSecondLimit=function(e){e&&"object"==typeof e&&(e=e.ptr),Ot(this.ptr,e)},p.prototype.GetTimestampUsec=p.prototype.GetTimestampUsec=function(){return At(this.ptr)},p.prototype.KeyDown=p.prototype.KeyDown=function(e){e&&"object"==typeof e&&(e=e.ptr),Bt(this.ptr,e)},p.prototype.KeyUp=p.prototype.KeyUp=function(e){e&&"object"==typeof e&&(e=e.ptr),Et(this.ptr,e)},p.prototype.PendingSamples=p.prototype.PendingSamples=function(){return Ht(this.ptr)},p.prototype.PopQueuedSamples=p.prototype.PopQueuedSamples=function(){return x(Lt(this.ptr),R)},p.prototype.GetSampleQueueSize=p.prototype.GetSampleQueueSize=function(){return Vt(this.ptr)},p.prototype.SetPcmOutputEnabled=p.prototype.SetPcmOutputEnabled=function(e){e&&"object"==typeof e&&(e=e.ptr),Kt(this.ptr,e)},p.prototype.SetPcmSuspended=p.prototype.SetPcmSuspended=function(e){e&&"object"==typeof e&&(e=e.ptr),Wt(this.ptr,e)},p.prototype.GetRomDataSize=p.prototype.GetRomDataSize=function(){return $t(this.ptr)},p.prototype.GetRomData=p.prototype.GetRomData=function(){return x(Qt(this.ptr),R)},p.prototype.GetNandDataSize=p.prototype.GetNandDataSize=function(){return Yt(this.ptr)},p.prototype.GetNandData=p.prototype.GetNandData=function(){return x(Jt(this.ptr),R)},p.prototype.GetNandDirtyPages=p.prototype.GetNandDirtyPages=function(){return x(Xt(this.ptr),R)},p.prototype.IsNandDirty=p.prototype.IsNandDirty=function(){return!!Zt(this.ptr)},p.prototype.SetNandDirty=p.prototype.SetNandDirty=function(e){e&&"object"==typeof e&&(e=e.ptr),qt(this.ptr,e)},p.prototype.GetSdCardDataSize=p.prototype.GetSdCardDataSize=function(){return er(this.ptr)},p.prototype.GetSdCardData=p.prototype.GetSdCardData=function(){return x(tr(this.ptr),R)},p.prototype.GetSdCardDirtyPages=p.prototype.GetSdCardDirtyPages=function(){return x(rr(this.ptr),R)},p.prototype.IsSdCardDirty=p.prototype.IsSdCardDirty=function(){return!!nr(this.ptr)},p.prototype.SetSdCardDirty=p.prototype.SetSdCardDirty=function(e){e&&"object"==typeof e&&(e=e.ptr),ir(this.ptr,e)},p.prototype.GetMemoryDataSize=p.prototype.GetMemoryDataSize=function(){return ar(this.ptr)},p.prototype.GetMemoryData=p.prototype.GetMemoryData=function(){return x(sr(this.ptr),R)},p.prototype.GetMemoryDirtyPages=p.prototype.GetMemoryDirtyPages=function(){return x(or(this.ptr),R)},p.prototype.GetDeviceType=p.prototype.GetDeviceType=function(){return _r(this.ptr)},p.prototype.SdCardInsert=p.prototype.SdCardInsert=function(e,r,o){var d=this.ptr;return v.prepare(),e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),o=o&&"object"==typeof o?o.ptr:yn(o),!!cr(d,e,r,o)},p.prototype.SdCardEject=p.prototype.SdCardEject=function(){pr(this.ptr)},p.prototype.SdCardInitialized=p.prototype.SdCardInitialized=function(){return!!ur(this.ptr)},p.prototype.GetSdCardId=p.prototype.GetSdCardId=function(){return F(dr(this.ptr))},p.prototype.Reset=p.prototype.Reset=function(){fr(this.ptr)},p.prototype.Save=p.prototype.Save=function(){lr(this.ptr)},p.prototype.GetSavestateSize=p.prototype.GetSavestateSize=function(){return mr(this.ptr)},p.prototype.GetSavestateData=p.prototype.GetSavestateData=function(){return x(hr(this.ptr),R)},p.prototype.IsSdInserted=p.prototype.IsSdInserted=function(){return!!br(this.ptr)},p.prototype.GetRamSize=p.prototype.GetRamSize=function(){return yr(this.ptr)},p.prototype.JamKey=p.prototype.JamKey=function(e,r){e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),Sr(this.ptr,e,r)},p.prototype.IsUiInitialized=p.prototype.IsUiInitialized=function(){return!!gr(this.ptr)},p.prototype.IsOsVersionSet=p.prototype.IsOsVersionSet=function(){return!!vr(this.ptr)},p.prototype.GetOsVersion=p.prototype.GetOsVersion=function(){return Pr(this.ptr)},p.prototype.IsLcdEnabled=p.prototype.IsLcdEnabled=function(){return!!Ur(this.ptr)},p.prototype.InstallDatabase=p.prototype.InstallDatabase=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),Dr(this.ptr,e,r)},p.prototype.NewDbBackup=p.prototype.NewDbBackup=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(xr(this.ptr,e),B)},p.prototype.__destroy__=p.prototype.__destroy__=function(){Gr(this.ptr)},(B.prototype=Object.create(Q.prototype)).constructor=B,B.prototype.__class__=B,B.__cache__={},s.DbBackup=B,B.prototype.Init=B.prototype.Init=function(){return!!Cr(this.ptr)},B.prototype.GetState=B.prototype.GetState=function(){return Ir(this.ptr)},B.prototype.Continue=B.prototype.Continue=function(){return!!Mr(this.ptr)},B.prototype.HasLastProcessedDb=B.prototype.HasLastProcessedDb=function(){return!!wr(this.ptr)},B.prototype.GetLastProcessedDb=B.prototype.GetLastProcessedDb=function(){return F(Fr(this.ptr))},B.prototype.GetArchiveData=B.prototype.GetArchiveData=function(){return x(zr(this.ptr),R)},B.prototype.GetArchiveSize=B.prototype.GetArchiveSize=function(){return Tr(this.ptr)},B.prototype.__destroy__=B.prototype.__destroy__=function(){Nr(this.ptr)},(J.prototype=Object.create(Q.prototype)).constructor=J,J.prototype.__class__=J,J.__cache__={},s.Bridge=J,J.prototype.Malloc=J.prototype.Malloc=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(jr(this.ptr,e),R)},J.prototype.Free=J.prototype.Free=function(e){e&&"object"==typeof e&&(e=e.ptr),Rr(this.ptr,e)},J.prototype.__destroy__=J.prototype.__destroy__=function(){Or(this.ptr)},(l.prototype=Object.create(Q.prototype)).constructor=l,l.prototype.__class__=l,l.__cache__={},s.SessionFile5=l,l.prototype.IsSessionFile=l.prototype.IsSessionFile=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Br(this.ptr,e,r)},l.prototype.GetDeviceId=l.prototype.GetDeviceId=function(){return Er(this.ptr)},l.prototype.SetDeviceId=l.prototype.SetDeviceId=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(Hr(this.ptr,e),l)},l.prototype.GetMetadata=l.prototype.GetMetadata=function(){return x(Lr(this.ptr),R)},l.prototype.GetMetadataSize=l.prototype.GetMetadataSize=function(){return Vr(this.ptr)},l.prototype.SetMetadata=l.prototype.SetMetadata=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(Kr(this.ptr,e,r),l)},l.prototype.GetNor=l.prototype.GetNor=function(){return x(Wr(this.ptr),R)},l.prototype.GetNorSize=l.prototype.GetNorSize=function(){return $r(this.ptr)},l.prototype.SetNor=l.prototype.SetNor=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(Qr(this.ptr,e,r),l)},l.prototype.GetNand=l.prototype.GetNand=function(){return x(Yr(this.ptr),R)},l.prototype.GetNandSize=l.prototype.GetNandSize=function(){return Jr(this.ptr)},l.prototype.SetNand=l.prototype.SetNand=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(Xr(this.ptr,e,r),l)},l.prototype.GetMemory=l.prototype.GetMemory=function(){return x(Zr(this.ptr),R)},l.prototype.GetMemorySize=l.prototype.GetMemorySize=function(){return qr(this.ptr)},l.prototype.SetMemory=l.prototype.SetMemory=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(en(this.ptr,e,r),l)},l.prototype.GetSavestate=l.prototype.GetSavestate=function(){return x(tn(this.ptr),R)},l.prototype.GetSavestateSize=l.prototype.GetSavestateSize=function(){return rn(this.ptr)},l.prototype.SetSavestate=l.prototype.SetSavestate=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),x(nn(this.ptr,e,r),l)},l.prototype.GetRamSize=l.prototype.GetRamSize=function(){return an(this.ptr)},l.prototype.SetRamSize=l.prototype.SetRamSize=function(e){return e&&"object"==typeof e&&(e=e.ptr),x(sn(this.ptr,e),l)},l.prototype.Serialize=l.prototype.Serialize=function(){return!!on(this.ptr)},l.prototype.GetSerializedSession=l.prototype.GetSerializedSession=function(){return x(_n(this.ptr),R)},l.prototype.GetSerializedSessionSize=l.prototype.GetSerializedSessionSize=function(){return cn(this.ptr)},l.prototype.GetVersion=l.prototype.GetVersion=function(){return pn(this.ptr)},l.prototype.Deserialize=l.prototype.Deserialize=function(e,r){return e&&"object"==typeof e&&(e=e.ptr),r&&"object"==typeof r&&(r=r.ptr),!!un(this.ptr,e,r)},l.prototype.__destroy__=l.prototype.__destroy__=function(){dn(this.ptr)},Be?s:new Promise((e,r)=>{Ae=e,Pe=r})}));g.exports=L,g.exports.default=L},6784:(g,z,T)=>{"use strict";var L=T(3948);z.J=L.default}},it={};function te(g){var z=it[g];if(void 0!==z)return z.exports;var T=it[g]={exports:{}};return vn[g].call(T.exports,T,T.exports,te),T.exports}te.n=g=>{var z=g&&g.__esModule?()=>g.default:()=>g;return te.d(z,{a:z}),z},te.d=(g,z)=>{for(var T in z)te.o(z,T)&&!te.o(g,T)&&Object.defineProperty(g,T,{enumerable:!0,get:z[T]})},te.o=(g,z)=>Object.prototype.hasOwnProperty.call(g,z),(()=>{"use strict";function g(i,t,n,a,_,c,f){try{var b=i[c](f),U=b.value}catch(y){return void n(y)}b.done?t(U):Promise.resolve(U).then(a,_)}function z(i){return function(){var t=this,n=arguments;return new Promise(function(a,_){var c=i.apply(t,n);function f(U){g(c,a,_,f,b,"next",U)}function b(U){g(c,a,_,f,b,"throw",U)}f(void 0)})}}function u(i,t,n,a){var f,_=arguments.length,c=_<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(i,t,n,a);else for(var b=i.length-1;b>=0;b--)(f=i[b])&&(c=(_<3?f(c):_>3?f(t,n,c):f(t,n))||c);return _>3&&c&&Object.defineProperty(t,n,c),c}"function"==typeof SuppressedError&&SuppressedError;var he=function(i){return i.palmPilot="PalmPilot",i.pilot="Pilot",i.iii="PalmIII",i.palmVx="PalmVx",i.palmV="PalmV",i.palmVII="PalmVII",i.palmVIIEZ="PalmVIIEZ",i.palmVIIx="PalmVIIx",i.iiic="PalmIIIc",i.iiix="PalmIIIx",i.iiixe="PalmIIIxe",i.iiie="PalmIIIe",i.m500="PalmM500",i.m505="PalmM505",i.m515="PalmM515",i.m520="PalmM520",i.m100="PalmM100",i.m105="PalmM105",i.m125="PalmM125",i.m130="PalmM130",i.i705="Palmi705",i.i710="PalmI710",i.handera330="HandEra330",i.handera330c="HandEra330c",i.pegS300="PEG-S300",i.pegS320="PEG-S320",i.pegS500c="PEG-S500C",i.pegT400="PEG-T400",i.pegN600c="PEG-N600C/N610C",i.pegT600c="PEG-T600",i.pegN700c="PEG-N700C/N710C",i.pegT650c="YSX1230",i.pegNR70="NR70",i.acerS11="Acer-S11",i.lp168="Legend-P168",i.te2="Tungsten-E2",i.frankene2="Franken-E2",i}(he||{}),Be=te(6702),Ee=te.n(Be),xe=te(6784);let We=0;function Fe(i){switch(i){case 0:return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 5;case 5:return 6;case 6:return 10;case 14:return 7;case 15:return 8;case 16:return 9;default:return 0}}function h(){return(i,t,n)=>{const a=n.value;return n.value=function(_,c){return this.guard(()=>a.call(this,_,c))},n}}class m{constructor(t){this.module=t,this.fatalErrorEvent=new xe.J,this.amIdead=!1,this.uarm=new t.Uarm,this.bridge=new t.Bridge}static create(t){return z(function*(){const n=We++;return new m(yield Ee()({print:a=>console.log(`${n}: ${a}`),printErr:a=>console.warn(`${n}: ${a}`),instantiateWasm:(a,_)=>{WebAssembly.instantiate(t,a).then(c=>_(c))}}))})()}setRamSize(t){this.uarm.SetRamSize(t)}setMemory(t){this.uarm.SetMemory(t.length,this.copyIn(t))}setNand(t){this.uarm.SetNand(t.length,this.copyIn(t))}setSd(t,n){this.uarm.SetSd(t.length,this.copyIn(t),n)}setSavestate(t){this.uarm.SetSavestate(t.length,this.copyIn(t))}launch(t){return this.uarm.Launch(t.length,this.copyIn(t))}buttonUp(t){const n=Fe(t);n>=0&&this.uarm.KeyUp(n)}buttonDown(t){const n=Fe(t);n>=0&&this.uarm.KeyDown(n)}penDown(t,n){this.uarm.PenDown(t,n)}penUp(){this.uarm.PenUp()}getTimestampUsec(){return this.uarm.GetTimestampUsec()}cycle(t){return this.uarm.Cycle(t)}getTimesliceSizeUsec(){return this.uarm.GetTimesliceSizeUsec()}getDevice(){const t=this.uarm.GetDeviceType();switch(t){case 0:return he.te2;case 1:return he.frankene2;default:throw new Error(`invalid device ID ${t}`)}}getFrame(t){const n=this.module.getPointer(this.uarm.GetFrame())>>>2;return 0===n?void 0:this.module.HEAPU32.subarray(n,n+320*t)}resetFrame(){this.uarm.ResetFrame()}setTargetMips(t){this.uarm.SetCyclesPerSecondLimit(1e6*t)}setMaxHostLoad(t){this.uarm.SetMaxLoad(100*t)}getMemorySize(){return this.uarm.GetMemoryDataSize()}getMemoryData(){const t=this.module.getPointer(this.uarm.GetMemoryData());return this.module.HEAPU8.subarray(t,t+this.uarm.GetMemoryDataSize())}getMemoryDirtyPages(){const t=this.module.getPointer(this.uarm.GetMemoryDirtyPages()),n=this.uarm.GetMemoryDataSize()>>>10,a=t>>>2;let _=n>>>5;return 32*_<n&&_++,this.module.HEAPU32.subarray(a,a+_)}getSdCardSize(){return this.uarm.GetSdCardDataSize()}getSdCardData(){const t=this.module.getPointer(this.uarm.GetSdCardData());if(0!==t)return this.module.HEAPU8.subarray(t,t+this.uarm.GetSdCardDataSize())}getSdCardDirtyPages(){const t=this.module.getPointer(this.uarm.GetSdCardDirtyPages());if(0===t)return;const n=this.uarm.GetSdCardDataSize()>>>13,a=t>>>2;let _=n>>>5;return 32*_<n&&_++,this.module.HEAPU32.subarray(a,a+_)}isSdCardDirty(){return this.uarm.IsSdCardDirty()}setSdCardDirty(t){this.uarm.SetSdCardDirty(t)}getNandSize(){return this.uarm.GetNandDataSize()}getNandData(){const t=this.module.getPointer(this.uarm.GetNandData());return this.module.HEAPU8.subarray(t,t+this.uarm.GetNandDataSize())}getNandDirtyPages(){const t=this.module.getPointer(this.uarm.GetNandDirtyPages()),n=this.uarm.GetNandDataSize()/4224|0,a=t>>>2;let _=n>>>5;return 32*_<n&&_++,this.module.HEAPU32.subarray(a,a+_)}isNandDirty(){return this.uarm.IsNandDirty()}setNandDirty(t){this.uarm.SetNandDirty(t)}saveState(){this.uarm.Save();const t=this.module.getPointer(this.uarm.GetSavestateData());return this.module.HEAPU8.subarray(t,t+this.uarm.GetSavestateSize())}getCurrentIps(){return this.uarm.CurrentIps()}getCurrentIpsMax(){return Number(this.uarm.CurrentIpsMax())}getSdCardKey(){return this.uarm.SdCardInitialized()?this.uarm.GetSdCardId():void 0}sdCardInsert(t,n){const a=this.copyIn(new Uint8Array(t.buffer,t.byteOffset,t.byteLength));return!!this.uarm.SdCardInsert(a,4*t.length,n)||(this.bridge.Free(a),!1)}sdCardEject(){this.uarm.SdCardEject()}sdCardInserted(){return this.uarm.IsSdInserted()}clearSampleQueue(){this.uarm.PopQueuedSamples()}getQueuedSamples(){const t=this.uarm.PendingSamples();if(0===t)return;const n=this.module.getPointer(this.uarm.PopQueuedSamples())>>>2;return this.module.HEAPU32.subarray(n,n+t)}getSampleQueueSize(){return this.uarm.GetSampleQueueSize()}disablePcm(t){this.uarm.SetPcmOutputEnabled(!t)}suspendPcm(t){this.uarm.SetPcmSuspended(t)}reset(){this.uarm.Reset()}jamButton(t,n){this.uarm.JamKey(Fe(t),n)}installDb(t){const n=this.copyIn(t),a=this.uarm.InstallDatabase(t.length,n);return this.bridge.Free(n),function st(i){switch(i){case 0:return 1;case 1:return 2;case-2:return-4;case-4:return-3;case-5:return-6;case-7:case-6:return-7;case-3:return-2;case-8:return-1}}(a)}createDbBackup(t){const n=this.uarm.NewDbBackup(t?1:0);if(n.Init())return{getState:()=>this.guard(()=>n.GetState()),continue:()=>this.guard(()=>n.Continue()),getLastProcessedDb:()=>this.guard(()=>n.HasLastProcessedDb()?n.GetLastProcessedDb():void 0),getArchive:()=>this.guard(()=>{const a=this.module.getPointer(n.GetArchiveData());if(0!==a)return this.module.HEAPU8.subarray(a,a+n.GetArchiveSize())}),destroy:()=>this.guard(()=>this.module.destroy(n))};this.module.destroy(n)}getRomData(){const t=this.module.getPointer(this.uarm.GetRomData());return new Uint8Array(this.module.HEAPU8.subarray(t,t+this.uarm.GetRomDataSize()))}isUiInitialized(){return this.uarm.IsUiInitialized()}getOsVersion(){return this.uarm.IsOsVersionSet()?this.uarm.GetOsVersion():void 0}isLcdEnabled(){return this.uarm.IsLcdEnabled()}dead(){return this.amIdead}guard(t){if(this.amIdead)throw new Error("uarm instance is dead");try{return t()}catch(n){throw this.amIdead=!0,this.uarm=void 0,this.fatalErrorEvent.dispatch(n instanceof Error?n:new Error("unknown error")),n}}copyIn(t){const n=this.bridge.Malloc(t.length),a=this.module.getPointer(n);return this.module.HEAPU8.subarray(a,a+t.length).set(t),n}}u([h()],m.prototype,"setRamSize",null),u([h()],m.prototype,"setMemory",null),u([h()],m.prototype,"setNand",null),u([h()],m.prototype,"setSd",null),u([h()],m.prototype,"setSavestate",null),u([h()],m.prototype,"launch",null),u([h()],m.prototype,"buttonUp",null),u([h()],m.prototype,"buttonDown",null),u([h()],m.prototype,"penDown",null),u([h()],m.prototype,"penUp",null),u([h()],m.prototype,"getTimestampUsec",null),u([h()],m.prototype,"cycle",null),u([h()],m.prototype,"getTimesliceSizeUsec",null),u([h()],m.prototype,"getDevice",null),u([h()],m.prototype,"getFrame",null),u([h()],m.prototype,"resetFrame",null),u([h()],m.prototype,"setTargetMips",null),u([h()],m.prototype,"setMaxHostLoad",null),u([h()],m.prototype,"getMemorySize",null),u([h()],m.prototype,"getMemoryData",null),u([h()],m.prototype,"getMemoryDirtyPages",null),u([h()],m.prototype,"getSdCardSize",null),u([h()],m.prototype,"getSdCardData",null),u([h()],m.prototype,"getSdCardDirtyPages",null),u([h()],m.prototype,"isSdCardDirty",null),u([h()],m.prototype,"setSdCardDirty",null),u([h()],m.prototype,"getNandSize",null),u([h()],m.prototype,"getNandData",null),u([h()],m.prototype,"getNandDirtyPages",null),u([h()],m.prototype,"isNandDirty",null),u([h()],m.prototype,"setNandDirty",null),u([h()],m.prototype,"saveState",null),u([h()],m.prototype,"getCurrentIps",null),u([h()],m.prototype,"getCurrentIpsMax",null),u([h()],m.prototype,"getSdCardKey",null),u([h()],m.prototype,"sdCardInsert",null),u([h()],m.prototype,"sdCardEject",null),u([h()],m.prototype,"sdCardInserted",null),u([h()],m.prototype,"clearSampleQueue",null),u([h()],m.prototype,"getQueuedSamples",null),u([h()],m.prototype,"getSampleQueueSize",null),u([h()],m.prototype,"disablePcm",null),u([h()],m.prototype,"suspendPcm",null),u([h()],m.prototype,"reset",null),u([h()],m.prototype,"jamButton",null),u([h()],m.prototype,"installDb",null),u([h()],m.prototype,"createDbBackup",null),u([h()],m.prototype,"getRomData",null),u([h()],m.prototype,"isUiInitialized",null),u([h()],m.prototype,"getOsVersion",null),u([h()],m.prototype,"isLcdEnabled",null),te(5259);const $e=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function pe(i){let t=-1;for(let n=0;n<i.length;n++)t=$e[255&(t^i[n])]^t>>>8;return~t}class Te{constructor(t,n,a,_,c){this.pageSize=t,this.pageCount=n,this.name=a,this.crcCheck=_,this.adapter=c,this.scheduledPageCount=0,this.dirtyPagesSize4=n>>>5,32*this.dirtyPagesSize4<n&&this.dirtyPagesSize4++,this.scheduledPages=new Uint32Array(n),this.pagePool=new Uint8Array(256*t)}takeSnapshot(){if(this.scheduledPageCount>0&&console.warn(`${this.name} pending, skipping snapshot...`),!this.adapter.isDirty())return;const t=this.adapter.getData(),n=this.adapter.getDirtyPages();if(!t||!n)return;let a=0,_=0;for(let c=0;c<n.length;c++){let f=n[c];if(0!==f){for(let b=0;b<4;b++){const U=255&f;if(f>>>=8,0!==U)for(let y=1;y<256;y<<=1){if(!(U&y)){_++;continue}this.scheduledPages[a]=_;const j=a*this.pageSize,A=_*this.pageSize;j>=this.pagePool.length&&this.growPagePool(),this.pagePool.subarray(j,j+this.pageSize).set(t.subarray(A,A+this.pageSize)),a++,_++}else _+=8}n[c]=0}else _+=32}return this.scheduledPageCount=a,this.scheduledPageCount>0?(this.adapter.setDirty(!1),{scheduledPageCount:this.scheduledPageCount,scheduledPages:this.scheduledPages.buffer,pagePool:this.pagePool.buffer,crc:this.crcCheck?pe(t):void 0}):void 0}getTransferables(){return this.scheduledPageCount>0?[this.scheduledPages.buffer,this.pagePool.buffer]:[]}returnSnapshot(t,n){if(!n)return;const a=this.scheduledPageCount;if(this.scheduledPages=new Uint32Array(n.scheduledPages),this.pagePool=new Uint8Array(n.pagePool),this.scheduledPageCount=0,t)return;const _=this.adapter.getDirtyPages();if(_)for(let c=0;c<a;c++){const f=this.scheduledPages[c];_[f>>>5]|=1<<(31&f)}this.adapter.setDirty(!0)}enableCrc(t){this.crcCheck=t}growPagePool(){const t=new Uint8Array(Math.min(Math.ceil(1.5*this.pagePool.length/this.pageSize)*this.pageSize,this.pageCount*this.pageSize));console.log(`growing ${this.name} page pool to ${t.length} bytes`),t.set(this.pagePool),this.pagePool=t}}class Ne{constructor(t,n,a){this.uarm=t,this.settings=n,this.pcmPort=a,this.timesliceTask=()=>{const _=this.uarm.getTimestampUsec(),c=Number(_),f=this.uarm.cycle(_),b=(this.uarm.getTimesliceSizeUsec()-Number(this.uarm.getTimestampUsec())+c)/1e3;this.timeoutHandle=this.immediateHandle=void 0,b<5?this.immediateHandle=setImmediate(this.timesliceTask):this.timeoutHandle=setTimeout(this.timesliceTask,b);const U=performance.now();if(this.settings.automaticSnapshotInterval>0&&U-this.lastSnapshotAt>this.settings.automaticSnapshotInterval&&!this.snapshotPending){const y=this.takeSnapshot();y&&this.snapshotEvent.dispatch(y),this.lastSnapshotAt=U}this.processSamples(f),this.updateSystemState(),this.timesliceEvent.dispatch({sizeSeconds:f,lcdEnabled:this.uarm.isLcdEnabled(),frame:this.backgrounded?void 0:this.getFrame(),currentIps:this.uarm.getCurrentIps(),currentIpsMax:this.uarm.getCurrentIpsMax()})},this.onPcmPortMessage=_=>{if(!this.pcmStreaming||this.settings.disableAudio)return;const c=_.data;switch(c.type){case"resumePcm":this.suspendPcm(!1);break;case"suspendPcm":this.uarm.suspendPcm(!0);break;case"returnBuffer":this.sampleBufferPool.push(c.buffer)}},this.timesliceEvent=new xe.J,this.snapshotEvent=new xe.J,this.systemStateChangeEvent=new xe.J,this.running=!1,this.backgrounded=!1,this.uarmInitialized=!1,this.framePool=[],this.deviceId=he.te2,this.snapshotPending=!1,this.lastSnapshotAt=0,this.pcmStreaming=!1,this.pcmSuspended=!1,this.pcmSuspendedForMsec=0,this.sampleBufferPool=[],this.returnSnapshotCallbacks=[],this.uiInitialized=!1,t.fatalErrorEvent.addHandler(()=>this.stop()),this.sampleQueueSize=t.getSampleQueueSize(),this.pcmPort.addEventListener("message",this.onPcmPortMessage),this.pcmPort.start()}openSession(t,n,a,_,c){const f=a?a.length>=33554432?33554432:16777216:void 0;if(void 0!==f&&this.uarm.setRamSize(f),n&&this.uarm.setNand(n),a&&this.uarm.setMemory(a),_&&this.uarm.setSavestate(_),c){const[b,U]=c;this.uarm.setSd(b,U)}return!!this.uarm.launch(t)&&(this.deviceId=this.uarm.getDevice(),this.pageTrackerMemory=new Te(1024,this.uarm.getMemorySize()>>>10,"memory",this.settings.memoryCrc,{getData:()=>this.uarm.getMemoryData(),getDirtyPages:()=>this.uarm.getMemoryDirtyPages(),isDirty:()=>!0,setDirty:()=>{}}),this.pageTrackerNand=new Te(4224,this.uarm.getNandSize()/4224|0,"nand",!1,{getData:()=>this.uarm.getNandData(),getDirtyPages:()=>this.uarm.getNandDirtyPages(),isDirty:()=>this.uarm.isNandDirty(),setDirty:b=>this.uarm.setNandDirty(b)}),this.updatePageTrackerSd(),this.uarmInitialized=!0,this.updateSettings(this.settings),!0)}updateSettings(t){this.settings=t,this.uarmInitialized&&(this.uarm.setMaxHostLoad(t.maxHostLoad),this.uarm.disablePcm(t.disableAudio),this.uarm.setTargetMips(t.targetMips),this.pageTrackerMemory?.enableCrc(t.memoryCrc))}buttonUp(t){this.uarm.buttonUp(t)}buttonDown(t){this.uarm.buttonDown(t)}penDown(t,n){this.uarm.penDown(t,n)}penUp(){this.uarm.penUp()}start(){this.running=!0,this.updateRunState()}stop(){this.running=!1,this.updateRunState()}setBackgrounded(t){this.backgrounded=t,this.updateRunState()}returnFrame(t){this.framePool.push(t)}returnSnapshot(t,n){if(this.snapshotPending)try{this.returnSnapshotUnguarded(t,n),this.returnSnapshotCallbacks.length>0&&(this.returnSnapshotCallbacks.forEach(a=>a()),this.returnSnapshotCallbacks=[])}finally{this.snapshotPending=!1}}takeSnapshot(){if(!this.snapshotPending)try{return this.takeSnapshotUnguarded()}finally{this.snapshotPending=!0}}refreshSnapshot(t){if(!this.snapshotPending)throw new Error("refresh snapshot called, but no pending snapshot!");return this.returnSnapshotUnguarded(t,!1),this.takeSnapshotUnguarded(t.timestamp,t.time)}waitForPendingSnapshot(){var t=this;return z(function*(){if(t.snapshotPending)return new Promise(n=>t.returnSnapshotCallbacks.push(n))})()}getMemorySize(){return this.uarm.getMemorySize()}getNandSize(){return this.uarm.getNandSize()}sdCardInsert(t,n){const a=this.uarm.sdCardInsert(t,n);return this.updatePageTrackerSd(),a}sdCardEject(){this.uarm.sdCardEject(),this.updatePageTrackerSd()}sdCardInserted(){return this.uarm.sdCardInserted()}getSdCardKey(){return this.uarm.getSdCardKey()}reset(t){switch(t){case 0:break;case 1:this.uarm.jamButton(4,2e3);break;case 2:this.uarm.jamButton(6,2e3)}this.uarm.reset()}installDb(t){return this.uarm.installDb(t)}backup(t){const n=this.uarm.createDbBackup(t);if(n)try{const a=[];for(;1===n.getState();)if(!n.continue()){const c=n.getLastProcessedDb();void 0!==c&&a.push(c)}const _=n.getArchive();return _?{archive:_.slice(),failedDatabases:a}:void 0}finally{n.destroy()}}getSdCardData(){const t=this.uarm.getSdCardData();return t?new Uint32Array(t.buffer,t.byteOffset,t.byteLength).slice():void 0}getFullState(){return{rom:this.uarm.getRomData().slice(),memory:this.uarm.getMemoryData().slice(),nand:this.uarm.getNandData().slice(),savestate:this.uarm.saveState().slice()}}enablePcmStreaming(){this.pcmStreaming||(this.pcmStreaming=!0,this.dispatchPcmPortMessage({type:"flush"}),this.suspendPcm(!1))}disablePcmStreaming(){this.pcmStreaming&&(this.pcmStreaming=!1,this.suspendPcm(!1))}takeSnapshotUnguarded(t,n=0){const a=Date.now(),_=this.uarm.saveState();if(this.savestate?this.savestate.set(_):this.savestate=_.slice(),!this.pageTrackerMemory||!this.pageTrackerNand)throw new Error("unreachable");const c=this.pageTrackerMemory.takeSnapshot(),f=this.pageTrackerNand.takeSnapshot(),b=this.pageTrackerSd?.takeSnapshot(),U=Date.now(),y=this.uarm.getSdCardKey();return[{memory:c,nand:f,sd:b&&void 0!==y?{snapshot:b,key:y,size:this.uarm.getSdCardSize()}:void 0,savestate:this.savestate.buffer,time:U-a+n,timestamp:t??U},[...this.pageTrackerMemory.getTransferables(),...this.pageTrackerNand.getTransferables(),...this.pageTrackerSd?.getTransferables()??[],this.savestate.buffer]]}returnSnapshotUnguarded(t,n){this.pageTrackerMemory?.returnSnapshot(n,t.memory),this.pageTrackerNand?.returnSnapshot(n,t.nand),this.pageTrackerSd&&t.sd&&this.pageTrackerSd.returnSnapshot(n,t.sd.snapshot),this.savestate=new Uint8Array(t.savestate)}updateRunState(){if(this.uarm.dead())return;const t=this.running&&(!this.backgrounded||this.settings.runInBackground);t&&void 0===this.timeoutHandle&&void 0===this.immediateHandle&&(this.immediateHandle=setImmediate(this.timesliceTask),this.dispatchPcmPortMessage({type:"flush"}),this.suspendPcm(!1)),t||(void 0!==this.timeoutHandle&&clearTimeout(this.timeoutHandle),void 0!==this.immediateHandle&&clearImmediate(this.immediateHandle),this.timeoutHandle=this.immediateHandle=void 0)}updatePageTrackerSd(){this.pageTrackerSd=void 0,0!==this.uarm.getSdCardSize()&&(this.pageTrackerSd=new Te(8192,this.uarm.getSdCardSize()>>>13,"sdcard",!1,{getData:()=>this.uarm.getSdCardData(),getDirtyPages:()=>this.uarm.getSdCardDirtyPages(),isDirty:()=>this.uarm.isSdCardDirty(),setDirty:t=>this.uarm.setSdCardDirty(t)}))}processSamples(t){if(!this.pcmStreaming||this.settings.disableAudio)return void this.uarm.clearSampleQueue();this.pcmSuspended&&(this.pcmSuspendedForMsec+=1e3*t,this.pcmSuspendedForMsec>500&&this.suspendPcm(!1));const n=this.uarm.getQueuedSamples();if(!n)return;const a=this.getSampleBuffer();a.set(n),this.dispatchPcmPortMessage({type:"sampleData",buffer:a.buffer,count:n.length},[a.buffer])}updateSystemState(){const t=this.uiInitialized;this.uiInitialized=this.uarm.isUiInitialized(),this.uiInitialized!==t&&(this.osVersion=this.uarm.getOsVersion(),this.systemStateChangeEvent.dispatch({osVersion:this.osVersion,uiInitialized:this.uiInitialized}))}getSampleBuffer(){return this.sampleBufferPool.length>0?new Uint32Array(this.sampleBufferPool.pop()):new Uint32Array(this.sampleQueueSize)}getFrame(){const t=this.uarm.getFrame(this.deviceId===he.frankene2?480:320);if(!t)return;let n;if(0===this.framePool.length)n=t.slice().buffer;else{const a=new Uint32Array(this.framePool.pop());a.set(t),n=a.buffer}return this.uarm.resetFrame(),n}suspendPcm(t){this.uarm.suspendPcm(t),this.pcmSuspended=t,t&&(this.pcmSuspendedForMsec=0)}dispatchPcmPortMessage(t,n){this.pcmPort.postMessage(t,n)}}let E;function V(){if(!E)throw new Error("worker not initialized");return E}function se(i,t){postMessage(i,t)}const He=new class Je{constructor(t){this.dispatchMessage=t,this.registeredMethods=new Map,this.registeredMethods=new Map}dispatch(t){var n=this;return z(function*(){const{id:a,method:_,args:c}=t,f=n.registeredMethods.get(_);if(f)try{let b;const U=yield f(c,y=>{b=[...b??[],...y]});n.dispatchMessage({type:"rpcSuccess",method:_,id:a,result:U},b)}catch(b){console.error(b),n.dispatchMessage({type:"rpcError",method:_,id:a,error:`${b}`})}else n.dispatchMessage({type:"rpcError",id:a,method:_,error:`method not registered: ${_}`})})()}register(t,n){return this.registeredMethods.set(t,n),this}}(se);function be(){return(be=z(function*(i){const t=i.data;switch(t.type){case"rpcCall":He.dispatch(t);break;case"updateSettings":E?.updateSettings(t.settings);break;case"buttonDown":E?.buttonDown(t.button);break;case"buttonUp":E?.buttonUp(t.button);break;case"penDown":E?.penDown(t.x,t.y);break;case"penUp":E?.penUp();break;case"returnFrame":E?.returnFrame(t.frame);break;case"returnSnapshot":E?.returnSnapshot(t.snapshot,t.success);break;case"setBackgrounded":E?.setBackgrounded(t.backgrounded);break;case"reset":E?.reset(t.resetType);break;case"setPcmStreaming":t.pcmStreaming?E?.enablePcmStreaming():E?.disablePcmStreaming()}})).apply(this,arguments)}He.register("initialize",function(){var i=z(function*({module:t,settings:n,pcmPort:a}){if(E)throw new Error("worker already initialized");const _=yield m.create(t);_.fatalErrorEvent.addHandler(c=>se({type:"fatalError",error:c.message})),E=new Ne(_,n,a),E.timesliceEvent.addHandler(c=>se({type:"timeslice",...c},c.frame?[c.frame]:void 0)),E.snapshotEvent.addHandler(c=>{const[f,b]=c;se({type:"snapshot",snapshot:f},b)}),E.systemStateChangeEvent.addHandler(c=>se({type:"systemStateChanged",...c}))});return function(t){return i.apply(this,arguments)}}()).register("openSession",({rom:i,memory:t,nand:n,state:a,card:_})=>V().openSession(i,n,t,a,_)).register("start",()=>V().start()).register("stop",()=>V().stop()).register("takeSnapshot",(i,t)=>{const n=V().takeSnapshot();if(!n)throw new Error("unable to take snapshot");const[a,_]=n;return t(_),a}).register("refreshSnapshot",(i,t)=>{const[n,a]=V().refreshSnapshot(i);return t(a),n}).register("waitForPendingSnapshot",()=>V().waitForPendingSnapshot()).register("getMemorySize",()=>({memory:V().getMemorySize(),nand:V().getNandSize()})).register("sdCardInsert",({data:i,key:t})=>V().sdCardInsert(i,t)).register("sdCardEject",()=>V().sdCardEject()).register("getSdCardState",()=>{if(!V().sdCardInserted())return{inserted:!1};const i=V().getSdCardKey();if(void 0===i)throw new Error("unreachable");return{inserted:!0,key:i}}).register("installDb",i=>V().installDb(i)).register("backup",({includeRom:i},t)=>{const n=V().backup(i);return n&&t([n.archive.buffer]),n}).register("getSdCardData",(i,t)=>{const n=V().getSdCardData();return n&&t([n.buffer]),n}).register("getFullState",(i,t)=>{const n=V().getFullState();return t([n.rom.buffer,n.memory.buffer,n.nand.buffer,n.savestate.buffer]),n}),addEventListener("message",function Xe(i){return be.apply(this,arguments)}),se({type:"ready"})})()})();
//# sourceMappingURL=9689.3e982b7205e314b7.js.map