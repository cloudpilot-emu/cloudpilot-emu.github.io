{"version":3,"sources":["webpack:///src/app/tabs/tabs.page.ts","webpack:///src/app/tabs/tabs.module.ts","webpack:///src/app/tabs/tabs-routing.module.ts","webpack:///src/app/tabs/tabs.page.html","webpack:///src/app/service/canvas-display.service.ts"],"names":["TabsPage","TabsPageModule","TabsPageRoutingModule","routes","path","component","router","canvasDisplayService","updateUseSmallUI","isMD","document","querySelector","headerHeight","this","useSmallUI","canvasArea","window","innerHeight","innerWidth","addEventListener","url","availableHeight","availableWidth","scaledWidth","scaledHeight","Math","min","height","devicePixelRatio","width","children","loadChildren","then","m","EmulationPageModule","SessionsPageModule","SettingsPageModule","AboutPageModule","redirectTo","pathMatch","forChild","BACKGROUND_COLOR_SILKSCREEN","BACKGROUND_COLOR_GRAYSCALE_DEVICE","loadImage","Promise","resolve","reject","image","Image","onload","onerror","src","prerenderedButtonFactor","sizes","Map","screenSize","has","set","canvas","createElement","ctx","getContext","Error","drawImage","get","IMAGE_SILKSCREEN_V","IMAGE_SILKSCREEN_M515","IMAGE_SILKSCREEN_IIIC","IMAGE_SILKSCREEN_M130","IMAGE_BUTTONS_V","IMAGE_BUTTONS_M515","IMAGE_BUTTONS_IIIC","IMAGE_BUTTONS_M130","DEFAULT_DIMENSIONS","m515","forEach","prerender","CanvasDisplayService","dimensions","scale","border","silkscreenHeight","separator","buttonsHeight","session","device","backgroundColor","fillCanvasRect","drawSilkscreen","drawButtons","silkscreenImage","fillRect","imageSmoothingEnabled","imageSmoothingQuality","snapshotStatistics","emulationStatistics","beginPath","fontFactor","font","fillStyle","Date","timestamp","toLocaleTimeString","pages","timeTotal","toFixed","timeBlocking","hostSpeed","emulationSpeed","averageFPS","line","i","fillText","activeButtons","ystart","buttonWidth","buttonsImage","includes","e","clip","contentX","contentY","contentWidth","contentHeight","bb","getBoundingClientRect","top","left","x","floor","clientX","y","clientY","totalHeight","style","rect","fill","iiic","i710","m130","palmV"],"mappings":"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","file":"x","sourcesContent":["import { CanvasDisplayService } from './../service/canvas-display.service';\nimport { Component } from '@angular/core';\nimport { Router } from '@angular/router';\n\n@Component({\n    selector: 'app-tabs',\n    templateUrl: 'tabs.page.html',\n    styleUrls: ['tabs.page.scss'],\n})\nexport class TabsPage {\n    constructor(private router: Router, private canvasDisplayService: CanvasDisplayService) {\n        window.addEventListener('resize', this.updateUseSmallUI);\n\n        this.updateUseSmallUI();\n    }\n\n    get smallUI(): boolean {\n        return this.router.url === '/tab/emulation' && this.useSmallUI;\n    }\n\n    private updateUseSmallUI = (): void => {\n        const isMD = !!document.querySelector('html.md');\n        const headerHeight = isMD ? 56 : 44;\n        const tabbarHeight = isMD ? 57 : 51;\n        const canvasPadding = 6;\n\n        this.useSmallUI =\n            this.canvasArea(window.innerHeight - headerHeight - tabbarHeight - canvasPadding, window.innerWidth - 6) <\n            this.canvasArea(window.innerHeight - headerHeight - 25 - canvasPadding, window.innerWidth - 6);\n    };\n\n    private canvasArea(availableHeight: number, availableWidth: number): number {\n        availableHeight = Math.min(availableHeight, this.canvasDisplayService.height / devicePixelRatio);\n        availableWidth = Math.min(availableWidth, this.canvasDisplayService.width / devicePixelRatio);\n\n        let scaledWidth: number;\n        let scaledHeight: number;\n\n        if (availableWidth / availableHeight > this.canvasDisplayService.width / this.canvasDisplayService.height) {\n            scaledHeight = availableHeight;\n            scaledWidth = (availableHeight / this.canvasDisplayService.height) * this.canvasDisplayService.width;\n        } else {\n            scaledWidth = availableWidth;\n            scaledHeight = (availableWidth / this.canvasDisplayService.width) * this.canvasDisplayService.height;\n        }\n\n        return scaledWidth * scaledHeight;\n    }\n\n    private useSmallUI = false;\n}\n","import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { IonicModule } from '@ionic/angular';\nimport { NgModule } from '@angular/core';\nimport { TabsPage } from './tabs.page';\nimport { TabsPageRoutingModule } from './tabs-routing.module';\n\n@NgModule({\n    imports: [IonicModule, CommonModule, FormsModule, TabsPageRoutingModule],\n    declarations: [TabsPage],\n})\nexport class TabsPageModule {}\n","import { RouterModule, Routes } from '@angular/router';\n\nimport { NgModule } from '@angular/core';\nimport { TabsPage } from './tabs.page';\n\nconst routes: Routes = [\n    {\n        path: 'tab',\n        component: TabsPage,\n        children: [\n            {\n                path: 'emulation',\n                loadChildren: () => import('../page/emulation/emulation.module').then((m) => m.EmulationPageModule),\n            },\n            {\n                path: 'sessions',\n                loadChildren: () => import('../page/sessions/sessions.module').then((m) => m.SessionsPageModule),\n            },\n            {\n                path: 'settings',\n                loadChildren: () => import('../page/settings/settings.module').then((m) => m.SettingsPageModule),\n            },\n            {\n                path: 'about',\n                loadChildren: () => import('../page/about/about.module').then((m) => m.AboutPageModule),\n            },\n            {\n                path: '',\n                redirectTo: '/tab/sessions',\n                pathMatch: 'full',\n            },\n        ],\n    },\n    {\n        path: '',\n        redirectTo: '/tab/sessions',\n        pathMatch: 'full',\n    },\n];\n\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule],\n})\nexport class TabsPageRoutingModule {}\n","<ion-tabs>\n\n  <div class=\"overflow-wrapper\">\n    <ion-tab-bar [class.small-ui]=\"smallUI\" slot=\"bottom\">\n      <ion-tab-button tab=\"emulation\">\n        <ion-icon name=\"phone-portrait-outline\"></ion-icon>\n        <ion-label>Emulator</ion-label>\n      </ion-tab-button>\n\n      <ion-tab-button tab=\"sessions\">\n        <ion-icon name=\"albums-outline\"></ion-icon>\n        <ion-label>Sessions</ion-label>\n      </ion-tab-button>\n\n      <ion-tab-button tab=\"settings\">\n        <ion-icon name=\"cog-outline\"></ion-icon>\n        <ion-label>Settings</ion-label>\n      </ion-tab-button>\n\n      <ion-tab-button tab=\"about\">\n        <ion-icon name=\"help-outline\"></ion-icon>\n        <ion-label>About</ion-label>\n      </ion-tab-button>\n    </ion-tab-bar>\n  </div>\n\n</ion-tabs>\n","import { DeviceId, isColor } from '../model/DeviceId';\n\nimport { EmulationStatistics } from './../model/EmulationStatistics';\nimport { GRAYSCALE_PALETTE_HEX } from './emulation.service';\nimport { Injectable } from '@angular/core';\nimport { PalmButton } from '../helper/Cloudpilot';\nimport { ScreenSize } from '../model/Dimensions';\nimport { Session } from '../model/Session';\nimport { SnapshotStatistics } from './../model/SnapshotStatistics';\nimport { deviceDimensions } from '../helper/deviceProperties';\n\nconst BACKGROUND_COLOR_SILKSCREEN = GRAYSCALE_PALETTE_HEX[2];\nconst BACKGROUND_COLOR_GRAYSCALE_DEVICE = GRAYSCALE_PALETTE_HEX[0];\nconst BACKGROUND_COLOR_COLOR_DEVICE = 'white';\nconst BACKGROUND_ACTIVE_BUTTON = 'rgba(0,0,0,0.2)';\n\nfunction loadImage(url: string): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const image = new Image();\n\n        image.onload = () => resolve(image);\n        image.onerror = () => reject();\n\n        image.src = url;\n    });\n}\n\nasync function prerenderedButton(url: string, screenSize: ScreenSize): Promise<HTMLCanvasElement> {\n    const canvas = document.createElement('canvas');\n    canvas.width = (screenSize === ScreenSize.screen320x320 ? 640 : 480) * devicePixelRatio;\n    canvas.height = (screenSize === ScreenSize.screen320x320 ? 120 : 90) * devicePixelRatio;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) throw new Error('get a new browser');\n\n    ctx.drawImage(await loadImage(url), 0, 0, canvas.width, canvas.height);\n\n    return canvas;\n}\n\nfunction prerenderedButtonFactor(url: string) {\n    const sizes = new Map<ScreenSize, Promise<HTMLCanvasElement>>();\n\n    return (screenSize: ScreenSize): Promise<HTMLCanvasElement> => {\n        if (!sizes.has(screenSize)) sizes.set(screenSize, prerenderedButton(url, screenSize));\n\n        return sizes.get(screenSize)!;\n    };\n}\n\nconst IMAGE_SILKSCREEN_V = loadImage('assets/skin/silkscreen/v.svg');\nconst IMAGE_SILKSCREEN_M515 = loadImage('assets/skin/silkscreen/m515.svg');\nconst IMAGE_SILKSCREEN_IIIC = loadImage('assets/skin/silkscreen/iiic.svg');\nconst IMAGE_SILKSCREEN_M130 = loadImage('assets/skin/silkscreen/m130.svg');\n\nconst IMAGE_BUTTONS_V = prerenderedButtonFactor('assets/skin/hard-buttons/v.svg');\nconst IMAGE_BUTTONS_M515 = prerenderedButtonFactor('assets/skin/hard-buttons/m515.svg');\nconst IMAGE_BUTTONS_IIIC = prerenderedButtonFactor('assets/skin/hard-buttons/iiic.svg');\nconst IMAGE_BUTTONS_M130 = prerenderedButtonFactor('assets/skin/hard-buttons/m130.svg');\n\nconst DEFAULT_DIMENSIONS = deviceDimensions(DeviceId.m515);\n\n[IMAGE_BUTTONS_IIIC, IMAGE_BUTTONS_V, IMAGE_BUTTONS_M130, IMAGE_BUTTONS_M515].forEach((prerender) => {\n    prerender(ScreenSize.screen160x160);\n    prerender(ScreenSize.screen320x320);\n});\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CanvasDisplayService {\n    constructor() {}\n\n    get scale(): number {\n        return (this.dimensions.screenSize === ScreenSize.screen320x320 ? 2 : 3) * devicePixelRatio;\n    }\n\n    get border(): number {\n        return 1 * this.scale;\n    }\n\n    get width(): number {\n        return this.scale * this.dimensions.width + 2 * this.border;\n    }\n\n    get separator(): number {\n        return this.dimensions.screenSize === ScreenSize.screen320x320 ? 2 : 1;\n    }\n\n    get buttonsHeight(): number {\n        return this.dimensions.screenSize === ScreenSize.screen320x320 ? 60 : 30;\n    }\n\n    get height(): number {\n        return (\n            this.scale *\n                (this.dimensions.height + this.dimensions.silkscreenHeight + this.separator + this.buttonsHeight) +\n            2 * this.border\n        );\n    }\n\n    async initialize(canvas: HTMLCanvasElement, session: Session | undefined): Promise<void> {\n        this.dimensions = session ? deviceDimensions(session.device) : DEFAULT_DIMENSIONS;\n\n        canvas.width = this.width;\n        canvas.height = this.height;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('canvas not supported - get a new browser');\n        }\n\n        this.ctx = ctx;\n\n        this.session = session;\n        this.fillCanvasRect(0, 0, this.width, this.height, this.backgroundColor());\n\n        await this.drawSilkscreen();\n        await this.drawButtons();\n    }\n\n    async drawSilkscreen(): Promise<void> {\n        if (!this.ctx) return;\n\n        const image = await this.silkscreenImage();\n\n        this.fillRect(\n            0,\n            this.dimensions.height + this.separator,\n            this.dimensions.width,\n            this.dimensions.silkscreenHeight,\n            BACKGROUND_COLOR_SILKSCREEN\n        );\n\n        this.ctx.imageSmoothingEnabled = true;\n        this.ctx.imageSmoothingQuality = 'high';\n\n        this.ctx.drawImage(\n            image,\n            this.border,\n            this.border + (this.dimensions.height + this.separator) * this.scale,\n            this.dimensions.width * this.scale,\n            this.dimensions.silkscreenHeight * this.scale\n        );\n    }\n\n    async drawStatistics(\n        snapshotStatistics?: SnapshotStatistics,\n        emulationStatistics?: EmulationStatistics\n    ): Promise<void> {\n        if (!this.ctx) return;\n\n        await this.drawSilkscreen();\n\n        this.ctx.beginPath();\n        this.fillRect(\n            0,\n            this.dimensions.height + this.separator,\n            this.dimensions.width,\n            this.dimensions.silkscreenHeight,\n            'rgba(255,255,255,0.6)'\n        );\n\n        const fontFactor = this.dimensions.screenSize === ScreenSize.screen320x320 ? 2 : 1;\n\n        this.ctx.font = `${this.scale * 6 * fontFactor}px monospace`;\n        this.ctx.fillStyle = 'black';\n        [\n            ...(!snapshotStatistics && !emulationStatistics ? ['collecting statistics...'] : []),\n            ...(snapshotStatistics\n                ? [\n                      `last snapshot          : ${new Date(snapshotStatistics.timestamp).toLocaleTimeString()}`,\n                      `snapshot pages         : ${snapshotStatistics.pages}`,\n                      `snapshot time total    : ${snapshotStatistics.timeTotal.toFixed(2)} msec`,\n                      `snapshot time blocking : ${snapshotStatistics.timeBlocking.toFixed(2)} msec`,\n                  ]\n                : []),\n            ...(emulationStatistics\n                ? [\n                      `host speed             : ${emulationStatistics.hostSpeed.toFixed(2)}x`,\n                      `emulation speed        : ${emulationStatistics.emulationSpeed.toFixed(2)}x`,\n                      `average FPS            : ${emulationStatistics.averageFPS.toFixed(2)}`,\n                  ]\n                : []),\n        ].forEach((line, i) =>\n            this.ctx!.fillText(\n                line,\n                this.border + fontFactor * this.scale,\n                this.border + (this.dimensions.height + fontFactor * (8 + i * 6)) * this.scale\n            )\n        );\n    }\n\n    async drawButtons(activeButtons: Array<PalmButton> = []): Promise<void> {\n        if (!this.ctx) return;\n\n        const ystart = this.dimensions.height + this.dimensions.silkscreenHeight + this.separator;\n        const buttonWidth = this.dimensions.screenSize === ScreenSize.screen320x320 ? 60 : 30;\n\n        this.ctx.drawImage(\n            await this.buttonsImage(),\n            this.border,\n            this.border + this.scale * ystart,\n            this.dimensions.width * this.scale,\n            this.buttonsHeight * this.scale\n        );\n\n        if (activeButtons.includes(PalmButton.cal)) {\n            this.fillRect(0, ystart, buttonWidth, this.buttonsHeight, BACKGROUND_ACTIVE_BUTTON);\n        }\n        if (activeButtons.includes(PalmButton.phone)) {\n            this.fillRect(buttonWidth, ystart, buttonWidth, this.buttonsHeight, BACKGROUND_ACTIVE_BUTTON);\n        }\n        if (activeButtons.includes(PalmButton.todo)) {\n            this.fillRect(\n                this.dimensions.width - 2 * buttonWidth,\n                ystart,\n                buttonWidth,\n                this.buttonsHeight,\n                BACKGROUND_ACTIVE_BUTTON\n            );\n        }\n        if (activeButtons.includes(PalmButton.notes)) {\n            this.fillRect(\n                this.dimensions.width - buttonWidth,\n                ystart,\n                buttonWidth,\n                this.buttonsHeight,\n                BACKGROUND_ACTIVE_BUTTON\n            );\n        }\n        if (activeButtons.includes(PalmButton.up)) {\n            this.fillRect(\n                2 * buttonWidth,\n                ystart,\n                this.dimensions.width - 4 * buttonWidth,\n                this.buttonsHeight / 2,\n                BACKGROUND_ACTIVE_BUTTON\n            );\n        }\n        if (activeButtons.includes(PalmButton.down)) {\n            this.fillRect(\n                2 * buttonWidth,\n                ystart + this.buttonsHeight / 2,\n                this.dimensions.width - 4 * buttonWidth,\n                this.buttonsHeight / 2,\n                BACKGROUND_ACTIVE_BUTTON\n            );\n        }\n    }\n\n    drawEmulationCanvas(canvas: HTMLCanvasElement): void {\n        if (!this.ctx) return;\n\n        this.ctx.imageSmoothingEnabled = false;\n        this.ctx.drawImage(\n            canvas,\n            this.border,\n            this.border,\n            this.scale * this.dimensions.width,\n            this.scale * this.dimensions.height\n        );\n    }\n\n    eventToPalmCoordinates(e: MouseEvent | Touch, clip = false): [number, number] | undefined {\n        if (!this.ctx) return;\n\n        const bb = this.ctx.canvas.getBoundingClientRect();\n\n        let contentX: number;\n        let contentY: number;\n        let contentWidth: number;\n        let contentHeight: number;\n\n        // CSS object-fit keeps the aspect ratio of the canvas content, but the canvas itself\n        // looses aspect and fills the container -> manually calculate the metrics for the content\n        if (bb.width / bb.height > this.width / this.height) {\n            contentHeight = bb.height;\n            contentWidth = (this.width / this.height) * bb.height;\n            contentY = bb.top;\n            contentX = bb.left + (bb.width - contentWidth) / 2;\n        } else {\n            contentWidth = bb.width;\n            contentHeight = (this.height / this.width) * bb.width;\n            contentX = bb.left;\n            contentY = bb.top + (bb.height - contentHeight) / 2;\n        }\n\n        // Compensate for the border\n        let x =\n            Math.floor((((e.clientX - contentX) / contentWidth) * this.width) / this.scale) - this.border / this.scale;\n        let y =\n            Math.floor((((e.clientY - contentY) / contentHeight) * this.height) / this.scale) -\n            this.border / this.scale;\n\n        // The canvas layout inside the border is as follows:\n        //\n        // * 0 .. 159   : LCD\n        // * 160        : separator\n        // * 161 .. 220 : silkscreen\n        // * 221 .. 250 : buttons\n        //\n        // we map this to 160x250 lines by mapping the separator to the silkscreen\n\n        if (y >= this.dimensions.height + this.separator) y -= 1;\n\n        const totalHeight = this.dimensions.height + this.dimensions.silkscreenHeight + this.buttonsHeight;\n\n        if (clip) {\n            if (x < 0) x = 0;\n            if (x >= this.dimensions.width) x = this.dimensions.width - 1;\n            if (y < 0) y = 0;\n            if (y >= totalHeight) {\n                y = this.dimensions.height + this.dimensions.silkscreenHeight - 1;\n            }\n        } else {\n            if (x < 0 || x >= this.dimensions.width || y < 0 || y >= totalHeight) {\n                return undefined;\n            }\n        }\n\n        return [x, y];\n    }\n\n    isButtons([, y]: [number, number]): boolean {\n        return y >= this.dimensions.height + this.dimensions.silkscreenHeight;\n    }\n\n    determineButton([x, y]: [number, number]): PalmButton {\n        const buttonWidth = this.dimensions.screenSize === ScreenSize.screen320x320 ? 60 : 30;\n\n        if (x >= this.dimensions.width - buttonWidth) return PalmButton.notes;\n        if (x >= this.dimensions.width - 2 * buttonWidth) return PalmButton.todo;\n        if (x >= 2 * buttonWidth) {\n            return y >=\n                this.dimensions.height + this.dimensions.silkscreenHeight + this.separator + this.buttonsHeight / 2\n                ? PalmButton.down\n                : PalmButton.up;\n        }\n        if (x >= buttonWidth) return PalmButton.phone;\n\n        return PalmButton.cal;\n    }\n\n    private fillRect(x: number, y: number, width: number, height: number, style: string): void {\n        if (!this.ctx) return;\n\n        this.ctx.beginPath();\n        this.ctx.rect(\n            this.border + this.scale * x,\n            this.border + this.scale * y,\n            this.scale * width,\n            this.scale * height\n        );\n        this.ctx.fillStyle = style;\n        this.ctx.fill();\n    }\n\n    private fillCanvasRect(x: number, y: number, width: number, height: number, style: string): void {\n        if (!this.ctx) return;\n\n        this.ctx.beginPath();\n        this.ctx.rect(x, y, width, height);\n        this.ctx.fillStyle = style;\n        this.ctx.fill();\n    }\n\n    private silkscreenImage(): Promise<HTMLImageElement> {\n        switch (this.session?.device) {\n            case DeviceId.m515:\n                return IMAGE_SILKSCREEN_M515;\n\n            case DeviceId.iiic:\n                return IMAGE_SILKSCREEN_IIIC;\n\n            case DeviceId.i710:\n            case DeviceId.m130:\n                return IMAGE_SILKSCREEN_M130;\n\n            case DeviceId.palmV:\n            default:\n                return IMAGE_SILKSCREEN_V;\n        }\n    }\n\n    private buttonsImage(): Promise<HTMLCanvasElement> {\n        switch (this.session?.device) {\n            case DeviceId.m515:\n            case DeviceId.i710:\n                return IMAGE_BUTTONS_M515(this.dimensions.screenSize);\n\n            case DeviceId.iiic:\n                return IMAGE_BUTTONS_IIIC(this.dimensions.screenSize);\n\n            case DeviceId.m130:\n                return IMAGE_BUTTONS_M130(this.dimensions.screenSize);\n\n            case DeviceId.palmV:\n            default:\n                return IMAGE_BUTTONS_V(this.dimensions.screenSize);\n        }\n    }\n\n    private backgroundColor(): string {\n        return isColor(this.session?.device) ? BACKGROUND_COLOR_COLOR_DEVICE : BACKGROUND_COLOR_GRAYSCALE_DEVICE;\n    }\n\n    private ctx: CanvasRenderingContext2D | undefined;\n    private session: Session | undefined;\n\n    private dimensions = DEFAULT_DIMENSIONS;\n}\n"]}